<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>yolov5Ê∫êÁ†ÅËØ¶Ëß£</title>
    <link href="/2022/10/21/yolov5%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/"/>
    <url>/2022/10/21/yolov5%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="yolo.yaml">yolo.yaml</h1><ul><li>‰ª•yolov5s.yaml‰∏∫‰æã</li></ul><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-comment"># YOLOv5 üöÄ by Ultralytics, GPL-3.0 license</span><br><br><span class="hljs-comment"># Parameters</span><br><span class="hljs-attr">nc:</span> <span class="hljs-number">80</span>  <span class="hljs-comment"># number of classes</span><br><span class="hljs-attr">depth_multiple:</span> <span class="hljs-number">0.33</span>  <span class="hljs-comment"># model depth multiple</span><br><span class="hljs-attr">width_multiple:</span> <span class="hljs-number">0.50</span>  <span class="hljs-comment"># layer channel multiple</span><br><span class="hljs-attr">anchors:</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">10</span>,<span class="hljs-number">13</span>, <span class="hljs-number">16</span>,<span class="hljs-number">30</span>, <span class="hljs-number">33</span>,<span class="hljs-number">23</span>]  <span class="hljs-comment"># P3/8</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">30</span>,<span class="hljs-number">61</span>, <span class="hljs-number">62</span>,<span class="hljs-number">45</span>, <span class="hljs-number">59</span>,<span class="hljs-number">119</span>]  <span class="hljs-comment"># P4/16</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">116</span>,<span class="hljs-number">90</span>, <span class="hljs-number">156</span>,<span class="hljs-number">198</span>, <span class="hljs-number">373</span>,<span class="hljs-number">326</span>]  <span class="hljs-comment"># P5/32</span><br><br><span class="hljs-comment"># YOLOv5 v6.0 backbone</span><br><span class="hljs-attr">backbone:</span><br>  <span class="hljs-comment"># [from, number, module, args]</span><br>  [[<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">64</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>]],  <span class="hljs-comment"># 0-P1/2</span><br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">128</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]],  <span class="hljs-comment"># 1-P2/4</span><br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">C3</span>, [<span class="hljs-number">128</span>]],<br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">256</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]],  <span class="hljs-comment"># 3-P3/8</span><br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">6</span>, <span class="hljs-string">C3</span>, [<span class="hljs-number">256</span>]],<br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">512</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]],  <span class="hljs-comment"># 5-P4/16</span><br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">9</span>, <span class="hljs-string">C3</span>, [<span class="hljs-number">512</span>]],<br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">1024</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]],  <span class="hljs-comment"># 7-P5/32</span><br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">C3</span>, [<span class="hljs-number">1024</span>]],<br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">SPPF</span>, [<span class="hljs-number">1024</span>, <span class="hljs-number">5</span>]],  <span class="hljs-comment"># 9</span><br>  ]<br><br><span class="hljs-comment"># YOLOv5 v6.0 head</span><br><span class="hljs-attr">head:</span><br>  [[<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">512</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]],<br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">nn.Upsample</span>, [<span class="hljs-string">None</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;nearest&#x27;</span>]],<br>   [[<span class="hljs-number">-1</span>, <span class="hljs-number">6</span>], <span class="hljs-number">1</span>, <span class="hljs-string">Concat</span>, [<span class="hljs-number">1</span>]],  <span class="hljs-comment"># cat backbone P4</span><br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">C3</span>, [<span class="hljs-number">512</span>, <span class="hljs-literal">False</span>]],  <span class="hljs-comment"># 13</span><br><br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">256</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]],<br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">nn.Upsample</span>, [<span class="hljs-string">None</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;nearest&#x27;</span>]],<br>   [[<span class="hljs-number">-1</span>, <span class="hljs-number">4</span>], <span class="hljs-number">1</span>, <span class="hljs-string">Concat</span>, [<span class="hljs-number">1</span>]],  <span class="hljs-comment"># cat backbone P3</span><br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">C3</span>, [<span class="hljs-number">256</span>, <span class="hljs-literal">False</span>]],  <span class="hljs-comment"># 17 (P3/8-small)</span><br><br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">256</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]],<br>   [[<span class="hljs-number">-1</span>, <span class="hljs-number">14</span>], <span class="hljs-number">1</span>, <span class="hljs-string">Concat</span>, [<span class="hljs-number">1</span>]],  <span class="hljs-comment"># cat head P4</span><br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">C3</span>, [<span class="hljs-number">512</span>, <span class="hljs-literal">False</span>]],  <span class="hljs-comment"># 20 (P4/16-medium)</span><br><br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">Conv</span>, [<span class="hljs-number">512</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>]],<br>   [[<span class="hljs-number">-1</span>, <span class="hljs-number">10</span>], <span class="hljs-number">1</span>, <span class="hljs-string">Concat</span>, [<span class="hljs-number">1</span>]],  <span class="hljs-comment"># cat head P5</span><br>   [<span class="hljs-number">-1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">C3</span>, [<span class="hljs-number">1024</span>, <span class="hljs-literal">False</span>]],  <span class="hljs-comment"># 23 (P5/32-large)</span><br><br>   [[<span class="hljs-number">17</span>, <span class="hljs-number">20</span>, <span class="hljs-number">23</span>], <span class="hljs-number">1</span>, <span class="hljs-string">Detect</span>, [<span class="hljs-string">nc</span>, <span class="hljs-string">anchors</span>]],  <span class="hljs-comment"># Detect(P3, P4, P5)</span><br>  ]<br><br></code></pre></div></td></tr></table></figure><h1 id="yolo.py">yolo.py</h1><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># È°πÁõÆÂú∞ÂùÄ‰øùÂ≠ò</span><br>FILE = Path(__file__).resolve()<br>ROOT = FILE.parents[<span class="hljs-number">1</span>]  <span class="hljs-comment"># YOLOv5 root directory</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(ROOT) <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> sys.path:<br>    sys.path.append(<span class="hljs-built_in">str</span>(ROOT))  <span class="hljs-comment"># add ROOT to PATH</span><br><span class="hljs-keyword">if</span> platform.system() != <span class="hljs-string">&#x27;Windows&#x27;</span>:<br>    ROOT = Path(os.path.relpath(ROOT, Path.cwd()))  <span class="hljs-comment"># relative</span><br>    <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Detect</span>(nn.Module):<br>    stride = <span class="hljs-literal">None</span>  <span class="hljs-comment"># strides computed during build</span><br>    onnx_dynamic = <span class="hljs-literal">False</span>  <span class="hljs-comment"># ONNX export parameter</span><br>    export = <span class="hljs-literal">False</span>  <span class="hljs-comment"># export mode</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, nc=<span class="hljs-number">80</span>, anchors=(<span class="hljs-params"></span>), ch=(<span class="hljs-params"></span>), inplace=<span class="hljs-literal">True</span></span>):  <span class="hljs-comment"># detection layer</span><br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.nc = nc  <span class="hljs-comment"># number of classes</span><br>        self.no = nc + <span class="hljs-number">5</span>  <span class="hljs-comment"># number of outputs per anchor</span><br>        self.nl = <span class="hljs-built_in">len</span>(anchors)  <span class="hljs-comment"># number of detection layers</span><br>        self.na = <span class="hljs-built_in">len</span>(anchors[<span class="hljs-number">0</span>]) // <span class="hljs-number">2</span>  <span class="hljs-comment"># number of anchors</span><br>        self.grid = [torch.zeros(<span class="hljs-number">1</span>)] * self.nl  <span class="hljs-comment"># init grid</span><br>        self.anchor_grid = [torch.zeros(<span class="hljs-number">1</span>)] * self.nl  <span class="hljs-comment"># init anchor grid</span><br>        self.register_buffer(<span class="hljs-string">&#x27;anchors&#x27;</span>, torch.tensor(anchors).<span class="hljs-built_in">float</span>().view(self.nl, -<span class="hljs-number">1</span>, <span class="hljs-number">2</span>))  <span class="hljs-comment"># shape(nl,na,2)</span><br>        self.m = nn.ModuleList(nn.Conv2d(x, self.no * self.na, <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> ch)  <span class="hljs-comment"># output conv</span><br>        self.inplace = inplace  <span class="hljs-comment"># use in-place ops (e.g. slice assignment)</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        z = []  <span class="hljs-comment"># inference output</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.nl):<br>            x[i] = self.m[i](x[i])  <span class="hljs-comment"># conv</span><br>            bs, _, ny, nx = x[i].shape  <span class="hljs-comment"># x(bs,255,20,20) to x(bs,3,20,20,85)</span><br>            x[i] = x[i].view(bs, self.na, self.no, ny, nx).permute(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>).contiguous()<br><br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.training:  <span class="hljs-comment"># inference</span><br>                <span class="hljs-keyword">if</span> self.onnx_dynamic <span class="hljs-keyword">or</span> self.grid[i].shape[<span class="hljs-number">2</span>:<span class="hljs-number">4</span>] != x[i].shape[<span class="hljs-number">2</span>:<span class="hljs-number">4</span>]:<br>                    self.grid[i], self.anchor_grid[i] = self._make_grid(nx, ny, i)<br><br>                y = x[i].sigmoid()<br>                <span class="hljs-keyword">if</span> self.inplace:<br>                    y[..., <span class="hljs-number">0</span>:<span class="hljs-number">2</span>] = (y[..., <span class="hljs-number">0</span>:<span class="hljs-number">2</span>] * <span class="hljs-number">2</span> + self.grid[i]) * self.stride[i]  <span class="hljs-comment"># xy</span><br>                    y[..., <span class="hljs-number">2</span>:<span class="hljs-number">4</span>] = (y[..., <span class="hljs-number">2</span>:<span class="hljs-number">4</span>] * <span class="hljs-number">2</span>) ** <span class="hljs-number">2</span> * self.anchor_grid[i]  <span class="hljs-comment"># wh</span><br>                <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># for YOLOv5 on AWS Inferentia https://github.com/ultralytics/yolov5/pull/2953</span><br>                    xy, wh, conf = y.split((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, self.nc + <span class="hljs-number">1</span>), <span class="hljs-number">4</span>)  <span class="hljs-comment"># y.tensor_split((2, 4, 5), 4)  # torch 1.8.0</span><br>                    xy = (xy * <span class="hljs-number">2</span> + self.grid[i]) * self.stride[i]  <span class="hljs-comment"># xy</span><br>                    wh = (wh * <span class="hljs-number">2</span>) ** <span class="hljs-number">2</span> * self.anchor_grid[i]  <span class="hljs-comment"># wh</span><br>                    y = torch.cat((xy, wh, conf), <span class="hljs-number">4</span>)<br>                z.append(y.view(bs, -<span class="hljs-number">1</span>, self.no))<br><br>        <span class="hljs-keyword">return</span> x <span class="hljs-keyword">if</span> self.training <span class="hljs-keyword">else</span> (torch.cat(z, <span class="hljs-number">1</span>),) <span class="hljs-keyword">if</span> self.export <span class="hljs-keyword">else</span> (torch.cat(z, <span class="hljs-number">1</span>), x)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_make_grid</span>(<span class="hljs-params">self, nx=<span class="hljs-number">20</span>, ny=<span class="hljs-number">20</span>, i=<span class="hljs-number">0</span></span>):<br>        d = self.anchors[i].device<br>        t = self.anchors[i].dtype<br>        shape = <span class="hljs-number">1</span>, self.na, ny, nx, <span class="hljs-number">2</span>  <span class="hljs-comment"># grid shape</span><br>        y, x = torch.arange(ny, device=d, dtype=t), torch.arange(nx, device=d, dtype=t)<br>        <span class="hljs-keyword">if</span> check_version(torch.__version__, <span class="hljs-string">&#x27;1.10.0&#x27;</span>):  <span class="hljs-comment"># torch&gt;=1.10.0 meshgrid workaround for torch&gt;=0.7 compatibility</span><br>            yv, xv = torch.meshgrid(y, x, indexing=<span class="hljs-string">&#x27;ij&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            yv, xv = torch.meshgrid(y, x)<br>        grid = torch.stack((xv, yv), <span class="hljs-number">2</span>).expand(shape) - <span class="hljs-number">0.5</span>  <span class="hljs-comment"># add grid offset, i.e. y = 2.0 * x - 0.5</span><br>        anchor_grid = (self.anchors[i] * self.stride[i]).view((<span class="hljs-number">1</span>, self.na, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)).expand(shape)<br>        <span class="hljs-keyword">return</span> grid, anchor_grid<br>    <br>    <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span>(nn.Module):<br>    <span class="hljs-comment"># YOLOv5 model</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, cfg=<span class="hljs-string">&#x27;yolov5s.yaml&#x27;</span>, ch=<span class="hljs-number">3</span>, nc=<span class="hljs-literal">None</span>, anchors=<span class="hljs-literal">None</span></span>):  <span class="hljs-comment"># model, input channels, number of classes</span><br>        <span class="hljs-built_in">super</span>().__init__()<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(cfg, <span class="hljs-built_in">dict</span>):<br>            self.yaml = cfg  <span class="hljs-comment"># model dict</span><br>        <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># is *.yaml</span><br>            <span class="hljs-keyword">import</span> yaml  <span class="hljs-comment"># for torch hub</span><br>            self.yaml_file = Path(cfg).name<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(cfg, encoding=<span class="hljs-string">&#x27;ascii&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                self.yaml = yaml.safe_load(f)  <span class="hljs-comment"># model dict</span><br><br>        <span class="hljs-comment"># Define model</span><br>        ch = self.yaml[<span class="hljs-string">&#x27;ch&#x27;</span>] = self.yaml.get(<span class="hljs-string">&#x27;ch&#x27;</span>, ch)  <span class="hljs-comment"># input channelsÔºåÂ¶ÇÊûúyamlÊñá‰ª∂‰∏≠Ê≤°ÊúâchÔºåÂàôÂÜôÂÖ•</span><br>        <span class="hljs-keyword">if</span> nc <span class="hljs-keyword">and</span> nc != self.yaml[<span class="hljs-string">&#x27;nc&#x27;</span>]:<br>            LOGGER.info(<span class="hljs-string">f&quot;Overriding model.yaml nc=<span class="hljs-subst">&#123;self.yaml[<span class="hljs-string">&#x27;nc&#x27;</span>]&#125;</span> with nc=<span class="hljs-subst">&#123;nc&#125;</span>&quot;</span>)<br>            self.yaml[<span class="hljs-string">&#x27;nc&#x27;</span>] = nc  <span class="hljs-comment"># override yaml value</span><br>        <span class="hljs-keyword">if</span> anchors:<br>            LOGGER.info(<span class="hljs-string">f&#x27;Overriding model.yaml anchors with anchors=<span class="hljs-subst">&#123;anchors&#125;</span>&#x27;</span>)<br>            self.yaml[<span class="hljs-string">&#x27;anchors&#x27;</span>] = <span class="hljs-built_in">round</span>(anchors)  <span class="hljs-comment"># override yaml valueÔºåround()ÂõõËàç‰∫îÂÖ•</span><br>        self.model, self.save = parse_model(deepcopy(self.yaml), ch=[ch])  <span class="hljs-comment"># model, savelist</span><br>        self.names = [<span class="hljs-built_in">str</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.yaml[<span class="hljs-string">&#x27;nc&#x27;</span>])]  <span class="hljs-comment"># default names</span><br>        self.inplace = self.yaml.get(<span class="hljs-string">&#x27;inplace&#x27;</span>, <span class="hljs-literal">True</span>)<br><br>        <span class="hljs-comment"># Build strides, anchors</span><br>        m = self.model[-<span class="hljs-number">1</span>]  <span class="hljs-comment"># Detect()</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(m, Detect):<br>            s = <span class="hljs-number">256</span>  <span class="hljs-comment"># 2x min stride</span><br>            m.inplace = self.inplace<br>            m.stride = torch.tensor([s / x.shape[-<span class="hljs-number">2</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> self.forward(torch.zeros(<span class="hljs-number">1</span>, ch, s, s))])  <span class="hljs-comment"># forward</span><br>            check_anchor_order(m)  <span class="hljs-comment"># must be in pixel-space (not grid-space)</span><br>            m.anchors /= m.stride.view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>            self.stride = m.stride<br>            self._initialize_biases()  <span class="hljs-comment"># only run once</span><br><br>        <span class="hljs-comment"># Init weights, biases</span><br>        initialize_weights(self)<br>        self.info()<br>        LOGGER.info(<span class="hljs-string">&#x27;&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x, augment=<span class="hljs-literal">False</span>, profile=<span class="hljs-literal">False</span>, visualize=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-keyword">if</span> augment:<br>            <span class="hljs-keyword">return</span> self._forward_augment(x)  <span class="hljs-comment"># augmented inference, None</span><br>        <span class="hljs-keyword">return</span> self._forward_once(x, profile, visualize)  <span class="hljs-comment"># single-scale inference, train</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_forward_augment</span>(<span class="hljs-params">self, x</span>):<br>        img_size = x.shape[-<span class="hljs-number">2</span>:]  <span class="hljs-comment"># height, width</span><br>        s = [<span class="hljs-number">1</span>, <span class="hljs-number">0.83</span>, <span class="hljs-number">0.67</span>]  <span class="hljs-comment"># scales</span><br>        f = [<span class="hljs-literal">None</span>, <span class="hljs-number">3</span>, <span class="hljs-literal">None</span>]  <span class="hljs-comment"># flips (2-ud, 3-lr)</span><br>        y = []  <span class="hljs-comment"># outputs</span><br>        <span class="hljs-keyword">for</span> si, fi <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(s, f):<br>            xi = scale_img(x.flip(fi) <span class="hljs-keyword">if</span> fi <span class="hljs-keyword">else</span> x, si, gs=<span class="hljs-built_in">int</span>(self.stride.<span class="hljs-built_in">max</span>()))<br>            yi = self._forward_once(xi)[<span class="hljs-number">0</span>]  <span class="hljs-comment"># forward</span><br>            <span class="hljs-comment"># cv2.imwrite(f&#x27;img_&#123;si&#125;.jpg&#x27;, 255 * xi[0].cpu().numpy().transpose((1, 2, 0))[:, :, ::-1])  # save</span><br>            yi = self._descale_pred(yi, fi, si, img_size)<br>            y.append(yi)<br>        y = self._clip_augmented(y)  <span class="hljs-comment"># clip augmented tails</span><br>        <span class="hljs-keyword">return</span> torch.cat(y, <span class="hljs-number">1</span>), <span class="hljs-literal">None</span>  <span class="hljs-comment"># augmented inference, train</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_forward_once</span>(<span class="hljs-params">self, x, profile=<span class="hljs-literal">False</span>, visualize=<span class="hljs-literal">False</span></span>):<br>        y, dt = [], []  <span class="hljs-comment"># outputs</span><br>        <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> self.model:<br>            <span class="hljs-keyword">if</span> m.f != -<span class="hljs-number">1</span>:  <span class="hljs-comment"># if not from previous layer</span><br>                x = y[m.f] <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(m.f, <span class="hljs-built_in">int</span>) <span class="hljs-keyword">else</span> [x <span class="hljs-keyword">if</span> j == -<span class="hljs-number">1</span> <span class="hljs-keyword">else</span> y[j] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> m.f]  <span class="hljs-comment"># from earlier layers</span><br>            <span class="hljs-keyword">if</span> profile:<br>                self._profile_one_layer(m, x, dt)<br>            x = m(x)  <span class="hljs-comment"># run</span><br>            y.append(x <span class="hljs-keyword">if</span> m.i <span class="hljs-keyword">in</span> self.save <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>)  <span class="hljs-comment"># save output</span><br>            <span class="hljs-keyword">if</span> visualize:<br>                feature_visualization(x, m.<span class="hljs-built_in">type</span>, m.i, save_dir=visualize)<br>        <span class="hljs-keyword">return</span> x<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_descale_pred</span>(<span class="hljs-params">self, p, flips, scale, img_size</span>):<br>        <span class="hljs-comment"># de-scale predictions following augmented inference (inverse operation)</span><br>        <span class="hljs-keyword">if</span> self.inplace:<br>            p[..., :<span class="hljs-number">4</span>] /= scale  <span class="hljs-comment"># de-scale</span><br>            <span class="hljs-keyword">if</span> flips == <span class="hljs-number">2</span>:<br>                p[..., <span class="hljs-number">1</span>] = img_size[<span class="hljs-number">0</span>] - p[..., <span class="hljs-number">1</span>]  <span class="hljs-comment"># de-flip ud</span><br>            <span class="hljs-keyword">elif</span> flips == <span class="hljs-number">3</span>:<br>                p[..., <span class="hljs-number">0</span>] = img_size[<span class="hljs-number">1</span>] - p[..., <span class="hljs-number">0</span>]  <span class="hljs-comment"># de-flip lr</span><br>        <span class="hljs-keyword">else</span>:<br>            x, y, wh = p[..., <span class="hljs-number">0</span>:<span class="hljs-number">1</span>] / scale, p[..., <span class="hljs-number">1</span>:<span class="hljs-number">2</span>] / scale, p[..., <span class="hljs-number">2</span>:<span class="hljs-number">4</span>] / scale  <span class="hljs-comment"># de-scale</span><br>            <span class="hljs-keyword">if</span> flips == <span class="hljs-number">2</span>:<br>                y = img_size[<span class="hljs-number">0</span>] - y  <span class="hljs-comment"># de-flip ud</span><br>            <span class="hljs-keyword">elif</span> flips == <span class="hljs-number">3</span>:<br>                x = img_size[<span class="hljs-number">1</span>] - x  <span class="hljs-comment"># de-flip lr</span><br>            p = torch.cat((x, y, wh, p[..., <span class="hljs-number">4</span>:]), -<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">return</span> p<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_clip_augmented</span>(<span class="hljs-params">self, y</span>):<br>        <span class="hljs-comment"># Clip YOLOv5 augmented inference tails</span><br>        nl = self.model[-<span class="hljs-number">1</span>].nl  <span class="hljs-comment"># number of detection layers (P3-P5)</span><br>        g = <span class="hljs-built_in">sum</span>(<span class="hljs-number">4</span> ** x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(nl))  <span class="hljs-comment"># grid points</span><br>        e = <span class="hljs-number">1</span>  <span class="hljs-comment"># exclude layer count</span><br>        i = (y[<span class="hljs-number">0</span>].shape[<span class="hljs-number">1</span>] // g) * <span class="hljs-built_in">sum</span>(<span class="hljs-number">4</span> ** x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(e))  <span class="hljs-comment"># indices</span><br>        y[<span class="hljs-number">0</span>] = y[<span class="hljs-number">0</span>][:, :-i]  <span class="hljs-comment"># large</span><br>        i = (y[-<span class="hljs-number">1</span>].shape[<span class="hljs-number">1</span>] // g) * <span class="hljs-built_in">sum</span>(<span class="hljs-number">4</span> ** (nl - <span class="hljs-number">1</span> - x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(e))  <span class="hljs-comment"># indices</span><br>        y[-<span class="hljs-number">1</span>] = y[-<span class="hljs-number">1</span>][:, i:]  <span class="hljs-comment"># small</span><br>        <span class="hljs-keyword">return</span> y<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_profile_one_layer</span>(<span class="hljs-params">self, m, x, dt</span>):<br>        c = <span class="hljs-built_in">isinstance</span>(m, Detect)  <span class="hljs-comment"># is final layer, copy input as inplace fix</span><br>        o = thop.profile(m, inputs=(x.copy() <span class="hljs-keyword">if</span> c <span class="hljs-keyword">else</span> x,), verbose=<span class="hljs-literal">False</span>)[<span class="hljs-number">0</span>] / <span class="hljs-number">1E9</span> * <span class="hljs-number">2</span> <span class="hljs-keyword">if</span> thop <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>  <span class="hljs-comment"># FLOPs</span><br>        t = time_sync()<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>            m(x.copy() <span class="hljs-keyword">if</span> c <span class="hljs-keyword">else</span> x)<br>        dt.append((time_sync() - t) * <span class="hljs-number">100</span>)<br>        <span class="hljs-keyword">if</span> m == self.model[<span class="hljs-number">0</span>]:<br>            LOGGER.info(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;time (ms)&#x27;</span>:&gt;10s&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;GFLOPs&#x27;</span>:&gt;10s&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;params&#x27;</span>:&gt;10s&#125;</span>  <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;module&#x27;</span>&#125;</span>&quot;</span>)<br>        LOGGER.info(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;dt[-<span class="hljs-number">1</span>]:<span class="hljs-number">10.2</span>f&#125;</span> <span class="hljs-subst">&#123;o:<span class="hljs-number">10.2</span>f&#125;</span> <span class="hljs-subst">&#123;m.np:<span class="hljs-number">10.0</span>f&#125;</span>  <span class="hljs-subst">&#123;m.<span class="hljs-built_in">type</span>&#125;</span>&#x27;</span>)<br>        <span class="hljs-keyword">if</span> c:<br>            LOGGER.info(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-built_in">sum</span>(dt):<span class="hljs-number">10.2</span>f&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;-&#x27;</span>:&gt;10s&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;-&#x27;</span>:&gt;10s&#125;</span>  Total&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_initialize_biases</span>(<span class="hljs-params">self, cf=<span class="hljs-literal">None</span></span>):  <span class="hljs-comment"># initialize biases into Detect(), cf is class frequency</span><br>        <span class="hljs-comment"># https://arxiv.org/abs/1708.02002 section 3.3</span><br>        <span class="hljs-comment"># cf = torch.bincount(torch.tensor(np.concatenate(dataset.labels, 0)[:, 0]).long(), minlength=nc) + 1.</span><br>        m = self.model[-<span class="hljs-number">1</span>]  <span class="hljs-comment"># Detect() module</span><br>        <span class="hljs-keyword">for</span> mi, s <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(m.m, m.stride):  <span class="hljs-comment"># from</span><br>            b = mi.bias.view(m.na, -<span class="hljs-number">1</span>)  <span class="hljs-comment"># conv.bias(255) to (3,85)</span><br>            b.data[:, <span class="hljs-number">4</span>] += math.log(<span class="hljs-number">8</span> / (<span class="hljs-number">640</span> / s) ** <span class="hljs-number">2</span>)  <span class="hljs-comment"># obj (8 objects per 640 image)</span><br>            b.data[:, <span class="hljs-number">5</span>:] += math.log(<span class="hljs-number">0.6</span> / (m.nc - <span class="hljs-number">0.999999</span>)) <span class="hljs-keyword">if</span> cf <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> torch.log(cf / cf.<span class="hljs-built_in">sum</span>())  <span class="hljs-comment"># cls</span><br>            mi.bias = torch.nn.Parameter(b.view(-<span class="hljs-number">1</span>), requires_grad=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_print_biases</span>(<span class="hljs-params">self</span>):<br>        m = self.model[-<span class="hljs-number">1</span>]  <span class="hljs-comment"># Detect() module</span><br>        <span class="hljs-keyword">for</span> mi <span class="hljs-keyword">in</span> m.m:  <span class="hljs-comment"># from</span><br>            b = mi.bias.detach().view(m.na, -<span class="hljs-number">1</span>).T  <span class="hljs-comment"># conv.bias(255) to (3,85)</span><br>            LOGGER.info(<br>                (<span class="hljs-string">&#x27;%6g Conv2d.bias:&#x27;</span> + <span class="hljs-string">&#x27;%10.3g&#x27;</span> * <span class="hljs-number">6</span>) % (mi.weight.shape[<span class="hljs-number">1</span>], *b[:<span class="hljs-number">5</span>].mean(<span class="hljs-number">1</span>).tolist(), b[<span class="hljs-number">5</span>:].mean()))<br><br>    <span class="hljs-comment"># def _print_weights(self):</span><br>    <span class="hljs-comment">#     for m in self.model.modules():</span><br>    <span class="hljs-comment">#         if type(m) is Bottleneck:</span><br>    <span class="hljs-comment">#             LOGGER.info(&#x27;%10.3g&#x27; % (m.w.detach().sigmoid() * 2))  # shortcut weights</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fuse</span>(<span class="hljs-params">self</span>):  <span class="hljs-comment"># fuse model Conv2d() + BatchNorm2d() layers</span><br>        LOGGER.info(<span class="hljs-string">&#x27;Fusing layers... &#x27;</span>)<br>        <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> self.model.modules():<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(m, (Conv, DWConv)) <span class="hljs-keyword">and</span> <span class="hljs-built_in">hasattr</span>(m, <span class="hljs-string">&#x27;bn&#x27;</span>):<br>                m.conv = fuse_conv_and_bn(m.conv, m.bn)  <span class="hljs-comment"># update conv</span><br>                <span class="hljs-built_in">delattr</span>(m, <span class="hljs-string">&#x27;bn&#x27;</span>)  <span class="hljs-comment"># remove batchnorm</span><br>                m.forward = m.forward_fuse  <span class="hljs-comment"># update forward</span><br>        self.info()<br>        <span class="hljs-keyword">return</span> self<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">info</span>(<span class="hljs-params">self, verbose=<span class="hljs-literal">False</span>, img_size=<span class="hljs-number">640</span></span>):  <span class="hljs-comment"># print model information</span><br>        model_info(self, verbose, img_size)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_apply</span>(<span class="hljs-params">self, fn</span>):<br>        <span class="hljs-comment"># Apply to(), cpu(), cuda(), half() to model tensors that are not parameters or registered buffers</span><br>        self = <span class="hljs-built_in">super</span>()._apply(fn)<br>        m = self.model[-<span class="hljs-number">1</span>]  <span class="hljs-comment"># Detect()</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(m, Detect):<br>            m.stride = fn(m.stride)<br>            m.grid = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(fn, m.grid))<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(m.anchor_grid, <span class="hljs-built_in">list</span>):<br>                m.anchor_grid = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(fn, m.anchor_grid))<br>        <span class="hljs-keyword">return</span> self<br>    <br>    <br><span class="hljs-comment"># Ëß£ÊûêÊ®°ÂûãÔºåËøîÂõûyaml‰∏≠ÊâÄÂ±ïÁ§∫ÁöÑÊ®°ÂûãÔºåsavelist</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_model</span>(<span class="hljs-params">d, ch</span>):  <span class="hljs-comment"># model_dict, input_channels(3)</span><br>    LOGGER.info(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;&#x27;</span>:&gt;<span class="hljs-number">3</span>&#125;</span><span class="hljs-subst">&#123;<span class="hljs-string">&#x27;from&#x27;</span>:&gt;<span class="hljs-number">18</span>&#125;</span><span class="hljs-subst">&#123;<span class="hljs-string">&#x27;n&#x27;</span>:&gt;<span class="hljs-number">3</span>&#125;</span><span class="hljs-subst">&#123;<span class="hljs-string">&#x27;params&#x27;</span>:&gt;<span class="hljs-number">10</span>&#125;</span>  <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;module&#x27;</span>:&lt;<span class="hljs-number">40</span>&#125;</span><span class="hljs-subst">&#123;<span class="hljs-string">&#x27;arguments&#x27;</span>:&lt;<span class="hljs-number">30</span>&#125;</span>&quot;</span>)<br>    anchors, nc, gd, gw = d[<span class="hljs-string">&#x27;anchors&#x27;</span>], d[<span class="hljs-string">&#x27;nc&#x27;</span>], d[<span class="hljs-string">&#x27;depth_multiple&#x27;</span>], d[<span class="hljs-string">&#x27;width_multiple&#x27;</span>]<br>    na = (<span class="hljs-built_in">len</span>(anchors[<span class="hljs-number">0</span>]) // <span class="hljs-number">2</span>) <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(anchors, <span class="hljs-built_in">list</span>) <span class="hljs-keyword">else</span> anchors  <span class="hljs-comment"># number of anchors</span><br>    no = na * (nc + <span class="hljs-number">5</span>)  <span class="hljs-comment"># number of outputs = anchors * (classes + 5)</span><br><br>    layers, save, c2 = [], [], ch[-<span class="hljs-number">1</span>]  <span class="hljs-comment"># layers, savelist, ch out</span><br>    <span class="hljs-comment"># ÂºÄÂßãËØªÂÖ•backboneÂíåheadÁöÑÊ®°ÂûãÂèÇÊï∞</span><br>    <span class="hljs-keyword">for</span> i, (f, n, m, args) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(d[<span class="hljs-string">&#x27;backbone&#x27;</span>] + d[<span class="hljs-string">&#x27;head&#x27;</span>]):  <span class="hljs-comment"># from, number, module, args</span><br>        m = <span class="hljs-built_in">eval</span>(m) <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(m, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">else</span> m  <span class="hljs-comment"># eval strings</span><br>        <span class="hljs-keyword">for</span> j, a <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(args):<br>            <span class="hljs-keyword">try</span>:<br>                args[j] = <span class="hljs-built_in">eval</span>(a) <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(a, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">else</span> a  <span class="hljs-comment"># eval strings</span><br>            <span class="hljs-keyword">except</span> NameError:<br>                <span class="hljs-keyword">pass</span><br><br>        n = n_ = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">round</span>(n * gd), <span class="hljs-number">1</span>) <span class="hljs-keyword">if</span> n &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> n  <span class="hljs-comment"># depth gainÔºåÊ†πÊçÆÊ®°ÂûãÂ§ßÂ∞èÊù•Â∞ÜmoduleÊï∞Èáè‰πò‰ª•depth_multiple</span><br>        <span class="hljs-keyword">if</span> m <span class="hljs-keyword">in</span> (Conv, GhostConv, Bottleneck, GhostBottleneck, SPP, SPPF, DWConv, MixConv2d, Focus, CrossConv,<br>                 BottleneckCSP, C3, C3TR, C3SPP, C3Ghost):<br>            c1, c2 = ch[f], args[<span class="hljs-number">0</span>]<span class="hljs-comment"># c1‰∏∫ËæìÂÖ•ÈÄöÈÅìÊï∞Ôºåc2‰∏∫ËæìÂá∫</span><br>            <span class="hljs-keyword">if</span> c2 != no:  <span class="hljs-comment"># if not output</span><br>                <span class="hljs-comment"># make_divisible‰∏≠ËøîÂõûmath.ceil(c2 * gw / 8) * 8</span><br>                <span class="hljs-comment"># ‰∏∫‰∫Ü‰ΩøÈÄöÈÅìÊï∞‰∏∫8ÁöÑÂÄçÊï∞</span><br>                c2 = make_divisible(c2 * gw, <span class="hljs-number">8</span>)<br><span class="hljs-comment"># argsÁöÑÂàóË°®‰∏∫[ËæìÂÖ•ÈÄöÈÅìÊï∞ÔºåËæìÂá∫ÈÄöÈÅìÊï∞ÔºåyamlÊñá‰ª∂‰∏≠ÂêéÈù¢ÁöÑÂèÇÊï∞]</span><br>            args = [c1, c2, *args[<span class="hljs-number">1</span>:]]<br>            <span class="hljs-comment"># Â¶ÇÊûúmodule‰∏∫‰∏ãÈù¢Ëøô‰∫õmoduleÔºåÈÇ£‰πàÂú®Á¨¨‰∏â‰ΩçÊîæÂÖ•ÈúÄË¶ÅÂæ™ÁéØÁöÑÊï∞Èáèn</span><br>            <span class="hljs-keyword">if</span> m <span class="hljs-keyword">in</span> [BottleneckCSP, C3, C3TR, C3Ghost]:<br>                args.insert(<span class="hljs-number">2</span>, n)  <span class="hljs-comment"># number of repeats</span><br>                n = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> m <span class="hljs-keyword">is</span> nn.BatchNorm2d:<br>            <span class="hljs-comment"># Â¶ÇÊûúmÊòØBatchNorm2dÔºåÈÇ£‰πàÂèÇÊï∞Â∞±‰∏∫‰∏ä‰∏Ä‰∏™moduleÁöÑËæìÂá∫ÈÄöÈÅìÊï∞</span><br>            args = [ch[f]]<br>        <span class="hljs-keyword">elif</span> m <span class="hljs-keyword">is</span> Concat:<br>            <span class="hljs-comment"># Â¶ÇÊûúmÊòØConcatÔºåÈÇ£‰πàËæìÂá∫ÈÄöÈÅìÊï∞c2Â∞±‰∏∫Êù•ÁöÑÂá†‰∏™moduleÁöÑËæìÂá∫ÈÄöÈÅìÊï∞‰πãÂíå</span><br>            c2 = <span class="hljs-built_in">sum</span>(ch[x] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> f)<br>        <span class="hljs-keyword">elif</span> m <span class="hljs-keyword">is</span> Detect:<br>            <span class="hljs-comment"># Â¶ÇÊûúmÊòØDetectÔºåÈÇ£‰πàÂèÇÊï∞Â∞±Âä†‰∏ä‰∏∫Êù•ÁöÑÂá†‰∏™moduleÁöÑËæìÂá∫ÈÄöÈÅìÊï∞ÁöÑÂàóË°®</span><br>            args.append([ch[x] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> f])<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(args[<span class="hljs-number">1</span>], <span class="hljs-built_in">int</span>):  <span class="hljs-comment"># number of anchors</span><br>                args[<span class="hljs-number">1</span>] = [<span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(args[<span class="hljs-number">1</span>] * <span class="hljs-number">2</span>))] * <span class="hljs-built_in">len</span>(f)<br>        <span class="hljs-keyword">elif</span> m <span class="hljs-keyword">is</span> Contract:<br>            c2 = ch[f] * args[<span class="hljs-number">0</span>] ** <span class="hljs-number">2</span><br>        <span class="hljs-keyword">elif</span> m <span class="hljs-keyword">is</span> Expand:<br>            c2 = ch[f] // args[<span class="hljs-number">0</span>] ** <span class="hljs-number">2</span><br>        <span class="hljs-keyword">else</span>:<br>            c2 = ch[f]<br><br>        <span class="hljs-comment"># Â∞ÜyamlÁöÑmoduleÊ∑ªÂä†Âà∞nn.Sequential‰∏≠</span><br>        m_ = nn.Sequential(*(m(*args) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n))) <span class="hljs-keyword">if</span> n &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> m(*args)  <span class="hljs-comment"># module</span><br>        t = <span class="hljs-built_in">str</span>(m)[<span class="hljs-number">8</span>:-<span class="hljs-number">2</span>].replace(<span class="hljs-string">&#x27;__main__.&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)  <span class="hljs-comment"># module type</span><br>        np = <span class="hljs-built_in">sum</span>(x.numel() <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> m_.parameters())  <span class="hljs-comment"># number params</span><br>        m_.i, m_.f, m_.<span class="hljs-built_in">type</span>, m_.np = i, f, t, np  <span class="hljs-comment"># attach index, &#x27;from&#x27; index, type, number params</span><br>        LOGGER.info(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;i:&gt;<span class="hljs-number">3</span>&#125;</span><span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(f):&gt;<span class="hljs-number">18</span>&#125;</span><span class="hljs-subst">&#123;n_:&gt;<span class="hljs-number">3</span>&#125;</span><span class="hljs-subst">&#123;np:<span class="hljs-number">10.0</span>f&#125;</span>  <span class="hljs-subst">&#123;t:&lt;<span class="hljs-number">40</span>&#125;</span><span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(args):&lt;<span class="hljs-number">30</span>&#125;</span>&#x27;</span>)  <span class="hljs-comment"># print</span><br>        save.extend(x % i <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> ([f] <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(f, <span class="hljs-built_in">int</span>) <span class="hljs-keyword">else</span> f) <span class="hljs-keyword">if</span> x != -<span class="hljs-number">1</span>)  <span class="hljs-comment"># append to savelist</span><br>        layers.append(m_)<span class="hljs-comment"># layerÂàóË°®‰∏≠Ê∑ªÂä†Ê≠§Êó∂ÈÅçÂéÜÁöÑmodule</span><br>        <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>:<span class="hljs-comment"># Â¶ÇÊûúÊòØÁ¨¨‰∏Ä‰∏™moduleÔºåÂÖàÊ∏ÖÁ©∫chÂàóË°®</span><br>            ch = []<br>        ch.append(c2)<span class="hljs-comment"># Âú®ch‰∏≠Ê∑ªÂä†ËæìÂá∫ÈÄöÈÅìÊï∞</span><br>    <span class="hljs-keyword">return</span> nn.Sequential(*layers), <span class="hljs-built_in">sorted</span>(save)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    parser = argparse.ArgumentParser()<br>    parser.add_argument(<span class="hljs-string">&#x27;--cfg&#x27;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">str</span>, default=<span class="hljs-string">&#x27;yolov5s.yaml&#x27;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;model.yaml&#x27;</span>)<br>    parser.add_argument(<span class="hljs-string">&#x27;--batch-size&#x27;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, default=<span class="hljs-number">1</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;total batch size for all GPUs&#x27;</span>)<br>    parser.add_argument(<span class="hljs-string">&#x27;--device&#x27;</span>, default=<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;cuda device, i.e. 0 or 0,1,2,3 or cpu&#x27;</span>)<br>    parser.add_argument(<span class="hljs-string">&#x27;--profile&#x27;</span>, action=<span class="hljs-string">&#x27;store_true&#x27;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;profile model speed&#x27;</span>)<br>    parser.add_argument(<span class="hljs-string">&#x27;--line-profile&#x27;</span>, action=<span class="hljs-string">&#x27;store_true&#x27;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;profile model speed layer by layer&#x27;</span>)<br>    parser.add_argument(<span class="hljs-string">&#x27;--test&#x27;</span>, action=<span class="hljs-string">&#x27;store_true&#x27;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;test all yolo*.yaml&#x27;</span>)<br>    opt = parser.parse_args()<br>    opt.cfg = check_yaml(opt.cfg)  <span class="hljs-comment"># check YAML</span><br>    print_args(<span class="hljs-built_in">vars</span>(opt))<br>    device = select_device(opt.device)<br><br>    <span class="hljs-comment"># Create model</span><br>    im = torch.rand(opt.batch_size, <span class="hljs-number">3</span>, <span class="hljs-number">640</span>, <span class="hljs-number">640</span>).to(device)<br>    model = Model(opt.cfg).to(device)<br><br>    <span class="hljs-comment"># Options</span><br>    <span class="hljs-keyword">if</span> opt.line_profile:  <span class="hljs-comment"># profile layer by layer</span><br>        _ = model(im, profile=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">elif</span> opt.profile:  <span class="hljs-comment"># profile forward-backward</span><br>        results = profile(<span class="hljs-built_in">input</span>=im, ops=[model], n=<span class="hljs-number">3</span>)<br><br>    <span class="hljs-keyword">elif</span> opt.test:  <span class="hljs-comment"># test all models</span><br>        <span class="hljs-keyword">for</span> cfg <span class="hljs-keyword">in</span> Path(ROOT / <span class="hljs-string">&#x27;models&#x27;</span>).rglob(<span class="hljs-string">&#x27;yolo*.yaml&#x27;</span>):<br>            <span class="hljs-keyword">try</span>:<br>                _ = Model(cfg)<br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Error in <span class="hljs-subst">&#123;cfg&#125;</span>: <span class="hljs-subst">&#123;e&#125;</span>&#x27;</span>)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>cv</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>yolov1</title>
    <link href="/2022/09/30/yolov1/"/>
    <url>/2022/09/30/yolov1/</url>
    
    <content type="html"><![CDATA[<h1 id="Ê®°Âûã‰ªãÁªç">Ê®°Âûã‰ªãÁªç</h1><p><img src="/img/cv/image-20220930153754299.png" /></p><p><img src="/img/cv/image-20220930153824653.png" /></p><p><img src="/img/cv/image-20220930153848083.png" /></p><p><img src="/img/cv/image-20220930153904048.png" /></p><p><img src="/img/cv/image-20220930153921376.png" /></p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>cv</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SSD</title>
    <link href="/2022/09/30/SSD/"/>
    <url>/2022/09/30/SSD/</url>
    
    <content type="html"><![CDATA[<h1 id="Ê®°Âûã‰ªãÁªç">Ê®°Âûã‰ªãÁªç</h1><p><img src="/img/cv/image-20220930152818338.png" /></p><p><img src="/img/cv/image-20220930152839522.png" /></p><p><img src="/img/cv/image-20220930152851705.png" /></p><p><img src="/img/cv/image-20220930152903880.png" /></p><p><img src="/img/cv/image-20220930152918813.png" /></p><p><img src="/img/cv/image-20220930152930806.png" /></p><p><img src="/img/cv/image-20220930152941778.png" /></p><p><img src="/img/cv/image-20220930152952521.png" /></p><p><img src="/img/cv/image-20220930153004458.png" /></p><p><img src="/img/cv/image-20220930153015647.png" /></p><p><img src="/img/cv/image-20220930153028568.png" /></p><p><img src="/img/cv/image-20220930153042132.png" /></p><p><img src="/img/cv/image-20220930153054831.png" /></p><p><img src="/img/cv/image-20220930153110871.png" /></p><p><img src="/img/cv/image-20220930153121772.png" /></p><p><img src="/img/cv/image-20220930153132417.png" /></p><p><img src="/img/cv/image-20220930153142800.png" /></p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>cv</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>FPN</title>
    <link href="/2022/09/30/FPN/"/>
    <url>/2022/09/30/FPN/</url>
    
    <content type="html"><![CDATA[<h1 id="Ê®°Âûã‰ªãÁªç">Ê®°Âûã‰ªãÁªç</h1><p><img src="/img/cv/image-20220930111912244.png" /></p><p><img src="/img/cv/image-20220930111926838.png" /></p><p><img src="/img/cv/image-20220930111940668.png" /></p><p><img src="/img/cv/image-20220930112000674.png" /></p><p><img src="/img/cv/image-20220930112024501.png" /></p><p><img src="/img/cv/image-20220930112036794.png" /></p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>cv</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Faster_R-CNN</title>
    <link href="/2022/09/30/Faster-R-CNN/"/>
    <url>/2022/09/30/Faster-R-CNN/</url>
    
    <content type="html"><![CDATA[<h1 id="Ê®°Âûã‰ªãÁªç">Ê®°Âûã‰ªãÁªç</h1><p><img src="/img/cv/image-20220930104009662.png" /></p><p><img src="/img/cv/image-20220930104029226.png" /></p><p><img src="/img/cv/image-20220930104047080.png" /></p><p><img src="/img/cv/image-20220930104101860.png" /></p><p><img src="/img/cv/image-20220930104253294.png" /></p><p><img src="/img/cv/image-20220930104309535.png" /></p><p><img src="/img/cv/image-20220930104322156.png" /></p><p><img src="/img/cv/image-20220930104332006.png" /></p><p><img src="/img/cv/image-20220930104345120.png" /></p><p><img src="/img/cv/image-20220930104356421.png" /></p><p><img src="/img/cv/image-20220930104409007.png" /></p><p><img src="/img/cv/image-20220930104420565.png" /></p><p><img src="/img/cv/image-20220930104433453.png" /></p><p><img src="/img/cv/image-20220930104446017.png" /></p><p><img src="/img/cv/image-20220930104500570.png" /></p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>cv</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Fast_R-CNN</title>
    <link href="/2022/09/30/Fast-R-CNN/"/>
    <url>/2022/09/30/Fast-R-CNN/</url>
    
    <content type="html"><![CDATA[<h1 id="Ê®°Âûã‰ªãÁªç">Ê®°Âûã‰ªãÁªç</h1><p><img src="/img/cv/image-20220930103138705.png" /></p><p><img src="/img/cv/image-20220930103151991.png" /></p><p><img src="/img/cv/image-20220930103204019.png" /></p><p><img src="/img/cv/image-20220930103243703.png" /></p><p><img src="/img/cv/image-20220930103316912.png" /></p><p><img src="/img/cv/image-20220930103331647.png" /></p><p><img src="/img/cv/image-20220930103413400.png" /></p><p><img src="/img/cv/image-20220930103431178.png" /></p><p><img src="/img/cv/image-20220930103445275.png" /></p><p><img src="/img/cv/image-20220930103507638.png" /></p><p><img src="/img/cv/image-20220930103520918.png" /></p><p><img src="/img/cv/image-20220930103548664.png" /></p><p><img src="/img/cv/image-20220930103600909.png" /></p><p><img src="/img/cv/image-20220930103638505.png" /></p><p><img src="/img/cv/image-20220930103656760.png" /></p><p><img src="/img/cv/image-20220930103721592.png" /></p><p><img src="/img/cv/image-20220930103736379.png" /></p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>cv</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>RCNN</title>
    <link href="/2022/09/29/RCNN/"/>
    <url>/2022/09/29/RCNN/</url>
    
    <content type="html"><![CDATA[<h1 id="Ê®°Âûã‰ªãÁªç">Ê®°Âûã‰ªãÁªç</h1><p><img src="/img/cv/image-20220929174947399.png" /></p><p><img src="/img/cv/image-20220929174959830.png" /></p><p><img src="/img/cv/image-20220929175012228.png" /></p><p><img src="/img/cv/image-20220929175024811.png" /></p><p><img src="/img/cv/image-20220929175035980.png" /></p><p><img src="/img/cv/image-20220929175055640.png" /></p><p><img src="/img/cv/image-20220929175116843.png" /></p><p><img src="/img/cv/image-20220929175137830.png" /></p><p><img src="/img/cv/image-20220929175155293.png" /></p><p><img src="/img/cv/image-20220929175207362.png" /></p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>cv</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>GoogleNet</title>
    <link href="/2022/09/29/GoogleNet/"/>
    <url>/2022/09/29/GoogleNet/</url>
    
    <content type="html"><![CDATA[<h1 id="Ê®°Âûã‰ªãÁªç">Ê®°Âûã‰ªãÁªç</h1><p><img src="/img/cv/image-20220929165102079.png" /></p><p><img src="/img/cv/image-20220929165115906.png" /></p><p><img src="/img/cv/image-20220929165128922.png" /></p><p><img src="/img/cv/image-20220929165145364.png" /></p><p><img src="/img/cv/image-20220929165157614.png" /></p><p><img src="/img/cv/image-20220929165210033.png" /></p><p><img src="/img/cv/image-20220929165223735.png" /></p><h1 id="Ê®°Âûã‰ª£Á†Å">Ê®°Âûã‰ª£Á†Å</h1><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GoogLeNet</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, num_classes=<span class="hljs-number">1000</span>, aux_logits=<span class="hljs-literal">True</span>, init_weights=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-built_in">super</span>(GoogLeNet, self).__init__()<br>        self.aux_logits = aux_logits<br><br>        self.conv1 = BasicConv2d(<span class="hljs-number">3</span>, <span class="hljs-number">64</span>, kernel_size=<span class="hljs-number">7</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">3</span>)<br>        self.maxpool1 = nn.MaxPool2d(<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, ceil_mode=<span class="hljs-literal">True</span>)<br><br>        self.conv2 = BasicConv2d(<span class="hljs-number">64</span>, <span class="hljs-number">64</span>, kernel_size=<span class="hljs-number">1</span>)<br>        self.conv3 = BasicConv2d(<span class="hljs-number">64</span>, <span class="hljs-number">192</span>, kernel_size=<span class="hljs-number">3</span>, padding=<span class="hljs-number">1</span>)<br>        self.maxpool2 = nn.MaxPool2d(<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, ceil_mode=<span class="hljs-literal">True</span>)<br><br>        self.inception3a = Inception(<span class="hljs-number">192</span>, <span class="hljs-number">64</span>, <span class="hljs-number">96</span>, <span class="hljs-number">128</span>, <span class="hljs-number">16</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>)<br>        self.inception3b = Inception(<span class="hljs-number">256</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">192</span>, <span class="hljs-number">32</span>, <span class="hljs-number">96</span>, <span class="hljs-number">64</span>)<br>        self.maxpool3 = nn.MaxPool2d(<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, ceil_mode=<span class="hljs-literal">True</span>)<br><br>        self.inception4a = Inception(<span class="hljs-number">480</span>, <span class="hljs-number">192</span>, <span class="hljs-number">96</span>, <span class="hljs-number">208</span>, <span class="hljs-number">16</span>, <span class="hljs-number">48</span>, <span class="hljs-number">64</span>)<br>        self.inception4b = Inception(<span class="hljs-number">512</span>, <span class="hljs-number">160</span>, <span class="hljs-number">112</span>, <span class="hljs-number">224</span>, <span class="hljs-number">24</span>, <span class="hljs-number">64</span>, <span class="hljs-number">64</span>)<br>        self.inception4c = Inception(<span class="hljs-number">512</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>, <span class="hljs-number">256</span>, <span class="hljs-number">24</span>, <span class="hljs-number">64</span>, <span class="hljs-number">64</span>)<br>        self.inception4d = Inception(<span class="hljs-number">512</span>, <span class="hljs-number">112</span>, <span class="hljs-number">144</span>, <span class="hljs-number">288</span>, <span class="hljs-number">32</span>, <span class="hljs-number">64</span>, <span class="hljs-number">64</span>)<br>        self.inception4e = Inception(<span class="hljs-number">528</span>, <span class="hljs-number">256</span>, <span class="hljs-number">160</span>, <span class="hljs-number">320</span>, <span class="hljs-number">32</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>)<br>        self.maxpool4 = nn.MaxPool2d(<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, ceil_mode=<span class="hljs-literal">True</span>)<br><br>        self.inception5a = Inception(<span class="hljs-number">832</span>, <span class="hljs-number">256</span>, <span class="hljs-number">160</span>, <span class="hljs-number">320</span>, <span class="hljs-number">32</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>)<br>        self.inception5b = Inception(<span class="hljs-number">832</span>, <span class="hljs-number">384</span>, <span class="hljs-number">192</span>, <span class="hljs-number">384</span>, <span class="hljs-number">48</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>)<br><br>        <span class="hljs-keyword">if</span> self.aux_logits:<br>            self.aux1 = InceptionAux(<span class="hljs-number">512</span>, num_classes)<br>            self.aux2 = InceptionAux(<span class="hljs-number">528</span>, num_classes)<br><br>        self.avgpool = nn.AdaptiveAvgPool2d((<span class="hljs-number">1</span>, <span class="hljs-number">1</span>))<br>        self.dropout = nn.Dropout(<span class="hljs-number">0.4</span>)<br>        self.fc = nn.Linear(<span class="hljs-number">1024</span>, num_classes)<br>        <span class="hljs-keyword">if</span> init_weights:<br>            self._initialize_weights()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-comment"># N x 3 x 224 x 224</span><br>        x = self.conv1(x)<br>        <span class="hljs-comment"># N x 64 x 112 x 112</span><br>        x = self.maxpool1(x)<br>        <span class="hljs-comment"># N x 64 x 56 x 56</span><br>        x = self.conv2(x)<br>        <span class="hljs-comment"># N x 64 x 56 x 56</span><br>        x = self.conv3(x)<br>        <span class="hljs-comment"># N x 192 x 56 x 56</span><br>        x = self.maxpool2(x)<br><br>        <span class="hljs-comment"># N x 192 x 28 x 28</span><br>        x = self.inception3a(x)<br>        <span class="hljs-comment"># N x 256 x 28 x 28</span><br>        x = self.inception3b(x)<br>        <span class="hljs-comment"># N x 480 x 28 x 28</span><br>        x = self.maxpool3(x)<br>        <span class="hljs-comment"># N x 480 x 14 x 14</span><br>        x = self.inception4a(x)<br>        <span class="hljs-comment"># N x 512 x 14 x 14</span><br>        <span class="hljs-keyword">if</span> self.training <span class="hljs-keyword">and</span> self.aux_logits:    <span class="hljs-comment"># eval model lose this layer</span><br>            aux1 = self.aux1(x)<br><br>        x = self.inception4b(x)<br>        <span class="hljs-comment"># N x 512 x 14 x 14</span><br>        x = self.inception4c(x)<br>        <span class="hljs-comment"># N x 512 x 14 x 14</span><br>        x = self.inception4d(x)<br>        <span class="hljs-comment"># N x 528 x 14 x 14</span><br>        <span class="hljs-keyword">if</span> self.training <span class="hljs-keyword">and</span> self.aux_logits:    <span class="hljs-comment"># eval model lose this layer</span><br>            aux2 = self.aux2(x)<br><br>        x = self.inception4e(x)<br>        <span class="hljs-comment"># N x 832 x 14 x 14</span><br>        x = self.maxpool4(x)<br>        <span class="hljs-comment"># N x 832 x 7 x 7</span><br>        x = self.inception5a(x)<br>        <span class="hljs-comment"># N x 832 x 7 x 7</span><br>        x = self.inception5b(x)<br>        <span class="hljs-comment"># N x 1024 x 7 x 7</span><br><br>        x = self.avgpool(x)<br>        <span class="hljs-comment"># N x 1024 x 1 x 1</span><br>        x = torch.flatten(x, <span class="hljs-number">1</span>)<br>        <span class="hljs-comment"># N x 1024</span><br>        x = self.dropout(x)<br>        x = self.fc(x)<br>        <span class="hljs-comment"># N x 1000 (num_classes)</span><br>        <span class="hljs-keyword">if</span> self.training <span class="hljs-keyword">and</span> self.aux_logits:   <span class="hljs-comment"># eval model lose this layer</span><br>            <span class="hljs-keyword">return</span> x, aux2, aux1<br>        <span class="hljs-keyword">return</span> x<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_initialize_weights</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> self.modules():<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(m, nn.Conv2d):<br>                nn.init.kaiming_normal_(m.weight, mode=<span class="hljs-string">&#x27;fan_out&#x27;</span>, nonlinearity=<span class="hljs-string">&#x27;relu&#x27;</span>)<br>                <span class="hljs-keyword">if</span> m.bias <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                    nn.init.constant_(m.bias, <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(m, nn.Linear):<br>                nn.init.normal_(m.weight, <span class="hljs-number">0</span>, <span class="hljs-number">0.01</span>)<br>                nn.init.constant_(m.bias, <span class="hljs-number">0</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Inception</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, in_channels, ch1x1, ch3x3red, ch3x3, ch5x5red, ch5x5, pool_proj</span>):<br>        <span class="hljs-built_in">super</span>(Inception, self).__init__()<br><br>        self.branch1 = BasicConv2d(in_channels, ch1x1, kernel_size=<span class="hljs-number">1</span>)<br><br>        self.branch2 = nn.Sequential(<br>            BasicConv2d(in_channels, ch3x3red, kernel_size=<span class="hljs-number">1</span>),<br>            BasicConv2d(ch3x3red, ch3x3, kernel_size=<span class="hljs-number">3</span>, padding=<span class="hljs-number">1</span>)   <span class="hljs-comment"># ‰øùËØÅËæìÂá∫Â§ßÂ∞èÁ≠â‰∫éËæìÂÖ•Â§ßÂ∞è</span><br>        )<br><br>        self.branch3 = nn.Sequential(<br>            BasicConv2d(in_channels, ch5x5red, kernel_size=<span class="hljs-number">1</span>),<br>            <span class="hljs-comment"># Âú®ÂÆòÊñπÁöÑÂÆûÁé∞‰∏≠ÔºåÂÖ∂ÂÆûÊòØ3x3ÁöÑkernelÂπ∂‰∏çÊòØ5x5ÔºåËøôÈáåÊàë‰πüÊáíÂæóÊîπ‰∫ÜÔºåÂÖ∑‰ΩìÂèØ‰ª•ÂèÇËÄÉ‰∏ãÈù¢ÁöÑissue</span><br>            <span class="hljs-comment"># Please see https://github.com/pytorch/vision/issues/906 for details.</span><br>            BasicConv2d(ch5x5red, ch5x5, kernel_size=<span class="hljs-number">5</span>, padding=<span class="hljs-number">2</span>)   <span class="hljs-comment"># ‰øùËØÅËæìÂá∫Â§ßÂ∞èÁ≠â‰∫éËæìÂÖ•Â§ßÂ∞è</span><br>        )<br><br>        self.branch4 = nn.Sequential(<br>            nn.MaxPool2d(kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>),<br>            BasicConv2d(in_channels, pool_proj, kernel_size=<span class="hljs-number">1</span>)<br>        )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        branch1 = self.branch1(x)<br>        branch2 = self.branch2(x)<br>        branch3 = self.branch3(x)<br>        branch4 = self.branch4(x)<br><br>        outputs = [branch1, branch2, branch3, branch4]<br>        <span class="hljs-keyword">return</span> torch.cat(outputs, <span class="hljs-number">1</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">InceptionAux</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, in_channels, num_classes</span>):<br>        <span class="hljs-built_in">super</span>(InceptionAux, self).__init__()<br>        self.averagePool = nn.AvgPool2d(kernel_size=<span class="hljs-number">5</span>, stride=<span class="hljs-number">3</span>)<br>        self.conv = BasicConv2d(in_channels, <span class="hljs-number">128</span>, kernel_size=<span class="hljs-number">1</span>)  <span class="hljs-comment"># output[batch, 128, 4, 4]</span><br><br>        self.fc1 = nn.Linear(<span class="hljs-number">2048</span>, <span class="hljs-number">1024</span>)<br>        self.fc2 = nn.Linear(<span class="hljs-number">1024</span>, num_classes)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-comment"># aux1: N x 512 x 14 x 14, aux2: N x 528 x 14 x 14</span><br>        x = self.averagePool(x)<br>        <span class="hljs-comment"># aux1: N x 512 x 4 x 4, aux2: N x 528 x 4 x 4</span><br>        x = self.conv(x)<br>        <span class="hljs-comment"># N x 128 x 4 x 4</span><br>        x = torch.flatten(x, <span class="hljs-number">1</span>)<br>        x = F.dropout(x, <span class="hljs-number">0.5</span>, training=self.training)<br>        <span class="hljs-comment"># N x 2048</span><br>        x = F.relu(self.fc1(x), inplace=<span class="hljs-literal">True</span>)<br>        x = F.dropout(x, <span class="hljs-number">0.5</span>, training=self.training)<br>        <span class="hljs-comment"># N x 1024</span><br>        x = self.fc2(x)<br>        <span class="hljs-comment"># N x num_classes</span><br>        <span class="hljs-keyword">return</span> x<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicConv2d</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, in_channels, out_channels, **kwargs</span>):<br>        <span class="hljs-built_in">super</span>(BasicConv2d, self).__init__()<br>        self.conv = nn.Conv2d(in_channels, out_channels, **kwargs)<br>        self.relu = nn.ReLU(inplace=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = self.conv(x)<br>        x = self.relu(x)<br>        <span class="hljs-keyword">return</span> x<br></code></pre></div></td></tr></table></figure><h1 id="ËÆ≠ÁªÉ‰ª£Á†Å">ËÆ≠ÁªÉ‰ª£Á†Å</h1><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> transforms, datasets<br><span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optim<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><br><span class="hljs-keyword">from</span> model <span class="hljs-keyword">import</span> GoogLeNet<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    device = torch.device(<span class="hljs-string">&quot;cuda:0&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;using &#123;&#125; device.&quot;</span>.<span class="hljs-built_in">format</span>(device))<br><br>    data_transform = &#123;<br>        <span class="hljs-string">&quot;train&quot;</span>: transforms.Compose([transforms.RandomResizedCrop(<span class="hljs-number">224</span>),<br>                                     transforms.RandomHorizontalFlip(),<br>                                     transforms.ToTensor(),<br>                                     transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))]),<br>        <span class="hljs-string">&quot;val&quot;</span>: transforms.Compose([transforms.Resize((<span class="hljs-number">224</span>, <span class="hljs-number">224</span>)),<br>                                   transforms.ToTensor(),<br>                                   transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))])&#125;<br><br>    data_root = os.path.abspath(os.path.join(os.getcwd(), <span class="hljs-string">&quot;../..&quot;</span>))  <span class="hljs-comment"># get data root path</span><br>    image_path = os.path.join(data_root, <span class="hljs-string">&quot;data_set&quot;</span>, <span class="hljs-string">&quot;flower_data&quot;</span>)  <span class="hljs-comment"># flower data set path</span><br>    <span class="hljs-keyword">assert</span> os.path.exists(image_path), <span class="hljs-string">&quot;&#123;&#125; path does not exist.&quot;</span>.<span class="hljs-built_in">format</span>(image_path)<br>    train_dataset = datasets.ImageFolder(root=os.path.join(image_path, <span class="hljs-string">&quot;train&quot;</span>),<br>                                         transform=data_transform[<span class="hljs-string">&quot;train&quot;</span>])<br>    train_num = <span class="hljs-built_in">len</span>(train_dataset)<br><br>    <span class="hljs-comment"># &#123;&#x27;daisy&#x27;:0, &#x27;dandelion&#x27;:1, &#x27;roses&#x27;:2, &#x27;sunflower&#x27;:3, &#x27;tulips&#x27;:4&#125;</span><br>    flower_list = train_dataset.class_to_idx<br>    cla_dict = <span class="hljs-built_in">dict</span>((val, key) <span class="hljs-keyword">for</span> key, val <span class="hljs-keyword">in</span> flower_list.items())<br>    <span class="hljs-comment"># write dict into json file</span><br>    json_str = json.dumps(cla_dict, indent=<span class="hljs-number">4</span>)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;class_indices.json&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> json_file:<br>        json_file.write(json_str)<br><br>    batch_size = <span class="hljs-number">32</span><br>    nw = <span class="hljs-built_in">min</span>([os.cpu_count(), batch_size <span class="hljs-keyword">if</span> batch_size &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>, <span class="hljs-number">8</span>])  <span class="hljs-comment"># number of workers</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Using &#123;&#125; dataloader workers every process&#x27;</span>.<span class="hljs-built_in">format</span>(nw))<br><br>    train_loader = torch.utils.data.DataLoader(train_dataset,<br>                                               batch_size=batch_size, shuffle=<span class="hljs-literal">True</span>,<br>                                               num_workers=nw)<br><br>    validate_dataset = datasets.ImageFolder(root=os.path.join(image_path, <span class="hljs-string">&quot;val&quot;</span>),<br>                                            transform=data_transform[<span class="hljs-string">&quot;val&quot;</span>])<br>    val_num = <span class="hljs-built_in">len</span>(validate_dataset)<br>    validate_loader = torch.utils.data.DataLoader(validate_dataset,<br>                                                  batch_size=batch_size, shuffle=<span class="hljs-literal">False</span>,<br>                                                  num_workers=nw)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;using &#123;&#125; images for training, &#123;&#125; images for validation.&quot;</span>.<span class="hljs-built_in">format</span>(train_num,<br>                                                                           val_num))<br><br>    <span class="hljs-comment"># test_data_iter = iter(validate_loader)</span><br>    <span class="hljs-comment"># test_image, test_label = test_data_iter.next()</span><br><br>    net = GoogLeNet(num_classes=<span class="hljs-number">5</span>, aux_logits=<span class="hljs-literal">True</span>, init_weights=<span class="hljs-literal">True</span>)<br>    <span class="hljs-comment"># Â¶ÇÊûúË¶Å‰ΩøÁî®ÂÆòÊñπÁöÑÈ¢ÑËÆ≠ÁªÉÊùÉÈáçÔºåÊ≥®ÊÑèÊòØÂ∞ÜÊùÉÈáçËΩΩÂÖ•ÂÆòÊñπÁöÑÊ®°ÂûãÔºå‰∏çÊòØÊàë‰ª¨Ëá™Â∑±ÂÆûÁé∞ÁöÑÊ®°Âûã</span><br>    <span class="hljs-comment"># ÂÆòÊñπÁöÑÊ®°Âûã‰∏≠‰ΩøÁî®‰∫ÜbnÂ±Ç‰ª•ÂèäÊîπ‰∫Ü‰∏Ä‰∫õÂèÇÊï∞Ôºå‰∏çËÉΩÊ∑∑Áî®</span><br>    <span class="hljs-comment"># import torchvision</span><br>    <span class="hljs-comment"># net = torchvision.models.googlenet(num_classes=5)</span><br>    <span class="hljs-comment"># model_dict = net.state_dict()</span><br>    <span class="hljs-comment"># # È¢ÑËÆ≠ÁªÉÊùÉÈáç‰∏ãËΩΩÂú∞ÂùÄ: https://download.pytorch.org/models/googlenet-1378be20.pth</span><br>    <span class="hljs-comment"># pretrain_model = torch.load(&quot;googlenet.pth&quot;)</span><br>    <span class="hljs-comment"># del_list = [&quot;aux1.fc2.weight&quot;, &quot;aux1.fc2.bias&quot;,</span><br>    <span class="hljs-comment">#             &quot;aux2.fc2.weight&quot;, &quot;aux2.fc2.bias&quot;,</span><br>    <span class="hljs-comment">#             &quot;fc.weight&quot;, &quot;fc.bias&quot;]</span><br>    <span class="hljs-comment"># pretrain_dict = &#123;k: v for k, v in pretrain_model.items() if k not in del_list&#125;</span><br>    <span class="hljs-comment"># model_dict.update(pretrain_dict)</span><br>    <span class="hljs-comment"># net.load_state_dict(model_dict)</span><br>    net.to(device)<br>    loss_function = nn.CrossEntropyLoss()<br>    optimizer = optim.Adam(net.parameters(), lr=<span class="hljs-number">0.0003</span>)<br><br>    epochs = <span class="hljs-number">30</span><br>    best_acc = <span class="hljs-number">0.0</span><br>    save_path = <span class="hljs-string">&#x27;./googleNet.pth&#x27;</span><br>    train_steps = <span class="hljs-built_in">len</span>(train_loader)<br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>        <span class="hljs-comment"># train</span><br>        net.train()<br>        running_loss = <span class="hljs-number">0.0</span><br>        train_bar = tqdm(train_loader, file=sys.stdout)<br>        <span class="hljs-keyword">for</span> step, data <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(train_bar):<br>            images, labels = data<br>            optimizer.zero_grad()<br>            logits, aux_logits2, aux_logits1 = net(images.to(device))<br>            loss0 = loss_function(logits, labels.to(device))<br>            loss1 = loss_function(aux_logits1, labels.to(device))<br>            loss2 = loss_function(aux_logits2, labels.to(device))<br>            loss = loss0 + loss1 * <span class="hljs-number">0.3</span> + loss2 * <span class="hljs-number">0.3</span><br>            loss.backward()<br>            optimizer.step()<br><br>            <span class="hljs-comment"># print statistics</span><br>            running_loss += loss.item()<br><br>            train_bar.desc = <span class="hljs-string">&quot;train epoch[&#123;&#125;/&#123;&#125;] loss:&#123;:.3f&#125;&quot;</span>.<span class="hljs-built_in">format</span>(epoch + <span class="hljs-number">1</span>,<br>                                                                     epochs,<br>                                                                     loss)<br><br>        <span class="hljs-comment"># validate</span><br>        net.<span class="hljs-built_in">eval</span>()<br>        acc = <span class="hljs-number">0.0</span>  <span class="hljs-comment"># accumulate accurate number / epoch</span><br>        <span class="hljs-keyword">with</span> torch.no_grad():<br>            val_bar = tqdm(validate_loader, file=sys.stdout)<br>            <span class="hljs-keyword">for</span> val_data <span class="hljs-keyword">in</span> val_bar:<br>                val_images, val_labels = val_data<br>                outputs = net(val_images.to(device))  <span class="hljs-comment"># eval model only have last output layer</span><br>                predict_y = torch.<span class="hljs-built_in">max</span>(outputs, dim=<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>]<br>                acc += torch.eq(predict_y, val_labels.to(device)).<span class="hljs-built_in">sum</span>().item()<br><br>        val_accurate = acc / val_num<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[epoch %d] train_loss: %.3f  val_accuracy: %.3f&#x27;</span> %<br>              (epoch + <span class="hljs-number">1</span>, running_loss / train_steps, val_accurate))<br><br>        <span class="hljs-keyword">if</span> val_accurate &gt; best_acc:<br>            best_acc = val_accurate<br>            torch.save(net.state_dict(), save_path)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Finished Training&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()\<br></code></pre></div></td></tr></table></figure><h1 id="È¢ÑÊµã‰ª£Á†Å">È¢ÑÊµã‰ª£Á†Å</h1><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> transforms<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">from</span> model <span class="hljs-keyword">import</span> GoogLeNet<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    device = torch.device(<span class="hljs-string">&quot;cuda:0&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)<br><br>    data_transform = transforms.Compose(<br>        [transforms.Resize((<span class="hljs-number">224</span>, <span class="hljs-number">224</span>)),<br>         transforms.ToTensor(),<br>         transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))])<br><br>    <span class="hljs-comment"># load image</span><br>    img_path = <span class="hljs-string">&quot;../tulip.jpg&quot;</span><br>    <span class="hljs-keyword">assert</span> os.path.exists(img_path), <span class="hljs-string">&quot;file: &#x27;&#123;&#125;&#x27; dose not exist.&quot;</span>.<span class="hljs-built_in">format</span>(img_path)<br>    img = Image.<span class="hljs-built_in">open</span>(img_path)<br>    plt.imshow(img)<br>    <span class="hljs-comment"># [N, C, H, W]</span><br>    img = data_transform(img)<br>    <span class="hljs-comment"># expand batch dimension</span><br>    img = torch.unsqueeze(img, dim=<span class="hljs-number">0</span>)<br><br>    <span class="hljs-comment"># read class_indict</span><br>    json_path = <span class="hljs-string">&#x27;./class_indices.json&#x27;</span><br>    <span class="hljs-keyword">assert</span> os.path.exists(json_path), <span class="hljs-string">&quot;file: &#x27;&#123;&#125;&#x27; dose not exist.&quot;</span>.<span class="hljs-built_in">format</span>(json_path)<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(json_path, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        class_indict = json.load(f)<br><br>    <span class="hljs-comment"># create model</span><br>    model = GoogLeNet(num_classes=<span class="hljs-number">5</span>, aux_logits=<span class="hljs-literal">False</span>).to(device)<br><br>    <span class="hljs-comment"># load model weights</span><br>    weights_path = <span class="hljs-string">&quot;./googleNet.pth&quot;</span><br>    <span class="hljs-keyword">assert</span> os.path.exists(weights_path), <span class="hljs-string">&quot;file: &#x27;&#123;&#125;&#x27; dose not exist.&quot;</span>.<span class="hljs-built_in">format</span>(weights_path)<br>    missing_keys, unexpected_keys = model.load_state_dict(torch.load(weights_path, map_location=device),<br>                                                          strict=<span class="hljs-literal">False</span>)<br><br>    model.<span class="hljs-built_in">eval</span>()<br>    <span class="hljs-keyword">with</span> torch.no_grad():<br>        <span class="hljs-comment"># predict class</span><br>        output = torch.squeeze(model(img.to(device))).cpu()<br>        predict = torch.softmax(output, dim=<span class="hljs-number">0</span>)<br>        predict_cla = torch.argmax(predict).numpy()<br><br>    print_res = <span class="hljs-string">&quot;class: &#123;&#125;   prob: &#123;:.3&#125;&quot;</span>.<span class="hljs-built_in">format</span>(class_indict[<span class="hljs-built_in">str</span>(predict_cla)],<br>                                                 predict[predict_cla].numpy())<br>    plt.title(print_res)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(predict)):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;class: &#123;:10&#125;   prob: &#123;:.3&#125;&quot;</span>.<span class="hljs-built_in">format</span>(class_indict[<span class="hljs-built_in">str</span>(i)],<br>                                                  predict[i].numpy()))<br>    plt.show()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>cv</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>AlexNet</title>
    <link href="/2022/09/29/AlexNet/"/>
    <url>/2022/09/29/AlexNet/</url>
    
    <content type="html"><![CDATA[<h1 id="ÁΩëÁªú‰ªãÁªç">ÁΩëÁªú‰ªãÁªç</h1><p><img src="/img/cv/image-20220929160500941.png" /></p><p><img src="/img/cv/image-20220929160537393.png" /></p><p><img src="/img/cv/image-20220929160556682.png" /></p><p><img src="/img/cv/image-20220929160608567.png" /></p><ul><li>‰ΩøÁî®‰∫Ü‰∏ä‰∏ã‰∏§Â±ÇÁöÑÁªìÊûÑÔºå‰∏ä‰∏ã‰∏§Â±ÇÁªìÊûÑ‰∏ÄÊ†∑</li></ul><p><img src="/img/cv/image-20220929160655961.png" /></p><p><img src="/img/cv/image-20220929160708562.png" /></p><h1 id="Ê®°Âûã‰ª£Á†Å">Ê®°Âûã‰ª£Á†Å</h1><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AlexNet</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, num_classes=<span class="hljs-number">1000</span>, init_weights=<span class="hljs-literal">False</span></span>):<br>        <span class="hljs-built_in">super</span>(AlexNet, self).__init__()<br>        self.features = nn.Sequential(<br>            nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">48</span>, kernel_size=<span class="hljs-number">11</span>, stride=<span class="hljs-number">4</span>, padding=<span class="hljs-number">2</span>),  <span class="hljs-comment"># input[3, 224, 224]  output[48, 55, 55]</span><br>            nn.ReLU(inplace=<span class="hljs-literal">True</span>),<br>            nn.MaxPool2d(kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>),                  <span class="hljs-comment"># output[48, 27, 27]</span><br>            nn.Conv2d(<span class="hljs-number">48</span>, <span class="hljs-number">128</span>, kernel_size=<span class="hljs-number">5</span>, padding=<span class="hljs-number">2</span>),           <span class="hljs-comment"># output[128, 27, 27]</span><br>            nn.ReLU(inplace=<span class="hljs-literal">True</span>),<br>            nn.MaxPool2d(kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>),                  <span class="hljs-comment"># output[128, 13, 13]</span><br>            nn.Conv2d(<span class="hljs-number">128</span>, <span class="hljs-number">192</span>, kernel_size=<span class="hljs-number">3</span>, padding=<span class="hljs-number">1</span>),          <span class="hljs-comment"># output[192, 13, 13]</span><br>            nn.ReLU(inplace=<span class="hljs-literal">True</span>),<br>            nn.Conv2d(<span class="hljs-number">192</span>, <span class="hljs-number">192</span>, kernel_size=<span class="hljs-number">3</span>, padding=<span class="hljs-number">1</span>),          <span class="hljs-comment"># output[192, 13, 13]</span><br>            nn.ReLU(inplace=<span class="hljs-literal">True</span>),<br>            nn.Conv2d(<span class="hljs-number">192</span>, <span class="hljs-number">128</span>, kernel_size=<span class="hljs-number">3</span>, padding=<span class="hljs-number">1</span>),          <span class="hljs-comment"># output[128, 13, 13]</span><br>            nn.ReLU(inplace=<span class="hljs-literal">True</span>),<br>            nn.MaxPool2d(kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>),                  <span class="hljs-comment"># output[128, 6, 6]</span><br>        )<br>        self.classifier = nn.Sequential(<br>            nn.Dropout(p=<span class="hljs-number">0.5</span>),<br>            nn.Linear(<span class="hljs-number">128</span> * <span class="hljs-number">6</span> * <span class="hljs-number">6</span>, <span class="hljs-number">2048</span>),<br>            nn.ReLU(inplace=<span class="hljs-literal">True</span>),<br>            nn.Dropout(p=<span class="hljs-number">0.5</span>),<br>            nn.Linear(<span class="hljs-number">2048</span>, <span class="hljs-number">2048</span>),<br>            nn.ReLU(inplace=<span class="hljs-literal">True</span>),<br>            nn.Linear(<span class="hljs-number">2048</span>, num_classes),<br>        )<br>        <span class="hljs-keyword">if</span> init_weights:<br>            self._initialize_weights()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = self.features(x)<br>        x = torch.flatten(x, start_dim=<span class="hljs-number">1</span>)<br>        x = self.classifier(x)<br>        <span class="hljs-keyword">return</span> x<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_initialize_weights</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> self.modules():<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(m, nn.Conv2d):<br>                nn.init.kaiming_normal_(m.weight, mode=<span class="hljs-string">&#x27;fan_out&#x27;</span>, nonlinearity=<span class="hljs-string">&#x27;relu&#x27;</span>)<br>                <span class="hljs-keyword">if</span> m.bias <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                    nn.init.constant_(m.bias, <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(m, nn.Linear):<br>                nn.init.normal_(m.weight, <span class="hljs-number">0</span>, <span class="hljs-number">0.01</span>)<br>                nn.init.constant_(m.bias, <span class="hljs-number">0</span>)<br></code></pre></div></td></tr></table></figure><h1 id="ËÆ≠ÁªÉ‰ª£Á†Å">ËÆ≠ÁªÉ‰ª£Á†Å</h1><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> transforms, datasets, utils<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optim<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><br><span class="hljs-keyword">from</span> model <span class="hljs-keyword">import</span> AlexNet<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    device = torch.device(<span class="hljs-string">&quot;cuda:0&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;using &#123;&#125; device.&quot;</span>.<span class="hljs-built_in">format</span>(device))<br><br>    data_transform = &#123;<br>        <span class="hljs-string">&quot;train&quot;</span>: transforms.Compose([transforms.RandomResizedCrop(<span class="hljs-number">224</span>),<br>                                     transforms.RandomHorizontalFlip(),<br>                                     transforms.ToTensor(),<br>                                     transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))]),<br>        <span class="hljs-string">&quot;val&quot;</span>: transforms.Compose([transforms.Resize((<span class="hljs-number">224</span>, <span class="hljs-number">224</span>)),  <span class="hljs-comment"># cannot 224, must (224, 224)</span><br>                                   transforms.ToTensor(),<br>                                   transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))])&#125;<br><br>    data_root = os.path.abspath(os.path.join(os.getcwd(), <span class="hljs-string">&quot;../..&quot;</span>))  <span class="hljs-comment"># get data root path</span><br>    image_path = os.path.join(data_root, <span class="hljs-string">&quot;data_set&quot;</span>, <span class="hljs-string">&quot;flower_data&quot;</span>)  <span class="hljs-comment"># flower data set path</span><br>    <span class="hljs-keyword">assert</span> os.path.exists(image_path), <span class="hljs-string">&quot;&#123;&#125; path does not exist.&quot;</span>.<span class="hljs-built_in">format</span>(image_path)<br>    train_dataset = datasets.ImageFolder(root=os.path.join(image_path, <span class="hljs-string">&quot;train&quot;</span>),<br>                                         transform=data_transform[<span class="hljs-string">&quot;train&quot;</span>])<br>    train_num = <span class="hljs-built_in">len</span>(train_dataset)<br><br>    <span class="hljs-comment"># &#123;&#x27;daisy&#x27;:0, &#x27;dandelion&#x27;:1, &#x27;roses&#x27;:2, &#x27;sunflower&#x27;:3, &#x27;tulips&#x27;:4&#125;</span><br>    flower_list = train_dataset.class_to_idx<br>    cla_dict = <span class="hljs-built_in">dict</span>((val, key) <span class="hljs-keyword">for</span> key, val <span class="hljs-keyword">in</span> flower_list.items())<br>    <span class="hljs-comment"># write dict into json file</span><br>    json_str = json.dumps(cla_dict, indent=<span class="hljs-number">4</span>)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;class_indices.json&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> json_file:<br>        json_file.write(json_str)<br><br>    batch_size = <span class="hljs-number">32</span><br>    nw = <span class="hljs-built_in">min</span>([os.cpu_count(), batch_size <span class="hljs-keyword">if</span> batch_size &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>, <span class="hljs-number">8</span>])  <span class="hljs-comment"># number of workers</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Using &#123;&#125; dataloader workers every process&#x27;</span>.<span class="hljs-built_in">format</span>(nw))<br><br>    train_loader = torch.utils.data.DataLoader(train_dataset,<br>                                               batch_size=batch_size, shuffle=<span class="hljs-literal">True</span>,<br>                                               num_workers=nw)<br><br>    validate_dataset = datasets.ImageFolder(root=os.path.join(image_path, <span class="hljs-string">&quot;val&quot;</span>),<br>                                            transform=data_transform[<span class="hljs-string">&quot;val&quot;</span>])<br>    val_num = <span class="hljs-built_in">len</span>(validate_dataset)<br>    validate_loader = torch.utils.data.DataLoader(validate_dataset,<br>                                                  batch_size=<span class="hljs-number">4</span>, shuffle=<span class="hljs-literal">False</span>,<br>                                                  num_workers=nw)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;using &#123;&#125; images for training, &#123;&#125; images for validation.&quot;</span>.<span class="hljs-built_in">format</span>(train_num,<br>                                                                           val_num))<br>    <span class="hljs-comment"># test_data_iter = iter(validate_loader)</span><br>    <span class="hljs-comment"># test_image, test_label = test_data_iter.next()</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># def imshow(img):</span><br>    <span class="hljs-comment">#     img = img / 2 + 0.5  # unnormalize</span><br>    <span class="hljs-comment">#     npimg = img.numpy()</span><br>    <span class="hljs-comment">#     plt.imshow(np.transpose(npimg, (1, 2, 0)))</span><br>    <span class="hljs-comment">#     plt.show()</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># print(&#x27; &#x27;.join(&#x27;%5s&#x27; % cla_dict[test_label[j].item()] for j in range(4)))</span><br>    <span class="hljs-comment"># imshow(utils.make_grid(test_image))</span><br><br>    net = AlexNet(num_classes=<span class="hljs-number">5</span>, init_weights=<span class="hljs-literal">True</span>)<br><br>    net.to(device)<br>    loss_function = nn.CrossEntropyLoss()<br>    <span class="hljs-comment"># pata = list(net.parameters())</span><br>    optimizer = optim.Adam(net.parameters(), lr=<span class="hljs-number">0.0002</span>)<br><br>    epochs = <span class="hljs-number">10</span><br>    save_path = <span class="hljs-string">&#x27;./AlexNet.pth&#x27;</span><br>    best_acc = <span class="hljs-number">0.0</span><br>    train_steps = <span class="hljs-built_in">len</span>(train_loader)<br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>        <span class="hljs-comment"># train</span><br>        net.train()<br>        running_loss = <span class="hljs-number">0.0</span><br>        train_bar = tqdm(train_loader, file=sys.stdout)<br>        <span class="hljs-keyword">for</span> step, data <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(train_bar):<br>            images, labels = data<br>            optimizer.zero_grad()<br>            outputs = net(images.to(device))<br>            loss = loss_function(outputs, labels.to(device))<br>            loss.backward()<br>            optimizer.step()<br><br>            <span class="hljs-comment"># print statistics</span><br>            running_loss += loss.item()<br><br>            train_bar.desc = <span class="hljs-string">&quot;train epoch[&#123;&#125;/&#123;&#125;] loss:&#123;:.3f&#125;&quot;</span>.<span class="hljs-built_in">format</span>(epoch + <span class="hljs-number">1</span>,<br>                                                                     epochs,<br>                                                                     loss)<br><br>        <span class="hljs-comment"># validate</span><br>        net.<span class="hljs-built_in">eval</span>()<br>        acc = <span class="hljs-number">0.0</span>  <span class="hljs-comment"># accumulate accurate number / epoch</span><br>        <span class="hljs-keyword">with</span> torch.no_grad():<br>            val_bar = tqdm(validate_loader, file=sys.stdout)<br>            <span class="hljs-keyword">for</span> val_data <span class="hljs-keyword">in</span> val_bar:<br>                val_images, val_labels = val_data<br>                outputs = net(val_images.to(device))<br>                predict_y = torch.<span class="hljs-built_in">max</span>(outputs, dim=<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>]<br>                acc += torch.eq(predict_y, val_labels.to(device)).<span class="hljs-built_in">sum</span>().item()<br><br>        val_accurate = acc / val_num<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[epoch %d] train_loss: %.3f  val_accuracy: %.3f&#x27;</span> %<br>              (epoch + <span class="hljs-number">1</span>, running_loss / train_steps, val_accurate))<br><br>        <span class="hljs-keyword">if</span> val_accurate &gt; best_acc:<br>            best_acc = val_accurate<br>            torch.save(net.state_dict(), save_path)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Finished Training&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></div></td></tr></table></figure><h1 id="È¢ÑÊµã‰ª£Á†Å">È¢ÑÊµã‰ª£Á†Å</h1><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> transforms<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">from</span> model <span class="hljs-keyword">import</span> AlexNet<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    device = torch.device(<span class="hljs-string">&quot;cuda:0&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)<br><br>    data_transform = transforms.Compose(<br>        [transforms.Resize((<span class="hljs-number">224</span>, <span class="hljs-number">224</span>)),<br>         transforms.ToTensor(),<br>         transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))])<br><br>    <span class="hljs-comment"># load image</span><br>    img_path = <span class="hljs-string">&quot;../tulip.jpg&quot;</span><br>    <span class="hljs-keyword">assert</span> os.path.exists(img_path), <span class="hljs-string">&quot;file: &#x27;&#123;&#125;&#x27; dose not exist.&quot;</span>.<span class="hljs-built_in">format</span>(img_path)<br>    img = Image.<span class="hljs-built_in">open</span>(img_path)<br><br>    plt.imshow(img)<br>    <span class="hljs-comment"># [N, C, H, W]</span><br>    img = data_transform(img)<br>    <span class="hljs-comment"># expand batch dimension</span><br>    img = torch.unsqueeze(img, dim=<span class="hljs-number">0</span>)<br><br>    <span class="hljs-comment"># read class_indict</span><br>    json_path = <span class="hljs-string">&#x27;./class_indices.json&#x27;</span><br>    <span class="hljs-keyword">assert</span> os.path.exists(json_path), <span class="hljs-string">&quot;file: &#x27;&#123;&#125;&#x27; dose not exist.&quot;</span>.<span class="hljs-built_in">format</span>(json_path)<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(json_path, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        class_indict = json.load(f)<br><br>    <span class="hljs-comment"># create model</span><br>    model = AlexNet(num_classes=<span class="hljs-number">5</span>).to(device)<br><br>    <span class="hljs-comment"># load model weights</span><br>    weights_path = <span class="hljs-string">&quot;./AlexNet.pth&quot;</span><br>    <span class="hljs-keyword">assert</span> os.path.exists(weights_path), <span class="hljs-string">&quot;file: &#x27;&#123;&#125;&#x27; dose not exist.&quot;</span>.<span class="hljs-built_in">format</span>(weights_path)<br>    model.load_state_dict(torch.load(weights_path))<br><br>    model.<span class="hljs-built_in">eval</span>()<br>    <span class="hljs-keyword">with</span> torch.no_grad():<br>        <span class="hljs-comment"># predict class</span><br>        output = torch.squeeze(model(img.to(device))).cpu()<br>        predict = torch.softmax(output, dim=<span class="hljs-number">0</span>)<br>        predict_cla = torch.argmax(predict).numpy()<br><br>    print_res = <span class="hljs-string">&quot;class: &#123;&#125;   prob: &#123;:.3&#125;&quot;</span>.<span class="hljs-built_in">format</span>(class_indict[<span class="hljs-built_in">str</span>(predict_cla)],<br>                                                 predict[predict_cla].numpy())<br>    plt.title(print_res)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(predict)):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;class: &#123;:10&#125;   prob: &#123;:.3&#125;&quot;</span>.<span class="hljs-built_in">format</span>(class_indict[<span class="hljs-built_in">str</span>(i)],<br>                                                  predict[i].numpy()))<br>    plt.show()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>cv</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>redis</title>
    <link href="/2022/09/19/redis/"/>
    <url>/2022/09/19/redis/</url>
    
    <content type="html"><![CDATA[<p>‰ªÄ‰πàÈ¨ºÂïäÔºÅÂø´ÁÇπÈÉ®ÁΩ≤ÊàêÂäüÔºÅÔºÅÔºÅÔºÅ</p>]]></content>
    
    
    <categories>
      
      <category>ÂºÄÂèë</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ÈÄíÂΩí</title>
    <link href="/2022/08/18/%E9%80%92%E5%BD%92/"/>
    <url>/2022/08/18/%E9%80%92%E5%BD%92/</url>
    
    <content type="html"><![CDATA[<h2 id="powx-n">50„ÄÅPow(x, n)</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/50.png" /></p><p>‰ΩøÁî®ÈÄíÂΩíÁöÑÊÄùÊÉ≥ÔºåÁõ¥Êé•Âæ™ÁéØ‰ºöÂØºËá¥ËøêË°åÊó∂Èó¥ËøáÈïø</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">myPow</span>(<span class="hljs-params">self, x: <span class="hljs-built_in">float</span>, n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">float</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">quickPow</span>(<span class="hljs-params">N</span>):<br>            <span class="hljs-keyword">if</span> N == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span><br>            y = quickPow(N // <span class="hljs-number">2</span>)<br>            <span class="hljs-keyword">return</span> y * y <span class="hljs-keyword">if</span> N % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> y * y * x<br>        <span class="hljs-keyword">return</span> quickPow(n) <span class="hljs-keyword">if</span> n &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">1.0</span> / quickPow(-n)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>LeetCode</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SpringBoot</title>
    <link href="/2022/07/26/SpringBoot/"/>
    <url>/2022/07/26/SpringBoot/</url>
    
    <content type="html"><![CDATA[<h1 id="ÂëòÂ∑•ÁÆ°ÁêÜÁ≥ªÁªü">ÂëòÂ∑•ÁÆ°ÁêÜÁ≥ªÁªü</h1><h2 id="ÂõΩÈôÖÂåñ">ÂõΩÈôÖÂåñ</h2><p>Êñ∞Âª∫propertiesÈÖçÁΩÆÊñá‰ª∂ÔºåÂàõÂª∫Á¨¨‰∫å‰∏™zh_CNÊñá‰ª∂ÊòØ‰ºöËá™Âä®ÁîüÊàêResourceBundleÊñá‰ª∂Â§πÔºåÂèØÈÄöËøáÂè≥ÈîÆÊñá‰ª∂Â§πÂø´ÈÄüÁîüÊàêÈÖçÁΩÆÊñá‰ª∂</p><p><img src="/img/ÂºÄÂèë/SpringBoot/1.png" /></p><p>ÂÆâË£Ö‰∫ÜResource Bundle EditorÊèí‰ª∂ÂêéÔºåÂèØ‰ª•ÁÇπÂáªÂ∑¶‰∏ãËßíÁöÑResourceBundleËøõË°åÂèØËßÜÂåñÈÖçÁΩÆ</p><p><img src="/img/ÂºÄÂèë/SpringBoot/2.png" /></p><p>Â∞±‰ºöÂá∫Áé∞Ëøô‰∏™È°µÈù¢</p><p><img src="/img/ÂºÄÂèë/SpringBoot/3.png" /></p><p>Âè≥ÈîÆÊ∑ªÂä†ÈÖçÁΩÆ</p><p><img src="/img/ÂºÄÂèë/SpringBoot/4.png" /></p><p>ÂèØÈÄöËøáÊ≠§ÊñπÊ≥ïËøõË°åÂèØËßÜÂåñÈÖçÁΩÆÂõΩÈôÖÂåñ</p><p><img src="/img/ÂºÄÂèë/SpringBoot/5.png" /></p><p>ÈöèÂêéÂú®application.properties‰∏≠Â∞ÜÈÖçÁΩÆÊñá‰ª∂ÂØºÂÖ•</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"># ÂõΩÈôÖÂåñÈÖçÁΩÆÊñá‰ª∂Âú®Ëøô<br>spring.messages.basename=i18n.login<br></code></pre></div></td></tr></table></figure><p>Âú®html‰∏≠Â∞ÜÈúÄË¶ÅÂõΩÈôÖÂåñÁöÑÊñáÂ≠óËøõË°å‰øÆÊîπÔºåÈÄöËøá#{xxxx}ÂèñÂæóÔºåÂ¶Ç‰∏ãÂõæÊâÄÁ§∫</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">th:placeholder</span>=<span class="hljs-string">&quot;#&#123;login.username&#125;&quot;</span> <span class="hljs-attr">required</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">autofocus</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">th:placeholder</span>=<span class="hljs-string">&quot;#&#123;login.password&#125;&quot;</span> <span class="hljs-attr">required</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;remember-me&quot;</span>&gt;</span>[[#&#123;login.remember&#125;]]<br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-lg btn-primary btn-block&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;#&#123;login.btn&#125;&quot;</span>&gt;</span>Sign in<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>‰∏∫‰∫ÜËÉΩÂ§üÂú®È°µÈù¢‰∏≠ÁÇπÂáª‰∏≠ÊñáÊàñËÄÖËã±ÊñáÊåâÈíÆËøõË°åÈ°µÈù¢ÁöÑ‰∏≠Ëã±ÊñáÂàáÊç¢ÔºåÊàë‰ª¨Âú®html‰∏≠ÂèëÈÄÅËØ∑Ê±ÇÔºåÂπ∂‰∏îÂú®configÊñá‰ª∂Â§πÊñ∞Âª∫MyLocaleResolverÁ±ª</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-sm&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/index.html(l=&#x27;zh_CN&#x27;)&#125;&quot;</span>&gt;</span>‰∏≠Êñá<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-sm&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/index.html(l=&#x27;en_US&#x27;)&#125;&quot;</span>&gt;</span>English<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyLocaleResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LocaleResolver</span> &#123;<br><br>    <span class="hljs-comment">//Ëß£ÊûêËØ∑Ê±Ç</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Locale <span class="hljs-title function_">resolveLocale</span><span class="hljs-params">(HttpServletRequest httpServletRequest)</span> &#123;<br>        <span class="hljs-comment">//Ëé∑ÂèñËØ∑Ê±Ç‰∏≠ÁöÑËØ≠Ë®ÄÂèÇÊï∞</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">language</span> <span class="hljs-operator">=</span> httpServletRequest.getParameter(<span class="hljs-string">&quot;l&quot;</span>);<br>        <br>        <span class="hljs-comment">//Â¶ÇÊûúÊ≤°ÊúâÂ∞±‰ΩøÁî®ÈªòËÆ§ÁöÑ</span><br>        <span class="hljs-type">Locale</span> <span class="hljs-variable">locale</span> <span class="hljs-operator">=</span> Locale.getDefault();<br>        <br>        <span class="hljs-comment">//Â¶ÇÊûúËØ∑Ê±ÇÁöÑÂèÇÊï∞ÈìæÊé•Êê∫Â∏¶‰∫ÜÂõΩÈôÖÂåñÁöÑÂèÇÊï∞</span><br>        <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(language)) &#123;<br>            <span class="hljs-comment">//zh_CN</span><br>            String[] split = language.split(<span class="hljs-string">&quot;_&quot;</span>);<br>            <span class="hljs-comment">//ÂõΩÂÆ∂ÔºåÂú∞Âå∫</span><br>            locale = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Locale</span>(split[<span class="hljs-number">0</span>], split[<span class="hljs-number">1</span>]);<br>        &#125;<br>        <span class="hljs-keyword">return</span> locale;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setLocale</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Locale locale)</span> &#123;<br><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ÊúÄÂêéÂú®ËßÜÂõæËß£ÊûêÂô®‰∏≠Ê≥®ÂÜåBean</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMVCConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br><br>    <span class="hljs-comment">//È°µÈù¢Ë∑≥ËΩ¨</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> &#123;<br>        registry.addViewController(<span class="hljs-string">&quot;/&quot;</span>).setViewName(<span class="hljs-string">&quot;index&quot;</span>);<br>        registry.addViewController(<span class="hljs-string">&quot;/index.html&quot;</span>).setViewName(<span class="hljs-string">&quot;index&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//Ëá™ÂÆö‰πâÁöÑÂõΩÈôÖÂåñ‰∏ªÈîÆÂ∞±ÁîüÊïà‰∫Ü</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> LocaleResolver <span class="hljs-title function_">localeResolver</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyLocaleResolver</span>();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="ÁôªÂΩïÂäüËÉΩÂÆûÁé∞">ÁôªÂΩïÂäüËÉΩÂÆûÁé∞</h2><p>Âú®html‰∏≠ËøõË°åË°®ÂçïËØ∑Ê±Ç</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-signin&quot;</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/user/login&#125;&quot;</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>ÂêéÁ´ØÊñ∞Âª∫LoginControllerÁ±ªËøõË°åÂ§ÑÁêÜ</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginController</span> &#123;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/user/login&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username, <span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String password, Model model)</span> &#123;<br>        <span class="hljs-comment">//ÂÖ∑‰ΩìÁöÑ‰∏öÂä°</span><br>        <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(username) &amp;&amp; <span class="hljs-string">&quot;123123&quot;</span>.equals(password)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;dashboard&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//ÂëäËØâÁî®Êà∑Ôºå‰Ω†ÁôªÂΩïÈîôËØØ‰∫Ü</span><br>            model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>Âú®ÂâçÁ´ØÈ°µÈù¢‰∏≠ÊòæÁ§∫ÁôªÂΩïÈîôËØØÁöÑ‰ø°ÊÅØ</p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--Â¶ÇÊûúmsgÊ∂àÊÅØ‰∏∫Á©∫ÔºåÂ∞±‰∏çÊòæÁ§∫Ê∂àÊÅØ--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: red&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;msg&#125;&quot;</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;not #strings.isEmpty(msg)&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>‰∏∫‰∫Ü‰ΩøÂæóÊõ¥Âä†ËßÑËåÉÔºåÊâÄ‰ª•Êàë‰ª¨Ë¶Å‰ΩøÁî®ÈáçÂÆöÂêëÔºå‰ΩøÂæóÁΩëÂùÄÈ°µÈù¢‰∏ç‰ºöÊòæÁ§∫ËøáÂ§ö‰ø°ÊÅØ</p><p>ÂÖàÂú®ËßÜÂõæËß£ÊûêÂô®‰∏≠Ê∑ªÂä†main.htmlÈ°µÈù¢Ë∑≥ËΩ¨</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//È°µÈù¢Ë∑≥ËΩ¨</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> &#123;<br>        registry.addViewController(<span class="hljs-string">&quot;/&quot;</span>).setViewName(<span class="hljs-string">&quot;index&quot;</span>);<br>        registry.addViewController(<span class="hljs-string">&quot;/index.html&quot;</span>).setViewName(<span class="hljs-string">&quot;index&quot;</span>);<br>        registry.addViewController(<span class="hljs-string">&quot;/main.html&quot;</span>).setViewName(<span class="hljs-string">&quot;dashboard&quot;</span>);<br>    &#125;<br></code></pre></div></td></tr></table></figure><p>‰øÆÊîπcontroller‰∏≠ÁöÑÈáçÂÆöÂêë</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (!StringUtils.isEmpty(username) &amp;&amp; <span class="hljs-string">&quot;123123&quot;</span>.equals(password)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/main.html&quot;</span>;<br>        &#125;<br></code></pre></div></td></tr></table></figure><p>‰ΩøÁî®‰∫ÜÈáçÂÆöÂêëÂêéÔºåÊàë‰ª¨‰∏çÈúÄË¶ÅÁôªÂΩïÈÉΩÂèØ‰ª•ÈÄöËøáËæìÂÖ•ÁΩëÂùÄËøõË°åËÆøÈóÆÔºåÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶ÅÊã¶Êà™Âô®</p><h2 id="ÁôªÂΩïÊã¶Êà™Âô®">ÁôªÂΩïÊã¶Êà™Âô®</h2><p>Êã¶Êà™Âô®ÁöÑÊÄùÊÉ≥ÊòØÈÄöËøáÊü•Áúãsession‰∏≠ÊòØÂê¶ÊúâÁôªÂΩïÁöÑ‰ø°ÊÅØ‰ªéËÄåÂà§Êñ≠ÊòØÂê¶Â∑≤ÁªèÁôªÂΩïÔºåÊâÄ‰ª•Êàë‰ª¨ÂÖàÂú®LoginController‰∏≠ËæìÂÖ•ÂèÇÊï∞ÂÖàÂä†ÂÖ•HttpSessionÔºåÂú®ÊàêÂäüÁôªÂΩïÁöÑÊó∂ÂÄôÊ∑ªÂä†session</p><p><code>addPathPatternsÔºöËØ•ÊñπÊ≥ïÁî®‰∫éÊåáÂÆöÊã¶Êà™Ë∑ØÂæÑÔºå‰æãÂ¶ÇÊã¶Êà™Ë∑ØÂæÑ‰∏∫‚Äú/**‚ÄùÔºåË°®Á§∫Êã¶Êà™ÊâÄÊúâËØ∑Ê±ÇÔºåÂåÖÊã¨ÂØπÈùôÊÄÅËµÑÊ∫êÁöÑËØ∑Ê±Ç„ÄÇ</code><code>excludePathPatternsÔºöËØ•ÊñπÊ≥ïÁî®‰∫éÊéíÈô§Êã¶Êà™Ë∑ØÂæÑÔºåÂç≥ÊåáÂÆö‰∏çÈúÄË¶ÅË¢´Êã¶Êà™Âô®Êã¶Êà™ÁöÑËØ∑Ê±Ç„ÄÇ</code></p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginController</span> &#123;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/user/login&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username, <span class="hljs-meta">@RequestParam(&quot;password&quot;)</span> String password, Model model, HttpSession session)</span> &#123;<br>        <span class="hljs-comment">//ÂÖ∑‰Ωì</span><br>        <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(username) &amp;&amp; <span class="hljs-string">&quot;123123&quot;</span>.equals(password)) &#123;<br>            session.setAttribute(<span class="hljs-string">&quot;loginUser&quot;</span>, username);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/main.html&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//ÂëäËØâÁî®Êà∑Ôºå‰Ω†ÁôªÂΩïÈîôËØØ‰∫Ü</span><br>            model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;Áî®Êà∑ÂêçÊàñÂØÜÁ†ÅÈîôËØØ&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ÈöèÂêéÂú®ConfigÊñá‰ª∂Â§π‰∏≠Ê∑ªÂä†LoginHandlerInterceptorÊã¶Êà™Âô®Á±ªÔºåËøîÂõûtrue‰ª£Ë°®ÂèØ‰ª•ËÆøÈóÆÔºåËøîÂõûfalse‰ª£Ë°®‰∏çËÉΩËÆøÈóÆ</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginHandlerInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-comment">//ÁôªÂΩïÊàêÂäü‰πãÂêéÔºåÂ∫îËØ•ÊúâÁî®Êà∑ÁöÑsession</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">loginUser</span> <span class="hljs-operator">=</span> request.getSession().getAttribute(<span class="hljs-string">&quot;loginUser&quot;</span>);<br><br>        <span class="hljs-keyword">if</span> (loginUser == <span class="hljs-literal">null</span>) &#123;<br>            request.setAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;Ê≤°ÊúâÊùÉÈôêÔºåËØ∑ÂÖàÁôªÂΩï&quot;</span>);<br>            request.getRequestDispatcher(<span class="hljs-string">&quot;/index.html&quot;</span>).forward(request, response);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ÊúÄÂêéÂú®ËßÜÂõæËß£ÊûêÂô®‰∏≠Ê∑ªÂä†Êã¶Êà™Âô®ÔºåÂÖ∂‰∏≠excludePathPatterns‰∏≠ÁöÑÂèÇÊï∞‰ª£Ë°®‰∏çÈúÄË¶ÅËøáÊª§ÁöÑËµÑÊ∫êÔºå‰æãÂ¶ÇÁôªÂΩïÈ°µÈù¢ÂíåÈùôÊÄÅËµÑÊ∫ê</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginHandlerInterceptor</span>()).addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>).excludePathPatterns(<span class="hljs-string">&quot;/index.html&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/user/login&quot;</span>, <span class="hljs-string">&quot;/static/**&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="Â±ïÁ§∫ÂëòÂ∑•ÂàóË°®">Â±ïÁ§∫ÂëòÂ∑•ÂàóË°®</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmploeeController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    EmployeeDao employeeDao;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/emps&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">list</span><span class="hljs-params">(Model model)</span> &#123;<br>        Collection&lt;Employee&gt; employees = employeeDao.getAll();<br>        model.addAttribute(<span class="hljs-string">&quot;emps&quot;</span>, employees);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;emp/list&quot;</span>;<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;main&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-md-9 ml-sm-auto col-lg-10 pt-3 px-4&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-sm btn-success&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/emp&#125;&quot;</span>&gt;</span>Ê∑ªÂä†ÂëòÂ∑•<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table-responsive&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table table-striped table-sm&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>id<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>lastName<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>email<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>gender<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>department<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>birth<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Êìç‰Ωú<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;emp:$&#123;emps&#125;&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;emp.getId()&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;emp.getLastName()&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;emp.getEmail()&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;emp.getGender()==0?&#x27;Â•≥&#x27;:&#x27;Áî∑&#x27;&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;emp.getDepartment().getDepartmentName()&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;#dates.format(emp.getBirth(), &#x27;yyyy-MM-dd HH:mm:ss&#x27;)&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-sm btn-primary&quot;</span>&gt;</span>ÁºñËæë<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-sm btn-danger&quot;</span>&gt;</span>Âà†Èô§<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h2 id="Â¢ûÂä†ÂëòÂ∑•">Â¢ûÂä†ÂëòÂ∑•</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/emp&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">addEmp</span><span class="hljs-params">(Employee employee)</span> &#123;<br><br>        employeeDao.save(employee);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/emps&quot;</span>;<br>    &#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/emp&#125;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>LastName<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;lastName&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Êµ∑ÁªµÂÆùÂÆù&quot;</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Email<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;1176244270@qq.com&quot;</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Gender<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check form-check-inline&quot;</span>&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-input&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gender&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-label&quot;</span>&gt;</span>Áî∑<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                 <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check form-check-inline&quot;</span>&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-input&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gender&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0&quot;</span>&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-label&quot;</span>&gt;</span>Â•≥<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                 <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>department<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;department.id&quot;</span>&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;dept:$&#123;departments&#125;&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;dept.getDepartmentName()&#125;&quot;</span> <span class="hljs-attr">th:value</span>=<span class="hljs-string">&quot;$&#123;dept.getId()&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                 <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Birth<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;birth&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Âò§Âò§Âò§&quot;</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span>&gt;</span>Ê∑ªÂä†<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h2 id="‰øÆÊîπÂëòÂ∑•">‰øÆÊîπÂëòÂ∑•</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ÂéªÂëòÂ∑•ÁöÑ‰øÆÊîπÈ°µÈù¢</span><br>    <span class="hljs-meta">@GetMapping(&quot;/emp/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toUpdateEmp</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span>Integer id, Model model)</span> &#123;<br>        <span class="hljs-comment">//Êü•Âá∫Êù•ÂéüÊù•ÁöÑÊï∞ÊçÆ</span><br>        <span class="hljs-type">Employee</span> <span class="hljs-variable">employee</span> <span class="hljs-operator">=</span> employeeDao.getEmployById(id);<br>        model.addAttribute(<span class="hljs-string">&quot;emp&quot;</span>, employee);<br><br>        Collection&lt;Department&gt; departments = departmentDao.getDepartments();<br>        model.addAttribute(<span class="hljs-string">&quot;departments&quot;</span>, departments);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;emp/update&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/updateEmp&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">updateEmp</span><span class="hljs-params">(Employee employee)</span> &#123;<br>        employeeDao.save(employee);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/emps&quot;</span>;<br>    &#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-sm btn-primary&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/emp/&#123;id&#125;(id=$&#123;emp.getId()&#125;)&#125;&quot;</span>&gt;</span>ÁºñËæë<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></div></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/updateEmp&#125;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">th:value</span>=<span class="hljs-string">&quot;$&#123;emp.getId()&#125;&quot;</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>LastName<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">th:value</span>=<span class="hljs-string">&quot;$&#123;emp.getLastName()&#125;&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;lastName&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Êµ∑ÁªµÂÆùÂÆù&quot;</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Email<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">th:value</span>=<span class="hljs-string">&quot;$&#123;emp.getEmail()&#125;&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;1176244270@qq.com&quot;</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Gender<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check form-check-inline&quot;</span>&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">th:checked</span>=<span class="hljs-string">&quot;$&#123;emp.getGender()==1&#125;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-input&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gender&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-label&quot;</span>&gt;</span>Áî∑<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                 <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check form-check-inline&quot;</span>&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">th:checked</span>=<span class="hljs-string">&quot;$&#123;emp.getGender()==0&#125;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-input&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gender&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0&quot;</span>&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-check-label&quot;</span>&gt;</span>Â•≥<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                 <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>department<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;department.id&quot;</span>&gt;</span><br>                     <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">th:selected</span>=<span class="hljs-string">&quot;$&#123;dept.getId() == emp.getDepartment().getId()&#125;&quot;</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;dept:$&#123;departments&#125;&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;dept.getDepartmentName()&#125;&quot;</span> <span class="hljs-attr">th:value</span>=<span class="hljs-string">&quot;$&#123;dept.getId()&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                 <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Birth<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">th:value</span>=<span class="hljs-string">&quot;$&#123;#dates.format(emp.getBirth(), &#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;birth&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Âò§Âò§Âò§&quot;</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span>&gt;</span>‰øÆÊîπ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h2 id="Âà†Èô§ÂëòÂ∑•">Âà†Èô§ÂëòÂ∑•</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//Âà†Èô§ÂëòÂ∑•</span><br>    <span class="hljs-meta">@GetMapping(&quot;/deleteEmp/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">deleteEmp</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-type">int</span> id)</span> &#123;<br>        employeeDao.delete(id);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/emps&quot;</span>;<br>    &#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-sm btn-danger&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/deleteEmp/&#123;id&#125;(id=$&#123;emp.getId()&#125;)&#125;&quot;</span>&gt;</span>Âà†Èô§<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h2 id="section">404</h2><p>SpringBootÂè™Áî®Âú®templates‰∏≠Êñ∞Âª∫‰∏Ä‰∏™errorÊñá‰ª∂Â§πÔºåÂú®error‰∏≠ÊîæÁΩÆÊàë‰ª¨Ëá™ÂÆö‰πâÁöÑ404.htmlÂç≥ÂèØ</p><h2 id="Ê≥®ÈîÄ">Ê≥®ÈîÄ</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/user/logout&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">logout</span><span class="hljs-params">(HttpSession session)</span> &#123;<br>        session.invalidate();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/index.html&quot;</span>;<br>    &#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav-link&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/user/logout&#125;&quot;</span>&gt;</span>ÈÄÄÂá∫<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h1 id="spring-data">Spring Data</h1><h2 id="Êï¥Âêàjdbc">Êï¥ÂêàJDBC</h2><p>Êñ∞Âª∫È°πÁõÆÊó∂ÈúÄË¶ÅÂãæÈÄâ‰∏äÂÖ≥Á≥ªÂûãÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑ<code>JDBC API</code>‰ª•Âèä<code>MYSQL Driver</code></p><p>È¶ñÂÖàÊñ∞Âª∫‰∏Ä‰∏™application.ymlÊñá‰ª∂ÔºåÂú®Êñá‰ª∂‰∏≠ËæìÂÖ•</p><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123123</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mybatis?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br></code></pre></div></td></tr></table></figure><p>ÁºñÂÜô‰∏Ä‰∏™ControllerÊù•ÊµãËØï‰∏Ä‰∏ãjdbcÁöÑ‰ΩøÁî®</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JDBCController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    JdbcTemplate jdbcTemplate;<br><br>    <span class="hljs-comment">//Êü•ËØ¢Êï∞ÊçÆÂ∫ìÁöÑÊâÄÊúâ‰ø°ÊÅØ</span><br>    <span class="hljs-meta">@GetMapping(&quot;/userList&quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">userList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from user&quot;</span>;<br>        List&lt;Map&lt;String, Object&gt;&gt; list_maps = jdbcTemplate.queryForList(sql);<br>        <span class="hljs-keyword">return</span> list_maps;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/addList&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">addUser</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;insert into mybatis.user values (4, &#x27;Â∞èÊòé&#x27;, &#x27;123123&#x27;)&quot;</span>;<br>        jdbcTemplate.update(sql);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;add-ok&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/updateList/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-type">int</span> id)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;update mybatis.user set name=?, pwd=? where id =&quot;</span> + id;<br>        Object[] objects = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">2</span>];<br>        objects[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;Â∞èÊòé2&quot;</span>;<br>        objects[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;asdfasdf&quot;</span>;<br>        jdbcTemplate.update(sql, objects);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;update-ok&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/deleteList/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-type">int</span> id)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;delete from mybatis.user where id=?&quot;</span> ;<br>        jdbcTemplate.update(sql, id);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;delete-ok&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="Êï¥ÂêàdruidÊï∞ÊçÆÊ∫ê">Êï¥ÂêàDruidÊï∞ÊçÆÊ∫ê</h2><p>Ê∑ªÂä†‰æùËµñ</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>Âú®application.yml‰∏≠ËøõË°åDruidÈÖçÁΩÆ</p><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123123</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mybatis?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br><br>    <span class="hljs-comment">#SpringBootÈªòËÆ§ÊòØ‰∏çÊ≥®ÂÖ•Ëøô‰∫õÁöÑÔºåÈúÄË¶ÅËá™Â∑±ÁªëÂÆö</span><br>    <span class="hljs-comment">#druidÊï∞ÊçÆÊ∫ê‰∏ìÊúâÈÖçÁΩÆ</span><br>    <span class="hljs-attr">initialSize:</span> <span class="hljs-number">5</span><br>    <span class="hljs-attr">minIdle:</span> <span class="hljs-number">5</span><br>    <span class="hljs-attr">maxActive:</span> <span class="hljs-number">20</span><br>    <span class="hljs-attr">maxWait:</span> <span class="hljs-number">60000</span><br>    <span class="hljs-attr">timeBetweenEvictionRunsMillis:</span> <span class="hljs-number">60000</span><br>    <span class="hljs-attr">minEvictableIdleTimeMillis:</span> <span class="hljs-number">300000</span><br>    <span class="hljs-attr">validationQuery:</span> <span class="hljs-string">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-string">FROM</span> <span class="hljs-string">DUAL</span><br>    <span class="hljs-attr">testWhileIdle:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">testOnBorrow:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">testOnReturn:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">poolPreparedStatements:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment">#ÈÖçÁΩÆÁõëÊéßÁªüËÆ°Êã¶Êà™ÁöÑfiltersÔºåstatÔºöÁõëÊéßÁªüËÆ°„ÄÅlog4jÔºöÊó•ÂøóËÆ∞ÂΩï„ÄÅwallÔºöÈò≤Âæ°sqlÊ≥®ÂÖ•</span><br>    <span class="hljs-comment">#Â¶ÇÊûúÂÖÅËÆ∏Êä•ÈîôÔºåjava.lang.ClassNotFoundException: org.apache.Log4j.Properity</span><br>    <span class="hljs-comment">#ÂàôÂØºÂÖ•log4j ‰æùËµñÂ∞±Ë°å</span><br>    <span class="hljs-attr">filters:</span> <span class="hljs-string">stat,wall,log4j</span><br>    <span class="hljs-attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="hljs-number">20</span><br>    <span class="hljs-attr">useGlobalDataSourceStat:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">connectionoProperties:</span> <span class="hljs-string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span><br></code></pre></div></td></tr></table></figure><p>Êàë‰ª¨Êñ∞Âª∫configÊñá‰ª∂Â§πÔºåÊñ∞Âª∫‰∏Ä‰∏™DruidConfigÁ±ªËøõË°åËá™ÂÆö‰πâÈÖçÁΩÆ</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DruidConfig</span> &#123;<br><br>    <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">druidDataSource</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DruidDataSource</span>();<br>    &#125;<br><br>    <span class="hljs-comment">//ÂêéÂè∞ÁõëÊéß</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title function_">statViewServlet</span><span class="hljs-params">()</span> &#123;<br>        ServletRegistrationBean&lt;StatViewServlet&gt; bean= <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletRegistrationBean</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StatViewServlet</span>(), <span class="hljs-string">&quot;/druid/*&quot;</span>);<br>        <span class="hljs-comment">//ÂêéÂè∞ÈúÄË¶ÅÊúâ‰∫∫ÁôªÂΩï</span><br>        HashMap&lt;String, String&gt; initParameters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-comment">//Â¢ûÂä†ÈÖçÁΩÆ</span><br>        initParameters.put(<span class="hljs-string">&quot;loinUsername&quot;</span>, <span class="hljs-string">&quot;admin&quot;</span>); <span class="hljs-comment">//ÁôªÂΩïkeyÊòØÂõ∫ÂÆöÁöÑ loinUsernameÂíåloginPassword</span><br>        initParameters.put(<span class="hljs-string">&quot;loginPassword&quot;</span>, <span class="hljs-string">&quot;123123&quot;</span>);<br><br>        <span class="hljs-comment">//ÂÖÅËÆ∏Ë∞ÅËÆøÈóÆ</span><br>        initParameters.put(<span class="hljs-string">&quot;allow&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br><br>        bean.setInitParameters(initParameters);<span class="hljs-comment">//ÂàùÂßãÂåñÂèÇÊï∞</span><br>        <span class="hljs-keyword">return</span> bean;<br>    &#125;<br></code></pre></div></td></tr></table></figure><p>Âú®ÁΩëÈ°µ‰∏≠ËæìÂÖ•<code>localhost:8080/druid</code>Âç≥ÂèØËøõÂÖ•ÂêéÂè∞ÁõëÊéßÔºåÂèØ‰ª•Âú®ÁõëÊéß‰∏≠Êü•ÁúãÂêÑÁßçsqlÔºåSessionÁ≠â„ÄÇ</p><h2 id="Êï¥Âêàmybatis">Êï¥ÂêàMyBatis</h2><p>ÂØºÂÖ•‰∏éSpringBootÊï¥ÂêàÁöÑ‰æùËµñ</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>Êñ∞Âª∫‰∏Ä‰∏™pojo</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String pwd;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>Êñ∞Âª∫‰∏Ä‰∏™MapperÊé•Âè£</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//Ëøô‰∏™Ê≥®Ëß£Ë°®Á§∫‰∫ÜËøôÊòØ‰∏Ä‰∏™mybatisÁöÑmapperÁ±ª</span><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    List&lt;User&gt; <span class="hljs-title function_">queryUserList</span><span class="hljs-params">()</span>;<br><br>    User <span class="hljs-title function_">queryUserById</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span>;<br><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">(User user)</span>;<br><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(User user)</span>;<br><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ÂØπ‰∫éMapperÊé•Âè£ÁöÑÂÆûÁé∞ÈúÄË¶ÅÂú®resourcesÊñá‰ª∂Â§π‰∏≠ËøõË°åÂÆûÁé∞ÔºåÊñ∞Âª∫Êñá‰ª∂ÁõÆÂΩï‰∏∫</p><ul><li>resources<ul><li>mybatis<ul><li>mapper<ul><li>UserMapper.xml</li></ul></li></ul></li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span><br><span class="hljs-meta">        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//dtd Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.zhou.mapper.UserMapper&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryUserList&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>        select * from user;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryUserById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>        select * from user where id = #&#123;id&#125;;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>        insert into mybatis.user(id, name, pwd) VALUES (#&#123;id&#125;,#&#123;name&#125;,#&#123;pwd&#125;);<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateUser&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>        update user set name = #&#123;name&#125;,pwd=#&#123;pwd&#125; where id = #&#123;id&#125;;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteUserById&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;int&quot;</span>&gt;</span><br>        delete from user where id = #&#123;id&#125;;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>‰∏∫‰∫Ü‰ΩøÂæóÂåÖËÉΩÂ§üË¢´Êâ´ÊèèÂà∞ÔºåÈúÄË¶ÅÂú®application‰∏≠ËøõË°åÈÖçÁΩÆ</p><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-comment"># Êï¥Âêàmybatis</span><br><span class="hljs-attr">mybatis.type-aliases-package</span>=<span class="hljs-string">com.zhou.pojo</span><br><span class="hljs-attr">mybatis.mapper-locations</span>=<span class="hljs-string">classpath:mybatis/mapper/*.xml</span><br></code></pre></div></td></tr></table></figure><p>‰∏∫‰∫ÜÂ≠¶‰π†ÔºåÁúÅÁï•‰∫ÜserviceÂ±ÇÔºåÁõ¥Êé•‰ªéControllerÂ±ÇË∞ÉÁî®Mapper</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/queryUserList&quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">queryUserList</span><span class="hljs-params">()</span> &#123;<br>        List&lt;User&gt; users = userMapper.queryUserList();<br>        <span class="hljs-keyword">return</span> users;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/addUser&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">addUser</span><span class="hljs-params">()</span> &#123;<br>        userMapper.addUser(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;ËÇòÂ≠êÂºÄ&quot;</span>, <span class="hljs-string">&quot;123123&quot;</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;add_finished&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/updateUser&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">updateUser</span><span class="hljs-params">()</span> &#123;<br>        userMapper.updateUser(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;ËÇòÂ≠êÂºÄ2&quot;</span>, <span class="hljs-string">&quot;12351234&quot;</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;update_finished&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/deleteUser&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">deleteUser</span><span class="hljs-params">()</span> &#123;<br>        userMapper.deleteUser(<span class="hljs-number">4</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;delete_finished&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h1 id="springsecurity">SpringSecurity</h1><p>shiroÂíåSpringSecurityÂæàÂÉèÔºåÈô§‰∫ÜÁ±ª‰∏ç‰∏ÄÊ†∑ÔºåÂêçÂ≠ó‰∏ç‰∏ÄÊ†∑</p><ul><li>ÂäüËÉΩÊùÉÈôê</li><li>ËÆøÈóÆÊùÉÈôê</li><li>ËèúÂçïÊùÉÈôê</li><li>Êã¶Êà™Âô®„ÄÅËøáÊª§Âô®</li></ul><h2 id="Áî®Êà∑ËÆ§ËØÅÂíåÊéàÊùÉ">Áî®Êà∑ËÆ§ËØÅÂíåÊéàÊùÉ</h2><p>ÂØºÂÖ•Ê®°Êùø</p><p><img src="/img/ÂºÄÂèë/SpringBoot/8.png" /></p><p>ÂÖàÂØπÈ°µÈù¢ËÆøÈóÆËøõË°åÁºñÂÜôcontrollerËøõË°åË∑≥ËΩ¨</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouterController</span> &#123;<br>    <span class="hljs-meta">@RequestMapping(&#123;&quot;/&quot;,&quot;/index&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/toLogin&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toLogin</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;views/login&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/level1/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">level1</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-type">int</span> id)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;views/level1/&quot;</span> + id;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/level2/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">level2</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-type">int</span> id)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;views/level2/&quot;</span> + id;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/level3/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">level3</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-type">int</span> id)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;views/level3/&quot;</span> + id;<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><p>ËÆøÈóÆ‰∏ªÈ°µ‰∏∫</p><p><img src="/img/ÂºÄÂèë/SpringBoot/9.png" /></p><p>ÂØºÂÖ•‰æùËµñ</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>Áé∞Âú®Êàë‰ª¨Ë¶ÅÂÆûÁé∞‰∏çÂêåÊùÉÈôêÁöÑ‰∫∫ËÆøÈóÆ‰∏çÂêåÁöÑÂäüËÉΩÈ°µÈù¢Ôºå‰æãÂ¶ÇÂè™Êúâvip1ÊùÉÈôêÁöÑÁî®Êà∑ÊâçËÉΩËÆøÈóÆlevel1‰∏ãÁöÑÈ°µÈù¢ÔºåËøôÊó∂ÂÄôÈúÄË¶ÅÊñ∞Âª∫‰∏Ä‰∏™ÈÖçÁΩÆÁ±ªËøõË°åÈÖçÁΩÆ</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@EnableWebSecurity</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> &#123;<br><br>    <span class="hljs-comment">//ÊéàÊùÉ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//È¶ñÈ°µÊâÄÊúâ‰∫∫ÈÉΩÂèØ‰ª•ËÆøÈóÆÔºåÂäüËÉΩÈ°µÂè™ÊúâÂØπÂ∫îÊúâÊùÉÈôêÁöÑ‰∫∫ÊâçËÉΩËÆøÈóÆ</span><br>        <span class="hljs-comment">//Á¨¨‰∏ÄË°å‰ª£Ë°®È¶ñÈ°µÊâÄÊúâ‰∫∫ÈÉΩÂèØ‰ª•ËÆøÈóÆ Á¨¨‰∫åË°å‰ª£Ë°®ÈúÄË¶Åvip1ÊâçËÉΩËøõË°åËÆøÈóÆ</span><br>        http.authorizeRequests()<br>                .antMatchers(<span class="hljs-string">&quot;/&quot;</span>).permitAll()<br>                .antMatchers(<span class="hljs-string">&quot;/level1/**&quot;</span>).hasRole(<span class="hljs-string">&quot;vip1&quot;</span>)<br>                .antMatchers(<span class="hljs-string">&quot;/level2/**&quot;</span>).hasRole(<span class="hljs-string">&quot;vip2&quot;</span>)<br>                .antMatchers(<span class="hljs-string">&quot;/level3/**&quot;</span>).hasRole(<span class="hljs-string">&quot;vip3&quot;</span>);<br><br>        <span class="hljs-comment">//Ê≤°ÊúâÊùÉÈôêÈªòËÆ§‰ºöÂõûÂà∞ÁôªÈôÜÈ°µÈù¢</span><br>        http.formLogin();<br>    &#125;<br><br>    <span class="hljs-comment">//ËÆ§ËØÅ</span><br>    <span class="hljs-comment">//ÂØÜÁ†ÅÁºñÁ†ÅÔºöPasswordEncoder</span><br>    <span class="hljs-comment">//Âú®Spring Security 5.0+ Êñ∞Â¢û‰∫ÜÂæàÂ§öÁöÑÂä†ÂØÜÊñπÊ≥ï ÈúÄË¶ÅÂØπÂØÜÁ†ÅËøõË°åÂä†ÂØÜÔºåÂê¶Âàô‰ºöÊä•Èîô</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-comment">//Ëøô‰∫õÊï∞ÊçÆÊ≠£Â∏∏Â∫îËØ•‰ªéÊï∞ÊçÆÂ∫ì‰∏≠ËØª</span><br>        auth.inMemoryAuthentication().passwordEncoder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>())<br>                .withUser(<span class="hljs-string">&quot;zhouzikai&quot;</span>).password(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>().encode(<span class="hljs-string">&quot;123123&quot;</span>)).roles(<span class="hljs-string">&quot;vip2&quot;</span>, <span class="hljs-string">&quot;vip3&quot;</span>)<br>                .and()<br>                .withUser(<span class="hljs-string">&quot;root&quot;</span>).password(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>().encode(<span class="hljs-string">&quot;123123&quot;</span>)).roles(<span class="hljs-string">&quot;vip1&quot;</span>, <span class="hljs-string">&quot;vip2&quot;</span>, <span class="hljs-string">&quot;vip3&quot;</span>)<br>                .and()<br>                .withUser(<span class="hljs-string">&quot;guest&quot;</span>).password(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>().encode(<span class="hljs-string">&quot;123123&quot;</span>)).roles(<span class="hljs-string">&quot;vip1&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="Ê≥®ÈîÄÂèäÊùÉÈôêÊéßÂà∂">Ê≥®ÈîÄÂèäÊùÉÈôêÊéßÂà∂</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ÊéàÊùÉ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//È¶ñÈ°µÊâÄÊúâ‰∫∫ÈÉΩÂèØ‰ª•ËÆøÈóÆÔºåÂäüËÉΩÈ°µÂè™ÊúâÂØπÂ∫îÊúâÊùÉÈôêÁöÑ‰∫∫ÊâçËÉΩËÆøÈóÆ</span><br>        <span class="hljs-comment">//Á¨¨‰∏ÄË°å‰ª£Ë°®È¶ñÈ°µÊâÄÊúâ‰∫∫ÈÉΩÂèØ‰ª•ËÆøÈóÆ Á¨¨‰∫åË°å‰ª£Ë°®ÈúÄË¶Åvip1ÊâçËÉΩËøõË°åËÆøÈóÆ</span><br>        http.authorizeRequests()<br>                .antMatchers(<span class="hljs-string">&quot;/&quot;</span>).permitAll()<br>                .antMatchers(<span class="hljs-string">&quot;/level1/**&quot;</span>).hasRole(<span class="hljs-string">&quot;vip1&quot;</span>)<br>                .antMatchers(<span class="hljs-string">&quot;/level2/**&quot;</span>).hasRole(<span class="hljs-string">&quot;vip2&quot;</span>)<br>                .antMatchers(<span class="hljs-string">&quot;/level3/**&quot;</span>).hasRole(<span class="hljs-string">&quot;vip3&quot;</span>);<br><br>        <span class="hljs-comment">//Ê≤°ÊúâÊùÉÈôêÈªòËÆ§‰ºöÂõûÂà∞ÁôªÈôÜÈ°µÈù¢</span><br>        http.formLogin();<br><br>        <span class="hljs-comment">//Ê≥®ÈîÄÔºåÂºÄÂêØ‰∫ÜÊ≥®ÈîÄÂäüËÉΩÔºåÂÜçË∑≥Âà∞È¶ñÈ°µ</span><br>        http.logout().logoutSuccessUrl(<span class="hljs-string">&quot;/&quot;</span>);<br>    &#125;<br></code></pre></div></td></tr></table></figure><h2 id="ËÆ∞‰ΩèÊàëÂèäÈ¶ñÈ°µÂÆöÂà∂">ËÆ∞‰ΩèÊàëÂèäÈ¶ñÈ°µÂÆöÂà∂</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ÂºÄÂêØËÆ∞‰ΩèÊàëÂäüËÉΩ:cookieÔºåÈªòËÆ§‰øùÂ≠ò‰∏§Âë®</span><br>        http.rememberMe();<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//Ê≤°ÊúâÊùÉÈôêÈªòËÆ§‰ºöÂõûÂà∞ÁôªÈôÜÈ°µÈù¢</span><br>        <span class="hljs-comment">//ÂÆöÂà∂ÁôªÂΩïÈ°µÂà∞toLogin</span><br>        http.formLogin().loginPage(<span class="hljs-string">&quot;/toLogin&quot;</span>);<br></code></pre></div></td></tr></table></figure><h1 id="swagger">Swagger</h1><h2 id="ÈõÜÊàêswagger">ÈõÜÊàêswagger</h2><p>ÂØºÂÖ•‰æùËµñ</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><p>ÁºñÂÜôhelloÁöÑController</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br><br>    <span class="hljs-meta">@RequestMapping(value = &quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ÈÖçÁΩÆSwagger</p><ul><li>Êñ∞Âª∫config.SwaggerConfig.java</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableSwagger2</span>   <span class="hljs-comment">//ÂºÄÂêØSwagger2</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwaggerConfig</span> &#123;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><p>ÊµãËØïËøêË°å</p><ul><li>ËæìÂÖ•<code>localhost:8080/swagger-ui.html</code></li></ul><p><img src="/img/ÂºÄÂèë/SpringBoot/10.png" /></p><h2 id="ÈÖçÁΩÆswagger‰ø°ÊÅØ">ÈÖçÁΩÆSwagger‰ø°ÊÅØ</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ÈÖçÁΩÆ‰∫ÜSwaggerÁöÑbeanÂÆû‰æã</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">docket</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>                .apiInfo(apiInfo());<br>    &#125;<br><br>    <span class="hljs-comment">//ÈÖçÁΩÆSwagger‰ø°ÊÅØ</span><br>    <span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">apiInfo</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-comment">//‰ΩúËÄÖ‰ø°ÊÅØ</span><br>        <span class="hljs-type">Contact</span> <span class="hljs-variable">contact</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Contact</span>(<span class="hljs-string">&quot;ËÇòÂ≠êÂºÄ&quot;</span>, <span class="hljs-string">&quot;https://www.baidu.com&quot;</span>, <span class="hljs-string">&quot;13600004906&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfo</span>(<span class="hljs-string">&quot;ËÇòÂ≠êÂºÄÁöÑSwaggerAPIÊñáÊ°£&quot;</span>,<br>                <span class="hljs-string">&quot;Api Documentation&quot;</span>,<br>                <span class="hljs-string">&quot;1.0&quot;</span>,<br>                <span class="hljs-string">&quot;urn:tos&quot;</span>,<br>                contact,<br>                <span class="hljs-string">&quot;Apache 2.0&quot;</span>,<br>                <span class="hljs-string">&quot;http://www.apache.org/licenses/LICENSE-2.0&quot;</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>());<br>    &#125;<br></code></pre></div></td></tr></table></figure><p><img src="/img/ÂºÄÂèë/SpringBoot/11.png" /></p><h2 id="ÈÖçÁΩÆÊâ´ÊèèÊé•Âè£ÂèäÂºÄÂÖ≥">ÈÖçÁΩÆÊâ´ÊèèÊé•Âè£ÂèäÂºÄÂÖ≥</h2><ul><li>ÈÄöËøáselect()„ÄÅapis()‰ª•Âèäbuild()ÊñπÊ≥ïËøõË°åÈÖçÁΩÆÈúÄË¶ÅÊâ´ÊèèÁöÑÊé•Âè£</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ÈÖçÁΩÆ‰∫ÜSwaggerÁöÑbeanÂÆû‰æã</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">docket</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>                .apiInfo(apiInfo())<br>                .select()<br>                <span class="hljs-comment">//RequestHandlerSelectorsÈÖçÁΩÆË¶ÅÊâ´ÊèèÁªìÊûúÁöÑÊñπÂºè</span><br>                <span class="hljs-comment">//basePackage()ÊåáÂÆöË¶ÅÊâ´ÊèèÁöÑÂåÖ</span><br>            <span class="hljs-comment">//any()Êâ´ÊèèÂÖ®ÈÉ®</span><br>                <span class="hljs-comment">//none()‰∏çÊâ´Êèè</span><br>                <span class="hljs-comment">//withClassAnnotationÊâ´ÊèèÁ±ª‰∏äÁöÑÊ≥®Ëß£</span><br>                <span class="hljs-comment">//withMethodAnnotationÊâ´ÊèèÊñπÊ≥ï‰∏äÁöÑÊ≥®Ëß£</span><br>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.example.swagger.controller&quot;</span>))<br>            <span class="hljs-comment">//path()ËøáÊª§Ë∑ØÂæÑ</span><br>                <span class="hljs-comment">//.paths(PathSelectors.ant(&quot;/zhou/**&quot;))</span><br>                .build();<br>    &#125;<br></code></pre></div></td></tr></table></figure><ul><li>ÈÄöËøáenable()ÊñπÊ≥ïÂØπswaggerËøõË°åÂºÄÂÖ≥</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ÈÖçÁΩÆ‰∫ÜSwaggerÁöÑbeanÂÆû‰æã</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">docket</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>                .apiInfo(apiInfo())<br>                <span class="hljs-comment">//Â¶ÇÊûú‰∏∫falseÂàô‰∏çÂêØÂä®</span><br>                .enable(<span class="hljs-literal">false</span>)<br>                .select()<br>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.example.swagger.controller&quot;</span>))<br>                .build();<br>    &#125;<br></code></pre></div></td></tr></table></figure><ul><li>Â¶ÇÊûúÊàë‰ª¨ÊÉ≥Ë¶ÅÂú®ÂºÄÂèëÁéØÂ¢É‰∏≠‰ΩøÁî®Ôºå‰ΩÜÊòØÂú®‰∏äÁ∫øÁéØÂ¢É‰∏≠‰∏ç‰ΩøÁî®</li><li>È¶ñÂÖà‰ºöÊñ∞Âª∫‰∏§‰∏™ÈÖçÁΩÆÊñá‰ª∂ÔºåÂàÜÂà´‰∏∫application-dev.propertiesÂíåapplication-prod.propertiesÔºåÂàÜÂà´‰∏∫ÂºÄÂèëÁéØÂ¢ÉÂíå‰∏äÁ∫øÁéØÂ¢É‰∏≠ÁöÑÈÖçÁΩÆ</li><li>‰πãÂêéÂØπÁéØÂ¢ÉËøõË°åËØªÂèñÔºåÂà§Êñ≠ÊòØÂê¶‰∏∫ÂºÄÂèëÁéØÂ¢ÉÔºåÂÜç‰º†Áªôenable()</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">docket</span><span class="hljs-params">(Environment environment)</span> &#123;<br><br>        <span class="hljs-comment">//ËÆæÁΩÆË¶ÅÊòæÁ§∫ÁöÑSwaggerÁéØÂ¢É</span><br>        <span class="hljs-type">Profiles</span> <span class="hljs-variable">profiles</span> <span class="hljs-operator">=</span> Profiles.of(<span class="hljs-string">&quot;dev&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);<br><br>        <span class="hljs-comment">//ÈÄöËøáenvironment.acceptsProfilesÂà§Êñ≠ÊòØÂê¶Âú®Ëá™Â∑±ËÆæÂÆöÁöÑÁéØÂ¢ÉÂΩì‰∏≠</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> environment.acceptsProfiles(profiles);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>                .apiInfo(apiInfo())<br>                .enable(flag)<br>                .select()<br>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.example.swagger.controller&quot;</span>))<br>                .build();<br>    &#125;<br></code></pre></div></td></tr></table></figure><ul><li>Âú®application.properties‰∏≠ÈÖçÁΩÆ</li></ul><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">spring.profiles.active</span>=<span class="hljs-string">dev</span><br></code></pre></div></td></tr></table></figure><ul><li>Âú®application-dev.properties‰∏≠ÈÖçÁΩÆ</li></ul><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">server.port</span>=<span class="hljs-string">8081</span><br></code></pre></div></td></tr></table></figure><ul><li>Âú®application-prod.properties‰∏≠ÈÖçÁΩÆ</li></ul><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">server.port</span>=<span class="hljs-string">8082</span><br></code></pre></div></td></tr></table></figure><h2 id="ÈÖçÁΩÆapiÂàÜÁªÑ">ÈÖçÁΩÆapiÂàÜÁªÑ</h2><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br>   <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">docket1</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2).groupName(<span class="hljs-string">&quot;A&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Bean</span><br>   <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">docket2</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2).groupName(<span class="hljs-string">&quot;B&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Bean</span><br>   <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">docket3</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2).groupName(<span class="hljs-string">&quot;C&quot;</span>);<br>   &#125;<br><br><span class="hljs-meta">@Bean</span><br>   <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">docket</span><span class="hljs-params">(Environment environment)</span> &#123;<br><br>       <span class="hljs-type">Profiles</span> <span class="hljs-variable">profiles</span> <span class="hljs-operator">=</span> Profiles.of(<span class="hljs-string">&quot;dev&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);<br><br>       <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> environment.acceptsProfiles(profiles);<br><br>       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>               .apiInfo(apiInfo())<br>               .enable(flag)<br>               .groupName(<span class="hljs-string">&quot;ËÇòÂ≠êÂºÄ&quot;</span>)<br>               .select()<br>               .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.example.swagger.controller&quot;</span>))<br>               .build();<br>   &#125;<br></code></pre></div></td></tr></table></figure><ul><li>Êñ∞Âª∫ÂÆû‰ΩìÁ±ªÔºåÂÖ∂‰∏≠apiÊ≥®Ëß£Áõ∏ÂΩì‰∫éÊòØÊ≥®ÈáäÔºåËÉΩÂ§üÂú®swagger‰∏≠ÁúãÂà∞</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@ApiModel(&quot;Áî®Êà∑ÂÆû‰ΩìÁ±ª&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <br>    <span class="hljs-meta">@ApiModelProperty(&quot;Áî®Êà∑Âêç&quot;)</span><br>    <span class="hljs-keyword">public</span> String username;<br>    <br>    <span class="hljs-meta">@ApiModelProperty(&quot;ÂØÜÁ†Å&quot;)</span><br>    <span class="hljs-keyword">public</span> String password;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>Âú®ÊéßÂà∂Á±ªËøõË°åÊ≥®Èáä</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;HelloÊéßÂà∂ÊñπÊ≥ï&quot;)</span><br>    <span class="hljs-meta">@GetMapping(&quot;/hello2&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello2</span><span class="hljs-params">(<span class="hljs-meta">@ApiParam(&quot;Áî®Êà∑Âêç&quot;)</span> String username)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span> + username;<br>    &#125;<br>    <br>&#125;<br></code></pre></div></td></tr></table></figure><h1 id="ÂºÇÊ≠•‰ªªÂä°">ÂºÇÊ≠•‰ªªÂä°</h1><p>È¶ñÂÖàÁºñÂÜô‰∏Ä‰∏™Á≠âÂæÖ3ÁßíÈíüÂõûÂ§çËØ∑Ê±ÇÁöÑÈúÄÊ±Ç</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncService</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            Thread.sleep(<span class="hljs-number">3000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>        System.out.println(<span class="hljs-string">&quot;Êï∞ÊçÆÊ≠£Âú®Â§ÑÁêÜ„ÄÇ„ÄÇ„ÄÇ&quot;</span>);<br><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    AsyncService asyncService;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br>        asyncService.hello();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ok&quot;</span>;<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><p>ËøôÊó∂ÂÄôÁî®Êà∑ÂøÖÈ°ªË¶ÅÁ≠âÂæÖ3Áßí‰πãÂêéÊâçÂèØ‰ª•Êî∂Âà∞ÂõûÂ§çÁöÑËØ∑Ê±ÇÔºåËøôÊó∂ÂÄôÈúÄË¶ÅÂºÇÊ≠•ËØ∑Ê±Ç</p><ul><li>ÂÖàÂú®Service‰∏≠Ê∑ªÂä†<code>@Async</code>Ê≥®Ëß£</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncService</span> &#123;<br><br>    <span class="hljs-comment">//ÂëäËØâSpringËøôÊòØ‰∏Ä‰∏™ÂºÇÊ≠•ÁöÑÊñπÊ≥ï</span><br>    <span class="hljs-meta">@Async</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            Thread.sleep(<span class="hljs-number">3000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>        System.out.println(<span class="hljs-string">&quot;Êï∞ÊçÆÊ≠£Âú®Â§ÑÁêÜ„ÄÇ„ÄÇ„ÄÇ&quot;</span>);<br><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>‰πãÂêéÂÜçmainÊñπÊ≥ï‰∏≠ÂºÄÂêØÊñπÊ≥ï</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ÂºÄÂêØÂºÇÊ≠•Ê≥®Ëß£ÂäüËÉΩ</span><br><span class="hljs-meta">@EnableAsync</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(TestApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><h1 id="ÈÇÆ‰ª∂‰ªªÂä°">ÈÇÆ‰ª∂‰ªªÂä°</h1><ul><li>Ê∑ªÂä†‰æùËµñ</li></ul><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ul><li>ÈúÄË¶ÅÂÜçÈÖçÁΩÆÊñá‰ª∂‰∏≠Ê∑ªÂä†ÈÖçÁΩÆ</li></ul><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">spring.mail.username</span>=<span class="hljs-string">1735257086@qq.com</span><br><span class="hljs-attr">spring.mail.password</span>=<span class="hljs-string">dzzmxmfwltrpcbid</span><br><span class="hljs-attr">spring.mail.host</span>=<span class="hljs-string">smtp.qq.com</span><br><span class="hljs-comment"># Â¶ÇÊûúÊòØqqÈÇÆÁÆ±ÔºåÂºÄÂêØÂä†ÂØÜÈ™åËØÅ</span><br><span class="hljs-attr">spring.mail.properties.mail.smtp.ssl.enable</span>=<span class="hljs-string">true</span><br></code></pre></div></td></tr></table></figure><ul><li>ÁºñÂÜôËØ∑Ê±Ç</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestApplicationTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    JavaMailSenderImpl mailSender;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//‰∏Ä‰∏™ÁÆÄÂçïÁöÑÈÇÆ‰ª∂</span><br>        <span class="hljs-type">SimpleMailMessage</span> <span class="hljs-variable">mailMessage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleMailMessage</span>();<br><br>        mailMessage.setSubject(<span class="hljs-string">&quot;ËÇòÂ≠êÂºÄ‰Ω†Â•Ω&quot;</span>);<br>        mailMessage.setText(<span class="hljs-string">&quot;Ë∞¢Ë∞¢‰Ω†ËÇòÂ≠êÂºÄ,Â§™ÂñúÊ¨¢‰Ω†Âï¶&quot;</span>);<br><br>        mailMessage.setTo(<span class="hljs-string">&quot;1735257086@qq.com&quot;</span>);<br>        mailMessage.setFrom(<span class="hljs-string">&quot;1735257086@qq.com&quot;</span>);<br><br>        mailSender.send(mailMessage);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> MessagingException &#123;<br>        <span class="hljs-comment">//‰∏Ä‰∏™Â§çÊùÇÁöÑÈÇÆ‰ª∂</span><br>        <span class="hljs-type">MimeMessage</span> <span class="hljs-variable">mimeMessage</span> <span class="hljs-operator">=</span> mailSender.createMimeMessage();<br><br>        <span class="hljs-type">MimeMessageHelper</span> <span class="hljs-variable">helper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MimeMessageHelper</span>(mimeMessage, <span class="hljs-literal">true</span>);<br><br>        helper.setSubject(<span class="hljs-string">&quot;ËÇòÂ≠êÂºÄ‰Ω†Â•Ω&quot;</span>);<br>        helper.setText(<span class="hljs-string">&quot;&lt;p style=&#x27;color:red&gt;ÈÇÆ‰ª∂ÊµãËØï&lt;/p&gt;&quot;</span>, <span class="hljs-literal">true</span>);   <span class="hljs-comment">//true‰ª£Ë°®‰∏∫html</span><br><br>        <span class="hljs-comment">//ÈôÑ‰ª∂</span><br>        helper.addAttachment(<span class="hljs-string">&quot;1.jpg&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;D:\\1.jpg&quot;</span>));<br><br>        helper.setTo(<span class="hljs-string">&quot;1735257086@qq.com&quot;</span>);<br>        helper.setFrom(<span class="hljs-string">&quot;1735257086@qq.com&quot;</span>);<br><br>        mailSender.send(mimeMessage);<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><h1 id="ÂÆöÊó∂‰ªªÂä°">ÂÆöÊó∂‰ªªÂä°</h1><ul><li>Âú®mainÊñπÊ≥ï‰∏≠Ê∑ªÂä†Ê≥®Èáä</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-comment">//ÂºÄÂêØÂºÇÊ≠•Ê≥®Ëß£ÂäüËÉΩ</span><br><span class="hljs-meta">@EnableAsync</span><br><span class="hljs-comment">//ÂºÄÂßãÂÆöÊó∂ÂäüËÉΩÊ≥®Ëß£</span><br><span class="hljs-meta">@EnableScheduling</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(TestApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>ÁºñÂÜôÈúÄÊ±Ç</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScheduledService</span> &#123;<br><br>    <span class="hljs-comment">//Âú®ÁâπÂÆöÁöÑÊó∂Èó¥ÁÇπÊâßË°åËøô‰∏™ÊñπÊ≥ï Timer</span><br>    <span class="hljs-comment">//CronË°®ËææÂºè</span><br>    <span class="hljs-comment">//Áßí ÂàÜ Êó∂ Êó• Êúà Âë®Âá†</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    * 30 15 10 * * Ôºü    ÊØèÂ§©ÁöÑ10ÁÇπ15ÂàÜ30Áßí</span><br><span class="hljs-comment">    * 30 0/5 10,18 * * ?    ÊØèÂ§©10ÁÇπÂíå18ÁÇπÔºåÊØèÈöî5ÂàÜÈíüÊâßË°å‰∏ÄÊ¨°</span><br><span class="hljs-comment">    * */</span><br>    <span class="hljs-meta">@Scheduled(cron = &quot;0 * * * * 0-7&quot;)</span>  <span class="hljs-comment">//ÊØèÂ§©ÊØèÂàÜÈíüÁöÑÁ¨¨0ÁßíËøêË°å</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;‰Ω†Ë¢´ÊâßË°å‰∫Ü&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><ul><li>cronË°®ËææÂºèÂèØ‰ª•Âú®ÁôæÂ∫¶Êü•ÊâæÁîüÊàêÂô®</li></ul><h1 id="Êï¥Âêàredis">Êï¥ÂêàRedis</h1><ul><li>Êñ∞Âª∫È°πÁõÆÊó∂ÈúÄË¶ÅÂú®ÈùûÂÖ≥Á≥ªÂûãÊï∞ÊçÆÂ∫ì(NoSQL)‰∏≠ÂãæÈÄâ‰∏äSpring Data Redis(Access+Driver)</li></ul><h1 id="ÂàÜÂ∏ÉÂºèÁêÜËÆ∫">ÂàÜÂ∏ÉÂºèÁêÜËÆ∫</h1>]]></content>
    
    
    <categories>
      
      <category>ÂºÄÂèë</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Á¨¨ÂçÅ‰∏âËÆ≤-Âü∫‰∫é‰∏ä‰∏ãÊñáÁöÑË°®ÂæÅ‰∏éNLPÈ¢ÑËÆ≠ÁªÉÊ®°Âûã</title>
    <link href="/2022/06/15/%E7%AC%AC%E5%8D%81%E4%B8%89%E8%AE%B2-%E5%9F%BA%E4%BA%8E%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84%E8%A1%A8%E5%BE%81%E4%B8%8ENLP%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/"/>
    <url>/2022/06/15/%E7%AC%AC%E5%8D%81%E4%B8%89%E8%AE%B2-%E5%9F%BA%E4%BA%8E%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84%E8%A1%A8%E5%BE%81%E4%B8%8ENLP%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ËØçÂêëÈáèÁü•ËØÜÂõûÈ°æ">1 ËØçÂêëÈáèÁü•ËØÜÂõûÈ°æ</h1><h2 id="ËØçÂêëÈáèË°®ÂæÅ">1.1 ËØçÂêëÈáèË°®ÂæÅ</h2><ul><li>Áé∞Âú®Êàë‰ª¨ÂèØ‰ª•Ëé∑Âæó‰∏Ä‰∏™ÂçïËØçÁöÑË°®Á§∫<ul><li>Êàë‰ª¨ÂºÄÂßãÊó∂Â≠¶ËøáÁöÑÂçïËØçÂêëÈáè<ul><li>Word2vecÔºåGloVeÔºåfastText</li></ul></li></ul></li></ul><h2 id="È¢ÑËÆ≠ÁªÉÁöÑËØçÂêëÈáè">1.2 È¢ÑËÆ≠ÁªÉÁöÑËØçÂêëÈáè</h2><ul><li>Êàë‰ª¨ÂèØ‰ª•ÈöèÊú∫ÂàùÂßãÂåñËØçÂêëÈáèÔºåÂπ∂Ê†πÊçÆÊàë‰ª¨Ëá™Â∑±ÁöÑ‰∏ãÊ∏∏‰ªªÂä°ËÆ≠ÁªÉÂÆÉ‰ª¨</li><li>‰ΩÜÂú®ÁªùÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÔºå‰ΩøÁî®È¢ÑËÆ≠ÁªÉËØçÂêëÈáèÊòØÊúâÂ∏ÆÂä©ÁöÑÔºåÂõ†‰∏∫ÂÆÉ‰ª¨Êú¨Ë∫´ÊòØËá™Â∏¶‰ø°ÊÅØÁöÑ(Êàë‰ª¨ÂèØ‰ª•Âú®Êõ¥Â§ß‰ΩìÈáèÁöÑÈ¢ÑËÆ≠ÁªÉËØ≠Êñô‰∏äËÆ≠ÁªÉÂæóÂà∞ÂÆÉ‰ª¨)</li></ul><h2 id="Êú™Áü•ËØçÁöÑËØçÂêëÈáèÂ∫îÁî®Âª∫ËÆÆ">1.3 Êú™Áü•ËØçÁöÑËØçÂêëÈáèÂ∫îÁî®Âª∫ËÆÆ</h2><ul><li><p>ÁÆÄÂçï‰∏îÂ∏∏ËßÅÁöÑËß£ÂÜ≥ÊñπÊ°àÔºö</p></li><li><p>ËÆ≠ÁªÉÊó∂ÔºöËØçÊ±áË°®<span class="math inline">\(\{\text { wordsoccurring, say }, \geq 5 \text { times }\}\cup\{&lt;\mathrm{UNK}&gt;\}\)</span></p><ul><li>Â∞Ü<strong>ÊâÄÊúâ</strong>ÁΩïËßÅÁöÑËØç (Êï∞ÊçÆÈõÜ‰∏≠Âá∫Áé∞Ê¨°Êï∞Â∞è‰∫é 5)ÈÉΩÊò†Â∞Ñ‰∏∫<spanclass="math inline">\(&lt;UNK&gt;\)</span>Ôºå‰∏∫ÂÖ∂ËÆ≠ÁªÉ‰∏Ä‰∏™ËØçÂêëÈáè</li></ul></li><li><p><strong>ËøêË°åÊó∂</strong>Ôºö‰ΩøÁî®<spanclass="math inline">\(&lt;UNK&gt;\)</span>‰ª£ÊõøËØçÊ±áË°®‰πãÂ§ñÁöÑËØçOOV</p></li><li><p><strong>ÈóÆÈ¢ò</strong>Ôºö</p><ul><li>Ê≤°ÊúâÂäûÊ≥ïÂå∫ÂàÜ‰∏çÂêå UNK wordsÔºåÊó†ËÆ∫ÊòØË∫´‰ªΩËøòÊòØÊÑè‰πâ</li></ul></li></ul><p><strong>Ëß£ÂÜ≥ÊñπÊ°à</strong></p><p>‚Äã <strong>‰ΩøÁî®Â≠óÁ¨¶Á∫ßÊ®°ÂûãÂ≠¶‰π†ËØçÂêëÈáè</strong></p><ul><li>ÁâπÂà´ÊòØÂú® QA ‰∏≠Ôºåmatch on word identityÊòØÂæàÈáçË¶ÅÁöÑÔºåÂç≥‰ΩøËØçÂêëÈáèËØçÊ±áË°®‰ª•Â§ñÁöÑÂçïËØç</li></ul><p>‚Äã <strong>Â∞ùËØïËøô‰∫õÂª∫ËÆÆ</strong> (from Dhingra, Liu, Salakhutdinov,Cohen 2017)</p><ul><li><p>Â¶ÇÊûúÊµãËØïÊó∂ÁöÑ<spanclass="math inline">\(&lt;UNK&gt;\)</span>ÂçïËØç‰∏çÂú®‰Ω†ÁöÑËØçÊ±áË°®‰∏≠Ôºå‰ΩÜÊòØÂá∫Áé∞Âú®‰Ω†‰ΩøÁî®ÁöÑÊó†ÁõëÁù£ËØçÂµåÂÖ•‰∏≠ÔºåÊµãËØïÊó∂Áõ¥Êé•‰ΩøÁî®Ëøô‰∏™ÂêëÈáè</p></li><li><p>Ê≠§Â§ñÔºå‰Ω†ÂèØ‰ª•Â∞ÜÂÖ∂ËßÜ‰∏∫Êñ∞ÁöÑÂçïËØçÔºåÂπ∂‰∏∫ÂÖ∂ÂàÜÈÖç‰∏Ä‰∏™ÈöèÊú∫ÂêëÈáèÔºåÂ∞ÜÂÆÉ‰ª¨Ê∑ªÂä†Âà∞‰Ω†ÁöÑËØçÊ±áË°®</p></li><li><p>Â∏ÆÂä©ÂæàÂ§ßÊàñËÄÖ‰πüËÆ∏ËÉΩÂ∏ÆÁÇπÂøô</p></li><li><p>‰Ω†ÂèØ‰ª•ËØïËØïÂè¶‰∏Ä‰ª∂‰∫ã</p><ul><li>Â∞ÜÂÆÉ‰ª¨ÂàÜËß£‰∏∫ËØçÁ±ª (Â¶ÇÊú™Áü•Âè∑Á†ÅÔºåÂ§ßÂÜôÁ≠âÁ≠â)ÔºåÊØèÁßçÈÉΩÂØπÂ∫î‰∏Ä‰∏™ <spanclass="math inline">\(&lt;UNK-class&gt;\)</span></li></ul></li></ul><h2 id="ÂçïËØçÁöÑË°®Á§∫">1.4 ÂçïËØçÁöÑË°®Á§∫</h2><p><strong>Â≠òÂú®‰∏§‰∏™Â§ßÈóÆÈ¢ò</strong></p><ul><li>ÂØπ‰∫é‰∏Ä‰∏™ word type ÊÄªÊòØÊòØÁî®Áõ∏ÂêåÁöÑË°®Á§∫Ôºå‰∏çËÄÉËôëËøô‰∏™ word tokenÂá∫Áé∞ÁöÑ‰∏ä‰∏ãÊñá<ul><li>Êàë‰ª¨ÂèØ‰ª•ËøõË°åÈùûÂ∏∏ÁªÜÁ≤íÂ∫¶ÁöÑËØç‰πâÊ∂àÊ≠ß</li></ul></li><li>Êàë‰ª¨ÂØπ‰∏Ä‰∏™ËØçÂè™Êúâ‰∏ÄÁßçË°®Á§∫Ôºå‰ΩÜÊòØÂçïËØçÊúâ‰∏çÂêåÁöÑÊñπÈù¢ÔºåÂåÖÊã¨ËØ≠‰πâÔºåÂè•Ê≥ïË°å‰∏∫Ôºå‰ª•ÂèäË°®Ëææ/ Âê´‰πâ</li></ul><h2 id="Êàë‰ª¨‰∏ÄÁõ¥ÈÉΩÊúâËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÁöÑÂäûÊ≥ïÂêó">1.5Êàë‰ª¨‰∏ÄÁõ¥ÈÉΩÊúâËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÁöÑÂäûÊ≥ïÂêóÔºü</h2><ul><li>Âú®NLM‰∏≠ÔºåÊàë‰ª¨Áõ¥Êé•Â∞ÜÂçïËØçÂêëÈáè (ÂèØËÉΩÂè™Âú®ËØ≠ÊñôÂ∫ì‰∏äËÆ≠ÁªÉ) ÊèíÂÖ•LSTMÂ±Ç</li><li>ÈÇ£‰∫õLSTMÂ±ÇË¢´ËÆ≠ÁªÉÊù•È¢ÑÊµã‰∏ã‰∏Ä‰∏™ÂçïËØç</li><li>‰ΩÜËøô‰∫õËØ≠Ë®ÄÊ®°ÂûãÂú®ÊØè‰∏Ä‰∏™‰ΩçÁΩÆÁîüÊàêÁâπÂÆö‰∫é‰∏ä‰∏ãÊñáÁöÑËØçË°®Á§∫</li></ul><h2 id="ËÆ∫ÊñáËß£ËØª-peters-et-al.-2017-taglm-pre-elmo">1.6 ËÆ∫ÊñáËß£ËØª Peterset al. (2017): TagLM ‚Äì ‚ÄúPre-ELMo‚Äù</h2><ul><li><strong>ÊÉ≥Ê≥ï</strong>ÔºöÊÉ≥Ë¶ÅËé∑ÂæóÂçïËØçÂú®‰∏ä‰∏ãÊñáÁöÑÊÑèÊÄùÔºå‰ΩÜÊ†áÂáÜÁöÑ RNNÂ≠¶‰π†‰ªªÂä°Âè™Âú® task-labeled ÁöÑÂ∞èÊï∞ÊçÆ‰∏ä (Â¶Ç NER )</li><li>‰∏∫‰ªÄ‰πà‰∏çÈÄöËøáÂçäÁõëÁù£Â≠¶‰π†ÁöÑÊñπÂºèÂú®Â§ßÂûãÊó†Ê†áÁ≠æÊï∞ÊçÆÈõÜ‰∏äËÆ≠ÁªÉNLMÔºåËÄå‰∏çÂè™ÊòØËØçÂêëÈáè</li></ul><h2 id="Ê†áÁ≠æËØ≠Ë®ÄÊ®°Âûã-tag-lm">1.7 Ê†áÁ≠æËØ≠Ë®ÄÊ®°Âûã (Tag LM )</h2><ul><li><strong>Ê≠•È™§3</strong>ÔºöÂú®Â∫èÂàóÊ†áËÆ∞Ê®°Âûã‰∏≠ÂêåÊó∂‰ΩøÁî®ÂçïËØçÂµåÂÖ•Âíå LMÂµåÂÖ•</li><li><strong>Ê≠•È™§2</strong>Ôºö‰∏∫ËæìÂÖ•Â∫èÂàó‰∏≠ÁöÑÊØè‰∏™Ê†áËÆ∞ÂáÜÂ§áÂçïËØçÂµåÂÖ•Âíå LMÂµåÂÖ•</li><li><strong>Ê≠•È™§1</strong>ÔºöÈ¢ÑËÆ≠ÁªÉËØçÂµåÂÖ•ÂíåËØ≠Ë®ÄÊ®°Âûã</li><li>‰∏é‰∏äÊñáÊó†ÂÖ≥ÁöÑÂçïËØçÂµåÂÖ• + RNN model ÂæóÂà∞ÁöÑ hidden states‰Ωú‰∏∫ÁâπÂæÅËæìÂÖ•</li></ul><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/1.png" /></p><ul><li>Char CNN / RNN + Token Embedding ‰Ωú‰∏∫ bi-LSTM ÁöÑËæìÂÖ•</li><li>ÂæóÂà∞ÁöÑ hidden states ‰∏é Pre-trained bi-LM (ÂÜªÁªìÁöÑ) ÁöÑ hidden statesËøûÊé•Ëµ∑Êù•ËæìÂÖ•Âà∞Á¨¨‰∫åÂ±ÇÁöÑ bi-LSTM ‰∏≠</li></ul><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/2.png" /></p><h2 id="ÂëΩÂêçÂÆû‰ΩìËØÜÂà´-ner">1.8 ÂëΩÂêçÂÆû‰ΩìËØÜÂà´ (NER)</h2><ul><li>‰∏Ä‰∏™ÈùûÂ∏∏ÈáçË¶ÅÁöÑNLPÂ≠ê‰ªªÂä°Ôºö<strong>Êü•Êâæ</strong>Âíå<strong>ÂàÜÁ±ª</strong>ÊñáÊú¨‰∏≠ÁöÑÂÆû‰Ωì</li></ul><h2 id="ËÆ∫ÊñáËß£ËØª-peters-et-al.2017-taglm-pre-elmo">1.9 ËÆ∫ÊñáËß£ËØª Peterset al.(2017): TagLM-"Pre-ELMo"</h2><ul><li>ËØ≠Ë®ÄÊ®°ÂûãÂú® <code>Billion word benchmark</code>ÁöÑ8‰∫ø‰∏™ËÆ≠ÁªÉÂçïËØç‰∏äËÆ≠ÁªÉ</li></ul><p><strong>ËØ≠Ë®ÄÊ®°ÂûãËßÇÂØüÁªìÊûú</strong></p><ul><li>Âú®ÁõëÁù£Êï∞ÊçÆÈõÜ‰∏äËÆ≠ÁªÉÁöÑËØ≠Ë®ÄÊ®°ÂûãÂπ∂‰∏ç‰ºöÂèóÁõä</li><li>ÂèåÂêëËØ≠Ë®ÄÊ®°Âûã‰ªÖÊúâÂä©‰∫é forward ËøáÁ®ãÔºåÊèêÂçáÁ∫¶ 0.2</li><li>ÂÖ∑ÊúâÂ∑®Â§ßÁöÑËØ≠Ë®ÄÊ®°ÂûãËÆæËÆ° (Âõ∞ÊÉëÂ∫¶ 30) ÊØîËæÉÂ∞èÁöÑÊ®°Âûã (Âõ∞ÊÉëÂ∫¶ 48) ÊèêÂçáÁ∫¶0.3</li></ul><p><strong>‰ªªÂä°ÁâπÂÆöÁöÑBiLSTMËßÇÂØüÁªìÊûú</strong></p><ul><li>‰ªÖ‰ΩøÁî®LMÂµåÂÖ•Êù•È¢ÑÊµãÂπ∂‰∏çÊòØÂæàÂ•ΩÔºö88.17 F1<ul><li>Ëøú‰Ωé‰∫é‰ªÖÂú®Ê†áËÆ∞Êï∞ÊçÆ‰∏ä‰ΩøÁî® BiLSTM Ê†áËÆ∞Âô®</li></ul></li></ul><h2 id="ËÆ∫ÊñáËß£ËØª-also-in-the-air-mccann-et-al.2017cove">1.10 ËÆ∫ÊñáËß£ËØªAlso in the air: McCann et al.2017:CoVe</h2><ul><li><p>‰πüÊúâ‰∏ÄÁßçÊÄùË∑ØÔºö‰ΩøÁî®ËÆ≠ÁªÉÂ•ΩÁöÑÂ∫èÂàóÊ®°ÂûãÔºå‰∏∫ÂÖ∂‰ªñNLPÊ®°ÂûãÊèê‰æõ‰∏ä‰∏ãÊñá</p></li><li><p><strong>ÊÄùË∑Ø</strong>ÔºöÊú∫Âô®ÁøªËØëÊòØ‰∏∫‰∫Ü‰øùÂ≠òÊÑèÊÄùÔºåÊâÄ‰ª•Ëøô‰πüËÆ∏ÊòØ‰∏™Â•ΩÁõÆÊ†áÔºü</p></li><li><p>‰ΩøÁî® seq2seq + attention NMT system ‰∏≠ÁöÑ EncoderÔºåÂç≥ 2 Â±Çbi-LSTMÔºå‰Ωú‰∏∫‰∏ä‰∏ãÊñáÊèê‰æõËÄÖ</p></li><li><p>ÊâÄÂæóÂà∞ÁöÑ CoVe ÂêëÈáèÂú®ÂêÑÁßç‰ªªÂä°‰∏äÈÉΩ‰ºò‰∫é GloVe ÂêëÈáè</p></li><li><p>‰ΩÜÊòØÔºåÁªìÊûúÂπ∂‰∏çÂÉèÂÖ∂‰ªñÂπªÁÅØÁâá‰∏≠ÊèèËø∞ÁöÑÊõ¥ÁÆÄÂçïÁöÑ NLMËÆ≠ÁªÉÈÇ£‰πàÂ•ΩÔºåÊâÄ‰ª•‰ºº‰πéË¢´ÊîæÂºÉ‰∫Ü</p><ul><li>‰πüËÆ∏NMTÂè™ÊòØÊØîËØ≠Ë®ÄÂª∫Ê®°Êõ¥ÈöæÔºü</li><li>ÊàñËÆ∏Êúâ‰∏ÄÂ§©Ëøô‰∏™ÊÉ≥Ê≥ï‰ºöÂõûÊù•Ôºü</li></ul></li></ul><h1 id="elmoÊ®°Âûã">2.ELMoÊ®°Âûã</h1><h2id="ËÆ∫ÊñáËß£ËØª-peters-et-al.-2018-elmo-embeddings-from-language-models">2.1ËÆ∫ÊñáËß£ËØª Peters et al. (2018): ELMo: Embeddings from LanguageModels</h2><ul><li><p>ÂçïËØçÊ†áËÆ∞ÂêëÈáèÊàñ‰∏ä‰∏ãÊñáËØçÂêëÈáèÁöÑÁ™ÅÁ†¥</p></li><li><p>‰ΩøÁî®Èïø‰∏ä‰∏ãÊñáËÄå‰∏çÊòØ‰∏ä‰∏ãÊñáÁ™óÂè£Â≠¶‰π†ËØçÊ†áËÆ∞ÂêëÈáè(ËøôÈáåÔºåÊï¥‰∏™Âè•Â≠êÂèØËÉΩÊõ¥Èïø)</p></li><li><p>Â≠¶‰π†Ê∑±Â∫¶ Bi-NLMÔºåÂπ∂Âú®È¢ÑÊµã‰∏≠‰ΩøÁî®ÂÆÉÁöÑÊâÄÊúâÂ±Ç</p></li><li><p>ËÆ≠ÁªÉ‰∏Ä‰∏™ÂèåÂêëËØ≠Ë®ÄÊ®°Âûã (LM)</p></li><li><p>ÁõÆÊ†áÊòØÊïàÊûú OK ‰ΩÜ‰∏çË¶ÅÂ§™Â§ßÁöÑËØ≠Ë®ÄÊ®°Âûã (LM)</p><ul><li>‰ΩøÁî® 2 ‰∏™ biLSTM Â±Ç</li><li>(‰ªÖ) ‰ΩøÁî®Â≠óÁ¨¶CNNÊûÑÂª∫ÂàùÂßãÂçïËØçË°®Á§∫<ul><li>2048 ‰∏™ char n-gram filters Âíå 2 ‰∏™ highway layersÔºå512 Áª¥ÁöÑprojection</li></ul></li><li>4096 dim hidden/cell LSTMÁä∂ÊÄÅÔºå‰ΩøÁî® 512 dimÁöÑÂØπ‰∏ã‰∏Ä‰∏™ËæìÂÖ•ÁöÑÊäïÂΩ±</li><li>‰ΩøÁî®ÊÆãÂ∑ÆËøûÊé•</li><li>ÁªëÂÆö token ÁöÑËæìÂÖ•ÂíåËæìÂá∫ÁöÑÂèÇÊï∞(softmax)ÔºåÂπ∂Â∞ÜËøô‰∫õÂèÇÊï∞ÁªëÂÆöÂà∞Ê≠£ÂêëÂíåÂèçÂêëËØ≠Ë®ÄÊ®°Âûã (LM) ‰πãÈó¥</li></ul></li><li><p>ELMo Â≠¶‰π† biLM Ë°®Á§∫ÁöÑÁâπÂÆö‰ªªÂä°ÁªÑÂêà</p></li><li><p>ËøôÊòØ‰∏Ä‰∏™ÂàõÊñ∞ÔºåTagLM ‰∏≠‰ªÖ‰ªÖ‰ΩøÁî®Â†ÜÂè† LSTM ÁöÑÈ°∂Â±ÇÔºåELMo ËÆ§‰∏∫ BiLSTMÊâÄÊúâÂ±ÇÈÉΩÊòØÊúâÁî®ÁöÑ</p></li></ul><p><span class="math display">\[\begin{aligned}R_{k} &amp;=\left\{\mathbf{x}_{k}^{L M}, \overrightarrow{\mathbf{h}}_{k,j}^{L M}, \overleftarrow{\mathbf{h}}_{k, j}^{L M} \mid j=1, \ldots,L\right\} \\&amp;=\left\{\mathbf{h}_{k, j}^{L M} \mid j=0, \ldots, L\right\}\end{aligned}\]</span></p><p><span class="math display">\[\mathbf{E L M o}_{k}^{\text {task }}=E\left(R_{k} ; \Theta^{\text {task}}\right)=\gamma^{\text {task }} \sum_{j=0}^{L} s_{j}^{\text {task }}\mathbf{h}_{k, j}^{L M}\]</span></p><ul><li><p><span class="math inline">\(\gamma^{t a s k}\)</span>Ë°°Èáè ELMoÂØπ‰ªªÂä°ÁöÑÊÄª‰ΩìÊúâÁî®ÊÄßÔºåÊòØ‰∏∫ÁâπÂÆö‰ªªÂä°Â≠¶‰π†ÁöÑÂÖ®Â±ÄÊØî‰æãÂõ†Â≠ê</p></li><li><p><span class="math inline">\(s^{task}\)</span>ÊòØ softmaxÂΩí‰∏ÄÂåñÁöÑÊ∑∑ÂêàÊ®°ÂûãÊùÉÈáçÔºåÊòØ BiLSTMÁöÑÂä†ÊùÉÂπ≥ÂùáÂÄºÁöÑÊùÉÈáçÔºåÂØπ‰∏çÂêåÁöÑ‰ªªÂä°ÊòØ‰∏çÂêåÁöÑÔºåÂõ†‰∏∫‰∏çÂêåÁöÑ‰ªªÂä°ÂØπ‰∏çÂêåÂ±ÇÁöÑBiLSTM ÁöÑ</p></li><li><p>È¶ñÂÖàËøêË°å biLM Ëé∑ÂèñÊØè‰∏™ÂçïËØçÁöÑË°®Á§∫</p></li><li><p>ÁÑ∂ÂêéÔºåËÆ© (Êó†ËÆ∫‰ªÄ‰πà) ÊúÄÁªà‰ªªÂä°Ê®°Âûã‰ΩøÁî®ÂÆÉ‰ª¨</p><ul><li>ÂÜªÁªì ELMo ÁöÑÊùÉÈáçÔºåÁî®‰∫éÁõëÁù£Ê®°Âûã</li><li>Â∞Ü ELMo ÊùÉÈáçËøûÊé•Âà∞ÁâπÂÆö‰∫é‰ªªÂä°ÁöÑÊ®°Âûã‰∏≠<ul><li>ÁªÜËäÇÂèñÂÜ≥‰∫é‰ªªÂä°<ul><li>ÂÉè TagLM ‰∏ÄÊ†∑ËøûÊé•Âà∞‰∏≠Èó¥Â±ÇÊòØÂÖ∏ÂûãÁöÑ</li><li>ÂèØ‰ª•Âú®Áîü‰∫ßËæìÂá∫Êó∂Êèê‰æõÊõ¥Â§öÁöÑË°®Á§∫Ôºå‰æãÂ¶ÇÂú®ÈóÆÁ≠îÁ≥ªÁªü‰∏≠</li></ul></li></ul></li></ul></li></ul><h2 id="elmoÂú®Â∫èÂàóÊ†áËÆ∞Âô®‰∏≠ÁöÑ‰ΩøÁî®">2.2 ELMoÂú®Â∫èÂàóÊ†áËÆ∞Âô®‰∏≠ÁöÑ‰ΩøÁî®</h2><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/3.png" /></p><h2 id="elmo-Â±ÇÊùÉÈáç">2.3 ELMo ÔºöÂ±ÇÊùÉÈáç</h2><ul><li>Ëøô‰∏§‰∏™ biLSTM NLM Â±ÇÊúâ‰∏çÂêåÁöÑÁî®ÈÄî / Âê´‰πâ<ul><li>‰ΩéÂ±ÇÊõ¥ÈÄÇÂêà‰ΩéÁ∫ßËØ≠Ê≥ïÔºå‰æãÂ¶Ç<ul><li>ËØçÊÄßÊ†áÊ≥®(part-of-speech tagging)„ÄÅÂè•Ê≥ï‰æùËµñ(syntacticdependency)„ÄÅNER</li></ul></li><li>È´òÂ±ÇÊõ¥ÈÄÇÂêàÊõ¥È´òÁ∫ßÂà´ÁöÑËØ≠‰πâ<ul><li>ÊÉÖÁª™„ÄÅËØ≠‰πâËßíËâ≤Ê†áËÆ∞„ÄÅÈóÆÁ≠îÁ≥ªÁªü„ÄÅSNLI</li></ul></li></ul></li><li>Ëøô‰ºº‰πéÂæàÊúâË∂£Ôºå‰ΩÜÂÆÉÊòØÂ¶Ç‰ΩïÈÄöËøá‰∏§Â±Ç‰ª•‰∏äÁöÑÁΩëÁªúÊù•ÂÆûÁé∞ÁöÑÁúãËµ∑Êù•Êõ¥ÊúâË∂£</li></ul><h1 id="ulmfitÊ®°Âûã">3.ULMfitÊ®°Âûã</h1><h2 id="ulmfit">3.1 ULMfit</h2><ul><li><p>ËΩ¨Áßª NLM Áü•ËØÜÁöÑ‰∏ÄËà¨ÊÄùË∑ØÊòØ‰∏ÄÊ†∑ÁöÑ</p></li><li><p>ËøôÈáåÂ∫îÁî®‰∫éÊñáÊú¨ÂàÜÁ±ª</p><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/4.png" /></p></li><li><p>Âú®Â§ßÂûãÈÄöÁî®È¢ÜÂüüÁöÑÊó†ÁõëÁù£ËØ≠ÊñôÂ∫ì‰∏ä‰ΩøÁî® biLM ËÆ≠ÁªÉ</p><ul><li><p>Âú®ÁõÆÊ†á‰ªªÂä°Êï∞ÊçÆ‰∏äË∞ÉÊï¥ LM</p></li><li><p>ÂØπÁâπÂÆö‰ªªÂä°Â∞ÜÂàÜÁ±ªÂô®ËøõË°åÂæÆË∞É</p><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/5.png" /></p></li></ul></li><li><p>‰ΩøÁî®ÂêàÁêÜÂ§ßÂ∞èÁöÑ <code>1 GPU</code>ËØ≠Ë®ÄÊ®°ÂûãÔºåÂπ∂‰∏çÊòØÁúüÁöÑÂæàÂ§ß</p></li><li><p>Âú®LMË∞É‰ºò‰∏≠Ë¶ÅÊ≥®ÊÑèÂæàÂ§ö</p><ul><li>‰∏çÂêåÁöÑÊØèÂ±ÇÂ≠¶‰π†ÈÄüÂ∫¶</li><li>ÂÄæÊñú‰∏âËßíÂΩ¢Â≠¶‰π†Áéá (STLR) ËÆ°Âàí</li></ul></li><li><p>Â≠¶‰π†ÂàÜÁ±ªÂô®Êó∂ÈÄêÊ≠•ÂàÜÂ±ÇËß£ÂÜªÂíåSTLR</p></li><li><p>‰ΩøÁî®<span class="math inline">\(\left[h_{T},\operatorname{maxpool}(\mathbf{h}), \text { meanpool}(\mathbf{h})\right]\)</span>ËøõË°åÂàÜÁ±ª</p></li><li><p>‰ΩøÁî®Â§ßÂûãÁöÑÈ¢ÑËÆ≠ÁªÉËØ≠Ë®ÄÊ®°ÂûãÔºåÊòØ‰∏ÄÁßçÊèêÈ´òÊÄßËÉΩÁöÑÈùûÂ∏∏ÊúâÊïàÁöÑÊñπÊ≥ï</p></li></ul><h1 id="transformerÁªìÊûÑ">4.TransformerÁªìÊûÑ</h1><h2 id="transformer‰ªãÁªç">4.1 Transformer‰ªãÁªç</h2><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/6.png" /></p><ul><li>ÊâÄÊúâËøô‰∫õÊ®°ÂûãÈÉΩÊòØ‰ª•Transformer‰∏∫‰∏ªÁªìÊûÑÁöÑÔºåÊàë‰ª¨Â∫îËØ•Â≠¶‰π†‰∏Ä‰∏ãTransformerÂêß</li></ul><p><strong>Ë°•ÂÖÖËØ¥Êòé</strong></p><ul><li>Transformer ‰∏ç‰ªÖÂæàÂº∫Â§ßÔºåËÄå‰∏îÂÖÅËÆ∏Êâ©Â±ïÂà∞Êõ¥Â§ßÁöÑÂ∞∫ÂØ∏</li></ul><h2 id="transformers-Âä®Êú∫">4.2 Transformers Âä®Êú∫</h2><ul><li><p>Êàë‰ª¨ÊÉ≥Ë¶ÅÂπ∂Ë°åÂåñÔºå‰ΩÜÊòØRNNsÊú¨Ë¥®‰∏äÊòØÈ°∫Â∫èÁöÑ</p></li><li><p>Â∞ΩÁÆ°Êúâ GRUs Âíå LSTMsÔºåRNNs‰ªçÁÑ∂ÈúÄË¶ÅÊ≥®ÊÑèÊú∫Âà∂Êù•Â§ÑÁêÜÈïøÊúü‰æùËµñÂÖ≥Á≥ª‚Äî‚ÄîÂê¶ÂàôÁä∂ÊÄÅ‰πãÈó¥ÁöÑ path length<strong>Ë∑ØÂæÑÈïøÂ∫¶</strong> ‰ºöÈöèÁùÄÂ∫èÂàóÂ¢ûÈïø</p></li><li><p>‰ΩÜÂ¶ÇÊûúÊ≥®ÊÑèÂäõËÆ©Êàë‰ª¨ËøõÂÖ•‰ªª‰Ωï‰∏Ä‰∏™Áä∂ÊÄÅ‚Ä¶‚Ä¶‰πüËÆ∏Êàë‰ª¨ÂèØ‰ª•Âè™Áî®Ê≥®ÊÑèÂäõËÄå‰∏çÈúÄË¶ÅRNN?</p></li></ul><h2 id="transformer-Ê¶ÇËßà">4.3 Transformer Ê¶ÇËßà</h2><ul><li>Â∫èÂàóÂà∞Â∫èÂàóÁºñÁ†ÅËß£Á†ÅÊ®°ÂûãÔºå‰ΩÜÂÆÉÊòØÈùûÂæ™ÁéØÈùû‰∏≤Ë°åÁªìÊûÑ</li><li><strong>‰ªªÂä°</strong>ÔºöÂπ≥Ë°åËØ≠ÊñôÂ∫ìÁöÑÊú∫Âô®ÁøªËØë</li><li>È¢ÑÊµãÊØè‰∏™ÁøªËØëÂçïËØç</li><li>ÊúÄÁªàÊàêÊú¨/ËØØÂ∑ÆÂáΩÊï∞ÊòØ softmax ÂàÜÁ±ªÂô®Âü∫Á°Ä‰∏äÁöÑÊ†áÂáÜ‰∫§ÂèâÁÜµËØØÂ∑Æ</li></ul><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/7.png" /></p><h2 id="transformer-Âü∫Á°Ä">4.4 Transformer Âü∫Á°Ä</h2><ul><li>Ëá™Â≠¶ transformer<ul><li>‰∏ªË¶ÅÊé®ËçêËµÑÊ∫ê<ul><li>http://nlp.seas.harvard.edu/2018/04/03/attention.html</li><li>The Annotated Transformer by Sasha Rush</li></ul></li><li>‰∏Ä‰∏™‰ΩøÁî®PyTorchÁöÑJupyterÁ¨îËÆ∞Êú¨ÔºåËß£Èáä‰∫Ü‰∏ÄÂàáÔºÅ</li></ul></li><li>Áé∞Âú®ÔºöÊàë‰ª¨ÂÆö‰πâ Transformer ÁΩëÁªúÁöÑÂü∫Êú¨ÊûÑÂª∫ÂùóÔºöÁ¨¨‰∏ÄÔºåÊñ∞ÁöÑÊ≥®ÊÑèÂäõÂ±Ç</li></ul><h2 id="ÁÇπ‰πòÊ≥®ÊÑèÂäõ-dot-product-attention">4.5 ÁÇπ‰πòÊ≥®ÊÑèÂäõ Dot-ProductAttention</h2><ul><li><p><strong>ËæìÂÖ•</strong>ÔºöÂØπ‰∫é‰∏Ä‰∏™ËæìÂá∫ËÄåË®ÄÁöÑÊü•ËØ¢<spanclass="math inline">\(q\)</span>Âíå‰∏ÄÁªÑÈîÆ-ÂÄºÂØπ<spanclass="math inline">\((k-v)\)</span></p></li><li><p>QueryÔºåkeysÔºåvaluesÔºåand output ÈÉΩÊòØÂêëÈáè</p></li><li><p>ËæìÂá∫ÂÄºÁöÑÂä†ÊùÉÂíå</p></li><li><p>ÊùÉÈáçÁöÑÊØè‰∏™ÂÄºÊòØÁî±Êü•ËØ¢ÂíåÁõ∏ÂÖ≥ÈîÆÁöÑÂÜÖÁßØËÆ°ÁÆóÁªìÊûú</p></li><li><p>Query Âíå keys ÊúâÁõ∏ÂêåÁª¥Êï∞<spanclass="math inline">\(d_k\)</span>Ôºåvalue ÁöÑÁª¥Êï∞‰∏∫<spanclass="math inline">\(d_v\)</span></p></li></ul><p><span class="math display">\[A(q, K, V)=\sum_{i} \frac{e^{q \cdot k_{i}}}{\sum_{j} e^{q \cdot k_{j}}}v_{i}\]</span></p><h2 id="ÁÇπ‰πòÊ≥®ÊÑèÂäõÁü©ÈòµË°®Á§∫Ê≥ï">4.6 ÁÇπ‰πòÊ≥®ÊÑèÂäõÁü©ÈòµË°®Á§∫Ê≥ï</h2><ul><li>ÂΩìÊàë‰ª¨ÊúâÂ§ö‰∏™Êü•ËØ¢<spanclass="math inline">\(q\)</span>Êó∂ÔºåÊàë‰ª¨Â∞ÜÂÆÉ‰ª¨Âè†Âä†Âú®‰∏Ä‰∏™Áü©Èòµ<spanclass="math inline">\(Q\)</span>‰∏≠</li><li>ÂèòÊàê<span class="math inline">\(A(Q, K,V)=\operatorname{softmax}\left(Q K^{T}\right) V\)</span></li></ul><h2 id="Áº©ÊîæÁÇπ‰πòÊ≥®ÊÑèÂäõ">4.7 Áº©ÊîæÁÇπ‰πòÊ≥®ÊÑèÂäõ</h2><ul><li><p><strong>ÈóÆÈ¢ò</strong>Ôºö<spanclass="math inline">\(d_k\)</span>ÂèòÂ§ßÊó∂Ôºå<spanclass="math inline">\(q^Tk\)</span>ÁöÑÊñπÂ∑ÆÂ¢ûÂ§ß ‚Üí ‰∏Ä‰∫õ softmax‰∏≠ÁöÑÂÄºÁöÑÊñπÂ∑ÆÂ∞Ü‰ºöÂèòÂ§ß ‚Üí softmax ÂæóÂà∞ÁöÑÊòØÂ≥∞ÂÄº ‚Üí Âõ†Ê≠§Ê¢ØÂ∫¶ÂèòÂ∞è‰∫Ü</p></li><li><p><strong>Ëß£ÂÜ≥ÊñπÊ°à</strong>ÔºöÈÄöËøá query / keyÂêëÈáèÁöÑÈïøÂ∫¶ËøõË°åÁº©Êîæ</p></li></ul><p><span class="math display">\[A(Q, K, V)=\operatorname{softmax}\left(\frac{QK^{T}}{\sqrt{d_{k}}}\right) V\]</span></p><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/11.png" /></p><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/9.png" /></p><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/8.png" /></p><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/10.png" /></p><h2 id="ÁºñÁ†ÅÂô®‰∏≠ÁöÑËá™Ê≥®ÊÑèÂäõ">4.8 ÁºñÁ†ÅÂô®‰∏≠ÁöÑËá™Ê≥®ÊÑèÂäõ</h2><ul><li><p>ËæìÂÖ•ÂçïËØçÂêëÈáèÊòØ queriesÔºåkeys and values</p></li><li><p>Êç¢Âè•ËØùËØ¥Ôºö<strong>Ëøô‰∏™ËØçÂêëÈáèËá™Â∑±ÈÄâÊã©ÂΩºÊ≠§</strong></p></li><li><p>ËØçÂêëÈáèÂ†ÜÊ†à= Q = K = V</p></li><li><p>Êàë‰ª¨‰ºöÈÄöËøáËß£Á†ÅÂô®ÊòéÁôΩ‰∏∫‰ªÄ‰πàÊàë‰ª¨Âú®ÂÆö‰πâ‰∏≠Â∞Ü‰ªñ‰ª¨ÂàÜÂºÄ</p></li></ul><h2 id="Â§öÂ§¥Ê≥®ÊÑèÂäõ">4.9 Â§öÂ§¥Ê≥®ÊÑèÂäõ</h2><ul><li>ÁÆÄÂçï self-attention ÁöÑÈóÆÈ¢ò<ul><li>ÂçïËØçÂè™Êúâ‰∏ÄÁßçÁõ∏‰∫í‰∫§‰∫íÁöÑÊñπÂºè</li></ul></li><li><strong>Ëß£ÂÜ≥ÊñπÊ°à</strong>Ôºö<strong>Â§öÂ§¥Ê≥®ÊÑèÂäõ</strong></li><li>È¶ñÂÖàÔºåÈÄöËøáÁü©Èòµ<span class="math inline">\(W\)</span>Â∞Ü<spanclass="math inline">\(Q\)</span>Ôºå<spanclass="math inline">\(K\)</span>Ôºå<spanclass="math inline">\(V\)</span>Êò†Â∞ÑÂà∞<spanclass="math inline">\(h=8\)</span>ÁöÑËÆ∏Â§ö‰ΩéÁª¥Á©∫Èó¥</li><li>ÁÑ∂ÂêéÔºåÂ∫îÁî®Ê≥®ÊÑèÂäõÔºåÁÑ∂ÂêéËøûÊé•ËæìÂá∫ÔºåÈÄöËøáÁ∫øÊÄßÂ±Ç</li></ul><p><span class="math display">\[\operatorname{MultiHead}(\boldsymbol{Q}, \boldsymbol{K},\boldsymbol{V})=\operatorname{Concat}\left(\right.  head  _{1}, \ldots ,head  \left._{h}\right)  where \ head\  hention  _{i}=  Attention (\left.Q W_{i}^{Q}, K W_{i}^{K}, V W_{i}^{V}\right)\]</span></p><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/12.png" /></p><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/13.png" /></p><h2 id="ÂÆåÊï¥ÁöÑtransformerÊ®°Âùó">4.10 ÂÆåÊï¥ÁöÑtransformerÊ®°Âùó</h2><ul><li><p>ÊØè‰∏™ Block ÈÉΩÊúâ‰∏§‰∏™Â≠êÂ±Ç</p><ul><li><p>Â§öÂ§¥ attention</p></li><li><p>‰∏§Â±ÇÁöÑÂâçÈ¶àÁ•ûÁªèÁΩëÁªúÔºå‰ΩøÁî® ReLU</p></li></ul></li><li><p>Ëøô‰∏§‰∏™Â≠êÂ±ÇÈÉΩ</p><ul><li>ÊÆãÂ∑ÆËøûÊé•‰ª•ÂèäÂ±ÇÂΩí‰∏ÄÂåñ</li><li>LayerNorm(x+Sublayer(x))</li><li>Â±ÇÂΩí‰∏ÄÂåñÂ∞ÜËæìÂÖ•ËΩ¨Âåñ‰∏∫ÂùáÂÄºÊòØ0ÔºåÊñπÂ∑ÆÊòØ1ÔºåÊØè‰∏ÄÂ±ÇÂíåÊØè‰∏Ä‰∏™ËÆ≠ÁªÉÁÇπ(Âπ∂‰∏îÊ∑ªÂä†‰∫Ü‰∏§‰∏™ÂèÇÊï∞)</li></ul></li></ul><p><span class="math display">\[\mu^{l}=\frac{1}{H} \sum_{i=1}^{H} a_{i}^{l} \quad\sigma^{l}=\sqrt{\frac{1}{H}\sum_{i=1}^{H}\left(a_{i}^{l}-\mu^{l}\right)^{2}} \quadh_{i}=f\left(\frac{g_{i}}{\sigma_{i}}\left(a_{i}-\mu_{i}\right)+b_{i}\right)\]</span></p><h2 id="ÁºñÁ†ÅÂô®ËæìÂÖ•">4.11 ÁºñÁ†ÅÂô®ËæìÂÖ•</h2><ul><li><p>ÂÆûÈôÖÁöÑËØçË°®Á§∫ÊòØ byte-pair ÁºñÁ†Å</p></li><li><p>ËøòÊ∑ªÂä†‰∫Ü‰∏Ä‰∏™ positional encoding‰ΩçÁΩÆÁºñÁ†ÅÔºåÁõ∏ÂêåÁöÑËØçËØ≠Âú®‰∏çÂêåÁöÑ‰ΩçÁΩÆÊúâ‰∏çÂêåÁöÑÊï¥‰ΩìË°®ÂæÅ</p></li></ul><p><span class="math display">\[\left\{\begin{array}{l}P E(p o s, 2 i)=\sin \left(p o s / 10000^{2 i / d_{\text {model}}}\right) \\P E(\operatorname{pos}, 2 i+1)=\cos \left(p o s / 10000^{2 i / d_{\text{model }}}\right)\end{array}\right.\]</span></p><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/14.png" /></p><h2 id="ÂÆåÊï¥ÁºñÁ†ÅÂô®encoder">4.12 ÂÆåÊï¥ÁºñÁ†ÅÂô®Encoder</h2><ul><li><p>encoder ‰∏≠ÔºåÊØè‰∏™ Block ÈÉΩÊòØÊù•Ëá™Ââç‰∏ÄÂ±ÇÁöÑ<spanclass="math inline">\(Q,K,V\)</span></p></li><li><p>Blocks Ë¢´ÈáçÂ§ç 6 Ê¨° (ÂûÇÁõ¥ÊñπÂêë)</p></li><li><p>Âú®ÊØè‰∏™Èò∂ÊÆµÔºå‰Ω†ÂèØ‰ª•ÈÄöËøáÂ§öÂ§¥Ê≥®ÊÑèÂäõÁúãÂà∞Âè•Â≠ê‰∏≠ÁöÑÂêÑ‰∏™Âú∞ÊñπÔºåÁ¥ØÁßØ‰ø°ÊÅØÂπ∂Â∞ÜÂÖ∂Êé®ÈÄÅÂà∞‰∏ã‰∏ÄÂ±Ç„ÄÇÂú®‰ªª‰∏ÄÊñπÂêë‰∏äÁöÑÂ∫èÂàóÈÄêÊ≠•Êé®ÈÄÅ‰ø°ÊÅØÊù•ËÆ°ÁÆóÊÑüÂÖ¥Ë∂£ÁöÑÂÄº</p></li><li><p>ÈùûÂ∏∏ÂñÑ‰∫éÂ≠¶‰π†ËØ≠Ë®ÄÁªìÊûÑ</p></li></ul><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/15.png" /></p><h2 id="Ê≥®ÊÑèÂäõÂèØËßÜÂåñ">4.13 Ê≥®ÊÑèÂäõÂèØËßÜÂåñ</h2><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/16.png" /></p><h2 id="transformerËß£Á†ÅÂô®">4.14 TransformerËß£Á†ÅÂô®</h2><ul><li><p>decoder ‰∏≠Êúâ‰∏§‰∏™Á®çÂä†ÊîπÂèòÁöÑÂ≠êÂ±Ç</p></li><li><p>ÂØπ‰πãÂâçÁîüÊàêÁöÑËæìÂá∫ËøõË°å Masked decoder self-attention</p></li><li><p>Encoder-Decoder AttentionÔºåqueries Êù•Ëá™‰∫éÂâç‰∏Ä‰∏™ decoder Â±ÇÔºåkeysÂíå values Êù•Ëá™‰∫é encoder ÁöÑËæìÂá∫</p></li><li><p>Blocks ÂêåÊ†∑ÈáçÂ§ç 6 Ê¨°</p></li></ul><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/17.png" /></p><h2 id="transformerÁöÑÊäÄÂ∑ß‰∏éÂª∫ËÆÆ">4.15 TransformerÁöÑÊäÄÂ∑ß‰∏éÂª∫ËÆÆ</h2><p><strong>ÁªÜËäÇ</strong>(ËÆ∫Êñá/‰πãÂêéÁöÑËÆ≤Â∫ß)</p><ul><li><p>Byte-pair encodings</p></li><li><p>Checkpoint averaging</p></li><li><p>Adam ‰ºòÂåñÂô®ÊéßÂà∂Â≠¶‰π†ÈÄüÁéáÂèòÂåñ</p></li><li><p>ËÆ≠ÁªÉÊó∂ÔºåÂú®ÊØè‰∏ÄÂ±ÇÊ∑ªÂä†ÊÆãÂ∑Æ‰πãÂâçËøõË°å Dropout</p></li><li><p>Ê†áÁ≠æÂπ≥Êªë</p></li><li><p>Â∏¶ÊúâÊùüÊêúÁ¥¢ÂíåÈïøÂ∫¶ÊÉ©ÁΩöÁöÑËá™ÂõûÂΩíËß£Á†Å</p></li><li><p>Âõ†‰∏∫ transformerÊ≠£Âú®ËîìÂª∂Ôºå‰ΩÜ‰ªñ‰ª¨ÂæàÈöæ‰ºòÂåñÂπ∂‰∏î‰∏çÂÉèLSTMsÈÇ£Ê†∑ÂºÄÁÆ±Âç≥Áî®Ôºå‰ªñ‰ª¨Ëøò‰∏çËÉΩÂæàÂ•Ω‰∏éÂÖ∂‰ªñ‰ªªÂä°ÁöÑÊûÑ‰ª∂ÂÖ±ÂêåÂ∑•‰Ωú</p></li></ul><h1 id="bertÊ®°Âûã">5.BERTÊ®°Âûã</h1><h2 id="ËÆ∫ÊñáËß£ËØª-bert-devlin-chang-lee-toutanova-2018">5.1 ËÆ∫ÊñáËß£ËØªBERT: Devlin, Chang, Lee, Toutanova (2018)</h2><ul><li><p>BERTÔºöÁî®‰∫éËØ≠Ë®ÄÁêÜËß£ÁöÑÈ¢ÑËÆ≠ÁªÉÊ∑±Â∫¶ÂèåÂêë transformers</p></li><li><p>ÈóÆÈ¢òÔºöËØ≠Ë®ÄÊ®°ÂûãÂè™‰ΩøÁî®Â∑¶‰∏ä‰∏ãÊñáÊàñÂè≥‰∏ä‰∏ãÊñáÔºå‰ΩÜËØ≠Ë®ÄÁêÜËß£ÊòØÂèåÂêëÁöÑ</p></li><li><p>‰∏∫‰ªÄ‰πàLMsÊòØÂçïÂêëÁöÑÔºü</p><ul><li><strong>ÂéüÂõ†1</strong>ÔºöÊñπÂêëÊÄßÂØπ‰∫éÁîüÊàêÊ†ºÂºèËâØÂ•ΩÁöÑÊ¶ÇÁéáÂàÜÂ∏ÉÊòØÊúâÂøÖË¶ÅÁöÑ[Êàë‰ª¨‰∏çÂú®‰πéËøô‰∏™]</li><li><strong>ÂéüÂõ†2</strong>ÔºöÂèåÂêëÁºñÁ†ÅÂô®‰∏≠ÂçïËØçÂèØ‰ª•<code>ÁúãÂà∞Ëá™Â∑±</code></li></ul></li></ul><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/18.png" /></p><ul><li><p>Ëß£ÂÜ≥ÊñπÊ°àÔºöÊé©Áõñk%ÁöÑËæìÂÖ•ÂçïËØçÔºåÁÑ∂ÂêéÈ¢ÑÊµã masked words</p></li><li><p>‰∏çÂÜçÊòØ‰º†ÁªüÁöÑËÆ°ÁÆóÁîüÊàêÂè•Â≠êÁöÑÊ¶ÇÁéáÁöÑËØ≠Ë®ÄÊ®°ÂûãÔºåÁõÆÊ†áÊòØÂ°´Á©∫</p><ul><li>ÊÄªÊòØ‰ΩøÁî®k=15%</li></ul></li><li><p>Masking Â§™Â∞ëÔºöËÆ≠ÁªÉÂ§™ÊòÇË¥µ</p></li><li><p>Masking Â§™Â§öÔºöÊ≤°ÊúâË∂≥Â§üÁöÑ‰∏ä‰∏ãÊñá</p></li><li><p><strong>GPT</strong> ÊòØÁªèÂÖ∏ÁöÑÂçïÈ°πÁöÑËØ≠Ë®ÄÊ®°Âûã</p></li><li><p><strong>ELMo</strong>ÊòØÂèåÂêëÁöÑÔºå‰ΩÜÊòØ‰∏§‰∏™Ê®°ÂûãÊòØÂÆåÂÖ®Áã¨Á´ãËÆ≠ÁªÉÁöÑÔºåÂè™ÊòØÂ∞ÜËæìÂá∫ËøûÊé•Âú®‰∏ÄËµ∑ÔºåÂπ∂Ê≤°Êúâ‰ΩøÁî®ÂèåÂêëÁöÑcontext</p></li><li><p><strong>BERT</strong> ‰ΩøÁî® maskÁöÑÊñπÂºèËøõË°åÊï¥‰∏™‰∏ä‰∏ãÊñáÁöÑÈ¢ÑÊµãÔºå‰ΩøÁî®‰∫ÜÂèåÂêëÁöÑ‰∏ä‰∏ãÊñá‰ø°ÊÅØ</p></li></ul><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/19.png" /></p><h2 id="bert-Ê®°ÂûãÂæÆË∞É">5.2 BERT Ê®°ÂûãÂæÆË∞É</h2><ul><li>Âè™Â≠¶‰π†‰∏Ä‰∏™Âª∫Á´ãÂú®È°∂Â±ÇÁöÑÂàÜÁ±ªÂô®ÔºåÂæÆË∞ÉÁöÑÊØè‰∏™‰ªªÂä°</li></ul><p><img src="/img/nlp/Á¨¨ÂçÅ‰∏âËÆ≤/120.png" /></p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Á¨¨ÂçÅ‰∏ÄËÆ≤-NLP‰∏≠ÁöÑÂç∑ÁßØÁ•ûÁªèÁΩëÁªú</title>
    <link href="/2022/06/15/%E7%AC%AC%E5%8D%81%E4%B8%80%E8%AE%B2-NLP%E4%B8%AD%E7%9A%84%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    <url>/2022/06/15/%E7%AC%AC%E5%8D%81%E4%B8%80%E8%AE%B2-NLP%E4%B8%AD%E7%9A%84%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Á¨¨ÂçÅËÆ≤-NLP‰∏≠ÁöÑÈóÆÁ≠îÁ≥ªÁªü</title>
    <link href="/2022/06/06/%E7%AC%AC%E5%8D%81%E8%AE%B2-NLP%E4%B8%AD%E7%9A%84%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/"/>
    <url>/2022/06/06/%E7%AC%AC%E5%8D%81%E8%AE%B2-NLP%E4%B8%AD%E7%9A%84%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[<h1 id="squadÈóÆÁ≠îÊï∞ÊçÆÈõÜ">1„ÄÅSQuADÈóÆÁ≠îÊï∞ÊçÆÈõÜ</h1><h2 id="ÊñØÂù¶Á¶èÈóÆÁ≠îÊï∞ÊçÆÈõÜ-squad">1.1 ÊñØÂù¶Á¶èÈóÆÁ≠îÊï∞ÊçÆÈõÜ (SQuAD)</h2><ul><li><p>PassageÊòØÊù•Ëá™Áª¥Âü∫ÁôæÁßëÁöÑ‰∏ÄÊÆµÊñáÊú¨ÔºåÁ≥ªÁªüÈúÄË¶ÅÂõûÁ≠îÈóÆÈ¢òÔºåÂú®ÊñáÁ´†‰∏≠ÊâæÂá∫Á≠îÊ°à</p></li><li><p><span class="math inline">\(1000k\)</span>‰∏™Ê†∑Êú¨</p></li><li><p>Á≠îÊ°àÂøÖÈ°ªÊòØÊñáÁ´†‰∏≠ÁöÑ‰∏ÄÁ≥ªÂàóÂçïËØçÂ∫èÂàó</p></li><li><p>‰πüÂ∞±ÊòØÊèêÂèñÂºèÈóÆÁ≠î</p></li></ul><h2 id="squad-ËØÑ‰º∞v1.1">1.2 SQuAD ËØÑ‰º∞Ôºåv1.1</h2><p>‰ΩúËÄÖÊî∂ÈõÜ‰∫Ü3‰∏™ÂèÇËÄÉÁ≠îÊ°à</p><p>Á≥ªÁªüÂú®‰∏§‰∏™ÊåáÊ†á‰∏äËÆ°ÁÆóÂæóÂàÜ -<strong>Á≤æÁ°ÆÂåπÈÖç</strong>Ôºö1/0ÁöÑÂáÜÁ°ÆÂ∫¶Ôºå‰Ω†ÊòØÂê¶ÂåπÈÖç‰∏â‰∏™Á≠îÊ°à‰∏≠ÁöÑ‰∏Ä‰∏™ -F1ÔºöÂ∞ÜÁ≥ªÁªüÂíåÊØè‰∏™Á≠îÊ°àÈÉΩËßÜ‰∏∫ËØçË¢ãÔºåÂπ∂ËØÑ‰º∞</p><p><span class="math display">\[\text { Precision }=\frac{T P}{T P+F P}\]</span></p><p><span class="math display">\[\text { Recall }=\frac{T P}{T P+F N}\]</span></p><p><span class="math display">\[\text { harmonic mean } \mathrm{F} 1=\frac{2 P R}{P+R}\]</span></p><ul><li>ÂàÜÊï∞ÊòØ (ÂÆèËßÇ) Âπ≥ÂùáÊØèÈ¢ò F1ÂàÜÊï∞</li></ul><p>F1ÊµãÈáèË¢´ËßÜ‰∏∫Êõ¥ÂèØÈù†ÁöÑÊåáÊ†áÔºå‰Ωú‰∏∫‰∏ªË¶ÅÊåáÊ†á‰ΩøÁî®</p><ul><li>ÂÆÉ‰∏çÊòØÂü∫‰∫éÈÄâÊã©ÊòØÂê¶Âíå‰∫∫Á±ªÈÄâÊã©ÁöÑË∑®Â∫¶ÂÆåÂÖ®Áõ∏ÂêåÔºå‰∫∫Á±ªÈÄâÊã©ÁöÑË∑®Â∫¶ÂÆπÊòìÂèóÂà∞ÂêÑÁßçÂΩ±ÂìçÔºåÂåÖÊã¨Êç¢Ë°å</li><li>Âú®ÂçïÊ¨°Á∫ßÂà´ÂåπÈÖç‰∏çÂêåÁöÑÁ≠îÊ°à</li></ul><p>Ëøô‰∏§‰∏™ÊåáÊ†áÂøΩËßÜÊ†áÁÇπÁ¨¶Âè∑ÂíåÂÜ†ËØç (a, an, the only)</p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Êñ∞ÈóªÊñáÊú¨ÂàÜÁ±ª</title>
    <link href="/2022/05/20/%E6%96%B0%E9%97%BB%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/"/>
    <url>/2022/05/20/%E6%96%B0%E9%97%BB%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<h1 id="Ëß£È¢òÊÄùË∑Ø">Ëß£È¢òÊÄùË∑Ø</h1><p>ËµõÈ¢òÊÄùË∑ØÂàÜÊûêÔºöËµõÈ¢òÊú¨Ë¥®ÊòØ‰∏Ä‰∏™ÊñáÊú¨ÂàÜÁ±ªÈóÆÈ¢òÔºåÈúÄË¶ÅÊ†πÊçÆÊØèÂè•ÁöÑÂ≠óÁ¨¶ËøõË°åÂàÜÁ±ª„ÄÇ‰ΩÜËµõÈ¢òÁªôÂá∫ÁöÑÊï∞ÊçÆÊòØÂåøÂêçÂåñÁöÑÔºå‰∏çËÉΩÁõ¥Êé•‰ΩøÁî®‰∏≠ÊñáÂàÜËØçÁ≠âÊìç‰ΩúÔºåËøô‰∏™ÊòØËµõÈ¢òÁöÑÈöæÁÇπ„ÄÇ</p><p>Âõ†Ê≠§Êú¨Ê¨°ËµõÈ¢òÁöÑÈöæÁÇπÊòØÈúÄË¶ÅÂØπÂåøÂêçÂ≠óÁ¨¶ËøõË°åÂª∫Ê®°ÔºåËøõËÄåÂÆåÊàêÊñáÊú¨ÂàÜÁ±ªÁöÑËøáÁ®ã„ÄÇÁî±‰∫éÊñáÊú¨Êï∞ÊçÆÊòØ‰∏ÄÁßçÂÖ∏ÂûãÁöÑÈùûÁªìÊûÑÂåñÊï∞ÊçÆÔºåÂõ†Ê≠§ÂèØËÉΩÊ∂âÂèäÂà∞<code>ÁâπÂæÅÊèêÂèñ</code>Âíå<code>ÂàÜÁ±ªÊ®°Âûã</code>‰∏§‰∏™ÈÉ®ÂàÜ„ÄÇ‰∏∫‰∫ÜÂáè‰ΩéÂèÇËµõÈöæÂ∫¶ÔºåÊàë‰ª¨Êèê‰æõ‰∫Ü‰∏Ä‰∫õËß£È¢òÊÄùË∑Ø‰æõÂ§ßÂÆ∂ÂèÇËÄÉÔºö</p><ul><li>ÊÄùË∑Ø1ÔºöTF-IDF + Êú∫Âô®Â≠¶‰π†ÂàÜÁ±ªÂô®</li></ul><p>Áõ¥Êé•‰ΩøÁî®TF-IDFÂØπÊñáÊú¨ÊèêÂèñÁâπÂæÅÔºåÂπ∂‰ΩøÁî®ÂàÜÁ±ªÂô®ËøõË°åÂàÜÁ±ª„ÄÇÂú®ÂàÜÁ±ªÂô®ÁöÑÈÄâÊã©‰∏äÔºåÂèØ‰ª•‰ΩøÁî®SVM„ÄÅLR„ÄÅÊàñËÄÖXGBoost„ÄÇ</p><ul><li>ÊÄùË∑Ø2ÔºöFastText</li></ul><p>FastTextÊòØÂÖ•Èó®Ê¨æÁöÑËØçÂêëÈáèÔºåÂà©Áî®FacebookÊèê‰æõÁöÑFastTextÂ∑•ÂÖ∑ÔºåÂèØ‰ª•Âø´ÈÄüÊûÑÂª∫Âá∫ÂàÜÁ±ªÂô®„ÄÇ</p><ul><li>ÊÄùË∑Ø3ÔºöWordVec + Ê∑±Â∫¶Â≠¶‰π†ÂàÜÁ±ªÂô®</li></ul><p>WordVecÊòØËøõÈò∂Ê¨æÁöÑËØçÂêëÈáèÔºåÂπ∂ÈÄöËøáÊûÑÂª∫Ê∑±Â∫¶Â≠¶‰π†ÂàÜÁ±ªÂÆåÊàêÂàÜÁ±ª„ÄÇÊ∑±Â∫¶Â≠¶‰π†ÂàÜÁ±ªÁöÑÁΩëÁªúÁªìÊûÑÂèØ‰ª•ÈÄâÊã©TextCNN„ÄÅTextRNNÊàñËÄÖBiLSTM„ÄÇ</p><ul><li>ÊÄùË∑Ø4ÔºöBertËØçÂêëÈáè</li></ul><p>BertÊòØÈ´òÈÖçÊ¨æÁöÑËØçÂêëÈáèÔºåÂÖ∑ÊúâÂº∫Â§ßÁöÑÂª∫Ê®°Â≠¶‰π†ËÉΩÂäõ„ÄÇ</p><h2 id="Êï∞ÊçÆ‰∏ãËΩΩ">Êï∞ÊçÆ‰∏ãËΩΩ</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">! mkdir ./data<br></code></pre></div></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">train data</span><br>! wget https://tianchi-competition.oss-cn-hangzhou.aliyuncs.com/531810/train_set.csv.zip<br>! unzip train_set.csv.zip -d ./data<br>! rm train_set.csv.zip<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">test</span> data</span><br>! wget https://tianchi-competition.oss-cn-hangzhou.aliyuncs.com/531810/test_a.csv.zip<br>! unzip test_a.csv.zip -d ./data<br>! rm test_a.csv.zip<br></code></pre></div></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">2.È¢ÑËÆ≠ÁªÉ‰∏ãËΩΩ</span><br>! wget http://tianchi-media.oss-cn-beijing.aliyuncs.com/dragonball/NLP/emb.zip<br>! unzip emb.zip<br>! rm emb.zip<br>! mv ./emb/bert-mini/bert_config.json ./emb/bert-mini/config.json <br></code></pre></div></td></tr></table></figure><h2 id="Êñ∞Âª∫‰øùÂ≠òÁõÆÂΩï">Êñ∞Âª∫‰øùÂ≠òÁõÆÂΩï</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">! mkdir ./save<br></code></pre></div></td></tr></table></figure><h2 id="ÂÆâË£ÖÂøÖË¶ÅÂåÖ">ÂÆâË£ÖÂøÖË¶ÅÂåÖ</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">! pip install fasttext transformers==2.9.0 gensim torch==1.3.0<br></code></pre></div></td></tr></table></figure><h2 id="Êï∞ÊçÆËØªÂèñ">Êï∞ÊçÆËØªÂèñ</h2><p>ËµõÈ¢òÊï∞ÊçÆËôΩÁÑ∂ÊòØÊñáÊú¨Êï∞ÊçÆÔºåÊØè‰∏™Êñ∞ÈóªÊòØ‰∏çÂÆöÈïøÁöÑÔºå‰ΩÜ‰ªªÁÑ∂‰ΩøÁî®csvÊ†ºÂºèËøõË°åÂ≠òÂÇ®„ÄÇÂõ†Ê≠§ÂèØ‰ª•Áõ¥Êé•Áî®<code>Pandas</code>ÂÆåÊàêÊï∞ÊçÆËØªÂèñÁöÑÊìç‰Ωú„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br>train_df = pd.read_csv(<span class="hljs-string">&#x27;./data/train_set.csv&#x27;</span>, sep=<span class="hljs-string">&#x27;\t&#x27;</span>, nrows=<span class="hljs-number">100</span>)<br></code></pre></div></td></tr></table></figure><p>ËøôÈáåÁöÑ<code>read_csv</code>Áî±‰∏âÈÉ®ÂàÜÊûÑÊàêÔºö</p><ul><li>ËØªÂèñÁöÑÊñá‰ª∂Ë∑ØÂæÑÔºåËøôÈáåÈúÄË¶ÅÊ†πÊçÆÊîπÊàê‰Ω†Êú¨Âú∞ÁöÑË∑ØÂæÑÔºåÂèØ‰ª•‰ΩøÁî®Áõ∏ÂØπË∑ØÂæÑÊàñÁªùÂØπË∑ØÂæÑÔºõ</li><li>ÂàÜÈöîÁ¨¶<code>sep</code>Ôºå‰∏∫ÊØèÂàóÂàÜÂâ≤ÁöÑÂ≠óÁ¨¶ÔºåËÆæÁΩÆ‰∏∫<code>\t</code>Âç≥ÂèØÔºõ</li><li>ËØªÂèñË°åÊï∞<code>nrows</code>Ôºå‰∏∫Ê≠§Ê¨°ËØªÂèñÊñá‰ª∂ÁöÑÂáΩÊï∞ÔºåÊòØÊï∞ÂÄºÁ±ªÂûãÔºàÁî±‰∫éÊï∞ÊçÆÈõÜÊØîËæÉÂ§ßÔºåÂª∫ËÆÆÂÖàËÆæÁΩÆ‰∏∫100ÔºâÔºõ</li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">train_df.head()<br></code></pre></div></td></tr></table></figure><table><thead><tr class="header"><th style="text-align: left;">label</th><th style="text-align: left;">text</th><th></th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">0</td><td style="text-align: left;">2</td><td>2967 6758 339 2021 1854 3731 4109 3792 4149 15...</td></tr><tr class="even"><td style="text-align: left;">1</td><td style="text-align: left;">11</td><td>4464 486 6352 5619 2465 4802 1452 3137 5778 54...</td></tr><tr class="odd"><td style="text-align: left;">2</td><td style="text-align: left;">3</td><td>7346 4068 5074 3747 5681 6093 1777 2226 7354 6...</td></tr><tr class="even"><td style="text-align: left;">3</td><td style="text-align: left;">2</td><td>7159 948 4866 2109 5520 2490 211 3956 5520 549...</td></tr><tr class="odd"><td style="text-align: left;">4</td><td style="text-align: left;">3</td><td>3646 3055 3055 2490 4659 6065 3370 5814 2465 5...</td></tr></tbody></table><p>‰∏äÂõæÊòØËØªÂèñÂ•ΩÁöÑÊï∞ÊçÆÔºåÊòØË°®Ê†ºÁöÑÂΩ¢Âºè„ÄÇÁ¨¨‰∏ÄÂàó‰∏∫Êñ∞ÈóªÁöÑÁ±ªÂà´ÔºåÁ¨¨‰∫åÂàó‰∏∫Êñ∞ÈóªÁöÑÂ≠óÁ¨¶„ÄÇ</p><h1 id="Êï∞ÊçÆÂàÜÊûê">Êï∞ÊçÆÂàÜÊûê</h1><p>Âú®ËØªÂèñÂÆåÊàêÊï∞ÊçÆÈõÜÂêéÔºåÊàë‰ª¨ËøòÂèØ‰ª•ÂØπÊï∞ÊçÆÈõÜËøõË°åÊï∞ÊçÆÂàÜÊûêÁöÑÊìç‰Ωú„ÄÇËôΩÁÑ∂ÂØπ‰∫éÈùûÁªìÊûÑÊï∞ÊçÆÂπ∂‰∏çÈúÄË¶ÅÂÅöÂæàÂ§öÁöÑÊï∞ÊçÆÂàÜÊûêÔºå‰ΩÜÈÄöËøáÊï∞ÊçÆÂàÜÊûêËøòÊòØÂèØ‰ª•ÊâæÂá∫‰∏Ä‰∫õËßÑÂæãÁöÑ„ÄÇ</p><p>Ê≠§Ê≠•È™§Êàë‰ª¨ËØªÂèñ‰∫ÜÊâÄÊúâÁöÑËÆ≠ÁªÉÈõÜÊï∞ÊçÆÔºåÂú®Ê≠§Êàë‰ª¨ÈÄöËøáÊï∞ÊçÆÂàÜÊûêÂ∏åÊúõÂæóÂá∫‰ª•‰∏ãÁªìËÆ∫Ôºö</p><ul><li>ËµõÈ¢òÊï∞ÊçÆ‰∏≠ÔºåÊñ∞ÈóªÊñáÊú¨ÁöÑÈïøÂ∫¶ÊòØÂ§öÂ∞ëÔºü</li><li>ËµõÈ¢òÊï∞ÊçÆÁöÑÁ±ªÂà´ÂàÜÂ∏ÉÊòØÊÄé‰πàÊ†∑ÁöÑÔºåÂì™‰∫õÁ±ªÂà´ÊØîËæÉÂ§öÔºü</li><li>ËµõÈ¢òÊï∞ÊçÆ‰∏≠ÔºåÂ≠óÁ¨¶ÂàÜÂ∏ÉÊòØÊÄé‰πàÊ†∑ÁöÑÔºü</li></ul><h2 id="Âè•Â≠êÈïøÂ∫¶ÂàÜÊûê">Âè•Â≠êÈïøÂ∫¶ÂàÜÊûê</h2><p>Âú®ËµõÈ¢òÊï∞ÊçÆ‰∏≠ÊØèË°åÂè•Â≠êÁöÑÂ≠óÁ¨¶‰ΩøÁî®Á©∫Ê†ºËøõË°åÈöîÂºÄÔºåÊâÄ‰ª•ÂèØ‰ª•Áõ¥Êé•ÁªüËÆ°ÂçïËØçÁöÑ‰∏™Êï∞Êù•ÂæóÂà∞ÊØè‰∏™Âè•Â≠êÁöÑÈïøÂ∫¶„ÄÇÁªüËÆ°Âπ∂Â¶Ç‰∏ãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">%pylab inline<br>train_df[<span class="hljs-string">&#x27;text_len&#x27;</span>] = train_df[<span class="hljs-string">&#x27;text&#x27;</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">len</span>(x.split(<span class="hljs-string">&#x27; &#x27;</span>)))<br><span class="hljs-built_in">print</span>(train_df[<span class="hljs-string">&#x27;text_len&#x27;</span>].describe())<br></code></pre></div></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">opulating the interactive namespace from numpy and matplotlib<br>count     100.000000<br>mean      872.320000<br>std       923.138191<br>min        64.000000<br><span class="hljs-meta prompt_">25% </span><span class="language-bash">      359.500000</span><br><span class="hljs-meta prompt_">50% </span><span class="language-bash">      598.000000</span><br><span class="hljs-meta prompt_">75% </span><span class="language-bash">     1058.000000</span><br>max      7125.000000<br>Name: text_len, dtype: float64<br></code></pre></div></td></tr></table></figure><p>ÂØπÊñ∞ÈóªÂè•Â≠êÁöÑÁªüËÆ°ÂèØ‰ª•ÂæóÂá∫ÔºåÊú¨Ê¨°ËµõÈ¢òÁªôÂÆöÁöÑÊñáÊú¨ÊØîËæÉÈïøÔºåÊØè‰∏™Âè•Â≠êÂπ≥ÂùáÁî±907‰∏™Â≠óÁ¨¶ÊûÑÊàêÔºåÊúÄÁü≠ÁöÑÂè•Â≠êÈïøÂ∫¶‰∏∫2ÔºåÊúÄÈïøÁöÑÂè•Â≠êÈïøÂ∫¶‰∏∫57921„ÄÇ</p><h2 id="Êñ∞ÈóªÁ±ªÂà´ÂàÜÂ∏É">Êñ∞ÈóªÁ±ªÂà´ÂàÜÂ∏É</h2><p>Êé•‰∏ãÊù•ÂèØ‰ª•ÂØπÊï∞ÊçÆÈõÜÁöÑÁ±ªÂà´ËøõË°åÂàÜÂ∏ÉÁªüËÆ°ÔºåÂÖ∑‰ΩìÁªüËÆ°ÊØèÁ±ªÊñ∞ÈóªÁöÑÊ†∑Êú¨‰∏™Êï∞„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">train_df[<span class="hljs-string">&#x27;label&#x27;</span>].value_counts().plot(kind=<span class="hljs-string">&#x27;bar&#x27;</span>)<br>plt.title(<span class="hljs-string">&#x27;News class count&#x27;</span>)<br>plt.xlabel(<span class="hljs-string">&quot;category&quot;</span>)<br></code></pre></div></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">Text</span><span class="hljs-params">(<span class="hljs-number">0.5</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;category&#x27;</span>)</span></span><br></code></pre></div></td></tr></table></figure><p><img src="/img/nlp/Êñ∞ÈóªÊñáÊú¨ÂàÜÁ±ª/1.png" /></p><p>Âú®Êï∞ÊçÆÈõÜ‰∏≠Ê†áÁ≠æÁöÑÂØπÂ∫îÁöÑÂÖ≥Á≥ªÂ¶Ç‰∏ãÔºö{'ÁßëÊäÄ': 0, 'ËÇ°Á•®': 1, '‰ΩìËÇ≤': 2,'Â®±‰πê': 3, 'Êó∂Êîø': 4, 'Á§æ‰ºö': 5, 'ÊïôËÇ≤': 6, 'Ë¥¢Áªè': 7, 'ÂÆ∂Â±Ö': 8,'Ê∏∏Êàè': 9, 'Êàø‰∫ß': 10, 'Êó∂Â∞ö': 11, 'ÂΩ©Á•®': 12, 'ÊòüÂ∫ß': 13}</p><p>‰ªéÁªüËÆ°ÁªìÊûúÂèØ‰ª•ÁúãÂá∫ÔºåËµõÈ¢òÁöÑÊï∞ÊçÆÈõÜÁ±ªÂà´ÂàÜÂ∏ÉÂ≠òÂú®ËæÉ‰∏∫‰∏çÂùáÂåÄÁöÑÊÉÖÂÜµ„ÄÇÂú®ËÆ≠ÁªÉÈõÜ‰∏≠ÁßëÊäÄÁ±ªÊñ∞ÈóªÊúÄÂ§öÔºåÂÖ∂Ê¨°ÊòØËÇ°Á•®Á±ªÊñ∞ÈóªÔºåÊúÄÂ∞ëÁöÑÊñ∞ÈóªÊòØÊòüÂ∫ßÊñ∞Èóª„ÄÇ</p><h2 id="Â≠óÁ¨¶ÂàÜÂ∏ÉÁªüËÆ°">Â≠óÁ¨¶ÂàÜÂ∏ÉÁªüËÆ°</h2><p>Êé•‰∏ãÊù•ÂèØ‰ª•ÁªüËÆ°ÊØè‰∏™Â≠óÁ¨¶Âá∫Áé∞ÁöÑÊ¨°Êï∞ÔºåÈ¶ñÂÖàÂèØ‰ª•Â∞ÜËÆ≠ÁªÉÈõÜ‰∏≠ÊâÄÊúâÁöÑÂè•Â≠êËøõË°åÊãºÊé•ËøõËÄåÂàíÂàÜ‰∏∫Â≠óÁ¨¶ÔºåÂπ∂ÁªüËÆ°ÊØè‰∏™Â≠óÁ¨¶ÁöÑ‰∏™Êï∞„ÄÇ</p><p>‰ªéÁªüËÆ°ÁªìÊûú‰∏≠ÂèØ‰ª•ÁúãÂá∫ÔºåÂú®ËÆ≠ÁªÉÈõÜ‰∏≠ÊÄªÂÖ±ÂåÖÊã¨6869‰∏™Â≠óÔºåÂÖ∂‰∏≠ÁºñÂè∑3750ÁöÑÂ≠óÂá∫Áé∞ÁöÑÊ¨°Êï∞ÊúÄÂ§öÔºåÁºñÂè∑5034ÁöÑÂ≠óÂá∫Áé∞ÁöÑÊ¨°Êï∞ÊúÄÂ∞ë„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter<br>all_lines = <span class="hljs-string">&#x27; &#x27;</span>.join(<span class="hljs-built_in">list</span>(train_df[<span class="hljs-string">&#x27;text&#x27;</span>]))<br>word_count = Counter(all_lines.split(<span class="hljs-string">&quot; &quot;</span>))<br>word_count = <span class="hljs-built_in">sorted</span>(word_count.items(), key=<span class="hljs-keyword">lambda</span> d:d[<span class="hljs-number">1</span>], reverse = <span class="hljs-literal">True</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(word_count))<br><br><span class="hljs-built_in">print</span>(word_count[<span class="hljs-number">0</span>])<br><br><span class="hljs-built_in">print</span>(word_count[-<span class="hljs-number">1</span>])<br></code></pre></div></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">2405<br>(&#x27;3750&#x27;, 3702)<br>(&#x27;5034&#x27;, 1)<br></code></pre></div></td></tr></table></figure><h2 id="Êï∞ÊçÆÂàÜÊûêÁöÑÁªìËÆ∫">Êï∞ÊçÆÂàÜÊûêÁöÑÁªìËÆ∫</h2><p>ÈÄöËøá‰∏äËø∞ÂàÜÊûêÊàë‰ª¨ÂèØ‰ª•ÂæóÂá∫‰ª•‰∏ãÁªìËÆ∫Ôºö</p><ol type="1"><li>ËµõÈ¢ò‰∏≠ÊØè‰∏™Êñ∞ÈóªÂåÖÂê´ÁöÑÂ≠óÁ¨¶‰∏™Êï∞Âπ≥Âùá‰∏∫1000‰∏™ÔºåËøòÊúâ‰∏Ä‰∫õÊñ∞ÈóªÂ≠óÁ¨¶ËæÉÈïøÔºõ</li><li>ËµõÈ¢ò‰∏≠Êñ∞ÈóªÁ±ªÂà´ÂàÜÂ∏É‰∏çÂùáÂåÄÔºåÁßëÊäÄÁ±ªÊñ∞ÈóªÊ†∑Êú¨ÈáèÊé•Ëøë4wÔºåÊòüÂ∫ßÁ±ªÊñ∞ÈóªÊ†∑Êú¨Èáè‰∏çÂà∞1kÔºõ</li><li>ËµõÈ¢òÊÄªÂÖ±ÂåÖÊã¨7000-8000‰∏™Â≠óÁ¨¶Ôºõ</li></ol><p>ÈÄöËøáÊï∞ÊçÆÂàÜÊûêÔºåÊàë‰ª¨ËøòÂèØ‰ª•ÂæóÂá∫‰ª•‰∏ãÁªìËÆ∫Ôºö</p><ol type="1"><li>ÊØè‰∏™Êñ∞ÈóªÂπ≥ÂùáÂ≠óÁ¨¶‰∏™Êï∞ËæÉÂ§öÔºåÂèØËÉΩÈúÄË¶ÅÊà™Êñ≠Ôºõ</li><li>Áî±‰∫éÁ±ªÂà´‰∏çÂùáË°°Ôºå‰ºö‰∏•ÈáçÂΩ±ÂìçÊ®°ÂûãÁöÑÁ≤æÂ∫¶Ôºõ</li></ol><h1 id="Âü∫‰∫éÊú∫Âô®Â≠¶‰π†ÁöÑÊñáÊú¨ÂàÜÁ±ª">Âü∫‰∫éÊú∫Âô®Â≠¶‰π†ÁöÑÊñáÊú¨ÂàÜÁ±ª</h1><h2 id="Â≠¶‰π†ÁõÆÊ†á"><strong>Â≠¶‰π†ÁõÆÊ†á</strong></h2><ul><li>Â≠¶‰ºöTF-IDFÁöÑÂéüÁêÜÂíå‰ΩøÁî®</li><li>‰ΩøÁî®sklearnÁöÑÊú∫Âô®Â≠¶‰π†Ê®°ÂûãÂÆåÊàêÊñáÊú¨ÂàÜÁ±ª</li></ul><h2 id="ÊñáÊú¨Ë°®Á§∫ÊñπÊ≥ï">ÊñáÊú¨Ë°®Á§∫ÊñπÊ≥ï</h2><h3 id="one-hot">One-hot</h3><p>ËøôÈáåÁöÑOne-hot‰∏éÊï∞ÊçÆÊåñÊéò‰ªªÂä°‰∏≠ÁöÑÊìç‰ΩúÊòØ‰∏ÄËá¥ÁöÑÔºåÂç≥Â∞ÜÊØè‰∏Ä‰∏™ÂçïËØç‰ΩøÁî®‰∏Ä‰∏™Á¶ªÊï£ÁöÑÂêëÈáèË°®Á§∫„ÄÇÂÖ∑‰ΩìÂ∞ÜÊØè‰∏™Â≠ó/ËØçÁºñÁ†Å‰∏Ä‰∏™Á¥¢ÂºïÔºåÁÑ∂ÂêéÊ†πÊçÆÁ¥¢ÂºïËøõË°åËµãÂÄº„ÄÇ</p><p>One-hotË°®Á§∫ÊñπÊ≥ïÁöÑ‰æãÂ≠êÂ¶Ç‰∏ãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Âè•Â≠ê<span class="hljs-number">1</span>ÔºöÊàë Áà± Âåó ‰∫¨ Â§© ÂÆâ Èó®<br>Âè•Â≠ê<span class="hljs-number">2</span>ÔºöÊàë Âñú Ê¨¢ ‰∏ä Êµ∑<br></code></pre></div></td></tr></table></figure><p>È¶ñÂÖàÂØπÊâÄÊúâÂè•Â≠êÁöÑÂ≠óËøõË°åÁ¥¢ÂºïÔºåÂç≥Â∞ÜÊØè‰∏™Â≠óÁ°ÆÂÆö‰∏Ä‰∏™ÁºñÂè∑Ôºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&#123;<br>    <span class="hljs-string">&#x27;Êàë&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;Áà±&#x27;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;Âåó&#x27;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&#x27;‰∫¨&#x27;</span>: <span class="hljs-number">4</span>, <span class="hljs-string">&#x27;Â§©&#x27;</span>: <span class="hljs-number">5</span>,<br>  <span class="hljs-string">&#x27;ÂÆâ&#x27;</span>: <span class="hljs-number">6</span>, <span class="hljs-string">&#x27;Èó®&#x27;</span>: <span class="hljs-number">7</span>, <span class="hljs-string">&#x27;Âñú&#x27;</span>: <span class="hljs-number">8</span>, <span class="hljs-string">&#x27;Ê¨¢&#x27;</span>: <span class="hljs-number">9</span>, <span class="hljs-string">&#x27;‰∏ä&#x27;</span>: <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;Êµ∑&#x27;</span>: <span class="hljs-number">11</span><br>&#125;<br></code></pre></div></td></tr></table></figure><p>Âú®ËøôÈáåÂÖ±ÂåÖÊã¨11‰∏™Â≠óÔºåÂõ†Ê≠§ÊØè‰∏™Â≠óÂèØ‰ª•ËΩ¨Êç¢‰∏∫‰∏Ä‰∏™11Áª¥Â∫¶Á®ÄÁñèÂêëÈáèÔºö</p><figure class="highlight prolog"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs prolog">ÊàëÔºö[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]<br>Áà±Ôºö[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]<br>...<br>Êµ∑Ôºö[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]<br></code></pre></div></td></tr></table></figure><h3 id="bag-of-words">Bag of Words</h3><p>Bag of WordsÔºàËØçË¢ãË°®Á§∫ÔºâÔºå‰πüÁß∞‰∏∫CountVectorsÔºåÊØè‰∏™ÊñáÊ°£ÁöÑÂ≠ó/ËØçÂèØ‰ª•‰ΩøÁî®ÂÖ∂Âá∫Áé∞Ê¨°Êï∞Êù•ËøõË°åË°®Á§∫„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Âè•Â≠ê<span class="hljs-number">1</span>ÔºöÊàë Áà± Âåó ‰∫¨ Â§© ÂÆâ Èó®<br>Âè•Â≠ê<span class="hljs-number">2</span>ÔºöÊàë Âñú Ê¨¢ ‰∏ä Êµ∑<br></code></pre></div></td></tr></table></figure><p>Áõ¥Êé•ÁªüËÆ°ÊØè‰∏™Â≠óÂá∫Áé∞ÁöÑÊ¨°Êï∞ÔºåÂπ∂ËøõË°åËµãÂÄºÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">Âè•Â≠ê<span class="hljs-number">1</span>ÔºöÊàë Áà± Âåó ‰∫¨ Â§© ÂÆâ Èó®<br>ËΩ¨Êç¢‰∏∫ [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]<br><br>Âè•Â≠ê<span class="hljs-number">2</span>ÔºöÊàë Âñú Ê¨¢ ‰∏ä Êµ∑<br>ËΩ¨Êç¢‰∏∫ [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]<br></code></pre></div></td></tr></table></figure><p>Âú®sklearn‰∏≠ÂèØ‰ª•Áõ¥Êé•<code>CountVectorizer</code>Êù•ÂÆûÁé∞Ëøô‰∏ÄÊ≠•È™§Ôºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.feature_extraction.text <span class="hljs-keyword">import</span> CountVectorizer<br>corpus = [<br>    <span class="hljs-string">&#x27;This is the first document.&#x27;</span>,<br>    <span class="hljs-string">&#x27;This document is the second document.&#x27;</span>,<br>    <span class="hljs-string">&#x27;And this is the third one.&#x27;</span>,<br>    <span class="hljs-string">&#x27;Is this the first document?&#x27;</span>,<br>]<br>vectorizer = CountVectorizer()<br>vectorizer.fit_transform(corpus).toarray()<br></code></pre></div></td></tr></table></figure><h3 id="n-gram">N-gram</h3><p>N-gram‰∏éCountVectorsÁ±ª‰ººÔºå‰∏çËøáÂä†ÂÖ•‰∫ÜÁõ∏ÈÇªÂçïËØçÁªÑÂêàÊàê‰∏∫Êñ∞ÁöÑÂçïËØçÔºåÂπ∂ËøõË°åËÆ°Êï∞„ÄÇ</p><p>Â¶ÇÊûúNÂèñÂÄº‰∏∫2ÔºåÂàôÂè•Â≠ê1ÂíåÂè•Â≠ê2Â∞±Âèò‰∏∫Ôºö</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs">Âè•Â≠ê1ÔºöÊàëÁà± Áà±Âåó Âåó‰∫¨ ‰∫¨Â§© Â§©ÂÆâ ÂÆâÈó®<br>Âè•Â≠ê2ÔºöÊàëÂñú ÂñúÊ¨¢ Ê¨¢‰∏ä ‰∏äÊµ∑<br></code></pre></div></td></tr></table></figure><h3 id="tf-idf">TF-IDF</h3><p>TF-IDF ÂàÜÊï∞Áî±‰∏§ÈÉ®ÂàÜÁªÑÊàêÔºöÁ¨¨‰∏ÄÈÉ®ÂàÜÊòØ<strong>ËØçËØ≠È¢ëÁéá</strong>ÔºàTermFrequencyÔºâÔºåÁ¨¨‰∫åÈÉ®ÂàÜÊòØ<strong>ÈÄÜÊñáÊ°£È¢ëÁéá</strong>ÔºàInverse DocumentFrequencyÔºâ„ÄÇÂÖ∂‰∏≠ËÆ°ÁÆóËØ≠ÊñôÂ∫ì‰∏≠ÊñáÊ°£ÊÄªÊï∞Èô§‰ª•Âê´ÊúâËØ•ËØçËØ≠ÁöÑÊñáÊ°£Êï∞ÈáèÔºåÁÑ∂ÂêéÂÜçÂèñÂØπÊï∞Â∞±ÊòØÈÄÜÊñáÊ°£È¢ëÁéá„ÄÇ</p><figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">TF</span><span class="hljs-params">(t)</span></span>= ËØ•ËØçËØ≠Âú®ÂΩìÂâçÊñáÊ°£Âá∫Áé∞ÁöÑÊ¨°Êï∞ / ÂΩìÂâçÊñáÊ°£‰∏≠ËØçËØ≠ÁöÑÊÄªÊï∞<br><span class="hljs-function"><span class="hljs-title">IDF</span><span class="hljs-params">(t)</span></span>= log_eÔºàÊñáÊ°£ÊÄªÊï∞ / Âá∫Áé∞ËØ•ËØçËØ≠ÁöÑÊñáÊ°£ÊÄªÊï∞Ôºâ<br></code></pre></div></td></tr></table></figure><h2 id="Âü∫‰∫éÊú∫Âô®Â≠¶‰π†ÁöÑÊñáÊú¨ÂàÜÁ±ª-1">Âü∫‰∫éÊú∫Âô®Â≠¶‰π†ÁöÑÊñáÊú¨ÂàÜÁ±ª</h2><p>Êé•‰∏ãÊù•Êàë‰ª¨Â∞ÜÂØπÊØî‰∏çÂêåÊñáÊú¨Ë°®Á§∫ÁÆóÊ≥ïÁöÑÁ≤æÂ∫¶ÔºåÈÄöËøáÊú¨Âú∞ÊûÑÂª∫È™åËØÅÈõÜËÆ°ÁÆóF1ÂæóÂàÜ„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Count Vectors + RidgeClassifier</span><br><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><span class="hljs-keyword">from</span> sklearn.feature_extraction.text <span class="hljs-keyword">import</span> CountVectorizer<br><span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> RidgeClassifier<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> f1_score<br><br>train_df = pd.read_csv(<span class="hljs-string">&#x27;./data/train_set.csv&#x27;</span>, sep=<span class="hljs-string">&#x27;\t&#x27;</span>, nrows=<span class="hljs-number">15000</span>)<br><br>vectorizer = CountVectorizer(max_features=<span class="hljs-number">3000</span>)<br>train_test = vectorizer.fit_transform(train_df[<span class="hljs-string">&#x27;text&#x27;</span>])<br><br>clf = RidgeClassifier()<br>clf.fit(train_test[:<span class="hljs-number">10000</span>], train_df[<span class="hljs-string">&#x27;label&#x27;</span>].values[:<span class="hljs-number">10000</span>])<br><br>val_pred = clf.predict(train_test[<span class="hljs-number">10000</span>:])<br><span class="hljs-built_in">print</span>(f1_score(train_df[<span class="hljs-string">&#x27;label&#x27;</span>].values[<span class="hljs-number">10000</span>:], val_pred, average=<span class="hljs-string">&#x27;macro&#x27;</span>))<br></code></pre></div></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">0.741494277019762<br></code></pre></div></td></tr></table></figure><h1id="Âü∫‰∫éÊ∑±Â∫¶Â≠¶‰π†ÁöÑÊñáÊú¨ÂàÜÁ±ª-word2vec">Âü∫‰∫éÊ∑±Â∫¶Â≠¶‰π†ÁöÑÊñáÊú¨ÂàÜÁ±ª-Word2Vec</h1><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> torch<br><br>logging.basicConfig(level=logging.INFO, <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)-15s %(levelname)s: %(message)s&#x27;</span>)<br><br><span class="hljs-comment"># set seed</span><br>seed = <span class="hljs-number">666</span><br>random.seed(seed)<br>np.random.seed(seed)<br>torch.cuda.manual_seed(seed)<br>torch.manual_seed(seed)<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># split data to 10 fold</span><br>fold_num = <span class="hljs-number">10</span><br>data_file = <span class="hljs-string">&#x27;./data/train_set.csv&#x27;</span><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">all_data2fold</span>(<span class="hljs-params">fold_num, num=<span class="hljs-number">10000</span></span>):<br>    fold_data = []<br>    f = pd.read_csv(data_file, sep=<span class="hljs-string">&#x27;\t&#x27;</span>, encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>)<br>    <span class="hljs-comment"># texts: [&#x27;2967 6758 339 2021 1854 3731 4109 3792 4149 1519 ...]</span><br>    texts = f[<span class="hljs-string">&#x27;text&#x27;</span>].tolist()[:num]<br>    <span class="hljs-comment"># labels: [2, 11, 3, 2, 3, 9, 3, 10, 12, 3, 0, 7, 4, 0, 0 ...]</span><br>    labels = f[<span class="hljs-string">&#x27;label&#x27;</span>].tolist()[:num]<br><br>    total = <span class="hljs-built_in">len</span>(labels)<br><br>    <span class="hljs-comment"># Êâì‰π±indexÈ°∫Â∫èÔºå‰Ωøall_textsÂíåall_labelsÈöèÊú∫Ôºà‰∏Ä‰∏ÄÂØπÂ∫îÔºâ„ÄÇ</span><br>    index = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(total))<br>    <span class="hljs-comment"># index: [3447, 966, 593, 5029, 4382, 2345, 974, 3786, 2249, ...]</span><br>    np.random.shuffle(index)<br><br>    all_texts = []<br>    all_labels = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> index:<br>        all_texts.append(texts[i])<br>        all_labels.append(labels[i])<br>    <span class="hljs-comment"># all_texts: [&#x27;600 3373 2828 2515 5026 245 3743 26 2396 6122 3720 14 ...]</span><br>    <span class="hljs-comment"># all_labels: [2, 4, 8, 7, 0, 0, 2, 1, 12, 0, ...]</span><br><br>    <span class="hljs-comment"># ÂàõÂª∫key:valueÂ≠óÂÖ∏ÔºåÂÖ∂‰∏≠keyÊòØlabel,valueÊòØlabelÂØπÂ∫îÁöÑindexÂàóË°®„ÄÇ</span><br>    label2id = &#123;&#125;<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(total):<br>        label = <span class="hljs-built_in">str</span>(all_labels[i])<br>        <span class="hljs-keyword">if</span> label <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> label2id:<br>            label2id[label] = [i]<br>        <span class="hljs-keyword">else</span>:<br>            label2id[label].append(i)<br>    <span class="hljs-comment"># label2id: &#123;&#x27;2&#x27;: [0, 6, 14, 21, 27, 28, 32, 39, ...], &#x27;4&#x27;: [...], ...&#125;</span><br><br>    <span class="hljs-comment"># Â∞ÜÂêå‰∏ÄlabelÂàíÂàÜ‰∏∫10Êäò„ÄÇ</span><br>    all_index = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(fold_num)]<br>    <span class="hljs-keyword">for</span> label, data <span class="hljs-keyword">in</span> label2id.items():<br>        <span class="hljs-comment"># print(label, len(data))</span><br>        <span class="hljs-comment"># ËÆædata = 105</span><br>        <span class="hljs-comment"># fold_num = 10</span><br>        <span class="hljs-comment"># batch_size = 10</span><br>        <span class="hljs-comment"># other = 5</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        i=0, cur_batch_size = 11, datch_data = [data[0], data[1], ... , data[10]]</span><br><span class="hljs-string">        i=1, cur_batch_size = 11, datch_data = [data[10], data[11], ... , data[20]]</span><br><span class="hljs-string">        ......</span><br><span class="hljs-string">        i=5, cur_batch_size = 10, datch_data = [data[50], data[51], ... , data[59]]</span><br><span class="hljs-string">        i=6, cur_batch_size = 10, datch_data = [data[60], data[61], ... , data[69]]</span><br><span class="hljs-string">        ......</span><br><span class="hljs-string">        i=9, cur_batch_size = 10, datch_data = [data[90], data[91], ... , data[99]]</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># print(label, len(data))</span><br>        batch_size = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(data) / fold_num)<br>        other = <span class="hljs-built_in">len</span>(data) - batch_size * fold_num<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(fold_num):<br>            cur_batch_size = batch_size + <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> i &lt; other <span class="hljs-keyword">else</span> batch_size<br>            <span class="hljs-comment"># print(cur_batch_size)</span><br>            batch_data = [data[i * batch_size + b] <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(cur_batch_size)]<br>            all_index[i].extend(batch_data)<br><br>    batch_size = <span class="hljs-built_in">int</span>(total / fold_num)<br>    other_texts = []<br>    other_labels = []<br>    other_num = <span class="hljs-number">0</span><br>    start = <span class="hljs-number">0</span><br>    <span class="hljs-comment"># Â∞Ü10ÊäòÂàÜÁ±ªÂêéÁöÑall_indexÊåâÁÖßindexÂàÜÂà´ÂàíÂàÜ</span><br>    <span class="hljs-keyword">for</span> fold <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(fold_num):<br>        num = <span class="hljs-built_in">len</span>(all_index[fold])<br>        texts = [all_texts[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> all_index[fold]]<br>        labels = [all_labels[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> all_index[fold]]<br><br>        <span class="hljs-comment"># ÂçïÊäòÊï∞Èáè&gt;10ÊäòÂπ≥ÂùáÊï∞Êó∂ÔºåÊñáÊú¨Êï∞Êà™Êñ≠Ëá≥Âπ≥ÂùáÊï∞batch_size,Âπ∂ÈôçÊà™Êñ≠ÁöÑÊñáÊú¨ÂàÜËá≥other_texts,Ê†áÁ≠æfold_labelsÂêå‰∏ä</span><br>        <span class="hljs-keyword">if</span> num &gt; batch_size:<br>            fold_texts = texts[:batch_size]<br>            other_texts.extend(texts[batch_size:])<br>            fold_labels = labels[:batch_size]<br>            other_labels.extend(labels[batch_size:])<br>            other_num += num - batch_size<br>        <span class="hljs-comment"># ÂçïÊäòÊï∞Èáè&lt;10ÊäòÂπ≥ÂùáÊï∞Êó∂ÔºåÂéüÊúâÁöÑÊñáÊú¨Âä†other_size‰∏≠batch_size-numÁöÑÊñáÊú¨Êï∞ÔºåÊ†áÁ≠æfold_labelsÂêå‰∏ä</span><br>        <span class="hljs-keyword">elif</span> num &lt; batch_size:<br>            end = start + batch_size - num<br>            fold_texts = texts + other_texts[start: end]<br>            fold_labels = labels + other_labels[start: end]<br>            start = end<br>        <span class="hljs-comment"># Âê¶ÂàôÔºåÊñáÊú¨Êï∞ÂíåÊ†áÁ≠æÊï∞‰∏çÂèò„ÄÇ</span><br>        <span class="hljs-keyword">else</span>:<br>            fold_texts = texts<br>            fold_labels = labels<br><br>        <span class="hljs-keyword">assert</span> batch_size == <span class="hljs-built_in">len</span>(fold_labels)<br><br>        <span class="hljs-comment"># shuffleÔºåÂØπ10ÊäòÊñáÊú¨ÂíåÊ†áÁ≠æÈáçÊñ∞Âà∑Êñ∞„ÄÇ</span><br>        index = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(batch_size))<br>        np.random.shuffle(index)<br><br>        shuffle_fold_texts = []<br>        shuffle_fold_labels = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> index:<br>            shuffle_fold_texts.append(fold_texts[i])<br>            shuffle_fold_labels.append(fold_labels[i])<br><br>        data = &#123;<span class="hljs-string">&#x27;label&#x27;</span>: shuffle_fold_labels, <span class="hljs-string">&#x27;text&#x27;</span>: shuffle_fold_texts&#125;<br>        fold_data.append(data)<br><br>    logging.info(<span class="hljs-string">&quot;Fold lens %s&quot;</span>, <span class="hljs-built_in">str</span>([<span class="hljs-built_in">len</span>(data[<span class="hljs-string">&#x27;label&#x27;</span>]) <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> fold_data]))<br><br>    <span class="hljs-keyword">return</span> fold_data<br><br><br>fold_data = all_data2fold(<span class="hljs-number">10</span>)<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># build train data for word2vec</span><br>fold_id = <span class="hljs-number">9</span><br><br>train_texts = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, fold_id):<br>    data = fold_data[i]<br>    train_texts.extend(data[<span class="hljs-string">&#x27;text&#x27;</span>])<br>    <br>logging.info(<span class="hljs-string">&#x27;Total %d docs.&#x27;</span> % <span class="hljs-built_in">len</span>(train_texts))<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">logging.info(<span class="hljs-string">&#x27;Start training...&#x27;</span>)<br><span class="hljs-keyword">from</span> gensim.models.word2vec <span class="hljs-keyword">import</span> Word2Vec<br><br>num_features = <span class="hljs-number">100</span>     <span class="hljs-comment"># Word vector dimensionality</span><br>num_workers = <span class="hljs-number">8</span>       <span class="hljs-comment"># Number of threads to run in parallel</span><br><br>train_texts = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">list</span>(x.split()), train_texts))<br>model = Word2Vec(train_texts, workers=num_workers, size=num_features)<br>model.init_sims(replace=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># save model</span><br>model.save(<span class="hljs-string">&quot;./save/word2vec.bin&quot;</span>)<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># load model</span><br>model = Word2Vec.load(<span class="hljs-string">&quot;./save/word2vec.bin&quot;</span>)<br><br><span class="hljs-comment"># convert format</span><br>model.wv.save_word2vec_format(<span class="hljs-string">&#x27;./save/word2vec.txt&#x27;</span>, binary=<span class="hljs-literal">False</span>)<br></code></pre></div></td></tr></table></figure><h1id="Âü∫‰∫éÊ∑±Â∫¶Â≠¶‰π†ÁöÑÊñáÊú¨ÂàÜÁ±ª-textrnn">Âü∫‰∫éÊ∑±Â∫¶Â≠¶‰π†ÁöÑÊñáÊú¨ÂàÜÁ±ª-TextRNN</h1><p>TextRNNÂà©Áî®RNNÔºàÂæ™ÁéØÁ•ûÁªèÁΩëÁªúÔºâËøõË°åÊñáÊú¨ÁâπÂæÅÊäΩÂèñÔºåÁî±‰∫éÊñáÊú¨Êú¨Ë∫´ÊòØ‰∏ÄÁßçÂ∫èÂàóÔºåËÄåLSTMÂ§©ÁÑ∂ÈÄÇÂêàÂª∫Ê®°Â∫èÂàóÊï∞ÊçÆ„ÄÇTextRNNÂ∞ÜÂè•Â≠ê‰∏≠ÊØè‰∏™ËØçÁöÑËØçÂêëÈáè‰æùÊ¨°ËæìÂÖ•Âà∞ÂèåÂêëÂèåÂ±ÇLSTMÔºåÂàÜÂà´Â∞Ü‰∏§‰∏™ÊñπÂêëÊúÄÂêé‰∏Ä‰∏™ÊúâÊïà‰ΩçÁΩÆÁöÑÈöêËóèÂ±ÇÊãºÊé•Êàê‰∏Ä‰∏™ÂêëÈáè‰Ωú‰∏∫ÊñáÊú¨ÁöÑË°®Á§∫</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> torch<br><br>logging.basicConfig(level=logging.INFO, <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)-15s %(levelname)s: %(message)s&#x27;</span>)<br><br><span class="hljs-comment"># set seed</span><br>seed = <span class="hljs-number">666</span><br>random.seed(seed)<br>np.random.seed(seed)<br>torch.cuda.manual_seed(seed)<br>torch.manual_seed(seed)<br><br><span class="hljs-comment"># set cuda</span><br>gpu = <span class="hljs-number">0</span><br>use_cuda = gpu &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> torch.cuda.is_available()<br><span class="hljs-keyword">if</span> use_cuda:<br>    torch.cuda.set_device(gpu)<br>    device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span>, gpu)<br><span class="hljs-keyword">else</span>:<br>    device = torch.device(<span class="hljs-string">&quot;cpu&quot;</span>)<br>logging.info(<span class="hljs-string">&quot;Use cuda: %s, gpu id: %d.&quot;</span>, use_cuda, gpu)<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># split data to 10 fold</span><br>fold_num = <span class="hljs-number">10</span><br>data_file = <span class="hljs-string">&#x27;../data/train_set.csv&#x27;</span><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">all_data2fold</span>(<span class="hljs-params">fold_num, num=<span class="hljs-number">1000</span></span>):<br>    fold_data = []<br>    f = pd.read_csv(data_file, sep=<span class="hljs-string">&#x27;\t&#x27;</span>, encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>)<br>    texts = f[<span class="hljs-string">&#x27;text&#x27;</span>].tolist()[:num]<br>    labels = f[<span class="hljs-string">&#x27;label&#x27;</span>].tolist()[:num]<br><br>    total = <span class="hljs-built_in">len</span>(labels)<br><br>    index = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(total))<br>    np.random.shuffle(index)<br><br>    all_texts = []<br>    all_labels = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> index:<br>        all_texts.append(texts[i])<br>        all_labels.append(labels[i])<br><br>    label2id = &#123;&#125;<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(total):<br>        label = <span class="hljs-built_in">str</span>(all_labels[i])<br>        <span class="hljs-keyword">if</span> label <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> label2id:<br>            label2id[label] = [i]<br>        <span class="hljs-keyword">else</span>:<br>            label2id[label].append(i)<br><br>    all_index = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(fold_num)]<br>    <span class="hljs-keyword">for</span> label, data <span class="hljs-keyword">in</span> label2id.items():<br>        <span class="hljs-comment"># print(label, len(data))</span><br>        batch_size = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(data) / fold_num)<br>        other = <span class="hljs-built_in">len</span>(data) - batch_size * fold_num<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(fold_num):<br>            cur_batch_size = batch_size + <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> i &lt; other <span class="hljs-keyword">else</span> batch_size<br>            <span class="hljs-comment"># print(cur_batch_size)</span><br>            batch_data = [data[i * batch_size + b] <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(cur_batch_size)]<br>            all_index[i].extend(batch_data)<br><br>    batch_size = <span class="hljs-built_in">int</span>(total / fold_num)<br>    other_texts = []<br>    other_labels = []<br>    other_num = <span class="hljs-number">0</span><br>    start = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> fold <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(fold_num):<br>        num = <span class="hljs-built_in">len</span>(all_index[fold])<br>        texts = [all_texts[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> all_index[fold]]<br>        labels = [all_labels[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> all_index[fold]]<br><br>        <span class="hljs-keyword">if</span> num &gt; batch_size:<br>            fold_texts = texts[:batch_size]<br>            other_texts.extend(texts[batch_size:])<br>            fold_labels = labels[:batch_size]<br>            other_labels.extend(labels[batch_size:])<br>            other_num += num - batch_size<br>        <span class="hljs-keyword">elif</span> num &lt; batch_size:<br>            end = start + batch_size - num<br>            fold_texts = texts + other_texts[start: end]<br>            fold_labels = labels + other_labels[start: end]<br>            start = end<br>        <span class="hljs-keyword">else</span>:<br>            fold_texts = texts<br>            fold_labels = labels<br><br>        <span class="hljs-keyword">assert</span> batch_size == <span class="hljs-built_in">len</span>(fold_labels)<br><br>        <span class="hljs-comment"># shuffle</span><br>        index = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(batch_size))<br>        np.random.shuffle(index)<br><br>        shuffle_fold_texts = []<br>        shuffle_fold_labels = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> index:<br>            shuffle_fold_texts.append(fold_texts[i])<br>            shuffle_fold_labels.append(fold_labels[i])<br><br>        data = &#123;<span class="hljs-string">&#x27;label&#x27;</span>: shuffle_fold_labels, <span class="hljs-string">&#x27;text&#x27;</span>: shuffle_fold_texts&#125;<br>        fold_data.append(data)<br><br>    logging.info(<span class="hljs-string">&quot;Fold lens %s&quot;</span>, <span class="hljs-built_in">str</span>([<span class="hljs-built_in">len</span>(data[<span class="hljs-string">&#x27;label&#x27;</span>]) <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> fold_data]))<br><br>    <span class="hljs-keyword">return</span> fold_data<br><br><br>fold_data = all_data2fold(<span class="hljs-number">10</span>)<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># build vocab</span><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> BasicTokenizer<br><br>basic_tokenizer = BasicTokenizer()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vocab</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, train_data</span>):<br>        self.min_count = <span class="hljs-number">5</span><br>        self.pad = <span class="hljs-number">0</span><br>        self.unk = <span class="hljs-number">1</span><br>        self._id2word = [<span class="hljs-string">&#x27;[PAD]&#x27;</span>, <span class="hljs-string">&#x27;[UNK]&#x27;</span>]<br>        self._id2extword = [<span class="hljs-string">&#x27;[PAD]&#x27;</span>, <span class="hljs-string">&#x27;[UNK]&#x27;</span>]<br><br>        self._id2label = []<br>        self.target_names = []<br><br>        self.build_vocab(train_data)<br><br>        reverse = <span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(x, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(x))))<br>        <br>        <span class="hljs-comment"># _word2id = &#123;&#x27;[PAD]&#x27;: 0, &#x27;[UNK]&#x27;: 1&#125;</span><br>        self._word2id = reverse(self._id2word)<br>        self._label2id = reverse(self._id2label)<br><br>        logging.info(<span class="hljs-string">&quot;Build vocab: words %d, labels %d.&quot;</span> % (self.word_size, self.label_size))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build_vocab</span>(<span class="hljs-params">self, data</span>):<br>        self.word_counter = Counter()<br><br>        <span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> data[<span class="hljs-string">&#x27;text&#x27;</span>]:<br>            words = text.split()<br>            <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:<br>                self.word_counter[word] += <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">for</span> word, count <span class="hljs-keyword">in</span> self.word_counter.most_common():<br>            <span class="hljs-keyword">if</span> count &gt;= self.min_count:<br>                self._id2word.append(word)<br><br>        label2name = &#123;<span class="hljs-number">0</span>: <span class="hljs-string">&#x27;ÁßëÊäÄ&#x27;</span>, <span class="hljs-number">1</span>: <span class="hljs-string">&#x27;ËÇ°Á•®&#x27;</span>, <span class="hljs-number">2</span>: <span class="hljs-string">&#x27;‰ΩìËÇ≤&#x27;</span>, <span class="hljs-number">3</span>: <span class="hljs-string">&#x27;Â®±‰πê&#x27;</span>, <span class="hljs-number">4</span>: <span class="hljs-string">&#x27;Êó∂Êîø&#x27;</span>, <span class="hljs-number">5</span>: <span class="hljs-string">&#x27;Á§æ‰ºö&#x27;</span>, <span class="hljs-number">6</span>: <span class="hljs-string">&#x27;ÊïôËÇ≤&#x27;</span>, <span class="hljs-number">7</span>: <span class="hljs-string">&#x27;Ë¥¢Áªè&#x27;</span>,<br>                      <span class="hljs-number">8</span>: <span class="hljs-string">&#x27;ÂÆ∂Â±Ö&#x27;</span>, <span class="hljs-number">9</span>: <span class="hljs-string">&#x27;Ê∏∏Êàè&#x27;</span>, <span class="hljs-number">10</span>: <span class="hljs-string">&#x27;Êàø‰∫ß&#x27;</span>, <span class="hljs-number">11</span>: <span class="hljs-string">&#x27;Êó∂Â∞ö&#x27;</span>, <span class="hljs-number">12</span>: <span class="hljs-string">&#x27;ÂΩ©Á•®&#x27;</span>, <span class="hljs-number">13</span>: <span class="hljs-string">&#x27;ÊòüÂ∫ß&#x27;</span>&#125;<br><br>        self.label_counter = Counter(data[<span class="hljs-string">&#x27;label&#x27;</span>])<br><br>        <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(self.label_counter)):<br>            count = self.label_counter[label]<br>            self._id2label.append(label)<br>            self.target_names.append(label2name[label])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_pretrained_embs</span>(<span class="hljs-params">self, embfile</span>):<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(embfile, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            lines = f.readlines()<br>            items = lines[<span class="hljs-number">0</span>].split()<br>            word_count, embedding_dim = <span class="hljs-built_in">int</span>(items[<span class="hljs-number">0</span>]), <span class="hljs-built_in">int</span>(items[<span class="hljs-number">1</span>])<br><br>        index = <span class="hljs-built_in">len</span>(self._id2extword)<br>        embeddings = np.zeros((word_count + index, embedding_dim))<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines[<span class="hljs-number">1</span>:]:<br>            values = line.split()<br>            self._id2extword.append(values[<span class="hljs-number">0</span>])<br>            vector = np.array(values[<span class="hljs-number">1</span>:], dtype=<span class="hljs-string">&#x27;float64&#x27;</span>)<br>            embeddings[self.unk] += vector<br>            embeddings[index] = vector<br>            index += <span class="hljs-number">1</span><br><br>        embeddings[self.unk] = embeddings[self.unk] / word_count<br>        embeddings = embeddings / np.std(embeddings)<br><br>        reverse = <span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(x, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(x))))<br>        self._extword2id = reverse(self._id2extword)<br><br>        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(<span class="hljs-built_in">set</span>(self._id2extword)) == <span class="hljs-built_in">len</span>(self._id2extword)<br><br>        <span class="hljs-keyword">return</span> embeddings<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">word2id</span>(<span class="hljs-params">self, xs</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(xs, <span class="hljs-built_in">list</span>):<br>            <span class="hljs-keyword">return</span> [self._word2id.get(x, self.unk) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xs]<br>        <span class="hljs-keyword">return</span> self._word2id.get(xs, self.unk)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extword2id</span>(<span class="hljs-params">self, xs</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(xs, <span class="hljs-built_in">list</span>):<br>            <span class="hljs-keyword">return</span> [self._extword2id.get(x, self.unk) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xs]<br>        <span class="hljs-keyword">return</span> self._extword2id.get(xs, self.unk)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">label2id</span>(<span class="hljs-params">self, xs</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(xs, <span class="hljs-built_in">list</span>):<br>            <span class="hljs-keyword">return</span> [self._label2id.get(x, self.unk) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xs]<br>        <span class="hljs-keyword">return</span> self._label2id.get(xs, self.unk)<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">word_size</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self._id2word)<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extword_size</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self._id2extword)<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">label_size</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self._id2label)<br><br><br>vocab = Vocab(train_data)<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># build module</span><br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Attention</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, hidden_size</span>):<br>        <span class="hljs-built_in">super</span>(Attention, self).__init__()<br>        self.weight = nn.Parameter(torch.Tensor(hidden_size, hidden_size))<br>        self.weight.data.normal_(mean=<span class="hljs-number">0.0</span>, std=<span class="hljs-number">0.05</span>)<br><br>        self.bias = nn.Parameter(torch.Tensor(hidden_size))<br>        b = np.zeros(hidden_size, dtype=np.float32)<br>        self.bias.data.copy_(torch.from_numpy(b))<br><br>        self.query = nn.Parameter(torch.Tensor(hidden_size))<br>        self.query.data.normal_(mean=<span class="hljs-number">0.0</span>, std=<span class="hljs-number">0.05</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, batch_hidden, batch_masks</span>):<br>        <span class="hljs-comment"># batch_hidden: b x len x hidden_size (2 * hidden_size of lstm)</span><br>        <span class="hljs-comment"># batch_masks:  b x len</span><br><br>        <span class="hljs-comment"># linear</span><br>        key = torch.matmul(batch_hidden, self.weight) + self.bias  <span class="hljs-comment"># b x len x hidden</span><br><br>        <span class="hljs-comment"># compute attention</span><br>        outputs = torch.matmul(key, self.query)  <span class="hljs-comment"># b x len</span><br><br>        masked_outputs = outputs.masked_fill((<span class="hljs-number">1</span> - batch_masks).<span class="hljs-built_in">bool</span>(), <span class="hljs-built_in">float</span>(-<span class="hljs-number">1e32</span>))<br><br>        attn_scores = F.softmax(masked_outputs, dim=<span class="hljs-number">1</span>)  <span class="hljs-comment"># b x len</span><br><br>        <span class="hljs-comment"># ÂØπ‰∫éÂÖ®Èõ∂ÂêëÈáèÔºå-1e32ÁöÑÁªìÊûú‰∏∫ 1/len, -inf‰∏∫nan, È¢ùÂ§ñË°•0</span><br>        masked_attn_scores = attn_scores.masked_fill((<span class="hljs-number">1</span> - batch_masks).<span class="hljs-built_in">bool</span>(), <span class="hljs-number">0.0</span>)<br><br>        <span class="hljs-comment"># sum weighted sources</span><br>        batch_outputs = torch.bmm(masked_attn_scores.unsqueeze(<span class="hljs-number">1</span>), key).squeeze(<span class="hljs-number">1</span>)  <span class="hljs-comment"># b x hidden</span><br><br>        <span class="hljs-keyword">return</span> batch_outputs, attn_scores<br><br><br><span class="hljs-comment"># build word encoder</span><br>word2vec_path = <span class="hljs-string">&#x27;../emb/word2vec.txt&#x27;</span><br>dropout = <span class="hljs-number">0.15</span><br>word_hidden_size = <span class="hljs-number">128</span><br>word_num_layers = <span class="hljs-number">2</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WordLSTMEncoder</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab</span>):<br>        <span class="hljs-built_in">super</span>(WordLSTMEncoder, self).__init__()<br>        self.dropout = nn.Dropout(dropout)<br>        self.word_dims = <span class="hljs-number">100</span><br><br>        self.word_embed = nn.Embedding(vocab.word_size, self.word_dims, padding_idx=<span class="hljs-number">0</span>)<br><br>        extword_embed = vocab.load_pretrained_embs(word2vec_path)<br>        extword_size, word_dims = extword_embed.shape<br>        logging.info(<span class="hljs-string">&quot;Load extword embed: words %d, dims %d.&quot;</span> % (extword_size, word_dims))<br><br>        self.extword_embed = nn.Embedding(extword_size, word_dims, padding_idx=<span class="hljs-number">0</span>)<br>        self.extword_embed.weight.data.copy_(torch.from_numpy(extword_embed))<br>        self.extword_embed.weight.requires_grad = <span class="hljs-literal">False</span><br><br>        input_size = self.word_dims<br><br>        self.word_lstm = nn.LSTM(<br>            input_size=input_size,<br>            hidden_size=word_hidden_size,<br>            num_layers=word_num_layers,<br>            batch_first=<span class="hljs-literal">True</span>,<br>            bidirectional=<span class="hljs-literal">True</span><br>        )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, word_ids, extword_ids, batch_masks</span>):<br>        <span class="hljs-comment"># word_ids: sen_num x sent_len</span><br>        <span class="hljs-comment"># extword_ids: sen_num x sent_len</span><br>        <span class="hljs-comment"># batch_masks   sen_num x sent_len</span><br><br>        word_embed = self.word_embed(word_ids)  <span class="hljs-comment"># sen_num x sent_len x 100</span><br>        extword_embed = self.extword_embed(extword_ids)<br>        batch_embed = word_embed + extword_embed<br><br>        <span class="hljs-keyword">if</span> self.training:<br>            batch_embed = self.dropout(batch_embed)<br><br>        hiddens, _ = self.word_lstm(batch_embed)  <span class="hljs-comment"># sen_num x sent_len x  hidden*2</span><br>        hiddens = hiddens * batch_masks.unsqueeze(<span class="hljs-number">2</span>)<br><br>        <span class="hljs-keyword">if</span> self.training:<br>            hiddens = self.dropout(hiddens)<br><br>        <span class="hljs-keyword">return</span> hiddens<br><br><br><span class="hljs-comment"># build sent encoder</span><br>sent_hidden_size = <span class="hljs-number">256</span><br>sent_num_layers = <span class="hljs-number">2</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SentEncoder</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, sent_rep_size</span>):<br>        <span class="hljs-built_in">super</span>(SentEncoder, self).__init__()<br>        self.dropout = nn.Dropout(dropout)<br><br>        self.sent_lstm = nn.LSTM(<br>            input_size=sent_rep_size,<br>            hidden_size=sent_hidden_size,<br>            num_layers=sent_num_layers,<br>            batch_first=<span class="hljs-literal">True</span>,<br>            bidirectional=<span class="hljs-literal">True</span><br>        )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, sent_reps, sent_masks</span>):<br>        <span class="hljs-comment"># sent_reps:  b x doc_len x sent_rep_size</span><br>        <span class="hljs-comment"># sent_masks: b x doc_len</span><br><br>        sent_hiddens, _ = self.sent_lstm(sent_reps)  <span class="hljs-comment"># b x doc_len x hidden*2</span><br>        sent_hiddens = sent_hiddens * sent_masks.unsqueeze(<span class="hljs-number">2</span>)<br><br>        <span class="hljs-keyword">if</span> self.training:<br>            sent_hiddens = self.dropout(sent_hiddens)<br><br>        <span class="hljs-keyword">return</span> sent_hiddens<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># build model</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab</span>):<br>        <span class="hljs-built_in">super</span>(Model, self).__init__()<br>        self.sent_rep_size = word_hidden_size * <span class="hljs-number">2</span><br>        self.doc_rep_size = sent_hidden_size * <span class="hljs-number">2</span><br>        self.all_parameters = &#123;&#125;<br>        parameters = []<br>        self.word_encoder = WordLSTMEncoder(vocab)<br>        self.word_attention = Attention(self.sent_rep_size)<br>        parameters.extend(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> p: p.requires_grad, self.word_encoder.parameters())))<br>        parameters.extend(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> p: p.requires_grad, self.word_attention.parameters())))<br><br>        self.sent_encoder = SentEncoder(self.sent_rep_size)<br>        self.sent_attention = Attention(self.doc_rep_size)<br>        parameters.extend(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> p: p.requires_grad, self.sent_encoder.parameters())))<br>        parameters.extend(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> p: p.requires_grad, self.sent_attention.parameters())))<br><br>        self.out = nn.Linear(self.doc_rep_size, vocab.label_size, bias=<span class="hljs-literal">True</span>)<br>        parameters.extend(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> p: p.requires_grad, self.out.parameters())))<br><br>        <span class="hljs-keyword">if</span> use_cuda:<br>            self.to(device)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parameters) &gt; <span class="hljs-number">0</span>:<br>            self.all_parameters[<span class="hljs-string">&quot;basic_parameters&quot;</span>] = parameters<br><br>        logging.info(<span class="hljs-string">&#x27;Build model with lstm word encoder, lstm sent encoder.&#x27;</span>)<br><br>        para_num = <span class="hljs-built_in">sum</span>([np.prod(<span class="hljs-built_in">list</span>(p.size())) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> self.parameters()])<br>        logging.info(<span class="hljs-string">&#x27;Model param num: %.2f M.&#x27;</span> % (para_num / <span class="hljs-number">1e6</span>))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, batch_inputs</span>):<br>        <span class="hljs-comment"># batch_inputs(batch_inputs1, batch_inputs2): b x doc_len x sent_len</span><br>        <span class="hljs-comment"># batch_masks : b x doc_len x sent_len</span><br>        batch_inputs1, batch_inputs2, batch_masks = batch_inputs<br>        batch_size, max_doc_len, max_sent_len = batch_inputs1.shape[<span class="hljs-number">0</span>], batch_inputs1.shape[<span class="hljs-number">1</span>], batch_inputs1.shape[<span class="hljs-number">2</span>]<br>        batch_inputs1 = batch_inputs1.view(batch_size * max_doc_len, max_sent_len)  <span class="hljs-comment"># sen_num x sent_len</span><br>        batch_inputs2 = batch_inputs2.view(batch_size * max_doc_len, max_sent_len)  <span class="hljs-comment"># sen_num x sent_len</span><br>        batch_masks = batch_masks.view(batch_size * max_doc_len, max_sent_len)  <span class="hljs-comment"># sen_num x sent_len</span><br><br>        batch_hiddens = self.word_encoder(batch_inputs1, batch_inputs2,<br>                                          batch_masks)  <span class="hljs-comment"># sen_num x sent_len x sent_rep_size</span><br>        sent_reps, atten_scores = self.word_attention(batch_hiddens, batch_masks)  <span class="hljs-comment"># sen_num x sent_rep_size</span><br><br>        sent_reps = sent_reps.view(batch_size, max_doc_len, self.sent_rep_size)  <span class="hljs-comment"># b x doc_len x sent_rep_size</span><br>        batch_masks = batch_masks.view(batch_size, max_doc_len, max_sent_len)  <span class="hljs-comment"># b x doc_len x max_sent_len</span><br>        sent_masks = batch_masks.<span class="hljs-built_in">bool</span>().<span class="hljs-built_in">any</span>(<span class="hljs-number">2</span>).<span class="hljs-built_in">float</span>()  <span class="hljs-comment"># b x doc_len</span><br><br>        sent_hiddens = self.sent_encoder(sent_reps, sent_masks)  <span class="hljs-comment"># b x doc_len x doc_rep_size</span><br>        doc_reps, atten_scores = self.sent_attention(sent_hiddens, sent_masks)  <span class="hljs-comment"># b x doc_rep_size</span><br><br>        batch_outputs = self.out(doc_reps)  <span class="hljs-comment"># b x num_labels</span><br><br>        <span class="hljs-keyword">return</span> batch_outputs<br><br><br>model = Model(vocab)<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># build optimizer</span><br>learning_rate = <span class="hljs-number">2e-4</span><br>decay = <span class="hljs-number">.75</span><br>decay_step = <span class="hljs-number">1000</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Optimizer</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_parameters</span>):<br>        self.all_params = []<br>        self.optims = []<br>        self.schedulers = []<br><br>        <span class="hljs-keyword">for</span> name, parameters <span class="hljs-keyword">in</span> model_parameters.items():<br>            <span class="hljs-keyword">if</span> name.startswith(<span class="hljs-string">&quot;basic&quot;</span>):<br>                optim = torch.optim.Adam(parameters, lr=learning_rate)<br>                self.optims.append(optim)<br><br>                l = <span class="hljs-keyword">lambda</span> step: decay ** (step // decay_step)<br>                scheduler = torch.optim.lr_scheduler.LambdaLR(optim, lr_lambda=l)<br>                self.schedulers.append(scheduler)<br>                self.all_params.extend(parameters)<br><br>            <span class="hljs-keyword">else</span>:<br>                Exception(<span class="hljs-string">&quot;no nameed parameters.&quot;</span>)<br><br>        self.num = <span class="hljs-built_in">len</span>(self.optims)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">for</span> optim, scheduler <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(self.optims, self.schedulers):<br>            optim.step()<br>            scheduler.step()<br>            optim.zero_grad()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">zero_grad</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">for</span> optim <span class="hljs-keyword">in</span> self.optims:<br>            optim.zero_grad()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_lr</span>(<span class="hljs-params">self</span>):<br>        lrs = <span class="hljs-built_in">tuple</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x.get_lr()[-<span class="hljs-number">1</span>], self.schedulers))<br>        lr = <span class="hljs-string">&#x27; %.5f&#x27;</span> * self.num<br>        res = lr % lrs<br>        <span class="hljs-keyword">return</span> res<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># build dataset</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sentence_split</span>(<span class="hljs-params">text, vocab, max_sent_len=<span class="hljs-number">256</span>, max_segment=<span class="hljs-number">16</span></span>):<br>    words = text.strip().split()<br>    document_len = <span class="hljs-built_in">len</span>(words)<br><br>    index = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, document_len, max_sent_len))<br>    index.append(document_len)<br><br>    segments = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(index) - <span class="hljs-number">1</span>):<br>        segment = words[index[i]: index[i + <span class="hljs-number">1</span>]]<br>        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(segment) &gt; <span class="hljs-number">0</span><br>        segment = [word <span class="hljs-keyword">if</span> word <span class="hljs-keyword">in</span> vocab._id2word <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&lt;UNK&gt;&#x27;</span> <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> segment]<br>        segments.append([<span class="hljs-built_in">len</span>(segment), segment])<br><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(segments) &gt; <span class="hljs-number">0</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(segments) &gt; max_segment:<br>        segment_ = <span class="hljs-built_in">int</span>(max_segment / <span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">return</span> segments[:segment_] + segments[-segment_:]<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> segments<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_examples</span>(<span class="hljs-params">data, vocab, max_sent_len=<span class="hljs-number">256</span>, max_segment=<span class="hljs-number">8</span></span>):<br>    label2id = vocab.label2id<br>    examples = []<br><br>    <span class="hljs-keyword">for</span> text, label <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(data[<span class="hljs-string">&#x27;text&#x27;</span>], data[<span class="hljs-string">&#x27;label&#x27;</span>]):<br>        <span class="hljs-comment"># label</span><br>        <span class="hljs-built_in">id</span> = label2id(label)<br><br>        <span class="hljs-comment"># words</span><br>        sents_words = sentence_split(text, vocab, max_sent_len, max_segment)<br>        doc = []<br>        <span class="hljs-keyword">for</span> sent_len, sent_words <span class="hljs-keyword">in</span> sents_words:<br>            word_ids = vocab.word2id(sent_words)<br>            extword_ids = vocab.extword2id(sent_words)<br>            doc.append([sent_len, word_ids, extword_ids])<br>        examples.append([<span class="hljs-built_in">id</span>, <span class="hljs-built_in">len</span>(doc), doc])<br><br>    logging.info(<span class="hljs-string">&#x27;Total %d docs.&#x27;</span> % <span class="hljs-built_in">len</span>(examples))<br>    <span class="hljs-keyword">return</span> examples<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># build loader</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">batch_slice</span>(<span class="hljs-params">data, batch_size</span>):<br>    batch_num = <span class="hljs-built_in">int</span>(np.ceil(<span class="hljs-built_in">len</span>(data) / <span class="hljs-built_in">float</span>(batch_size)))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(batch_num):<br>        cur_batch_size = batch_size <span class="hljs-keyword">if</span> i &lt; batch_num - <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-built_in">len</span>(data) - batch_size * i<br>        docs = [data[i * batch_size + b] <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(cur_batch_size)]<br><br>        <span class="hljs-keyword">yield</span> docs<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">data_iter</span>(<span class="hljs-params">data, batch_size, shuffle=<span class="hljs-literal">True</span>, noise=<span class="hljs-number">1.0</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    randomly permute data, then sort by source length, and partition into batches</span><br><span class="hljs-string">    ensure that the length of  sentences in each batch</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    batched_data = []<br>    <span class="hljs-keyword">if</span> shuffle:<br>        np.random.shuffle(data)<br><br>    lengths = [example[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> data]<br>    noisy_lengths = [- (l + np.random.uniform(- noise, noise)) <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> lengths]<br>    sorted_indices = np.argsort(noisy_lengths).tolist()<br>    sorted_data = [data[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sorted_indices]<br><br>    batched_data.extend(<span class="hljs-built_in">list</span>(batch_slice(sorted_data, batch_size)))<br><br>    <span class="hljs-keyword">if</span> shuffle:<br>        np.random.shuffle(batched_data)<br><br>    <span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> batched_data:<br>        <span class="hljs-keyword">yield</span> batch<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># some function</span><br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> f1_score, precision_score, recall_score<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_score</span>(<span class="hljs-params">y_ture, y_pred</span>):<br>    y_ture = np.array(y_ture)<br>    y_pred = np.array(y_pred)<br>    f1 = f1_score(y_ture, y_pred, average=<span class="hljs-string">&#x27;macro&#x27;</span>) * <span class="hljs-number">100</span><br>    p = precision_score(y_ture, y_pred, average=<span class="hljs-string">&#x27;macro&#x27;</span>) * <span class="hljs-number">100</span><br>    r = recall_score(y_ture, y_pred, average=<span class="hljs-string">&#x27;macro&#x27;</span>) * <span class="hljs-number">100</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>((reformat(p, <span class="hljs-number">2</span>), reformat(r, <span class="hljs-number">2</span>), reformat(f1, <span class="hljs-number">2</span>))), reformat(f1, <span class="hljs-number">2</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reformat</span>(<span class="hljs-params">num, n</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">float</span>(<span class="hljs-built_in">format</span>(num, <span class="hljs-string">&#x27;0.&#x27;</span> + <span class="hljs-built_in">str</span>(n) + <span class="hljs-string">&#x27;f&#x27;</span>))<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># build trainer</span><br><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> classification_report<br><br>clip = <span class="hljs-number">5.0</span><br>epochs = <span class="hljs-number">1</span><br>early_stops = <span class="hljs-number">3</span><br>log_interval = <span class="hljs-number">200</span><br><br>test_batch_size = <span class="hljs-number">16</span><br>train_batch_size = <span class="hljs-number">16</span><br><br>save_model = <span class="hljs-string">&#x27;../save/rnn.bin&#x27;</span><br>save_test = <span class="hljs-string">&#x27;../save/rnn.csv&#x27;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Trainer</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model, vocab</span>):<br>        self.model = model<br>        self.report = <span class="hljs-literal">True</span><br><br>        self.train_data = get_examples(train_data, vocab)<br>        self.batch_num = <span class="hljs-built_in">int</span>(np.ceil(<span class="hljs-built_in">len</span>(self.train_data) / <span class="hljs-built_in">float</span>(train_batch_size)))<br>        self.dev_data = get_examples(dev_data, vocab)<br>        self.test_data = get_examples(test_data, vocab)<br><br>        <span class="hljs-comment"># criterion</span><br>        self.criterion = nn.CrossEntropyLoss()<br><br>        <span class="hljs-comment"># label name</span><br>        self.target_names = vocab.target_names<br><br>        <span class="hljs-comment"># optimizer</span><br>        self.optimizer = Optimizer(model.all_parameters)<br><br>        <span class="hljs-comment"># count</span><br>        self.step = <span class="hljs-number">0</span><br>        self.early_stop = -<span class="hljs-number">1</span><br>        self.best_train_f1, self.best_dev_f1 = <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>        self.last_epoch = epochs<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train</span>(<span class="hljs-params">self</span>):<br>        logging.info(<span class="hljs-string">&#x27;Start training...&#x27;</span>)<br>        <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, epochs + <span class="hljs-number">1</span>):<br>            train_f1 = self._train(epoch)<br><br>            dev_f1 = self._<span class="hljs-built_in">eval</span>(epoch)<br><br>            <span class="hljs-keyword">if</span> self.best_dev_f1 &lt;= dev_f1:<br>                logging.info(<br>                    <span class="hljs-string">&quot;Exceed history dev = %.2f, current dev = %.2f&quot;</span> % (self.best_dev_f1, dev_f1))<br>                torch.save(self.model.state_dict(), save_model)<br><br>                self.best_train_f1 = train_f1<br>                self.best_dev_f1 = dev_f1<br>                self.early_stop = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">else</span>:<br>                self.early_stop += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> self.early_stop == early_stops:<br>                    logging.info(<br>                        <span class="hljs-string">&quot;Eearly stop in epoch %d, best train: %.2f, dev: %.2f&quot;</span> % (<br>                            epoch - early_stops, self.best_train_f1, self.best_dev_f1))<br>                    self.last_epoch = epoch<br>                    <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">self</span>):<br>        self.model.load_state_dict(torch.load(save_model))<br>        self._<span class="hljs-built_in">eval</span>(self.last_epoch + <span class="hljs-number">1</span>, test=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_train</span>(<span class="hljs-params">self, epoch</span>):<br>        self.optimizer.zero_grad()<br>        self.model.train()<br><br>        start_time = time.time()<br>        epoch_start_time = time.time()<br>        overall_losses = <span class="hljs-number">0</span><br>        losses = <span class="hljs-number">0</span><br>        batch_idx = <span class="hljs-number">1</span><br>        y_pred = []<br>        y_true = []<br>        <span class="hljs-keyword">for</span> batch_data <span class="hljs-keyword">in</span> data_iter(self.train_data, train_batch_size, shuffle=<span class="hljs-literal">True</span>):<br>            torch.cuda.empty_cache()<br>            batch_inputs, batch_labels = self.batch2tensor(batch_data)<br>            batch_outputs = self.model(batch_inputs)<br>            loss = self.criterion(batch_outputs, batch_labels)<br>            loss.backward()<br><br>            loss_value = loss.detach().cpu().item()<br>            losses += loss_value<br>            overall_losses += loss_value<br><br>            y_pred.extend(torch.<span class="hljs-built_in">max</span>(batch_outputs, dim=<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>].cpu().numpy().tolist())<br>            y_true.extend(batch_labels.cpu().numpy().tolist())<br><br>            nn.utils.clip_grad_norm_(self.optimizer.all_params, max_norm=clip)<br>            <span class="hljs-keyword">for</span> optimizer, scheduler <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(self.optimizer.optims, self.optimizer.schedulers):<br>                optimizer.step()<br>                scheduler.step()<br>            self.optimizer.zero_grad()<br><br>            self.step += <span class="hljs-number">1</span><br><br>            <span class="hljs-keyword">if</span> batch_idx % log_interval == <span class="hljs-number">0</span>:<br>                elapsed = time.time() - start_time<br><br>                lrs = self.optimizer.get_lr()<br>                logging.info(<br>                    <span class="hljs-string">&#x27;| epoch &#123;:3d&#125; | step &#123;:3d&#125; | batch &#123;:3d&#125;/&#123;:3d&#125; | lr&#123;&#125; | loss &#123;:.4f&#125; | s/batch &#123;:.2f&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<br>                        epoch, self.step, batch_idx, self.batch_num, lrs,<br>                        losses / log_interval,<br>                        elapsed / log_interval))<br><br>                losses = <span class="hljs-number">0</span><br>                start_time = time.time()<br><br>            batch_idx += <span class="hljs-number">1</span><br><br>        overall_losses /= self.batch_num<br>        during_time = time.time() - epoch_start_time<br><br>        <span class="hljs-comment"># reformat</span><br>        overall_losses = reformat(overall_losses, <span class="hljs-number">4</span>)<br>        score, f1 = get_score(y_true, y_pred)<br><br>        logging.info(<br>            <span class="hljs-string">&#x27;| epoch &#123;:3d&#125; | score &#123;&#125; | f1 &#123;&#125; | loss &#123;:.4f&#125; | time &#123;:.2f&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(epoch, score, f1,<br>                                                                                  overall_losses,<br>                                                                                  during_time))<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">set</span>(y_true) == <span class="hljs-built_in">set</span>(y_pred) <span class="hljs-keyword">and</span> self.report:<br>            report = classification_report(y_true, y_pred, digits=<span class="hljs-number">4</span>, target_names=self.target_names)<br>            logging.info(<span class="hljs-string">&#x27;\n&#x27;</span> + report)<br><br>        <span class="hljs-keyword">return</span> f1<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_eval</span>(<span class="hljs-params">self, epoch, test=<span class="hljs-literal">False</span></span>):<br>        self.model.<span class="hljs-built_in">eval</span>()<br>        start_time = time.time()<br><br>        y_pred = []<br>        y_true = []<br>        <span class="hljs-keyword">with</span> torch.no_grad():<br>            <span class="hljs-keyword">for</span> batch_data <span class="hljs-keyword">in</span> data_iter(self.dev_data, test_batch_size, shuffle=<span class="hljs-literal">False</span>):<br>                torch.cuda.empty_cache()<br>                batch_inputs, batch_labels = self.batch2tensor(batch_data)<br>                batch_outputs = self.model(batch_inputs)<br>                y_pred.extend(torch.<span class="hljs-built_in">max</span>(batch_outputs, dim=<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>].cpu().numpy().tolist())<br>                y_true.extend(batch_labels.cpu().numpy().tolist())<br><br>            score, f1 = get_score(y_true, y_pred)<br><br>            during_time = time.time() - start_time<br>            <br>            <span class="hljs-keyword">if</span> test:<br>                df = pd.DataFrame(&#123;<span class="hljs-string">&#x27;label&#x27;</span>: y_pred&#125;)<br>                df.to_csv(save_test, index=<span class="hljs-literal">False</span>, sep=<span class="hljs-string">&#x27;,&#x27;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                logging.info(<br>                    <span class="hljs-string">&#x27;| epoch &#123;:3d&#125; | dev | score &#123;&#125; | f1 &#123;&#125; | time &#123;:.2f&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(epoch, score, f1,<br>                                                                              during_time))<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">set</span>(y_true) == <span class="hljs-built_in">set</span>(y_pred) <span class="hljs-keyword">and</span> self.report:<br>                    report = classification_report(y_true, y_pred, digits=<span class="hljs-number">4</span>, target_names=self.target_names)<br>                    logging.info(<span class="hljs-string">&#x27;\n&#x27;</span> + report)<br><br>        <span class="hljs-keyword">return</span> f1<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">batch2tensor</span>(<span class="hljs-params">self, batch_data</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">            [[label, doc_len, [[sent_len, [sent_id0, ...], [sent_id1, ...]], ...]]</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        batch_size = <span class="hljs-built_in">len</span>(batch_data)<br>        doc_labels = []<br>        doc_lens = []<br>        doc_max_sent_len = []<br>        <span class="hljs-keyword">for</span> doc_data <span class="hljs-keyword">in</span> batch_data:<br>            doc_labels.append(doc_data[<span class="hljs-number">0</span>])<br>            doc_lens.append(doc_data[<span class="hljs-number">1</span>])<br>            sent_lens = [sent_data[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> sent_data <span class="hljs-keyword">in</span> doc_data[<span class="hljs-number">2</span>]]<br>            max_sent_len = <span class="hljs-built_in">max</span>(sent_lens)<br>            doc_max_sent_len.append(max_sent_len)<br><br>        max_doc_len = <span class="hljs-built_in">max</span>(doc_lens)<br>        max_sent_len = <span class="hljs-built_in">max</span>(doc_max_sent_len)<br><br>        batch_inputs1 = torch.zeros((batch_size, max_doc_len, max_sent_len), dtype=torch.int64)<br>        batch_inputs2 = torch.zeros((batch_size, max_doc_len, max_sent_len), dtype=torch.int64)<br>        batch_masks = torch.zeros((batch_size, max_doc_len, max_sent_len), dtype=torch.float32)<br>        batch_labels = torch.LongTensor(doc_labels)<br><br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(batch_size):<br>            <span class="hljs-keyword">for</span> sent_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(doc_lens[b]):<br>                sent_data = batch_data[b][<span class="hljs-number">2</span>][sent_idx]<br>                <span class="hljs-keyword">for</span> word_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(sent_data[<span class="hljs-number">0</span>]):<br>                    batch_inputs1[b, sent_idx, word_idx] = sent_data[<span class="hljs-number">1</span>][word_idx]<br>                    batch_inputs2[b, sent_idx, word_idx] = sent_data[<span class="hljs-number">2</span>][word_idx]<br>                    batch_masks[b, sent_idx, word_idx] = <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">if</span> use_cuda:<br>            batch_inputs1 = batch_inputs1.to(device)<br>            batch_inputs2 = batch_inputs2.to(device)<br>            batch_masks = batch_masks.to(device)<br>            batch_labels = batch_labels.to(device)<br><br>        <span class="hljs-keyword">return</span> (batch_inputs1, batch_inputs2, batch_masks), batch_labels<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># train</span><br>trainer = Trainer(model, vocab)<br>trainer.train()<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># test</span><br>trainer.test()<br></code></pre></div></td></tr></table></figure><h1 id="Âü∫‰∫éÊ∑±Â∫¶Â≠¶‰π†ÁöÑÊñáÊú¨ÂàÜÁ±ª-bert">Âü∫‰∫éÊ∑±Â∫¶Â≠¶‰π†ÁöÑÊñáÊú¨ÂàÜÁ±ª-BERT</h1><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> torch<br><br>logging.basicConfig(level=logging.INFO, <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)-15s %(levelname)s: %(message)s&#x27;</span>)<br><br><span class="hljs-comment"># set seed</span><br>seed = <span class="hljs-number">666</span><br>random.seed(seed)<br>np.random.seed(seed)<br>torch.cuda.manual_seed(seed)<br>torch.manual_seed(seed)<br><br><span class="hljs-comment"># set cuda</span><br>gpu = <span class="hljs-number">0</span><br>use_cuda = gpu &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> torch.cuda.is_available()<br><span class="hljs-keyword">if</span> use_cuda:<br>    torch.cuda.set_device(gpu)<br>    device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span>, gpu)<br><span class="hljs-keyword">else</span>:<br>    device = torch.device(<span class="hljs-string">&quot;cpu&quot;</span>)<br>logging.info(<span class="hljs-string">&quot;Use cuda: %s, gpu id: %d.&quot;</span>, use_cuda, gpu)<br><br><span class="hljs-comment"># split data to 10 fold</span><br>fold_num = <span class="hljs-number">10</span><br>data_file = <span class="hljs-string">&#x27;../data/train_set.csv&#x27;</span><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">all_data2fold</span>(<span class="hljs-params">fold_num, num=<span class="hljs-number">10000</span></span>):<br>    fold_data = []<br>    f = pd.read_csv(data_file, sep=<span class="hljs-string">&#x27;\t&#x27;</span>, encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>)<br>    texts = f[<span class="hljs-string">&#x27;text&#x27;</span>].tolist()[:num]<br>    labels = f[<span class="hljs-string">&#x27;label&#x27;</span>].tolist()[:num]<br><br>    total = <span class="hljs-built_in">len</span>(labels)<br><br>    index = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(total))<br>    np.random.shuffle(index)<br><br>    all_texts = []<br>    all_labels = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> index:<br>        all_texts.append(texts[i])<br>        all_labels.append(labels[i])<br><br>    label2id = &#123;&#125;<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(total):<br>        label = <span class="hljs-built_in">str</span>(all_labels[i])<br>        <span class="hljs-keyword">if</span> label <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> label2id:<br>            label2id[label] = [i]<br>        <span class="hljs-keyword">else</span>:<br>            label2id[label].append(i)<br><br>    all_index = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(fold_num)]<br>    <span class="hljs-keyword">for</span> label, data <span class="hljs-keyword">in</span> label2id.items():<br>        <span class="hljs-comment"># print(label, len(data))</span><br>        batch_size = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(data) / fold_num)<br>        other = <span class="hljs-built_in">len</span>(data) - batch_size * fold_num<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(fold_num):<br>            cur_batch_size = batch_size + <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> i &lt; other <span class="hljs-keyword">else</span> batch_size<br>            <span class="hljs-comment"># print(cur_batch_size)</span><br>            batch_data = [data[i * batch_size + b] <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(cur_batch_size)]<br>            all_index[i].extend(batch_data)<br><br>    batch_size = <span class="hljs-built_in">int</span>(total / fold_num)<br>    other_texts = []<br>    other_labels = []<br>    other_num = <span class="hljs-number">0</span><br>    start = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> fold <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(fold_num):<br>        num = <span class="hljs-built_in">len</span>(all_index[fold])<br>        texts = [all_texts[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> all_index[fold]]<br>        labels = [all_labels[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> all_index[fold]]<br><br>        <span class="hljs-keyword">if</span> num &gt; batch_size:<br>            fold_texts = texts[:batch_size]<br>            other_texts.extend(texts[batch_size:])<br>            fold_labels = labels[:batch_size]<br>            other_labels.extend(labels[batch_size:])<br>            other_num += num - batch_size<br>        <span class="hljs-keyword">elif</span> num &lt; batch_size:<br>            end = start + batch_size - num<br>            fold_texts = texts + other_texts[start: end]<br>            fold_labels = labels + other_labels[start: end]<br>            start = end<br>        <span class="hljs-keyword">else</span>:<br>            fold_texts = texts<br>            fold_labels = labels<br><br>        <span class="hljs-keyword">assert</span> batch_size == <span class="hljs-built_in">len</span>(fold_labels)<br><br>        <span class="hljs-comment"># shuffle</span><br>        index = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(batch_size))<br>        np.random.shuffle(index)<br><br>        shuffle_fold_texts = []<br>        shuffle_fold_labels = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> index:<br>            shuffle_fold_texts.append(fold_texts[i])<br>            shuffle_fold_labels.append(fold_labels[i])<br><br>        data = &#123;<span class="hljs-string">&#x27;label&#x27;</span>: shuffle_fold_labels, <span class="hljs-string">&#x27;text&#x27;</span>: shuffle_fold_texts&#125;<br>        fold_data.append(data)<br><br>    logging.info(<span class="hljs-string">&quot;Fold lens %s&quot;</span>, <span class="hljs-built_in">str</span>([<span class="hljs-built_in">len</span>(data[<span class="hljs-string">&#x27;label&#x27;</span>]) <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> fold_data]))<br><br>    <span class="hljs-keyword">return</span> fold_data<br><br><br>fold_data = all_data2fold(<span class="hljs-number">10</span>)<br><br><span class="hljs-comment"># build train, dev, test data</span><br>fold_id = <span class="hljs-number">9</span><br><br><span class="hljs-comment"># dev</span><br>dev_data = fold_data[fold_id]<br><br><span class="hljs-comment"># train</span><br>train_texts = []<br>train_labels = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, fold_id):<br>    data = fold_data[i]<br>    train_texts.extend(data[<span class="hljs-string">&#x27;text&#x27;</span>])<br>    train_labels.extend(data[<span class="hljs-string">&#x27;label&#x27;</span>])<br><br>train_data = &#123;<span class="hljs-string">&#x27;label&#x27;</span>: train_labels, <span class="hljs-string">&#x27;text&#x27;</span>: train_texts&#125;<br><br><span class="hljs-comment"># test</span><br>test_data_file = <span class="hljs-string">&#x27;../data/test_a.csv&#x27;</span><br>f = pd.read_csv(test_data_file, sep=<span class="hljs-string">&#x27;\t&#x27;</span>, encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>)<br>texts = f[<span class="hljs-string">&#x27;text&#x27;</span>].tolist()<br>test_data = &#123;<span class="hljs-string">&#x27;label&#x27;</span>: [<span class="hljs-number">0</span>] * <span class="hljs-built_in">len</span>(texts), <span class="hljs-string">&#x27;text&#x27;</span>: texts&#125;<br><br><span class="hljs-comment"># build vocab</span><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter<br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> BasicTokenizer<br><br><span class="hljs-comment"># ÂàÜËØçÂô®</span><br>basic_tokenizer = BasicTokenizer()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vocab</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, train_data</span>):<br>        self.min_count = <span class="hljs-number">5</span><br>        self.pad = <span class="hljs-number">0</span><br>        self.unk = <span class="hljs-number">1</span><br>        self._id2word = [<span class="hljs-string">&#x27;[PAD]&#x27;</span>, <span class="hljs-string">&#x27;[UNK]&#x27;</span>]<br>        self._id2extword = [<span class="hljs-string">&#x27;[PAD]&#x27;</span>, <span class="hljs-string">&#x27;[UNK]&#x27;</span>]<br><br>        self._id2label = []<br>        self.target_names = []<br><br>        self.build_vocab(train_data)<br><br>        reverse = <span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(x, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(x))))<br>        self._word2id = reverse(self._id2word)<br>        self._label2id = reverse(self._id2label)<br><br>        logging.info(<span class="hljs-string">&quot;Build vocab: words %d, labels %d.&quot;</span> % (self.word_size, self.label_size))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build_vocab</span>(<span class="hljs-params">self, data</span>):<br>        self.word_counter = Counter()<br><br>        <span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> data[<span class="hljs-string">&#x27;text&#x27;</span>]:<br>            words = text.split()<br>            <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:<br>                self.word_counter[word] += <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">for</span> word, count <span class="hljs-keyword">in</span> self.word_counter.most_common():<br>            <span class="hljs-keyword">if</span> count &gt;= self.min_count:<br>                self._id2word.append(word)<br><br>        label2name = &#123;<span class="hljs-number">0</span>: <span class="hljs-string">&#x27;ÁßëÊäÄ&#x27;</span>, <span class="hljs-number">1</span>: <span class="hljs-string">&#x27;ËÇ°Á•®&#x27;</span>, <span class="hljs-number">2</span>: <span class="hljs-string">&#x27;‰ΩìËÇ≤&#x27;</span>, <span class="hljs-number">3</span>: <span class="hljs-string">&#x27;Â®±‰πê&#x27;</span>, <span class="hljs-number">4</span>: <span class="hljs-string">&#x27;Êó∂Êîø&#x27;</span>, <span class="hljs-number">5</span>: <span class="hljs-string">&#x27;Á§æ‰ºö&#x27;</span>, <span class="hljs-number">6</span>: <span class="hljs-string">&#x27;ÊïôËÇ≤&#x27;</span>, <span class="hljs-number">7</span>: <span class="hljs-string">&#x27;Ë¥¢Áªè&#x27;</span>,<br>                      <span class="hljs-number">8</span>: <span class="hljs-string">&#x27;ÂÆ∂Â±Ö&#x27;</span>, <span class="hljs-number">9</span>: <span class="hljs-string">&#x27;Ê∏∏Êàè&#x27;</span>, <span class="hljs-number">10</span>: <span class="hljs-string">&#x27;Êàø‰∫ß&#x27;</span>, <span class="hljs-number">11</span>: <span class="hljs-string">&#x27;Êó∂Â∞ö&#x27;</span>, <span class="hljs-number">12</span>: <span class="hljs-string">&#x27;ÂΩ©Á•®&#x27;</span>, <span class="hljs-number">13</span>: <span class="hljs-string">&#x27;ÊòüÂ∫ß&#x27;</span>&#125;<br><br>        self.label_counter = Counter(data[<span class="hljs-string">&#x27;label&#x27;</span>])<br><br>        <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(self.label_counter)):<br>            count = self.label_counter[label]<br>            self._id2label.append(label)<br>            self.target_names.append(label2name[label])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_pretrained_embs</span>(<span class="hljs-params">self, embfile</span>):<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(embfile, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            lines = f.readlines()<br>            items = lines[<span class="hljs-number">0</span>].split()<br>            word_count, embedding_dim = <span class="hljs-built_in">int</span>(items[<span class="hljs-number">0</span>]), <span class="hljs-built_in">int</span>(items[<span class="hljs-number">1</span>])<br><br>        index = <span class="hljs-built_in">len</span>(self._id2extword)<br>        embeddings = np.zeros((word_count + index, embedding_dim))<br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines[<span class="hljs-number">1</span>:]:<br>            values = line.split()<br>            self._id2extword.append(values[<span class="hljs-number">0</span>])<br>            vector = np.array(values[<span class="hljs-number">1</span>:], dtype=<span class="hljs-string">&#x27;float64&#x27;</span>)<br>            embeddings[self.unk] += vector<br>            embeddings[index] = vector<br>            index += <span class="hljs-number">1</span><br><br>        embeddings[self.unk] = embeddings[self.unk] / word_count<br>        embeddings = embeddings / np.std(embeddings)<br><br>        reverse = <span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(x, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(x))))<br>        self._extword2id = reverse(self._id2extword)<br><br>        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(<span class="hljs-built_in">set</span>(self._id2extword)) == <span class="hljs-built_in">len</span>(self._id2extword)<br><br>        <span class="hljs-keyword">return</span> embeddings<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">word2id</span>(<span class="hljs-params">self, xs</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(xs, <span class="hljs-built_in">list</span>):<br>            <span class="hljs-keyword">return</span> [self._word2id.get(x, self.unk) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xs]<br>        <span class="hljs-keyword">return</span> self._word2id.get(xs, self.unk)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extword2id</span>(<span class="hljs-params">self, xs</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(xs, <span class="hljs-built_in">list</span>):<br>            <span class="hljs-keyword">return</span> [self._extword2id.get(x, self.unk) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xs]<br>        <span class="hljs-keyword">return</span> self._extword2id.get(xs, self.unk)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">label2id</span>(<span class="hljs-params">self, xs</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(xs, <span class="hljs-built_in">list</span>):<br>            <span class="hljs-keyword">return</span> [self._label2id.get(x, self.unk) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xs]<br>        <span class="hljs-keyword">return</span> self._label2id.get(xs, self.unk)<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">word_size</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self._id2word)<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extword_size</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self._id2extword)<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">label_size</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self._id2label)<br><br><br>vocab = Vocab(train_data)<br><br><span class="hljs-comment"># build module</span><br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Attention</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, hidden_size</span>):<br>        <span class="hljs-built_in">super</span>(Attention, self).__init__()<br>        self.weight = nn.Parameter(torch.Tensor(hidden_size, hidden_size))<br>        self.weight.data.normal_(mean=<span class="hljs-number">0.0</span>, std=<span class="hljs-number">0.05</span>)<br><br>        self.bias = nn.Parameter(torch.Tensor(hidden_size))<br>        b = np.zeros(hidden_size, dtype=np.float32)<br>        self.bias.data.copy_(torch.from_numpy(b))<br><br>        self.query = nn.Parameter(torch.Tensor(hidden_size))<br>        self.query.data.normal_(mean=<span class="hljs-number">0.0</span>, std=<span class="hljs-number">0.05</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, batch_hidden, batch_masks</span>):<br>        <span class="hljs-comment"># batch_hidden: b x len x hidden_size (2 * hidden_size of lstm)</span><br>        <span class="hljs-comment"># batch_masks:  b x len</span><br><br>        <span class="hljs-comment"># linear</span><br>        key = torch.matmul(batch_hidden, self.weight) + self.bias  <span class="hljs-comment"># b x len x hidden</span><br><br>        <span class="hljs-comment"># compute attention</span><br>        outputs = torch.matmul(key, self.query)  <span class="hljs-comment"># b x len</span><br><br>        masked_outputs = outputs.masked_fill((<span class="hljs-number">1</span> - batch_masks).<span class="hljs-built_in">bool</span>(), <span class="hljs-built_in">float</span>(-<span class="hljs-number">1e32</span>))<br><br>        attn_scores = F.softmax(masked_outputs, dim=<span class="hljs-number">1</span>)  <span class="hljs-comment"># b x len</span><br><br>        <span class="hljs-comment"># ÂØπ‰∫éÂÖ®Èõ∂ÂêëÈáèÔºå-1e32ÁöÑÁªìÊûú‰∏∫ 1/len, -inf‰∏∫nan, È¢ùÂ§ñË°•0</span><br>        masked_attn_scores = attn_scores.masked_fill((<span class="hljs-number">1</span> - batch_masks).<span class="hljs-built_in">bool</span>(), <span class="hljs-number">0.0</span>)<br><br>        <span class="hljs-comment"># sum weighted sources</span><br>        batch_outputs = torch.bmm(masked_attn_scores.unsqueeze(<span class="hljs-number">1</span>), key).squeeze(<span class="hljs-number">1</span>)  <span class="hljs-comment"># b x hidden</span><br><br>        <span class="hljs-keyword">return</span> batch_outputs, attn_scores<br><br><br><span class="hljs-comment"># build word encoder</span><br>bert_path = <span class="hljs-string">&#x27;./emb/bert-mini/&#x27;</span><br>dropout = <span class="hljs-number">0.15</span><br><br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> BertModel<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WordBertEncoder</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(WordBertEncoder, self).__init__()<br>        self.dropout = nn.Dropout(dropout)<br><br>        self.tokenizer = WhitespaceTokenizer()<br>        self.bert = BertModel.from_pretrained(bert_path)<br><br>        self.pooled = <span class="hljs-literal">False</span><br>        logging.info(<span class="hljs-string">&#x27;Build Bert encoder with pooled &#123;&#125;.&#x27;</span>.<span class="hljs-built_in">format</span>(self.pooled))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode</span>(<span class="hljs-params">self, tokens</span>):<br>        tokens = self.tokenizer.tokenize(tokens)<br>        <span class="hljs-keyword">return</span> tokens<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_bert_parameters</span>(<span class="hljs-params">self</span>):<br>        no_decay = [<span class="hljs-string">&#x27;bias&#x27;</span>, <span class="hljs-string">&#x27;LayerNorm.weight&#x27;</span>]<br>        optimizer_parameters = [<br>            &#123;<span class="hljs-string">&#x27;params&#x27;</span>: [p <span class="hljs-keyword">for</span> n, p <span class="hljs-keyword">in</span> self.bert.named_parameters() <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">any</span>(nd <span class="hljs-keyword">in</span> n <span class="hljs-keyword">for</span> nd <span class="hljs-keyword">in</span> no_decay)],<br>             <span class="hljs-string">&#x27;weight_decay&#x27;</span>: <span class="hljs-number">0.01</span>&#125;,<br>            &#123;<span class="hljs-string">&#x27;params&#x27;</span>: [p <span class="hljs-keyword">for</span> n, p <span class="hljs-keyword">in</span> self.bert.named_parameters() <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(nd <span class="hljs-keyword">in</span> n <span class="hljs-keyword">for</span> nd <span class="hljs-keyword">in</span> no_decay)],<br>             <span class="hljs-string">&#x27;weight_decay&#x27;</span>: <span class="hljs-number">0.0</span>&#125;<br>        ]<br>        <span class="hljs-keyword">return</span> optimizer_parameters<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, input_ids, token_type_ids</span>):<br>        <span class="hljs-comment"># input_ids: sen_num x bert_len</span><br>        <span class="hljs-comment"># token_type_ids: sen_num  x bert_len</span><br><br>        <span class="hljs-comment"># sen_num x bert_len x 256, sen_num x 256</span><br>        sequence_output, pooled_output = self.bert(input_ids=input_ids, token_type_ids=token_type_ids)<br><br>        <span class="hljs-keyword">if</span> self.pooled:<br>            reps = pooled_output<br>        <span class="hljs-keyword">else</span>:<br>            reps = sequence_output[:, <span class="hljs-number">0</span>, :]  <span class="hljs-comment"># sen_num x 256</span><br><br>        <span class="hljs-keyword">if</span> self.training:<br>            reps = self.dropout(reps)<br><br>        <span class="hljs-keyword">return</span> reps<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WhitespaceTokenizer</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;WhitespaceTokenizer with vocab.&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        vocab_file = bert_path + <span class="hljs-string">&#x27;vocab.txt&#x27;</span><br>        self._token2id = self.load_vocab(vocab_file)<br>        self._id2token = &#123;v: k <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> self._token2id.items()&#125;<br>        self.max_len = <span class="hljs-number">256</span><br>        self.unk = <span class="hljs-number">1</span><br><br>        logging.info(<span class="hljs-string">&quot;Build Bert vocab with size %d.&quot;</span> % (self.vocab_size))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_vocab</span>(<span class="hljs-params">self, vocab_file</span>):<br>        f = <span class="hljs-built_in">open</span>(vocab_file, <span class="hljs-string">&#x27;r&#x27;</span>)<br>        lines = f.readlines()<br>        lines = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x.strip(), lines))<br>        vocab = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(lines, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(lines))))<br>        <span class="hljs-keyword">return</span> vocab<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tokenize</span>(<span class="hljs-params">self, tokens</span>):<br>        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(tokens) &lt;= self.max_len - <span class="hljs-number">2</span><br>        tokens = [<span class="hljs-string">&quot;[CLS]&quot;</span>] + tokens + [<span class="hljs-string">&quot;[SEP]&quot;</span>]<br>        output_tokens = self.token2id(tokens)<br>        <span class="hljs-keyword">return</span> output_tokens<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">token2id</span>(<span class="hljs-params">self, xs</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(xs, <span class="hljs-built_in">list</span>):<br>            <span class="hljs-keyword">return</span> [self._token2id.get(x, self.unk) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> xs]<br>        <span class="hljs-keyword">return</span> self._token2id.get(xs, self.unk)<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">vocab_size</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self._id2token)<br><br><br><span class="hljs-comment"># build sent encoder</span><br>sent_hidden_size = <span class="hljs-number">256</span><br>sent_num_layers = <span class="hljs-number">2</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SentEncoder</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, sent_rep_size</span>):<br>        <span class="hljs-built_in">super</span>(SentEncoder, self).__init__()<br>        self.dropout = nn.Dropout(dropout)<br><br>        self.sent_lstm = nn.LSTM(<br>            input_size=sent_rep_size,<br>            hidden_size=sent_hidden_size,<br>            num_layers=sent_num_layers,<br>            batch_first=<span class="hljs-literal">True</span>,<br>            bidirectional=<span class="hljs-literal">True</span><br>        )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, sent_reps, sent_masks</span>):<br>        <span class="hljs-comment"># sent_reps:  b x doc_len x sent_rep_size</span><br>        <span class="hljs-comment"># sent_masks: b x doc_len</span><br><br>        sent_hiddens, _ = self.sent_lstm(sent_reps)  <span class="hljs-comment"># b x doc_len x hidden*2</span><br>        sent_hiddens = sent_hiddens * sent_masks.unsqueeze(<span class="hljs-number">2</span>)<br><br>        <span class="hljs-keyword">if</span> self.training:<br>            sent_hiddens = self.dropout(sent_hiddens)<br><br>        <span class="hljs-keyword">return</span> sent_hiddens<br><br><br><span class="hljs-comment"># build model</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab</span>):<br>        <span class="hljs-built_in">super</span>(Model, self).__init__()<br>        self.sent_rep_size = <span class="hljs-number">256</span><br>        self.doc_rep_size = sent_hidden_size * <span class="hljs-number">2</span><br>        self.all_parameters = &#123;&#125;<br>        parameters = []<br>        self.word_encoder = WordBertEncoder()<br>        bert_parameters = self.word_encoder.get_bert_parameters()<br><br>        self.sent_encoder = SentEncoder(self.sent_rep_size)<br>        self.sent_attention = Attention(self.doc_rep_size)<br>        parameters.extend(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> p: p.requires_grad, self.sent_encoder.parameters())))<br>        parameters.extend(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> p: p.requires_grad, self.sent_attention.parameters())))<br><br>        self.out = nn.Linear(self.doc_rep_size, vocab.label_size, bias=<span class="hljs-literal">True</span>)<br>        parameters.extend(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> p: p.requires_grad, self.out.parameters())))<br><br>        <span class="hljs-keyword">if</span> use_cuda:<br>            self.to(device)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parameters) &gt; <span class="hljs-number">0</span>:<br>            self.all_parameters[<span class="hljs-string">&quot;basic_parameters&quot;</span>] = parameters<br>        self.all_parameters[<span class="hljs-string">&quot;bert_parameters&quot;</span>] = bert_parameters<br><br>        logging.info(<span class="hljs-string">&#x27;Build model with bert word encoder, lstm sent encoder.&#x27;</span>)<br><br>        para_num = <span class="hljs-built_in">sum</span>([np.prod(<span class="hljs-built_in">list</span>(p.size())) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> self.parameters()])<br>        logging.info(<span class="hljs-string">&#x27;Model param num: %.2f M.&#x27;</span> % (para_num / <span class="hljs-number">1e6</span>))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, batch_inputs</span>):<br>        <span class="hljs-comment"># batch_inputs(batch_inputs1, batch_inputs2): b x doc_len x sent_len</span><br>        <span class="hljs-comment"># batch_masks : b x doc_len x sent_len</span><br>        batch_inputs1, batch_inputs2, batch_masks = batch_inputs<br>        batch_size, max_doc_len, max_sent_len = batch_inputs1.shape[<span class="hljs-number">0</span>], batch_inputs1.shape[<span class="hljs-number">1</span>], batch_inputs1.shape[<span class="hljs-number">2</span>]<br>        batch_inputs1 = batch_inputs1.view(batch_size * max_doc_len, max_sent_len)  <span class="hljs-comment"># sen_num x sent_len</span><br>        batch_inputs2 = batch_inputs2.view(batch_size * max_doc_len, max_sent_len)  <span class="hljs-comment"># sen_num x sent_len</span><br>        batch_masks = batch_masks.view(batch_size * max_doc_len, max_sent_len)  <span class="hljs-comment"># sen_num x sent_len</span><br><br>        sent_reps = self.word_encoder(batch_inputs1, batch_inputs2)  <span class="hljs-comment"># sen_num x sent_rep_size</span><br><br>        sent_reps = sent_reps.view(batch_size, max_doc_len, self.sent_rep_size)  <span class="hljs-comment"># b x doc_len x sent_rep_size</span><br>        batch_masks = batch_masks.view(batch_size, max_doc_len, max_sent_len)  <span class="hljs-comment"># b x doc_len x max_sent_len</span><br>        sent_masks = batch_masks.<span class="hljs-built_in">bool</span>().<span class="hljs-built_in">any</span>(<span class="hljs-number">2</span>).<span class="hljs-built_in">float</span>()  <span class="hljs-comment"># b x doc_len</span><br><br>        sent_hiddens = self.sent_encoder(sent_reps, sent_masks)  <span class="hljs-comment"># b x doc_len x doc_rep_size</span><br>        doc_reps, atten_scores = self.sent_attention(sent_hiddens, sent_masks)  <span class="hljs-comment"># b x doc_rep_size</span><br><br>        batch_outputs = self.out(doc_reps)  <span class="hljs-comment"># b x num_labels</span><br><br>        <span class="hljs-keyword">return</span> batch_outputs<br><br><br>model = Model(vocab)<br><br><span class="hljs-comment"># build optimizer</span><br>learning_rate = <span class="hljs-number">2e-4</span><br>bert_lr = <span class="hljs-number">5e-5</span><br>decay = <span class="hljs-number">.75</span><br>decay_step = <span class="hljs-number">1000</span><br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AdamW, get_linear_schedule_with_warmup<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Optimizer</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_parameters, steps</span>):<br>        self.all_params = []<br>        self.optims = []<br>        self.schedulers = []<br><br>        <span class="hljs-keyword">for</span> name, parameters <span class="hljs-keyword">in</span> model_parameters.items():<br>            <span class="hljs-keyword">if</span> name.startswith(<span class="hljs-string">&quot;basic&quot;</span>):<br>                optim = torch.optim.Adam(parameters, lr=learning_rate)<br>                self.optims.append(optim)<br><br>                l = <span class="hljs-keyword">lambda</span> step: decay ** (step // decay_step)<br>                scheduler = torch.optim.lr_scheduler.LambdaLR(optim, lr_lambda=l)<br>                self.schedulers.append(scheduler)<br>                self.all_params.extend(parameters)<br>            <span class="hljs-keyword">elif</span> name.startswith(<span class="hljs-string">&quot;bert&quot;</span>):<br>                optim_bert = AdamW(parameters, bert_lr, eps=<span class="hljs-number">1e-8</span>)<br>                self.optims.append(optim_bert)<br><br>                scheduler_bert = get_linear_schedule_with_warmup(optim_bert, <span class="hljs-number">0</span>, steps)<br>                self.schedulers.append(scheduler_bert)<br><br>                <span class="hljs-keyword">for</span> group <span class="hljs-keyword">in</span> parameters:<br>                    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> group[<span class="hljs-string">&#x27;params&#x27;</span>]:<br>                        self.all_params.append(p)<br>            <span class="hljs-keyword">else</span>:<br>                Exception(<span class="hljs-string">&quot;no nameed parameters.&quot;</span>)<br><br>        self.num = <span class="hljs-built_in">len</span>(self.optims)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">for</span> optim, scheduler <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(self.optims, self.schedulers):<br>            optim.step()<br>            scheduler.step()<br>            optim.zero_grad()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">zero_grad</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">for</span> optim <span class="hljs-keyword">in</span> self.optims:<br>            optim.zero_grad()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_lr</span>(<span class="hljs-params">self</span>):<br>        lrs = <span class="hljs-built_in">tuple</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x.get_lr()[-<span class="hljs-number">1</span>], self.schedulers))<br>        lr = <span class="hljs-string">&#x27; %.5f&#x27;</span> * self.num<br>        res = lr % lrs<br>        <span class="hljs-keyword">return</span> res<br><br><span class="hljs-comment"># build dataset</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sentence_split</span>(<span class="hljs-params">text, vocab, max_sent_len=<span class="hljs-number">256</span>, max_segment=<span class="hljs-number">16</span></span>):<br>    words = text.strip().split()<br>    document_len = <span class="hljs-built_in">len</span>(words)<br><br>    index = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, document_len, max_sent_len))<br>    index.append(document_len)<br><br>    segments = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(index) - <span class="hljs-number">1</span>):<br>        segment = words[index[i]: index[i + <span class="hljs-number">1</span>]]<br>        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(segment) &gt; <span class="hljs-number">0</span><br>        segment = [word <span class="hljs-keyword">if</span> word <span class="hljs-keyword">in</span> vocab._id2word <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&lt;UNK&gt;&#x27;</span> <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> segment]<br>        segments.append([<span class="hljs-built_in">len</span>(segment), segment])<br><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(segments) &gt; <span class="hljs-number">0</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(segments) &gt; max_segment:<br>        segment_ = <span class="hljs-built_in">int</span>(max_segment / <span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">return</span> segments[:segment_] + segments[-segment_:]<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> segments<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_examples</span>(<span class="hljs-params">data, word_encoder, vocab, max_sent_len=<span class="hljs-number">256</span>, max_segment=<span class="hljs-number">8</span></span>):<br>    label2id = vocab.label2id<br>    examples = []<br><br>    <span class="hljs-keyword">for</span> text, label <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(data[<span class="hljs-string">&#x27;text&#x27;</span>], data[<span class="hljs-string">&#x27;label&#x27;</span>]):<br>        <span class="hljs-comment"># label</span><br>        <span class="hljs-built_in">id</span> = label2id(label)<br><br>        <span class="hljs-comment"># words</span><br>        sents_words = sentence_split(text, vocab, max_sent_len-<span class="hljs-number">2</span>, max_segment)<br>        doc = []<br>        <span class="hljs-keyword">for</span> sent_len, sent_words <span class="hljs-keyword">in</span> sents_words:<br>            token_ids = word_encoder.encode(sent_words)<br>            sent_len = <span class="hljs-built_in">len</span>(token_ids)<br>            token_type_ids = [<span class="hljs-number">0</span>] * sent_len<br>            doc.append([sent_len, token_ids, token_type_ids])<br>        examples.append([<span class="hljs-built_in">id</span>, <span class="hljs-built_in">len</span>(doc), doc])<br><br>    logging.info(<span class="hljs-string">&#x27;Total %d docs.&#x27;</span> % <span class="hljs-built_in">len</span>(examples))<br>    <span class="hljs-keyword">return</span> examples<br><br><br><span class="hljs-comment"># build loader</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">batch_slice</span>(<span class="hljs-params">data, batch_size</span>):<br>    batch_num = <span class="hljs-built_in">int</span>(np.ceil(<span class="hljs-built_in">len</span>(data) / <span class="hljs-built_in">float</span>(batch_size)))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(batch_num):<br>        cur_batch_size = batch_size <span class="hljs-keyword">if</span> i &lt; batch_num - <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-built_in">len</span>(data) - batch_size * i<br>        docs = [data[i * batch_size + b] <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(cur_batch_size)]<br><br>        <span class="hljs-keyword">yield</span> docs<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">data_iter</span>(<span class="hljs-params">data, batch_size, shuffle=<span class="hljs-literal">True</span>, noise=<span class="hljs-number">1.0</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    randomly permute data, then sort by source length, and partition into batches</span><br><span class="hljs-string">    ensure that the length of  sentences in each batch</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    batched_data = []<br>    <span class="hljs-keyword">if</span> shuffle:<br>        np.random.shuffle(data)<br><br>        lengths = [example[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> data]<br>        noisy_lengths = [- (l + np.random.uniform(- noise, noise)) <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> lengths]<br>        sorted_indices = np.argsort(noisy_lengths).tolist()<br>        sorted_data = [data[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sorted_indices]<br>    <span class="hljs-keyword">else</span>:<br>        sorted_data = data<br><br>    batched_data.extend(<span class="hljs-built_in">list</span>(batch_slice(sorted_data, batch_size)))<br><br>    <span class="hljs-keyword">if</span> shuffle:<br>        np.random.shuffle(batched_data)<br><br>    <span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> batched_data:<br>        <span class="hljs-keyword">yield</span> batch<br><br><span class="hljs-comment"># some function</span><br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> f1_score, precision_score, recall_score<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_score</span>(<span class="hljs-params">y_ture, y_pred</span>):<br>    y_ture = np.array(y_ture)<br>    y_pred = np.array(y_pred)<br>    f1 = f1_score(y_ture, y_pred, average=<span class="hljs-string">&#x27;macro&#x27;</span>) * <span class="hljs-number">100</span><br>    p = precision_score(y_ture, y_pred, average=<span class="hljs-string">&#x27;macro&#x27;</span>) * <span class="hljs-number">100</span><br>    r = recall_score(y_ture, y_pred, average=<span class="hljs-string">&#x27;macro&#x27;</span>) * <span class="hljs-number">100</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>((reformat(p, <span class="hljs-number">2</span>), reformat(r, <span class="hljs-number">2</span>), reformat(f1, <span class="hljs-number">2</span>))), reformat(f1, <span class="hljs-number">2</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reformat</span>(<span class="hljs-params">num, n</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">float</span>(<span class="hljs-built_in">format</span>(num, <span class="hljs-string">&#x27;0.&#x27;</span> + <span class="hljs-built_in">str</span>(n) + <span class="hljs-string">&#x27;f&#x27;</span>))<br><br><br><span class="hljs-comment"># build trainer</span><br><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> classification_report<br><br>clip = <span class="hljs-number">5.0</span><br>epochs = <span class="hljs-number">1</span><br>early_stops = <span class="hljs-number">3</span><br>log_interval = <span class="hljs-number">50</span><br><br>test_batch_size = <span class="hljs-number">16</span><br>train_batch_size = <span class="hljs-number">16</span><br><br>save_model = <span class="hljs-string">&#x27;./bert.bin&#x27;</span><br>save_test = <span class="hljs-string">&#x27;./bert.csv&#x27;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Trainer</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model, vocab</span>):<br>        self.model = model<br>        self.report = <span class="hljs-literal">True</span><br><br>        self.train_data = get_examples(train_data, model.word_encoder, vocab)<br>        self.batch_num = <span class="hljs-built_in">int</span>(np.ceil(<span class="hljs-built_in">len</span>(self.train_data) / <span class="hljs-built_in">float</span>(train_batch_size)))<br>        self.dev_data = get_examples(dev_data, model.word_encoder, vocab)<br>        self.test_data = get_examples(test_data, model.word_encoder, vocab)<br><br>        <span class="hljs-comment"># criterion</span><br>        self.criterion = nn.CrossEntropyLoss()<br><br>        <span class="hljs-comment"># label name</span><br>        self.target_names = vocab.target_names<br><br>        <span class="hljs-comment"># optimizer</span><br>        self.optimizer = Optimizer(model.all_parameters, steps=self.batch_num * epochs)<br><br>        <span class="hljs-comment"># count</span><br>        self.step = <span class="hljs-number">0</span><br>        self.early_stop = -<span class="hljs-number">1</span><br>        self.best_train_f1, self.best_dev_f1 = <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>        self.last_epoch = epochs<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train</span>(<span class="hljs-params">self</span>):<br>        logging.info(<span class="hljs-string">&#x27;Start training...&#x27;</span>)<br>        <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, epochs + <span class="hljs-number">1</span>):<br>            train_f1 = self._train(epoch)<br><br>            dev_f1 = self._<span class="hljs-built_in">eval</span>(epoch)<br><br>            <span class="hljs-keyword">if</span> self.best_dev_f1 &lt;= dev_f1:<br>                logging.info(<br>                    <span class="hljs-string">&quot;Exceed history dev = %.2f, current dev = %.2f&quot;</span> % (self.best_dev_f1, dev_f1))<br>                torch.save(self.model.state_dict(), save_model)<br><br>                self.best_train_f1 = train_f1<br>                self.best_dev_f1 = dev_f1<br>                self.early_stop = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">else</span>:<br>                self.early_stop += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> self.early_stop == early_stops:<br>                    logging.info(<br>                        <span class="hljs-string">&quot;Eearly stop in epoch %d, best train: %.2f, dev: %.2f&quot;</span> % (<br>                            epoch - early_stops, self.best_train_f1, self.best_dev_f1))<br>                    self.last_epoch = epoch<br>                    <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">self</span>):<br>        self.model.load_state_dict(torch.load(save_model))<br>        self._<span class="hljs-built_in">eval</span>(self.last_epoch + <span class="hljs-number">1</span>, test=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_train</span>(<span class="hljs-params">self, epoch</span>):<br>        self.optimizer.zero_grad()<br>        self.model.train()<br><br>        start_time = time.time()<br>        epoch_start_time = time.time()<br>        overall_losses = <span class="hljs-number">0</span><br>        losses = <span class="hljs-number">0</span><br>        batch_idx = <span class="hljs-number">1</span><br>        y_pred = []<br>        y_true = []<br>        <span class="hljs-keyword">for</span> batch_data <span class="hljs-keyword">in</span> data_iter(self.train_data, train_batch_size, shuffle=<span class="hljs-literal">True</span>):<br>            torch.cuda.empty_cache()<br>            batch_inputs, batch_labels = self.batch2tensor(batch_data)<br>            batch_outputs = self.model(batch_inputs)<br>            loss = self.criterion(batch_outputs, batch_labels)<br>            loss.backward()<br><br>            loss_value = loss.detach().cpu().item()<br>            losses += loss_value<br>            overall_losses += loss_value<br><br>            y_pred.extend(torch.<span class="hljs-built_in">max</span>(batch_outputs, dim=<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>].cpu().numpy().tolist())<br>            y_true.extend(batch_labels.cpu().numpy().tolist())<br><br>            nn.utils.clip_grad_norm_(self.optimizer.all_params, max_norm=clip)<br>            <span class="hljs-keyword">for</span> optimizer, scheduler <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(self.optimizer.optims, self.optimizer.schedulers):<br>                optimizer.step()<br>                scheduler.step()<br>            self.optimizer.zero_grad()<br><br>            self.step += <span class="hljs-number">1</span><br><br>            <span class="hljs-keyword">if</span> batch_idx % log_interval == <span class="hljs-number">0</span>:<br>                elapsed = time.time() - start_time<br><br>                lrs = self.optimizer.get_lr()<br>                logging.info(<br>                    <span class="hljs-string">&#x27;| epoch &#123;:3d&#125; | step &#123;:3d&#125; | batch &#123;:3d&#125;/&#123;:3d&#125; | lr&#123;&#125; | loss &#123;:.4f&#125; | s/batch &#123;:.2f&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<br>                        epoch, self.step, batch_idx, self.batch_num, lrs,<br>                        losses / log_interval,<br>                        elapsed / log_interval))<br><br>                losses = <span class="hljs-number">0</span><br>                start_time = time.time()<br><br>            batch_idx += <span class="hljs-number">1</span><br><br>        overall_losses /= self.batch_num<br>        during_time = time.time() - epoch_start_time<br><br>        <span class="hljs-comment"># reformat</span><br>        overall_losses = reformat(overall_losses, <span class="hljs-number">4</span>)<br>        score, f1 = get_score(y_true, y_pred)<br><br>        logging.info(<br>            <span class="hljs-string">&#x27;| epoch &#123;:3d&#125; | score &#123;&#125; | f1 &#123;&#125; | loss &#123;:.4f&#125; | time &#123;:.2f&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(epoch, score, f1,<br>                                                                                  overall_losses,<br>                                                                                  during_time))<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">set</span>(y_true) == <span class="hljs-built_in">set</span>(y_pred) <span class="hljs-keyword">and</span> self.report:<br>            report = classification_report(y_true, y_pred, digits=<span class="hljs-number">4</span>, target_names=self.target_names)<br>            logging.info(<span class="hljs-string">&#x27;\n&#x27;</span> + report)<br><br>        <span class="hljs-keyword">return</span> f1<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_eval</span>(<span class="hljs-params">self, epoch, test=<span class="hljs-literal">False</span></span>):<br>        self.model.<span class="hljs-built_in">eval</span>()<br>        start_time = time.time()<br>        data = self.test_data <span class="hljs-keyword">if</span> test <span class="hljs-keyword">else</span> self.dev_data<br>        y_pred = []<br>        y_true = []<br>        <span class="hljs-keyword">with</span> torch.no_grad():<br>            <span class="hljs-keyword">for</span> batch_data <span class="hljs-keyword">in</span> data_iter(data, test_batch_size, shuffle=<span class="hljs-literal">False</span>):<br>                torch.cuda.empty_cache()<br>                batch_inputs, batch_labels = self.batch2tensor(batch_data)<br>                batch_outputs = self.model(batch_inputs)<br>                y_pred.extend(torch.<span class="hljs-built_in">max</span>(batch_outputs, dim=<span class="hljs-number">1</span>)[<span class="hljs-number">1</span>].cpu().numpy().tolist())<br>                y_true.extend(batch_labels.cpu().numpy().tolist())<br><br>            score, f1 = get_score(y_true, y_pred)<br><br>            during_time = time.time() - start_time<br><br>            <span class="hljs-keyword">if</span> test:<br>                df = pd.DataFrame(&#123;<span class="hljs-string">&#x27;label&#x27;</span>: y_pred&#125;)<br>                df.to_csv(save_test, index=<span class="hljs-literal">False</span>, sep=<span class="hljs-string">&#x27;,&#x27;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                logging.info(<br>                    <span class="hljs-string">&#x27;| epoch &#123;:3d&#125; | dev | score &#123;&#125; | f1 &#123;&#125; | time &#123;:.2f&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(epoch, score, f1,<br>                                                                                  during_time))<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">set</span>(y_true) == <span class="hljs-built_in">set</span>(y_pred) <span class="hljs-keyword">and</span> self.report:<br>                    report = classification_report(y_true, y_pred, digits=<span class="hljs-number">4</span>, target_names=self.target_names)<br>                    logging.info(<span class="hljs-string">&#x27;\n&#x27;</span> + report)<br><br>        <span class="hljs-keyword">return</span> f1<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">batch2tensor</span>(<span class="hljs-params">self, batch_data</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">            [[label, doc_len, [[sent_len, [sent_id0, ...], [sent_id1, ...]], ...]]</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        batch_size = <span class="hljs-built_in">len</span>(batch_data)<br>        doc_labels = []<br>        doc_lens = []<br>        doc_max_sent_len = []<br>        <span class="hljs-keyword">for</span> doc_data <span class="hljs-keyword">in</span> batch_data:<br>            doc_labels.append(doc_data[<span class="hljs-number">0</span>])<br>            doc_lens.append(doc_data[<span class="hljs-number">1</span>])<br>            sent_lens = [sent_data[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> sent_data <span class="hljs-keyword">in</span> doc_data[<span class="hljs-number">2</span>]]<br>            max_sent_len = <span class="hljs-built_in">max</span>(sent_lens)<br>            doc_max_sent_len.append(max_sent_len)<br><br>        max_doc_len = <span class="hljs-built_in">max</span>(doc_lens)<br>        max_sent_len = <span class="hljs-built_in">max</span>(doc_max_sent_len)<br><br>        batch_inputs1 = torch.zeros((batch_size, max_doc_len, max_sent_len), dtype=torch.int64)<br>        batch_inputs2 = torch.zeros((batch_size, max_doc_len, max_sent_len), dtype=torch.int64)<br>        batch_masks = torch.zeros((batch_size, max_doc_len, max_sent_len), dtype=torch.float32)<br>        batch_labels = torch.LongTensor(doc_labels)<br><br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(batch_size):<br>            <span class="hljs-keyword">for</span> sent_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(doc_lens[b]):<br>                sent_data = batch_data[b][<span class="hljs-number">2</span>][sent_idx]<br>                <span class="hljs-keyword">for</span> word_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(sent_data[<span class="hljs-number">0</span>]):<br>                    batch_inputs1[b, sent_idx, word_idx] = sent_data[<span class="hljs-number">1</span>][word_idx]<br>                    batch_inputs2[b, sent_idx, word_idx] = sent_data[<span class="hljs-number">2</span>][word_idx]<br>                    batch_masks[b, sent_idx, word_idx] = <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">if</span> use_cuda:<br>            batch_inputs1 = batch_inputs1.to(device)<br>            batch_inputs2 = batch_inputs2.to(device)<br>            batch_masks = batch_masks.to(device)<br>            batch_labels = batch_labels.to(device)<br><br>        <span class="hljs-keyword">return</span> (batch_inputs1, batch_inputs2, batch_masks), batch_labels<br><br><span class="hljs-comment"># train</span><br>trainer = Trainer(model, vocab)<br>trainer.train()<br><br><span class="hljs-comment"># test</span><br>trainer.test()<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>NLP-Assignment4</title>
    <link href="/2022/05/15/NLP-Assignment4/"/>
    <url>/2022/05/15/NLP-Assignment4/</url>
    
    <content type="html"><![CDATA[<h1 id="assignment4ËÆ≤Ëß£">Assignment4ËÆ≤Ëß£</h1><h2 id="rnnÂíåÁ•ûÁªèÁΩëÁªúÊú∫Âô®ÁøªËØë">RNNÂíåÁ•ûÁªèÁΩëÁªúÊú∫Âô®ÁøªËØë</h2><p>Êú∫Âô®ÁøªËØëÊòØÊåáÔºåÊûÑÂª∫‰∏Ä‰∏™Á≥ªÁªüÂÆåÊàêÊ∫êËØ≠Ë®ÄÂà∞ÁõÆÊ†áËØ≠Ë®ÄÁöÑÂèòÊç¢Êò†Â∞ÑÔºåÊØîÂ¶ÇÁªôÂÆö‰∏Ä‰∏™Ê∫êÂè•Â≠êÔºàÊØîÂ¶ÇË•øÁè≠ÁâôËØ≠ÔºâÔºåËæìÂá∫‰∏Ä‰∏™ÁõÆÊ†áÂè•Â≠êÔºàÊØîÂ¶ÇËã±ËØ≠Ôºâ„ÄÇÊú¨Ê¨°‰Ωú‰∏ö‰∏≠Ë¶ÅÂÆûÁé∞ÁöÑÊòØ‰∏Ä‰∏™Â∏¶Ê≥®ÊÑèÂäõÊú∫Âà∂ÁöÑSeq2SeqÁ•ûÁªèÊ®°ÂûãÔºåÁî®‰∫éÊûÑÂª∫Á•ûÁªèÁΩëÁªúÊú∫Âô®ÁøªËØëÔºàNMTÔºâÁ≥ªÁªü„ÄÇÈ¶ñÂÖàÊàë‰ª¨Êù•ÁúãNMTÁ≥ªÁªüÁöÑËÆ≠ÁªÉËøáÁ®ãÔºåÂÆÉÁî®Âà∞‰∫ÜÂèåÂêëLSTM‰Ωú‰∏∫ÁºñÁ†ÅÂô®ÔºàencoderÔºâÂíåÂçïÂêëLSTM‰Ωú‰∏∫Ëß£Á†ÅÂô®ÔºàdecoderÔºâ„ÄÇ</p><p><img src="http://ww1.sinaimg.cn/large/0060yMmAly1gsjzdzvwbaj30pv0hzjuy.jpg" referrerpolicy="no-referrer"/></p><p>ÁªôÂÆöÈïøÂ∫¶‰∏∫mÁöÑÊ∫êËØ≠Ë®ÄÂè•Â≠êÔºàsourceÔºâÔºåÁªèËøáÂµåÂÖ•Â±ÇÔºåÂæóÂà∞ËæìÂÖ•Â∫èÂàó <spanclass="math inline">\(x_1, x_2, ‚Ä¶, x_m \in R^{e \times1}\)</span>Ôºå<spanclass="math inline">\(e\)</span>ÊòØËØçÂêëÈáèÂ§ßÂ∞è„ÄÇÁªèËøáÂèåÂêëEncoderÂêéÔºåÂæóÂà∞ÂâçÂêëÔºà‚ÜíÔºâÂíåÂèçÂêëÔºà‚ÜêÔºâLSTMÁöÑÈöêËóèÂ±ÇÂíåÁ•ûÁªèÂÖÉÁä∂ÊÄÅÔºåÂ∞Ü‰∏§‰∏™ÊñπÂêëÁöÑÁä∂ÊÄÅËøûÊé•Ëµ∑Êù•ÂæóÂà∞Êó∂Èó¥Ê≠•<span class="math inline">\(i\)</span> ÁöÑÈöêËóèÁä∂ÊÄÅ <spanclass="math inline">\(h_i^{enc}\)</span> Âíå <spanclass="math inline">\(c_i^{enc}\)</span> Ôºö <spanclass="math display">\[\mathbf{h}_{i}^{\text {enc }}=\left[\overleftarrow{\mathbf{h}_{i}^{\text{enc }}} ; \overrightarrow{\mathbf{h}_{i}^{\text {enc }}}\right] \text {where } \mathbf{h}_{i}^{\text {enc }} \in \mathbb{R}^{2 h \times 1},\overleftarrow{\mathbf{h}_{i}^{\text {enc }}},\overrightarrow{\mathbf{h}_{i}^{\text {en }}} \in \mathbb{R}^{h \times1} \quad 1 \leq i \leq m\]</span></p><p><span class="math display">\[\mathbf{c}_{i}^{\text {enc }}=\left[\overleftarrow{\mathbf{c}_{i}^{\text{enc }}} ; \overrightarrow{\mathbf{c}_{i}^{\text {enc }}}\right] \text {where } \mathbf{c}_{i}^{\text {enc }} \in \mathbb{R}^{2 h \times 1},\overleftarrow{\mathbf{c}_{i}^{\text {enc }}},\overrightarrow{\mathbf{c}_{i}^{\text {en }}} \in \mathbb{R}^{h \times1} \quad 1 \leq i \leq m\]</span></p><p>Êé•ÁùÄÊàë‰ª¨‰ΩøÁî®‰∏Ä‰∏™Á∫øÊÄßÂ±ÇÊù•ÂàùÂßãÂåñDecoderÁöÑÂàùÂßãÈöêËóè„ÄÅÁ•ûÁªèÂÖÉÁöÑÁä∂ÊÄÅÔºö <spanclass="math display">\[\mathbf{h}_{0}^{\text {dec}}=\mathbf{W}_{h}\left[\overleftarrow{\mathbf{h}_{1}^{\text {enc }}} ;\overrightarrow{\mathbf{h}_{m}^{\text {enc }}}\right] \text { where }\mathbf{h}_{0}^{\text {dec }} \in \mathbb{R}^{h \times 1},\mathbf{W}_{h} \in \mathbb{R}^{h \times 2 h}\]</span></p><p><span class="math display">\[\mathbf{c}_{0}^{\text {dec}}=\mathbf{W}_{c}\left[\overleftarrow{\mathbf{c}_{1}^{\text {enc }}} ;\overrightarrow{\mathbf{c}_{m}^{\text {enc }}}\right] \text { where }\mathbf{c}_{0}^{\text {dec }} \in \mathbb{R}^{h \times 1},\mathbf{W}_{c} \in \mathbb{R}^{h \times 2 h}\]</span></p><p>DecoderÁöÑÊó∂Èó¥Ê≠•<span class="math inline">\(t\)</span> ÁöÑËæìÂÖ•‰∏∫ <spanclass="math inline">\(\bar{y}_t\)</span> ÔºåÂÆÉÁî±ÁõÆÊ†áËØ≠Ë®ÄÂè•Â≠ê <spanclass="math inline">\(y_t\)</span>Âíå‰∏ä‰∏ÄÁ•ûÁªèÂÖÉÁöÑËæìÂá∫Âíå‰∏ä‰∏ÄÁ•ûÁªèÂÖÉÁöÑËæìÂá∫<spanclass="math inline">\(o_{t-1}\)</span>ÁªèËøáËøûÊé•ÂæóÂà∞ÔºåÁªèËøáËøûÊé•ÂæóÂà∞Ôºå<spanclass="math inline">\(o_0\)</span>ÊòØ0ÂêëÈáèÔºåÊâÄ‰ª• <spanclass="math inline">\(\bar{y}_t \in R^{(e + h) \times 1}\)</span> <spanclass="math display">\[\mathbf{h}_{t}^{\mathrm{dec}},\mathbf{c}_{t}^{\mathrm{dec}}=\operatorname{Decoder}\left(\overline{\mathbf{y}_{t}},\mathbf{h}_{t-1}^{\mathrm{dec}}, \mathbf{c}_{t-1}^{\mathrm{dec}}\right)\text { where } \mathbf{h}_{t}^{\mathrm{dec}} \in \mathbb{R}^{h \times1}, \mathbf{c}_{t}^{\mathrm{dec}} \in \mathbb{R}^{h \times 1}\]</span> Êé•ÁùÄÊàë‰ª¨‰ΩøÁî® <span class="math inline">\(h^{dec}_t\)</span>Êù•ËÆ°ÁÆóÂú® <span class="math inline">\(h^{enc}_0, h^{enc}_1, ‚Ä¶,h^{enc}_m\)</span> ÁöÑ‰πòÁßØÊ≥®ÊÑèÂäõÔºàmultiplicative attentionÔºâÔºö <spanclass="math display">\[\begin{array}{c}\mathbf{e}_{t, i}=\left(\mathbf{h}_{t}^{\mathrm{dec}}\right)^{T}\mathbf{W}_{\text {attProj }} \mathbf{h}_{i}^{\text {enc }} \text {where } \mathbf{e}_{t} \in \mathbb{R}^{m \times 1}, \mathbf{W}_{\text{attProj }} \in \mathbb{R}^{h \times 2 h} \quad 1 \leq i \leq m \\\alpha_{t}=\operatorname{softmax}\left(\mathbf{e}_{t}\right) \text {where } \alpha_{t} \in \mathbb{R}^{m \times 1} \\\mathbf{a}_{t}=\sum_{i=1}^{m} \alpha_{t, i} \mathbf{h}_{i}^{\text {enc}} \text { where } \mathbf{a}_{t} \in \mathbb{R}^{2 h \times 1}\end{array}\]</span> ÁÑ∂ÂêéÂ∞ÜÊ≥®ÊÑèÂäõ <span class="math inline">\(a_t\)</span>ÂíåËß£Á†ÅÂô®ÁöÑÈöêËóèÁä∂ÊÄÅ <span class="math inline">\(h^{dec}_t\)</span>ËøûÊé•ÔºåÈÄÅÂÖ•Á∫øÊÄßÂ±ÇÔºåÂæóÂà∞ <em>combined-output</em> ÂêëÈáè <spanclass="math inline">\(o_t\)</span> <span class="math display">\[\begin{array}{r}\mathbf{u}_{t}=\left[\mathbf{a}_{t} ;\mathbf{h}_{t}^{\mathrm{dec}}\right] \text { where } \mathbf{u}_{t} \in\mathbb{R}^{3 h \times 1} \\\mathbf{v}_{t}=\mathbf{W}_{u} \mathbf{u}_{t} \text { where }\mathbf{v}_{t} \in \mathbb{R}^{h \times 1}, \mathbf{W}_{u} \in\mathbb{R}^{h \times 3 h} \\\mathbf{o}_{t}=\operatorname{Dropout}\left(\tanh\left(\mathbf{v}_{t}\right)\right) \text { where } \mathbf{o}_{t} \in\mathbb{R}^{h \times 1}\end{array}\]</span> ËøôÊ†∑‰ª•Êù•ÔºåÁõÆÊ†áËØçÁöÑÊ¶ÇÁéáÂàÜÂ∏ÉÂàô‰∏∫Ôºö <span class="math display">\[\mathbf{P}_{t}=\operatorname{softmax}\left(\mathbf{W}_{\text {vocab }}\mathbf{o}_{t}\right) \text { where } \mathbf{P}_{t} \in\mathbb{R}^{V_{t} \times 1}, \mathbf{W}_{\text {vocab }} \in\mathbb{R}^{V_{t} \times h}\]</span> ‰ΩøÁî®‰∫§ÂèâÁÜµÂÅöÁõÆÊ†áÂáΩÊï∞Âç≥ÂèØ <span class="math display">\[J_{t}(\theta)=\text { CrossEntropy }\left(\mathbf{P}_{t},\mathbf{g}_{t}\right)\]</span></p><p>‰ª£Á†ÅÂÆûÁé∞ÈÉ®ÂàÜÔºåÂÖ≥ÈîÆÂú®‰∫éËøáÁ®ã‰∏≠ÁöÑÂêëÈáèÁª¥Â∫¶ÔºåÂêëÈáèÁª¥Â∫¶ÂåπÈÖçÊ≤°ÊúâÈóÆÈ¢òÔºåÊï¥‰∏™ËøáÁ®ãÁöÑÂÆûÁé∞Â∞±ÊØîËæÉÊ∏ÖÊô∞„ÄÇ</p><h2 id="part1-Á•ûÁªèÁΩëÁªúÁøªËØëÁ≥ªÁªü‰ª£Á†ÅÂÆûÁé∞">part1Á•ûÁªèÁΩëÁªúÁøªËØëÁ≥ªÁªü‰ª£Á†ÅÂÆûÁé∞</h2><h3 id="a-pad_sents">(a) pad_sents</h3><p>In order to apply tensor operations, we must ensure that thesentences in a given batch are of the same length. Thus, we mustidentify the longest sentence in a batch and pad others to be the samelength. Implement the pad sents function in utils.py, which shallproduce these padded sentences.</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">pad_sents</span>(<span class="hljs-params">sents, pad_token</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; Pad list of sentences according to the longest sentence in the batch.</span><br><span class="hljs-string">    @param sents (list[list[str]]): list of sentences, where each sentence</span><br><span class="hljs-string">                                    is represented as a list of words</span><br><span class="hljs-string">    @param pad_token (str): padding token</span><br><span class="hljs-string">    @returns sents_padded (list[list[str]]): list of sentences where sentences shorter</span><br><span class="hljs-string">        than the max length sentence are padded out with the pad_token, such that</span><br><span class="hljs-string">        each sentences in the batch now has equal length.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    sents_padded = []<br><br>    <span class="hljs-comment"># YOUR CODE HERE (~6 Lines)</span><br>    corpus_size = <span class="hljs-built_in">len</span>(sents)<br>    lens = [<span class="hljs-built_in">len</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sents]  <span class="hljs-comment"># every sentence&#x27;s length</span><br>    max_lens = <span class="hljs-built_in">max</span>(lens)<br>    sents_padded = [sents[i] + [pad_token] * (max_lens - lens[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(corpus_size)]      <span class="hljs-comment"># shape N x max_lens</span><br>    <span class="hljs-comment"># END YOUR CODE</span><br><br>    <span class="hljs-keyword">return</span> sents_padded<br></code></pre></div></td></tr></table></figure><h3 id="b-modelembeddings">(b) ModelEmbeddings</h3><p>Implement the <code>__init__</code> function in model embeddings.pyto initialize the necessary source and target embeddings.</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelEmbeddings</span>(nn.Module): <br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Class that converts input words to their embeddings.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, embed_size, vocab</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        Init the Embedding layers.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        @param embed_size (int): Embedding size (dimensionality)</span><br><span class="hljs-string">        @param vocab (Vocab): Vocabulary object containing src and tgt languages</span><br><span class="hljs-string">                              See vocab.py for documentation.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">super</span>(ModelEmbeddings, self).__init__()<br>        self.embed_size = embed_size<br><br>        <span class="hljs-comment"># default values</span><br>        self.source = <span class="hljs-literal">None</span><br>        self.target = <span class="hljs-literal">None</span><br><br>        src_pad_token_idx = vocab.src[<span class="hljs-string">&#x27;&lt;pad&gt;&#x27;</span>]<br>        tgt_pad_token_idx = vocab.tgt[<span class="hljs-string">&#x27;&lt;pad&gt;&#x27;</span>]<br><br>        <span class="hljs-comment"># YOUR CODE HERE (~2 Lines)</span><br>        <span class="hljs-comment"># TODO - Initialize the following variables:</span><br>        <span class="hljs-comment">#     self.source (Embedding Layer for source language)</span><br>        <span class="hljs-comment">#     self.target (Embedding Layer for target langauge)</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># Note:</span><br>        <span class="hljs-comment">#     1. `vocab` object contains two vocabularies:</span><br>        <span class="hljs-comment">#            `vocab.src` for source</span><br>        <span class="hljs-comment">#            `vocab.tgt` for target</span><br>        <span class="hljs-comment">#     2. You can get the length of a specific vocabulary by running:</span><br>        <span class="hljs-comment">#             `len(vocab.&lt;specific_vocabulary&gt;)`</span><br>        <span class="hljs-comment">#     3. Remember to include the padding token for the specific vocabulary</span><br>        <span class="hljs-comment">#        when creating your Embedding.</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># Use the following docs to properly initialize these variables:</span><br>        <span class="hljs-comment">#     Embedding Layer:</span><br>        <span class="hljs-comment">#         https://pytorch.org/docs/stable/nn.html#torch.nn.Embedding</span><br><br>        self.source = nn.Embedding(<span class="hljs-built_in">len</span>(vocab.src), embed_size, padding_idx=src_pad_token_idx)<br>        self.target = nn.Embedding(<span class="hljs-built_in">len</span>(vocab.tgt), embed_size, padding_idx=tgt_pad_token_idx)<br><br>        <span class="hljs-comment"># END YOUR CODE</span><br></code></pre></div></td></tr></table></figure><h3 id="c-nmt">(c) NMT</h3><p>Implement the <code>__init__</code> function in nmt model.py toinitialize the necessary model embeddings (using the ModelEmbeddingsclass from model embeddings.py) and layers (LSTM, projection, anddropout) for the NMT system</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NMT</span>(nn.Module):<br>    <span class="hljs-string">&quot;&quot;&quot; Simple Neural Machine Translation Model:</span><br><span class="hljs-string">        - Bidrectional LSTM Encoder</span><br><span class="hljs-string">        - Unidirection LSTM Decoder</span><br><span class="hljs-string">        - Global Attention Model (Luong, et al. 2015)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, embed_size, hidden_size, vocab, dropout_rate=<span class="hljs-number">0.2</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot; Init NMT Model.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        @param embed_size (int): Embedding size (dimensionality)</span><br><span class="hljs-string">        @param hidden_size (int): Hidden Size (dimensionality)</span><br><span class="hljs-string">        @param vocab (Vocab): Vocabulary object containing src and tgt languages</span><br><span class="hljs-string">                              See vocab.py for documentation.</span><br><span class="hljs-string">        @param dropout_rate (float): Dropout probability, for attention</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">super</span>(NMT, self).__init__()<br>        self.model_embeddings = ModelEmbeddings(embed_size, vocab)<br>        self.hidden_size = hidden_size<br>        self.dropout_rate = dropout_rate<br>        self.vocab = vocab<br><br>        <span class="hljs-comment"># default values</span><br>        self.encoder = <span class="hljs-literal">None</span> <br>        self.decoder = <span class="hljs-literal">None</span><br>        self.h_projection = <span class="hljs-literal">None</span><br>        self.c_projection = <span class="hljs-literal">None</span><br>        self.att_projection = <span class="hljs-literal">None</span><br>        self.combined_output_projection = <span class="hljs-literal">None</span><br>        self.target_vocab_projection = <span class="hljs-literal">None</span><br>        self.dropout = <span class="hljs-literal">None</span><br><br>        <span class="hljs-comment"># YOUR CODE HERE (~8 Lines)</span><br>        <span class="hljs-comment"># TODO - Initialize the following variables:</span><br>        <span class="hljs-comment">#     self.encoder (Bidirectional LSTM with bias)</span><br>        <span class="hljs-comment">#     self.decoder (LSTM Cell with bias)</span><br>        <span class="hljs-comment">#     self.h_projection (Linear Layer with no bias), called W_&#123;h&#125; in the PDF.</span><br>        <span class="hljs-comment">#     self.c_projection (Linear Layer with no bias), called W_&#123;c&#125; in the PDF.</span><br>        <span class="hljs-comment">#     self.att_projection (Linear Layer with no bias), called W_&#123;attProj&#125; in the PDF.</span><br>        <span class="hljs-comment">#     self.combined_output_projection (Linear Layer with no bias), called W_&#123;u&#125; in the PDF.</span><br>        <span class="hljs-comment">#     self.target_vocab_projection (Linear Layer with no bias), called W_&#123;vocab&#125; in the PDF.</span><br>        <span class="hljs-comment">#     self.dropout (Dropout Layer)</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># Use the following docs to properly initialize these variables:</span><br>        <span class="hljs-comment">#     LSTM:</span><br>        <span class="hljs-comment">#         https://pytorch.org/docs/stable/nn.html#torch.nn.LSTM</span><br>        <span class="hljs-comment">#     LSTM Cell:</span><br>        <span class="hljs-comment">#         https://pytorch.org/docs/stable/nn.html#torch.nn.LSTMCell</span><br>        <span class="hljs-comment">#     Linear Layer:</span><br>        <span class="hljs-comment">#         https://pytorch.org/docs/stable/nn.html#torch.nn.Linear</span><br>        <span class="hljs-comment">#     Dropout Layer:</span><br>        <span class="hljs-comment">#         https://pytorch.org/docs/stable/nn.html#torch.nn.Dropout</span><br><br>        self.encoder = nn.LSTM(embed_size, hidden_size, bias=<span class="hljs-literal">True</span>, bidirectional=<span class="hljs-literal">True</span>)<br>        self.decoder = nn.LSTMCell(embed_size + hidden_size, hidden_size, bias=<span class="hljs-literal">True</span>)<br>        self.h_projection = nn.Linear(hidden_size * <span class="hljs-number">2</span>, hidden_size, bias=<span class="hljs-literal">False</span>) <span class="hljs-comment"># prj output of last h_state of encode (R^2h) to R^h</span><br>        self.c_projection = nn.Linear(hidden_size * <span class="hljs-number">2</span>, hidden_size, bias=<span class="hljs-literal">False</span>)<br>        self.att_projection = nn.Linear(hidden_size * <span class="hljs-number">2</span>, hidden_size, bias=<span class="hljs-literal">False</span>) <span class="hljs-comment"># 1 x 2h (h_encode_i) * 2h x h (W) * h * 1 (h_decode_t) = 1 x 1 = e_t,i</span><br>        self.combined_output_projection = nn.Linear(hidden_size * <span class="hljs-number">3</span>, hidden_size, bias=<span class="hljs-literal">False</span>) <span class="hljs-comment"># use after combined attention output and h_decode</span><br>        self.target_vocab_projection    = nn.Linear(hidden_size, <span class="hljs-built_in">len</span>(vocab.tgt), bias=<span class="hljs-literal">False</span>) <span class="hljs-comment"># for softmax of last</span><br>        self.dropout = nn.Dropout(self.dropout_rate)<br>        <span class="hljs-comment"># END YOUR CODE</span><br><br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, source: <span class="hljs-type">List</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]], target: <span class="hljs-type">List</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]]</span>) -&gt; torch.Tensor:<br>        <span class="hljs-string">&quot;&quot;&quot; Take a mini-batch of source and target sentences, compute the log-likelihood of</span><br><span class="hljs-string">        target sentences under the language models learned by the NMT system.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        @param source (List[List[str]]): list of source sentence tokens</span><br><span class="hljs-string">        @param target (List[List[str]]): list of target sentence tokens, wrapped by `&lt;s&gt;` and `&lt;/s&gt;`</span><br><span class="hljs-string"></span><br><span class="hljs-string">        @returns scores (Tensor): a variable/tensor of shape (b, ) representing the</span><br><span class="hljs-string">                                    log-likelihood of generating the gold-standard target sentence for</span><br><span class="hljs-string">                                    each example in the input batch. Here b = batch size.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># Compute sentence lengths</span><br>        source_lengths = [<span class="hljs-built_in">len</span>(s) <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> source]<br><br>        <span class="hljs-comment"># Convert list of lists into tensors</span><br>        source_padded = self.vocab.src.to_input_tensor(source, device=self.device)   <span class="hljs-comment"># Tensor: (src_len, b)</span><br>        target_padded = self.vocab.tgt.to_input_tensor(target, device=self.device)   <span class="hljs-comment"># Tensor: (tgt_len, b)</span><br><br>        <span class="hljs-comment">#     Run the network forward:</span><br>        <span class="hljs-comment">#     1. Apply the encoder to `source_padded` by calling `self.encode()`</span><br>        <span class="hljs-comment">#     2. Generate sentence masks for `source_padded` by calling `self.generate_sent_masks()`</span><br>        <span class="hljs-comment">#     3. Apply the decoder to compute combined-output by calling `self.decode()`</span><br>        <span class="hljs-comment">#     4. Compute log probability distribution over the target vocabulary using the</span><br>        <span class="hljs-comment">#        combined_outputs returned by the `self.decode()` function.</span><br><br>        enc_hiddens, dec_init_state = self.encode(source_padded, source_lengths)<br>        enc_masks = self.generate_sent_masks(enc_hiddens, source_lengths)<br>        combined_outputs = self.decode(enc_hiddens, enc_masks, dec_init_state, target_padded)<br>        P = F.log_softmax(self.target_vocab_projection(combined_outputs), dim=-<span class="hljs-number">1</span>)<br><br>        <span class="hljs-comment"># Zero out, probabilities for which we have nothing in the target text</span><br>        target_masks = (target_padded != self.vocab.tgt[<span class="hljs-string">&#x27;&lt;pad&gt;&#x27;</span>]).<span class="hljs-built_in">float</span>()<br>        <br>        <span class="hljs-comment"># Compute log probability of generating true target words</span><br>        target_gold_words_log_prob = torch.gather(P, index=target_padded[<span class="hljs-number">1</span>:].unsqueeze(-<span class="hljs-number">1</span>), dim=-<span class="hljs-number">1</span>).squeeze(-<span class="hljs-number">1</span>) * target_masks[<span class="hljs-number">1</span>:]<br>        scores = target_gold_words_log_prob.<span class="hljs-built_in">sum</span>(dim=<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> scores<br></code></pre></div></td></tr></table></figure><h3 id="d-encode">(d) encode</h3><p>Implement the <code>encode</code> function in nmt model.py. Thisfunction converts the padded source sentences into the tensor<spanclass="math inline">\(X\)</span>, generates<spanclass="math inline">\(h^{enc}_1,...,h^{enc}_m\)</span> , and computesthe initial state<span class="math inline">\(\ h^{dec}_0\)</span>andinitial cell<span class="math inline">\(\ c^{dec}_0\)</span>for theDecoder. You can run a non-comprehensive sanity check byexecuting:<code>python sanity_check.py 1d</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">encode</span>(<span class="hljs-params">self, source_padded: torch.Tensor, source_lengths: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-type">Tuple</span>[torch.Tensor, <span class="hljs-type">Tuple</span>[torch.Tensor, torch.Tensor]]:<br>   <span class="hljs-string">&quot;&quot;&quot; Apply the encoder to source sentences to obtain encoder hidden states.</span><br><span class="hljs-string">       Additionally, take the final states of the encoder and project them to obtain initial states for decoder.</span><br><span class="hljs-string"></span><br><span class="hljs-string">   @param source_padded (Tensor): Tensor of padded source sentences with shape (src_len, b), where</span><br><span class="hljs-string">                                   b = batch_size, src_len = maximum source sentence length. Note that </span><br><span class="hljs-string">                                  these have already been sorted in order of longest to shortest sentence.</span><br><span class="hljs-string">   @param source_lengths (List[int]): List of actual lengths for each of the source sentences in the batch</span><br><span class="hljs-string">   @returns enc_hiddens (Tensor): Tensor of hidden units with shape (b, src_len, h*2), where</span><br><span class="hljs-string">                                   b = batch size, src_len = maximum source sentence length, h = hidden size.</span><br><span class="hljs-string">   @returns dec_init_state (tuple(Tensor, Tensor)): Tuple of tensors representing the decoder&#x27;s initial</span><br><span class="hljs-string">                                           hidden state and cell.</span><br><span class="hljs-string">   &quot;&quot;&quot;</span><br>   enc_hiddens, dec_init_state = <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br><br>   <span class="hljs-comment"># YOUR CODE HERE (~ 8 Lines)</span><br>   <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span></span><br>   <span class="hljs-comment">#     1. Construct Tensor `X` of source sentences with shape (src_len, b, e) using the source model embeddings.</span><br>   <span class="hljs-comment">#         src_len = maximum source sentence length, b = batch size, e = embedding size. Note</span><br>   <span class="hljs-comment">#         that there is no initial hidden state or cell for the decoder.</span><br>   <span class="hljs-comment">#     2. Compute `enc_hiddens`, `last_hidden`, `last_cell` by applying the encoder to `X`.</span><br>   <span class="hljs-comment">#         - Before you can apply the encoder, you need to apply the `pack_padded_sequence` function to X.</span><br>   <span class="hljs-comment">#         - After you apply the encoder, you need to apply the `pad_packed_sequence` function to enc_hiddens.</span><br>   <span class="hljs-comment">#         - Note that the shape of the tensor returned by the encoder is (src_len b, h*2) and we want to</span><br>   <span class="hljs-comment">#           return a tensor of shape (b, src_len, h*2) as `enc_hiddens`.</span><br>   <span class="hljs-comment">#     3. Compute `dec_init_state` = (init_decoder_hidden, init_decoder_cell):</span><br>   <span class="hljs-comment">#         - `init_decoder_hidden`:</span><br>   <span class="hljs-comment">#             `last_hidden` is a tensor shape (2, b, h). The first dimension corresponds to forwards and backwards.</span><br>   <span class="hljs-comment">#             Concatenate the forwards and backwards tensors to obtain a tensor shape (b, 2*h).</span><br>   <span class="hljs-comment">#             Apply the h_projection layer to this in order to compute init_decoder_hidden.</span><br>   <span class="hljs-comment">#             This is h_0^&#123;dec&#125; in the PDF. Here b = batch size, h = hidden size</span><br>   <span class="hljs-comment">#         - `init_decoder_cell`:</span><br>   <span class="hljs-comment">#             `last_cell` is a tensor shape (2, b, h). The first dimension corresponds to forwards and backwards.</span><br>   <span class="hljs-comment">#             Concatenate the forwards and backwards tensors to obtain a tensor shape (b, 2*h).</span><br>   <span class="hljs-comment">#             Apply the c_projection layer to this in order to compute init_decoder_cell.</span><br>   <span class="hljs-comment">#             This is c_0^&#123;dec&#125; in the PDF. Here b = batch size, h = hidden size</span><br>   <span class="hljs-comment">#</span><br>   <span class="hljs-comment"># See the following docs, as you may need to use some of the following functions in your implementation:</span><br>   <span class="hljs-comment">#     Pack the padded sequence X before passing to the encoder:</span><br>   <span class="hljs-comment">#         https://pytorch.org/docs/stable/nn.html#torch.nn.utils.rnn.pack_padded_sequence</span><br>   <span class="hljs-comment">#     Pad the packed sequence, enc_hiddens, returned by the encoder:</span><br>   <span class="hljs-comment">#         https://pytorch.org/docs/stable/nn.html#torch.nn.utils.rnn.pad_packed_sequence</span><br>   <span class="hljs-comment">#     Tensor Concatenation:</span><br>   <span class="hljs-comment">#         https://pytorch.org/docs/stable/torch.html#torch.cat</span><br>   <span class="hljs-comment">#     Tensor Permute:</span><br>   <span class="hljs-comment">#         https://pytorch.org/docs/stable/tensors.html#torch.Tensor.permute</span><br>   X = self.model_embeddings.source(source_padded) <span class="hljs-comment"># (src_len, b, e)</span><br>   X = pack_padded_sequence(X, lengths=source_lengths) <span class="hljs-comment"># if feed pack to RNN, it will not calculate output for pad element</span><br>   <span class="hljs-comment"># pack_padded_sequence and pad_packed_sequence example:</span><br>   <span class="hljs-comment"># https://github.com/HarshTrivedi/packing-unpacking-pytorch-minimal-tutorial</span><br>   <span class="hljs-comment"># PackedSequence: Named Tuple with 2 attribute data &amp; batch_size</span><br>   <span class="hljs-comment"># data: shape (batch_sum_len x embed_dim)</span><br>   <span class="hljs-comment"># batch_size: each columns when feed to lstm (max = batch_size (start word of all sentence), min = 1 (only one word in this column))</span><br><br>   <span class="hljs-comment"># After feed PackedSequence to LSTM, return PackedSequence with the same attributes : data &amp; batch_size</span><br>   enc_hiddens, (last_hidden, last_cell) = self.encoder(X)<br>   <span class="hljs-comment"># pad_packed_sequence will unpack PackedSequence, which transform (data &amp; batch_size) -&gt; (max_len, b, h * 2)</span><br>   <span class="hljs-comment"># padded indice will be 0s</span><br>   enc_hiddens, _ = pad_packed_sequence(enc_hiddens)<br>   enc_hiddens = enc_hiddens.transpose(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<span class="hljs-comment"># (b, max_len, h* 2) Áª¥Â∫¶‰∫íÊç¢</span><br><br>   last_hidden = torch.cat((last_hidden[<span class="hljs-number">0</span>], last_hidden[<span class="hljs-number">1</span>]), <span class="hljs-number">1</span>)<span class="hljs-comment"># (2, b, h) -&gt; (b, h * 2)</span><br>   init_decoder_hidden = self.h_projection(last_hidden)<br><br>   last_cell = torch.cat((last_cell[<span class="hljs-number">0</span>], last_cell[<span class="hljs-number">1</span>]), <span class="hljs-number">1</span>)<br>   init_decoder_cell = self.c_projection(last_cell)<br><br>   dec_init_state = (init_decoder_hidden, init_decoder_cell)<br>   <span class="hljs-comment"># END YOUR CODE</span><br><br>   <span class="hljs-keyword">return</span> enc_hiddens, dec_init_state<br></code></pre></div></td></tr></table></figure><h3 id="e-decode">(e) decode</h3><p>Implement the <code>decode</code> function in nmt model.py. Thisfunction constructs y¬Ø and runs the step function over every timestepfor the input. You can run a non-comprehensive sanity check byexecuting:<code>python sanity_check.py 1e</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode</span>(<span class="hljs-params">self, enc_hiddens: torch.Tensor, enc_masks: torch.Tensor,</span><br><span class="hljs-params">            dec_init_state: <span class="hljs-type">Tuple</span>[torch.Tensor, torch.Tensor], target_padded: torch.Tensor</span>) -&gt; torch.Tensor:<br>    <span class="hljs-string">&quot;&quot;&quot;Compute combined output vectors for a batch.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    @param enc_hiddens (Tensor): Hidden states (b, src_len, h*2), where</span><br><span class="hljs-string">                                 b = batch size, src_len = maximum source sentence length, h = hidden size.</span><br><span class="hljs-string">    @param enc_masks (Tensor): Tensor of sentence masks (b, src_len), where</span><br><span class="hljs-string">                                 b = batch size, src_len = maximum source sentence length.</span><br><span class="hljs-string">    @param dec_init_state (tuple(Tensor, Tensor)): Initial state and cell for decoder</span><br><span class="hljs-string">    @param target_padded (Tensor): Gold-standard padded target sentences (tgt_len, b), where</span><br><span class="hljs-string">                                   tgt_len = maximum target sentence length, b = batch size. </span><br><span class="hljs-string"></span><br><span class="hljs-string">    @returns combined_outputs (Tensor): combined output tensor  (tgt_len, b,  h), where</span><br><span class="hljs-string">                                    tgt_len = maximum target sentence length, b = batch_size,  h = hidden size</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># Chop of the &lt;END&gt; token for max length sentences.</span><br>    target_padded = target_padded[:-<span class="hljs-number">1</span>]<br><br>    <span class="hljs-comment"># Initialize the decoder state (hidden and cell)</span><br>    dec_state = dec_init_state<br><br>    <span class="hljs-comment"># Initialize previous combined output vector o_&#123;t-1&#125; as zero</span><br>    batch_size = enc_hiddens.size(<span class="hljs-number">0</span>)<br>    o_prev = torch.zeros(batch_size, self.hidden_size, device=self.device)<br><br>    <span class="hljs-comment"># Initialize a list we will use to collect the combined output o_t on each step</span><br>    combined_outputs = []<br><br>    <span class="hljs-comment"># YOUR CODE HERE (~9 Lines)</span><br>    <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span></span><br>    <span class="hljs-comment">#     1. Apply the attention projection layer to `enc_hiddens` to obtain `enc_hiddens_proj`,</span><br>    <span class="hljs-comment">#         which should be shape (b, src_len, h),</span><br>    <span class="hljs-comment">#         where b = batch size, src_len = maximum source length, h = hidden size.</span><br>    <span class="hljs-comment">#         This is applying W_&#123;attProj&#125; to h^enc, as described in the PDF.</span><br>    <span class="hljs-comment">#     2. Construct tensor `Y` of target sentences with shape (tgt_len, b, e) using the target model embeddings.</span><br>    <span class="hljs-comment">#         where tgt_len = maximum target sentence length, b = batch size, e = embedding size.</span><br>    <span class="hljs-comment">#     3. Use the torch.split function to iterate over the time dimension of Y.</span><br>    <span class="hljs-comment">#         Within the loop, this will give you Y_t of shape (1, b, e) where b = batch size, e = embedding size.</span><br>    <span class="hljs-comment">#             - Squeeze Y_t into a tensor of dimension (b, e).</span><br>    <span class="hljs-comment">#             - Construct Ybar_t by concatenating Y_t with o_prev.</span><br>    <span class="hljs-comment">#             - Use the step function to compute the the Decoder&#x27;s next (cell, state) values</span><br>    <span class="hljs-comment">#               as well as the new combined output o_t.</span><br>    <span class="hljs-comment">#             - Append o_t to combined_outputs</span><br>    <span class="hljs-comment">#             - Update o_prev to the new o_t.</span><br>    <span class="hljs-comment">#     4. Use torch.stack to convert combined_outputs from a list length tgt_len of</span><br>    <span class="hljs-comment">#         tensors shape (b, h), to a single tensor shape (tgt_len, b, h)</span><br>    <span class="hljs-comment">#         where tgt_len = maximum target sentence length, b = batch size, h = hidden size.</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Note:</span><br>    <span class="hljs-comment">#    - When using the squeeze() function make sure to specify the dimension you want to squeeze</span><br>    <span class="hljs-comment">#      over. Otherwise, you will remove the batch dimension accidentally, if batch_size = 1.</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Use the following docs to implement this functionality:</span><br>    <span class="hljs-comment">#     Zeros Tensor:</span><br>    <span class="hljs-comment">#         https://pytorch.org/docs/stable/torch.html#torch.zeros</span><br>    <span class="hljs-comment">#     Tensor Splitting (iteration):</span><br>    <span class="hljs-comment">#         https://pytorch.org/docs/stable/torch.html#torch.split</span><br>    <span class="hljs-comment">#     Tensor Dimension Squeezing:</span><br>    <span class="hljs-comment">#         https://pytorch.org/docs/stable/torch.html#torch.squeeze</span><br>    <span class="hljs-comment">#     Tensor Concatenation:</span><br>    <span class="hljs-comment">#         https://pytorch.org/docs/stable/torch.html#torch.cat</span><br>    <span class="hljs-comment">#     Tensor Stacking:</span><br>    <span class="hljs-comment">#         https://pytorch.org/docs/stable/torch.html#torch.stack</span><br><br>    <span class="hljs-comment"># 1,</span><br>    enc_hiddens_proj = self.att_projection(enc_hiddens) <span class="hljs-comment"># enc_hiddens: (b, l, h * 2)  dot (h * 2, h) -&gt; b, l, h</span><br>    <span class="hljs-comment"># 2,</span><br>    Y = self.model_embeddings.target(target_padded) <span class="hljs-comment"># (tgt_len, b, h)</span><br>    <span class="hljs-comment"># 3,</span><br>    <span class="hljs-keyword">for</span> Y_t <span class="hljs-keyword">in</span> torch.split(Y, <span class="hljs-number">1</span>, dim=<span class="hljs-number">0</span>):<br>        squeezed = torch.squeeze(Y_t) <span class="hljs-comment"># shape (b, e)</span><br>        Ybar_t = torch.cat((squeezed, o_prev), dim=<span class="hljs-number">1</span>) <span class="hljs-comment"># shape (b, e + h)</span><br>        dec_state, o_t, _ = self.step(Ybar_t, dec_state, enc_hiddens, enc_hiddens_proj, enc_masks)<br>        combined_outputs.append(o_t)<br>        o_prev = o_t<br>    <span class="hljs-comment"># 4,</span><br>    combined_outputs = torch.stack(combined_outputs, dim=<span class="hljs-number">0</span>)<br>    <span class="hljs-comment"># END YOUR CODE</span><br><br>    <span class="hljs-keyword">return</span> combined_outputs<br></code></pre></div></td></tr></table></figure><h3 id="f-step">(f) step</h3><p>Implement the <code>step</code> function in nmt model.py. Thisfunction applies the Decoder‚Äôs LSTM cell for a single timestep,computing the encoding of the target word h dec t , the attention scoreset, attention distribution Œ±t, the attention output at, and finally thecombined output ot. You can run a non-comprehensive sanity check byexecuting:<code>python sanity_check.py 1f</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">self, Ybar_t: torch.Tensor,</span><br><span class="hljs-params">        dec_state: <span class="hljs-type">Tuple</span>[torch.Tensor, torch.Tensor],</span><br><span class="hljs-params">        enc_hiddens: torch.Tensor,</span><br><span class="hljs-params">        enc_hiddens_proj: torch.Tensor,</span><br><span class="hljs-params">        enc_masks: torch.Tensor</span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-type">Tuple</span>, torch.Tensor, torch.Tensor]:<br>    <span class="hljs-string">&quot;&quot;&quot; Compute one forward step of the LSTM decoder, including the attention computation.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    @param Ybar_t (Tensor): Concatenated Tensor of [Y_t o_prev], with shape (b, e + h). The input for the decoder,</span><br><span class="hljs-string">                            where b = batch size, e = embedding size, h = hidden size.</span><br><span class="hljs-string">    @param dec_state (tuple(Tensor, Tensor)): Tuple of tensors both with shape (b, h), where b = batch size, h = hidden size.</span><br><span class="hljs-string">            First tensor is decoder&#x27;s prev hidden state, second tensor is decoder&#x27;s prev cell.</span><br><span class="hljs-string">    @param enc_hiddens (Tensor): Encoder hidden states Tensor, with shape (b, src_len, h * 2), where b = batch size,</span><br><span class="hljs-string">                                src_len = maximum source length, h = hidden size.</span><br><span class="hljs-string">    @param enc_hiddens_proj (Tensor): Encoder hidden states Tensor, projected from (h * 2) to h. Tensor is with shape (b, src_len, h),</span><br><span class="hljs-string">                                where b = batch size, src_len = maximum source length, h = hidden size.</span><br><span class="hljs-string">    @param enc_masks (Tensor): Tensor of sentence masks shape (b, src_len),</span><br><span class="hljs-string">                                where b = batch size, src_len is maximum source length. </span><br><span class="hljs-string"></span><br><span class="hljs-string">    @returns dec_state (tuple (Tensor, Tensor)): Tuple of tensors both shape (b, h), where b = batch size, h = hidden size.</span><br><span class="hljs-string">            First tensor is decoder&#x27;s new hidden state, second tensor is decoder&#x27;s new cell.</span><br><span class="hljs-string">    @returns combined_output (Tensor): Combined output Tensor at timestep t, shape (b, h), where b = batch size, h = hidden size.</span><br><span class="hljs-string">    @returns e_t (Tensor): Tensor of shape (b, src_len). It is attention scores distribution.</span><br><span class="hljs-string">                            Note: You will not use this outside of this function.</span><br><span class="hljs-string">                                  We are simply returning this value so that we can sanity check</span><br><span class="hljs-string">                                  your implementation.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    combined_output = <span class="hljs-literal">None</span><br><br>    <span class="hljs-comment"># YOUR CODE HERE (~3 Lines)</span><br>    <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span></span><br>    <span class="hljs-comment">#     1. Apply the decoder to `Ybar_t` and `dec_state`to obtain the new dec_state.</span><br>    <span class="hljs-comment">#     2. Split dec_state into its two parts (dec_hidden, dec_cell)</span><br>    <span class="hljs-comment">#     3. Compute the attention scores e_t, a Tensor shape (b, src_len).</span><br>    <span class="hljs-comment">#        Note: b = batch_size, src_len = maximum source length, h = hidden size.</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment">#       Hints:</span><br>    <span class="hljs-comment">#         - dec_hidden is shape (b, h) and corresponds to h^dec_t in the PDF (batched)</span><br>    <span class="hljs-comment">#         - enc_hiddens_proj is shape (b, src_len, h) and corresponds to W_&#123;attProj&#125; h^enc (batched).</span><br>    <span class="hljs-comment">#         - Use batched matrix multiplication (torch.bmm) to compute e_t.</span><br>    <span class="hljs-comment">#         - To get the tensors into the right shapes for bmm, you will need to do some squeezing and unsqueezing.</span><br>    <span class="hljs-comment">#         - When using the squeeze() function make sure to specify the dimension you want to squeeze</span><br>    <span class="hljs-comment">#             over. Otherwise, you will remove the batch dimension accidentally, if batch_size = 1.</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Use the following docs to implement this functionality:</span><br>    <span class="hljs-comment">#     Batch Multiplication:</span><br>    <span class="hljs-comment">#        https://pytorch.org/docs/stable/torch.html#torch.bmm</span><br>    <span class="hljs-comment">#     Tensor Unsqueeze:</span><br>    <span class="hljs-comment">#         https://pytorch.org/docs/stable/torch.html#torch.unsqueeze</span><br>    <span class="hljs-comment">#     Tensor Squeeze:</span><br>    <span class="hljs-comment">#         https://pytorch.org/docs/stable/torch.html#torch.squeeze</span><br><br>    <span class="hljs-comment"># 1,</span><br>    dec_state = self.decoder(Ybar_t, dec_state)<br>    (dec_hidden, dec_cell) = dec_state<br>    <span class="hljs-comment"># 3, (b, src_len, h) .dot(b, h, 1) -&gt; (b, src_len, 1) -&gt; (b, src_len)</span><br>    e_t = enc_hiddens_proj.bmm(dec_hidden.unsqueeze(<span class="hljs-number">2</span>)).squeeze(<span class="hljs-number">2</span>)<br>    <span class="hljs-comment">### END YOUR CODE</span><br><br>    <span class="hljs-comment"># Set e_t to -inf where enc_masks has 1</span><br>    <span class="hljs-keyword">if</span> enc_masks <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        e_t.data.masked_fill_(enc_masks.byte(), -<span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)) <span class="hljs-comment"># mask the 0s with -inf, so e^x = 0</span><br><br>    <span class="hljs-comment"># YOUR CODE HERE (~6 Lines)</span><br>    <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span></span><br>    <span class="hljs-comment">#     1. Apply softmax to e_t to yield alpha_t</span><br>    <span class="hljs-comment">#     2. Use batched matrix multiplication between alpha_t and enc_hiddens to obtain the</span><br>    <span class="hljs-comment">#         attention output vector, a_t.</span><br>    <span class="hljs-comment">#     Hints:</span><br>    <span class="hljs-comment">#           - alpha_t is shape (b, src_len)</span><br>    <span class="hljs-comment">#           - enc_hiddens is shape (b, src_len, 2h)</span><br>    <span class="hljs-comment">#           - a_t should be shape (b, 2h)</span><br>    <span class="hljs-comment">#           - You will need to do some squeezing and unsqueezing.</span><br>    <span class="hljs-comment">#     Note: b = batch size, src_len = maximum source length, h = hidden size.</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment">#     3. Concatenate dec_hidden with a_t to compute tensor U_t</span><br>    <span class="hljs-comment">#     4. Apply the combined output projection layer to U_t to compute tensor V_t</span><br>    <span class="hljs-comment">#     5. Compute tensor O_t by first applying the Tanh function and then the dropout layer.</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Use the following docs to implement this functionality:</span><br>    <span class="hljs-comment">#     Softmax:</span><br>    <span class="hljs-comment">#         https://pytorch.org/docs/stable/nn.html#torch.nn.functional.softmax</span><br>    <span class="hljs-comment">#     Batch Multiplication:</span><br>    <span class="hljs-comment">#        https://pytorch.org/docs/stable/torch.html#torch.bmm</span><br>    <span class="hljs-comment">#     Tensor View:</span><br>    <span class="hljs-comment">#         https://pytorch.org/docs/stable/tensors.html#torch.Tensor.view</span><br>    <span class="hljs-comment">#     Tensor Concatenation:</span><br>    <span class="hljs-comment">#         https://pytorch.org/docs/stable/torch.html#torch.cat</span><br>    <span class="hljs-comment">#     Tanh:</span><br>    <span class="hljs-comment">#         https://pytorch.org/docs/stable/torch.html#torch.tanh</span><br><br>    <span class="hljs-comment"># 1, apply softmax to e_t</span><br>    alpha_t = F.softmax(e_t, dim=<span class="hljs-number">1</span>) <span class="hljs-comment"># (b, src_len)</span><br>    <span class="hljs-comment"># 2, (b, 1, src_len) x (b, src_len, 2h) = (b, 1, 2h) -&gt; (b, 2h)</span><br>    <span class="hljs-comment"># a_t = e_t.unsqueeze(1).bmm(enc_hiddens).squeeze(1)</span><br>    att_view = (alpha_t.size(<span class="hljs-number">0</span>), <span class="hljs-number">1</span>, alpha_t.size(<span class="hljs-number">1</span>))<br>    a_t = torch.bmm(alpha_t.view(*att_view), enc_hiddens).squeeze(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-comment"># 3, concate a_t (b, 2h) and dec_hidden (b, h) to U_t (b, 3h)</span><br>    U_t = torch.cat((a_t, dec_hidden), dim=<span class="hljs-number">1</span>)<br>    <span class="hljs-comment"># 4, apply combined output to U_T -&gt; V_t, shape (b, h)</span><br>    V_t = self.combined_output_projection(U_t)<br>    O_t = self.dropout(torch.tanh(V_t))<br><br>    <span class="hljs-comment"># END YOUR CODE</span><br><br>    combined_output = O_t<br>    <span class="hljs-keyword">return</span> dec_state, combined_output, e_t<br></code></pre></div></td></tr></table></figure><h3 id="g-generate_sent_masks">(g) generate_sent_masks</h3><p>The generate sent masks() function in nmt model.py produces a tensorcalled enc masks. It has shape (batch size, max source sentence length)and contains 1s in positions corresponding to ‚Äòpad‚Äô tokens in the input,and 0s for non-pad tokens. Look at how the masks are used during theattention computation in the step() function (lines 295-296). Firstexplain (in around three sentences) what effect the masks have on theentire attention computation. Then explain (in one or two sentences) whyit is necessary to use the masks in this way.</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_sent_masks</span>(<span class="hljs-params">self, enc_hiddens: torch.Tensor, source_lengths: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; torch.Tensor:<br>    <span class="hljs-string">&quot;&quot;&quot; Generate sentence masks for encoder hidden states.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    @param enc_hiddens (Tensor): encodings of shape (b, src_len, 2*h), where b = batch size,</span><br><span class="hljs-string">                                 src_len = max source length, h = hidden size. </span><br><span class="hljs-string">    @param source_lengths (List[int]): List of actual lengths for each of the sentences in the batch.</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    @returns enc_masks (Tensor): Tensor of sentence masks of shape (b, src_len),</span><br><span class="hljs-string">                                where src_len = max source length, h = hidden size.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    enc_masks = torch.zeros(enc_hiddens.size(<span class="hljs-number">0</span>), enc_hiddens.size(<span class="hljs-number">1</span>), dtype=torch.<span class="hljs-built_in">float</span>)<br>    <span class="hljs-keyword">for</span> e_id, src_len <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(source_lengths):<br>        enc_masks[e_id, src_len:] = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> enc_masks.to(self.device)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Á¨¨ÂÖ´ËÆ≤-Êú∫Âô®ÁøªËØë„ÄÅseq2seq‰∏éÊ≥®ÊÑèÂäõÊú∫Âà∂</title>
    <link href="/2022/05/14/%E7%AC%AC%E5%85%AB%E8%AE%B2-%E6%9C%BA%E5%99%A8%E7%BF%BB%E8%AF%91%E3%80%81seq2seq%E4%B8%8E%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/"/>
    <url>/2022/05/14/%E7%AC%AC%E5%85%AB%E8%AE%B2-%E6%9C%BA%E5%99%A8%E7%BF%BB%E8%AF%91%E3%80%81seq2seq%E4%B8%8E%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="Êú∫Âô®ÁøªËØë‰∏ésmtÁªüËÆ°Êú∫Âô®ÁøªËØë">1.Êú∫Âô®ÁøªËØë‰∏éSMTÔºàÁªüËÆ°Êú∫Âô®ÁøªËØëÔºâ</h1><h2 id="Êú∫Âô®ÁøªËØë">1.1 Êú∫Âô®ÁøªËØë</h2><p>Êú∫Âô®ÁøªËØë(MT)ÊòØÂ∞Ü‰∏Ä‰∏™Âè•Â≠ê<spanclass="math inline">\(x\)</span>‰ªé‰∏ÄÁßçËØ≠Ë®Ä(<strong>Ê∫êËØ≠Ë®Ä</strong>)ËΩ¨Êç¢‰∏∫Âè¶‰∏ÄÁßçËØ≠Ë®Ä(<strong>ÁõÆÊ†áËØ≠Ë®Ä</strong>)ÁöÑÂè•Â≠ê<spanclass="math inline">\(y\)</span>ÁöÑ‰ªªÂä°„ÄÇ</p><h2 id="sÊó©ÊúüÊú∫Âô®ÁøªËØë">1.2 1950sÔºöÊó©ÊúüÊú∫Âô®ÁøªËØë</h2><p>Êú∫Âô®ÁøªËØëÁ†îÁ©∂Âßã‰∫é20‰∏ñÁ∫™50Âπ¥‰ª£Âàù„ÄÇ</p><ul><li>‰øÑËØ≠ ‚Üí Ëã±ËØ≠(ÂÜ∑ÊàòÁöÑÊé®Âä®)</li><li>Á≥ªÁªü‰∏ªË¶ÅÊòØ<strong>Âü∫‰∫éËßÑÂàô</strong>ÁöÑÔºå‰ΩøÁî®ÂèåËØ≠ËØçÂÖ∏Êù•ËÆ≤‰øÑËØ≠ÂçïËØçÊò†Â∞Ñ‰∏∫ÂØπÂ∫îÁöÑËã±ËØ≠ÈÉ®ÂàÜ</li></ul><h2 id="s-2010sÁªüËÆ°Êú∫Âô®ÁøªËØë">1.3 1990s-2010sÔºöÁªüËÆ°Êú∫Âô®ÁøªËØë</h2><p><strong>Ê†∏ÂøÉÊÉ≥Ê≥ï</strong>Ôºö‰ªé<strong>Êï∞ÊçÆ</strong>‰∏≠Â≠¶‰π†<strong>Ê¶ÇÁéáÊ®°Âûã</strong></p><p>ÂÅáËÆæÊàë‰ª¨Ê≠£Âú®ÁøªËØëÊ≥ïËØ≠ ‚Üí Ëã±ËØ≠ÔºåÂØπ‰∫éÁªôÂÆöÊ≥ïËØ≠Âè•Â≠ê<spanclass="math inline">\(x\)</span>ÔºåÊàë‰ª¨ÊÉ≥Ë¶ÅÊâæÂà∞<strong>ÊúÄÂ•ΩÁöÑËã±ËØ≠Âè•Â≠ê</strong><spanclass="math inline">\(y\  argmax_yP(y|x)\)</span>Ôºå‰ΩøÁî®BayesËßÑÂàôÂ∞ÜÂÖ∂ÂàÜËß£‰∏∫<strong>‰∏§‰∏™ÁªÑ‰ª∂</strong>‰ªéËÄåÂàÜÂà´Â≠¶‰π†<span class="math display">\[argmaxx_yP(x|y)P(y)\]</span></p><ul><li><span class="math inline">\(P(x|y)\)</span>Ôºö<strong>TranslationModel / ÁøªËØëÊ®°Âûã</strong><ul><li>ÂàÜÊûêÂçïËØçÂíåÁü≠ËØ≠Â∫îËØ•Â¶Ç‰ΩïÁøªËØë(ÈÄºÁúü)</li><li>‰ªéÂπ∂Ë°åÊï∞ÊçÆ‰∏≠Â≠¶‰π†</li></ul></li><li><span class="math inline">\(P(y)\)</span>Ôºö<strong>Language Model /ËØ≠Ë®ÄÊ®°Âûã</strong><ul><li>Ê®°ÂûãÂ¶Ç‰ΩïÂÜôÂá∫Â•ΩËã±ËØ≠(ÊµÅÂà©)</li><li>‰ªéÂçïËØ≠Êï∞ÊçÆ‰∏≠Â≠¶‰π†</li></ul></li></ul><h2 id="s-2010sÁªüËÆ°Êú∫Âô®ÁøªËØë-1">1.4 1990s-2010sÔºöÁªüËÆ°Êú∫Âô®ÁøªËØë</h2><p><strong>ÈóÆÈ¢ò</strong>ÔºöÂ¶Ç‰ΩïÂ≠¶‰π†ÁøªËØëÊ®°Âûã<spanclass="math inline">\(P(x|y)\)</span>Ôºü</p><p>È¶ñÂÖàÔºåÈúÄË¶ÅÂ§ßÈáèÁöÑ<strong>Âπ∂Ë°åÊï∞ÊçÆ</strong>(‰æãÂ¶ÇÊàêÂØπÁöÑ‰∫∫Â∑•ÁøªËØëÁöÑÊ≥ïËØ≠/Ëã±ËØ≠Âè•Â≠ê)</p><h2 id="smtÁöÑÂ≠¶‰π†ÂØπÈΩê">1.5SMTÁöÑÂ≠¶‰π†ÂØπÈΩê</h2><p><strong>ÈóÆÈ¢ò</strong>ÔºöÂ¶Ç‰Ωï‰ªéÂπ∂Ë°åËØ≠ÊñôÂ∫ì‰∏≠Â≠¶‰π†ÁøªËØëÊ®°Âûã<spanclass="math inline">\(P(x|y)\)</span>Ôºü</p><p>Ëøõ‰∏ÄÊ≠•ÂàÜËß£ÔºöÊàë‰ª¨ÂÆûÈôÖ‰∏äÊÉ≥Ë¶ÅËÄÉËôë</p><p><span class="math display">\[P(x,a|y)\]</span></p><ul><li><span class="math inline">\(a\)</span>ÊòØÂØπÈΩê</li><li>Âç≥Ê≥ïËØ≠Âè•Â≠ê<span class="math inline">\(x\)</span>ÂíåËã±ËØ≠Âè•Â≠ê<spanclass="math inline">\(y\)</span>‰πãÈó¥ÁöÑÂçïËØçÁ∫ßÂØπÂ∫î</li></ul><h2 id="ÂØπÈΩê">1.6 ÂØπÈΩê</h2><p>ÂØπÈΩêÊòØÁøªËØëÂè•Â≠ê‰∏≠ÁâπÂÆöËØçËØ≠‰πãÈó¥ÁöÑÂØπÂ∫îÂÖ≥Á≥ª</p><ul><li>Ê≥®ÊÑèÔºöÊúâ‰∫õËØçÊ≤°ÊúâÂØπÂ∫îËØç</li></ul><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/1.png" /></p><h2 id="ÂØπÈΩêÊòØÂ§çÊùÇÁöÑ">1.7 ÂØπÈΩêÊòØÂ§çÊùÇÁöÑ</h2><p>ÂØπÈΩêÂèØ‰ª•ÊòØÂ§öÂØπ‰∏ÄÁöÑ</p><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/2.png" /></p><p>ÂØπÈΩêÂèØ‰ª•ÊòØ‰∏ÄÂØπÂ§öÁöÑ</p><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/3.png" /></p><p>Êúâ‰∫õËØçÂæà‰∏∞ÂØå</p><p>ÂØπÈΩêÂèØ‰ª•ÊòØ<strong>Â§öÂØπÂ§ö</strong>(Áü≠ËØ≠Á∫ß)</p><p>Êàë‰ª¨Â≠¶‰π†ÂæàÂ§öÂõ†Á¥†ÁöÑÁªÑÂêàÔºåÂåÖÊã¨</p><ul><li>ÁâπÂÆöÂçïËØçÂØπÈΩêÁöÑÊ¶ÇÁéá(‰πüÂèñÂÜ≥‰∫éÂèëÈÄÅ‰ΩçÁΩÆ)</li><li>ÁâπÂÆöÂçïËØçÂÖ∑ÊúâÁâπÂÆöÂ§öËØçÂØπÂ∫îÁöÑÊ¶ÇÁéá(ÂØπÂ∫îÂçïËØçÁöÑÊï∞Èáè)</li></ul><h2 id="smtÁöÑÂ≠¶‰π†ÂØπÈΩê-1">1.8 SMTÁöÑÂ≠¶‰π†ÂØπÈΩê</h2><ul><li>ÈóÆÈ¢òÔºöÂ¶Ç‰ΩïËÆ°ÁÆóargmax<ul><li>Êàë‰ª¨ÂèØ‰ª•Âàó‰∏æÊâÄÊúâÂèØËÉΩÁöÑ<spanclass="math inline">\(y\)</span>Âπ∂ËÆ°ÁÆóÊ¶ÇÁéáÔºü‚Üí ËÆ°ÁÆóÊàêÊú¨Â§™È´ò</li></ul></li><li>ÂõûÁ≠îÔºö‰ΩøÁî®ÂêØÂèëÂºèÊêúÁ¥¢ÁÆóÊ≥ïÊêúÁ¥¢ÊúÄ‰Ω≥ÁøªËØëÔºå‰∏¢ÂºÉÊ¶ÇÁéáËøá‰ΩéÁöÑÂÅáËÆæ<ul><li>Ëøô‰∏™ËøáÁ®ãÁß∞‰∏∫<strong>Ëß£Á†Å</strong></li></ul></li></ul><h2 id="smtËß£Á†Å">1.9 SMTËß£Á†Å</h2><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/4.png" /></p><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/5.png" /></p><h2 id="s-2010sÁªüËÆ°Êú∫Âô®ÁøªËØë-2">1.10 1990s-2010sÔºöÁªüËÆ°Êú∫Âô®ÁøªËØë</h2><p>SMTÊòØ‰∏Ä‰∏™<strong>Â∑®Â§ßÁöÑÁ†îÁ©∂È¢ÜÂüü</strong></p><p>ÊúÄÂ•ΩÁöÑÁ≥ªÁªüÈùûÂ∏∏Â§çÊùÇ</p><ul><li>Êï∞‰ª•ÁôæËÆ°ÁöÑÈáçË¶ÅÁªÜËäÇÊàë‰ª¨ËøòÊ≤°ÊúâÊèêÂà∞</li><li>Á≥ªÁªüÊúâËÆ∏Â§ö<strong>Áã¨Á´ãËÆæËÆ°Â≠êÁªÑ‰ª∂Â∑•Á®ã</strong></li><li>Â§ßÈáèÁâπÂæÅÂ∑•Á®ã<ul><li>ÂæàÂ§öÂäüËÉΩÈúÄË¶ÅËÆæËÆ°ÁâπÊÄßÊù•Ëé∑ÂèñÁâπÂÆöÁöÑËØ≠Ë®ÄÁé∞Ë±°</li></ul></li><li>ÈúÄË¶ÅÁºñËØëÂíåÁª¥Êä§È¢ùÂ§ñÁöÑËµÑÊ∫ê<ul><li>ÊØîÂ¶ÇÂèåËØ≠Áü≠ËØ≠ÂØπÂ∫îË°®</li></ul></li><li>ÈúÄË¶ÅÂ§ßÈáèÁöÑ‰∫∫ÂäõÊù•Áª¥Êä§<ul><li>ÂØπ‰∫éÊØè‰∏ÄÂØπËØ≠Ë®ÄÈÉΩÈúÄË¶ÅÈáçÂ§çÊìç‰Ωú</li></ul></li></ul><h1 id="Á•ûÁªèÁΩëÁªúÊú∫Âô®ÁøªËØë">2.Á•ûÁªèÁΩëÁªúÊú∫Âô®ÁøªËØë</h1><h2 id="Á•ûÁªèÊú∫Âô®ÁøªËØëneural-machine-translationnmt">2.1Á•ûÁªèÊú∫Âô®ÁøªËØëNeural Machine Translation(NMT)</h2><p><strong>Á•ûÁªèÊú∫Âô®ÁøªËØë</strong>(NMT)ÊòØÂà©Áî®Âçï‰∏™Á•ûÁªèÁΩëÁªúËøõË°åÊú∫Âô®ÁøªËØëÁöÑ‰∏ÄÁßçÊñπÊ≥ï</p><p>Á•ûÁªèÁΩëÁªúÊû∂ÊûÑÁß∞‰∏∫ <strong>sequence-to-sequence</strong>(ÂèàÂêçseq2seq)ÔºåÂÆÉÂåÖÂê´‰∏§‰∏™RNNs</p><ul><li>ÁºñÁ†ÅÂô®RNNÁîüÊàêÊ∫êËØ≠Âè•ÁöÑÁºñÁ†Å</li><li>Ê∫êËØ≠Âè•ÁöÑÁºñÁ†Å‰∏∫Ëß£Á†ÅÂô®RNNÊèê‰æõÂàùÂßãÈöêËóèÁä∂ÊÄÅ</li><li>Ëß£Á†ÅÂô®RNNÊòØ‰∏ÄÁßç‰ª•ÁºñÁ†Å‰∏∫Êù°‰ª∂ÁîüÊàêÁõÆÊ†áÂè•ÁöÑËØ≠Ë®ÄÊ®°Âûã</li><li><strong>Ê≥®ÊÑè</strong>ÔºöÊ≠§ÂõæÊòæÁ§∫‰∫ÜÊµãËØïÊó∂Ë°å‰∏∫ ‚ÜíËß£Á†ÅÂô®ËæìÂá∫‰Ωú‰∏∫‰∏ã‰∏ÄÊ≠•ÁöÑËæìÂÖ•</li></ul><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/6.png" /></p><h2 id="sequence-to-sequenceÊòØÂ§öÂäüËÉΩÁöÑ">2.2Sequence-to-sequenceÊòØÂ§öÂäüËÉΩÁöÑÔºÅ</h2><p>Â∫èÂàóÂà∞Â∫èÂàó‰∏ç‰ªÖ‰ªÖÂØπÊú∫Âô®ÁøªËØëÊúâÁî®</p><p>ËÆ∏Â§öNLP‰ªªÂä°ÂèØ‰ª•ÊåâÁÖßÈ°∫Â∫èËøõË°åË°®Ëææ</p><ul><li><strong>ÊëòË¶Å</strong>(ÈïøÊñáÊú¨ ‚Üí Áü≠ÊñáÊú¨)</li><li><strong>ÂØπËØù</strong>(Ââç‰∏ÄÂè•ËØù ‚Üí ‰∏ã‰∏ÄÂè•ËØù)</li><li><strong>Ëß£Êûê</strong>(ËæìÂÖ•ÊñáÊú¨ ‚Üí ËæìÂá∫Ëß£Êûê‰∏∫Â∫èÂàó)</li><li><strong>‰ª£Á†ÅÁîüÊàê</strong>(Ëá™ÁÑ∂ËØ≠Ë®Ä ‚Üí Python‰ª£Á†Å)</li></ul><h2 id="Á•ûÁªèÊú∫Âô®ÁøªËØënmt">2.3 Á•ûÁªèÊú∫Âô®ÁøªËØë(NMT)</h2><p><strong>sequence-to-sequence</strong>Ê®°ÂûãÊòØÊù°‰ª∂ËØ≠Ë®ÄÊ®°ÂûãÁöÑ‰∏Ä‰∏™‰æãÂ≠ê</p><ul><li>ËØ≠Ë®ÄÊ®°Âûã(Language Model)ÔºåÂõ†‰∏∫Ëß£Á†ÅÂô®Ê≠£Âú®È¢ÑÊµãÁõÆÊ†áÂè•ÁöÑ‰∏ã‰∏Ä‰∏™ÂçïËØç<spanclass="math inline">\(y\)</span></li><li>Êù°‰ª∂Á∫¶ÊùüÁöÑ(Conditional)ÔºåÂõ†‰∏∫È¢ÑÊµã‰πüÂèñÂÜ≥‰∫éÊ∫êÂè•<spanclass="math inline">\(x\)</span></li></ul><p>NMTÁõ¥Êé•ËÆ°ÁÆó<span class="math inline">\(P(y|x)\)</span>Ôºö <spanclass="math display">\[P(y \mid x)=P\left(y_{1} \mid x\right) P\left(y_{2} \mid y_{1}, x\right)P\left(y_{3} \mid y_{1}, y_{2}, x\right) \ldots P\left(y_{T} \mid y_{1},\ldots, y_{T-1}, x\right)\]</span></p><ul><li>‰∏äÂºè‰∏≠ÊúÄÂêé‰∏ÄÈ°π‰∏∫ÔºåÁªôÂÆöÂà∞ÁõÆÂâç‰∏∫Ê≠¢ÁöÑÁõÆÊ†áËØçÂíåÊ∫êÂè•<spanclass="math inline">\(x\)</span>Ôºå‰∏ã‰∏Ä‰∏™ÁõÆÊ†áËØçÁöÑÊ¶ÇÁéá</li></ul><p><strong>ÈóÆÈ¢ò</strong>ÔºöÂ¶Ç‰ΩïËÆ≠ÁªÉNMTÁ≥ªÁªüÔºü</p><p><strong>ÂõûÁ≠î</strong>ÔºöÊâæ‰∏Ä‰∏™Â§ßÁöÑÂπ≥Ë°åËØ≠ÊñôÂ∫ì</p><h2 id="ËÆ≠ÁªÉ‰∏Ä‰∏™Êú∫Âô®ÁøªËØëÁ≥ªÁªü">2.4 ËÆ≠ÁªÉ‰∏Ä‰∏™Êú∫Âô®ÁøªËØëÁ≥ªÁªü</h2><p>Seq2seqË¢´‰ºòÂåñ‰∏∫‰∏Ä‰∏™Âçï‰∏ÄÁöÑÁ≥ªÁªü„ÄÇÂèçÂêë‰º†Êí≠ËøêË°åÂú®‚ÄúÁ´ØÂà∞Á´Ø‚Äù‰∏≠</p><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/7.png" /></p><h1 id="Êú∫Âô®ÁøªËØëËß£Á†Å">3.Êú∫Âô®ÁøªËØëËß£Á†Å</h1><h2 id="Ë¥™Â©™Ëß£Á†Å">3.1 Ë¥™Â©™Ëß£Á†Å</h2><p>Êàë‰ª¨‰∫ÜËß£‰∫ÜÂ¶Ç‰ΩïÁîüÊàê(Êàñ‚ÄúËß£Á†Å‚Äù)ÁõÆÊ†áÂè•ÔºåÈÄöËøáÂØπËß£Á†ÅÂô®ÁöÑÊØè‰∏™Ê≠•È™§‰ΩøÁî®argmax</p><p>ËøôÊòØ<strong>Ë¥™Â©™Ëß£Á†Å</strong>(ÊØè‰∏ÄÊ≠•ÈÉΩÂèñÊúÄÂèØËÉΩÁöÑÂçïËØç)</p><p><strong>ËøôÁßçÊñπÊ≥ïÊúâÈóÆÈ¢òÂêó</strong>Ôºü</p><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/8.png" /></p><h2 id="Ë¥™Â©™Ëß£Á†ÅÁöÑÈóÆÈ¢ò">3.2 Ë¥™Â©™Ëß£Á†ÅÁöÑÈóÆÈ¢ò</h2><p>Ë¥™Â©™Ëß£Á†ÅÊ≤°ÊúâÂäûÊ≥ïÊí§ÈîÄÂÜ≥ÂÆö</p><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/9.png" /></p><p>Â¶Ç‰Ωï‰øÆÂ§çÔºü</p><h2 id="Á©∑‰∏æÊêúÁ¥¢Ëß£Á†Å">3.3 Á©∑‰∏æÊêúÁ¥¢Ëß£Á†Å</h2><p>ÁêÜÊÉ≥ÊÉÖÂÜµ‰∏ãÔºåÊàë‰ª¨ÊÉ≥Ë¶ÅÊâæÂà∞‰∏Ä‰∏™(ÈïøÂ∫¶‰∏∫<spanclass="math inline">\(T\)</span>)ÁöÑÁøªËØë<spanclass="math inline">\(y\)</span>‰ΩøÂÖ∂ÊúÄÂ§ßÂåñ <span class="math display">\[\begin{aligned}P(y \mid x) &amp;=P\left(y_{1} \mid x\right) P\left(y_{2} \mid y_{1},x\right) P\left(y_{3} \mid y_{1}, y_{2}, x\right) \ldots, P\left(y_{T}\mid y_{1}, \ldots, y_{T-1}, x\right) \\&amp;=\prod_{t=1}^{T} P\left(y_{t} \mid y_{1}, \ldots, y_{t-1}, x\right)\end{aligned}\]</span></p><p>Êàë‰ª¨ÂèØ‰ª•Â∞ùËØïËÆ°ÁÆóÊâÄÊúâÂèØËÉΩÁöÑÂ∫èÂàó - ËøôÊÑèÂë≥ÁùÄÂú®Ëß£Á†ÅÂô®ÁöÑÊØè‰∏ÄÊ≠•<spanclass="math inline">\(t\)</span>ÔºåÊàë‰ª¨Ë∑üË∏™<spanclass="math inline">\(V^t\)</span>‰∏™ÂèØËÉΩÁöÑÈÉ®ÂàÜÁøªËØëÔºåÂÖ∂‰∏≠<spanclass="math inline">\(V\)</span>ÊòØvocab Â§ßÂ∞è - ËøôÁßç<spanclass="math inline">\(O(V^t)\)</span>ÁöÑÂ§çÊùÇÊÄß<strong>Â§™ÊòÇË¥µ</strong>‰∫ÜÔºÅ</p><h2 id="ÈõÜÊùüÊêúÁ¥¢Ëß£Á†Å">3.4 ÈõÜÊùüÊêúÁ¥¢Ëß£Á†Å</h2><ul><li>Ê†∏ÂøÉÊÄùÊÉ≥ÔºöÂú®Ëß£Á†ÅÂô®ÁöÑÊØè‰∏ÄÊ≠•ÔºåË∑üË∏™‰∏™ÊúÄÂèØËÉΩÁöÑÈÉ®ÂàÜÁøªËØë(Êàë‰ª¨Áß∞‰πã‰∏∫ÂÅáËÆæ[hypotheses] )<ul><li><spanclass="math inline">\(k\)</span>ÊòØBeamÁöÑÂ§ßÂ∞è(ÂÆûÈôÖ‰∏≠Â§ßÁ∫¶ÊòØ5Âà∞10)</li></ul></li><li>ÂÅáËÆæ<spanclass="math inline">\(y_1,y_2,...,y_t\)</span>Êúâ‰∏Ä‰∏™<strong>ÂàÜÊï∞</strong>ÔºåÂç≥ÂÆÉÁöÑÂØπÊï∞Ê¶ÇÁéá</li></ul><p><span class="math display">\[\operatorname{score}\left(y_{1}, \ldots, y_{t}\right)=\logP_{\mathrm{LM}}\left(y_{1}, \ldots, y_{t} \mid x\right)=\sum_{i=1}^{t}\log P_{\mathrm{LM}}\left(y_{i} \mid y_{1}, \ldots, y_{i-1}, x\right)\]</span></p><ul><li><p>ÂàÜÊï∞ÈÉΩÊòØË¥üÊï∞ÔºåÂàÜÊï∞Ë∂äÈ´òË∂äÂ•Ω</p></li><li><p>Êàë‰ª¨ÂØªÊâæÂæóÂàÜËæÉÈ´òÁöÑÂÅáËÆæÔºåË∑üË∏™ÊØè‰∏ÄÊ≠•ÁöÑ top k ‰∏™ÈÉ®ÂàÜÁøªËØë</p></li><li><p>Ê≥¢ÊùüÊêúÁ¥¢ <strong>‰∏ç‰∏ÄÂÆöËÉΩ</strong> ÊâæÂà∞ÊúÄ‰ºòËß£</p></li><li><p>‰ΩÜÊØîÁ©∑‰∏æÊêúÁ¥¢<strong>ÊïàÁéáÈ´òÂæóÂ§ö</strong></p></li></ul><h2 id="ÈõÜÊùüÊêúÁ¥¢Ëß£Á†ÅÁ§∫‰æã">3.5 ÈõÜÊùüÊêúÁ¥¢Ëß£Á†ÅÔºöÁ§∫‰æã</h2><p>Beam size = k = 2ÔºåËìùËâ≤ÁöÑÊï∞Â≠óÊòØ <span class="math display">\[\operatorname{score}\left(y_{1}, \ldots, y_{t}\right)=\sum_{i=1}^{t}\log P_{\mathrm{LM}}\left(y_{i} \mid y_{1}, \ldots, y_{i-1}, x\right)\]</span> <img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/10.png" /></p><ul><li>ËÆ°ÁÆó‰∏ã‰∏Ä‰∏™ÂçïËØçÁöÑÊ¶ÇÁéáÂàÜÂ∏É</li><li>ÂèñÂâç‰∏™ÂçïËØçÂπ∂ËÆ°ÁÆóÂàÜÊï∞<ul><li>ÂØπ‰∫éÊØè‰∏ÄÊ¨°ÁöÑ<spanclass="math inline">\(k\)</span>‰∏™ÂÅáËÆæÔºåÊâæÂá∫ÊúÄÂâçÈù¢ÁöÑ<spanclass="math inline">\(k\)</span>‰∏™ÂçïËØçÂπ∂ËÆ°ÁÆóÂàÜÊï∞</li><li>Âú®ÁöÑÂÅáËÆæ‰∏≠Ôºå‰øùÁïô‰∏™ÊúÄÈ´òÁöÑÂàÜÂÄº<ul><li><span class="math inline">\(t=2\)</span>Êó∂Ôºå‰øùÁïôÂàÜÊï∞ÊúÄÈ´òÁöÑ<code>hit</code> Âíå <code>was</code></li><li><span class="math inline">\(t=3\)</span>Êó∂Ôºå‰øùÁïôÂàÜÊï∞ÊúÄÈ´òÁöÑ<code>a</code> Âíå <code>me</code></li><li><span class="math inline">\(t=4\)</span>Êó∂Ôºå‰øùÁïôÂàÜÊï∞ÊúÄÈ´òÁöÑ<code>pie</code> Âíå <code>with</code></li><li><span class="math inline">\(t=5\)</span>Êó∂Ôºå‰øùÁïôÂàÜÊï∞ÊúÄÈ´òÁöÑ<code>a</code> Âíå <code>one</code></li><li><span class="math inline">\(t=6\)</span>Êó∂Ôºå‰øùÁïôÂàÜÊï∞ÊúÄÈ´òÁöÑ<code>pie</code></li></ul></li></ul></li><li>ËøôÊòØÊúÄÈ´òÂæóÂàÜÁöÑÂÅáËÆæ</li><li>ÂõûÊ∫Ø‰ª•Ëé∑ÂæóÂÆåÊï¥ÁöÑÂÅáËÆæ</li></ul><h2 id="ÈõÜÊùüÊêúÁ¥¢Ëß£Á†ÅÂÅúÊ≠¢Âà§ÊçÆ">3.6 ÈõÜÊùüÊêúÁ¥¢Ëß£Á†ÅÔºöÂÅúÊ≠¢Âà§ÊçÆ</h2><ul><li>Âú®Ë¥™ÂøÉËß£Á†Å‰∏≠ÔºåÊàë‰ª¨ÈÄöÂ∏∏Ëß£Á†ÅÂà∞Ê®°Âûã‰∫ßÁîü‰∏Ä‰∏™‰ª§Áâå<ul><li>‰æãÂ¶ÇÔºö he hit me with a pie</li></ul></li><li>Âú®ÈõÜÊùüÊêúÁ¥¢Ëß£Á†Å‰∏≠Ôºå‰∏çÂêåÁöÑÂÅáËÆæÂèØËÉΩÂú®<strong>‰∏çÂêåÁöÑÊó∂Èó¥Ê≠•Èïø</strong>‰∏ä‰∫ßÁîü‰ª§Áâå<ul><li>ÂΩì‰∏Ä‰∏™ÂÅáËÆæÁîüÊàê‰∫Ü‰ª§ÁâåÔºåËØ•ÂÅáËÆæ<strong>ÂÆåÊàê</strong></li><li><strong>ÊääÂÆÉÊîæÂú®‰∏ÄËæπ</strong>ÔºåÈÄöËøá Beam SearchÁªßÁª≠Êé¢Á¥¢ÂÖ∂‰ªñÂÅáËÆæ</li></ul></li><li>ÈÄöÂ∏∏Êàë‰ª¨ÁªßÁª≠ËøõË°å Beam Search ÔºåÁõ¥Âà∞<ul><li>Êàë‰ª¨Âà∞ËææÊó∂Èó¥Ê≠•Èïø<span class="math inline">\(T\)</span>(ÂÖ∂‰∏≠<spanclass="math inline">\(T\)</span>ÊòØÈ¢ÑÂÆö‰πâÊà™Ê≠¢ÁÇπ)</li><li>Êàë‰ª¨Ëá≥Â∞ëÊúâ<spanclass="math inline">\(n\)</span>‰∏™Â∑≤ÂÆåÊàêÁöÑÂÅáËÆæ(ÂÖ∂‰∏≠<spanclass="math inline">\(n\)</span>ÊòØÈ¢ÑÂÆö‰πâÊà™Ê≠¢ÁÇπ)</li></ul></li></ul><h2 id="ÈõÜÊùüÊêúÁ¥¢Ëß£Á†ÅÂÆåÊàê">3.7 ÈõÜÊùüÊêúÁ¥¢Ëß£Á†ÅÔºöÂÆåÊàê</h2><p>Êàë‰ª¨ÊúâÂÆåÊï¥ÁöÑÂÅáËÆæÂàóË°®,Â¶Ç‰ΩïÈÄâÊã©ÂæóÂàÜÊúÄÈ´òÁöÑÔºü</p><p>Êàë‰ª¨Ê∏ÖÂçï‰∏äÁöÑÊØè‰∏™ÂÅáËÆæ<spanclass="math inline">\(y_1,...,y_t\)</span>ÈÉΩÊúâ‰∏Ä‰∏™ÂàÜÊï∞ <spanclass="math display">\[\operatorname{score}\left(y_{1}, \ldots, y_{t}\right)=\logP_{\mathrm{LM}}\left(y_{1}, \ldots, y_{t} \mid x\right)=\sum_{i=1}^{t}\log P_{\mathrm{LM}}\left(y_{i} \mid y_{1}, \ldots, y_{i-1}, x\right)\]</span> <strong>ÈóÆÈ¢òÂú®‰∫é</strong> ÔºöËæÉÈïøÁöÑÂÅáËÆæÂæóÂàÜËæÉ‰Ωé</p><p><strong>‰øÆÊ≠£</strong>ÔºöÊåâÈïøÂ∫¶Ê†áÂáÜÂåñ„ÄÇÁî®‰∏ãÂºèÊù•ÈÄâÊã©top one <spanclass="math display">\[\frac{1}{t} \sum_{i=1}^{t} \log P_{\mathrm{LM}}\left(y_{i} \mid y_{1},\ldots, y_{i-1}, x\right)\]</span></p><h2 id="Á•ûÁªèÊú∫Âô®ÁøªËØënmtÁöÑ‰ºòÁÇπ">3.8 Á•ûÁªèÊú∫Âô®ÁøªËØë(NMT)ÁöÑ‰ºòÁÇπ</h2><p>‰∏éSMTÁõ∏ÊØîÔºåNMTÊúâÂæàÂ§ö<strong>‰ºòÁÇπ</strong></p><p>Êõ¥Â•ΩÁöÑÊÄßËÉΩ</p><ul><li>Êõ¥ÊµÅÂà©</li><li>Êõ¥Â•ΩÂú∞‰ΩøÁî®‰∏ä‰∏ãÊñá</li><li>Êõ¥Â•ΩÂú∞‰ΩøÁî®Áü≠ËØ≠Áõ∏‰ººÊÄß</li></ul><p>Âçï‰∏™Á•ûÁªèÁΩëÁªúÁ´ØÂà∞Á´Ø‰ºòÂåñ</p><ul><li>Ê≤°ÊúâÂ≠êÁªÑ‰ª∂ÈúÄË¶ÅÂçïÁã¨‰ºòÂåñ</li></ul><p>ÈúÄË¶ÅÊõ¥Â∞ëÁöÑ‰∫∫Á±ªÂ∑•Á®ã‰ªòÂá∫</p><ul><li>Êó†ÁâπÂæÅÂ∑•Á®ã</li><li>ÊâÄÊúâËØ≠Ë®ÄÂØπÁöÑÊñπÊ≥ïÁõ∏Âêå</li></ul><h2 id="Á•ûÁªèÊú∫Âô®ÁøªËØënmtÁöÑÁº∫ÁÇπ">3.9 Á•ûÁªèÊú∫Âô®ÁøªËØë(NMT)ÁöÑÁº∫ÁÇπ</h2><p>SMTÁõ∏ÊØîÔºåNMTÁöÑ<strong>Áº∫ÁÇπ</strong></p><p>NMTÁöÑÂèØËß£ÈáäÊÄßËæÉÂ∑Æ</p><ul><li>Èöæ‰ª•Ë∞ÉËØï</li></ul><p>NMTÂæàÈöæÊéßÂà∂</p><ul><li>‰æãÂ¶ÇÔºå‰∏çËÉΩËΩªÊùæÊåáÂÆöÁøªËØëËßÑÂàôÊàñÊåáÂçó</li><li>ÂÆâÂÖ®ÈóÆÈ¢ò</li></ul><h1 id="Êú∫Âô®ÁøªËØëËØÑ‰º∞">4.Êú∫Âô®ÁøªËØëËØÑ‰º∞</h1><h2 id="Â¶Ç‰ΩïËØÑ‰º∞Êú∫Âô®ÁøªËØëË¥®Èáè">4.1 Â¶Ç‰ΩïËØÑ‰º∞Êú∫Âô®ÁøªËØëË¥®Èáè</h2><p>BLEU(Bilingual Evaluation Understudy)</p><ul><li>‰Ω†Â∞Ü‰ºöÂú® Assignment 4 ‰∏≠ÁúãÂà∞BLEUÁöÑÁªÜËäÇ</li></ul><p>BLEUÂ∞ÜÊú∫Âô®ÁøªËØëÂíå‰∫∫Â∑•ÁøªËØë(‰∏Ä‰∏™ÊàñÂ§ö‰∏™)ÔºåÂπ∂ËÆ°ÁÆó‰∏Ä‰∏™Áõ∏‰ººÁöÑÂàÜÊï∞</p><ul><li>n-gram Á≤æÂ∫¶ (nÈÄöÂ∏∏‰∏∫1-4)</li><li>ÂØπËøá‰∫éÁü≠ÁöÑÊú∫Âô®ÁøªËØëÁöÑÂä†‰∏äÊÉ©ÁΩö</li></ul><p>BLEUÂæàÊúâÁî®Ôºå‰ΩÜ‰∏çÂÆåÁæé</p><ul><li>ÊúâÂæàÂ§öÊúâÊïàÁöÑÊñπÊ≥ïÊù•ÁøªËØë‰∏Ä‰∏™Âè•Â≠ê</li><li>ÊâÄ‰ª•‰∏Ä‰∏™<strong>Â•ΩÁöÑ</strong>ÁøªËØëÂèØ‰ª•ÂæóÂà∞‰∏Ä‰∏™Á≥üÁ≥ïÁöÑBLEUscoreÔºåÂõ†‰∏∫ÂÆÉ‰∏é‰∫∫Â∑•ÁøªËØëÁöÑn-gramÈáçÂè†ËæÉ‰Ωé</li></ul><h2 id="Êú∫Âô®ÁøªËØëÈóÆÈ¢òÂÆåÁæéËß£ÂÜ≥‰∫ÜÂêó">4.2 Êú∫Âô®ÁøªËØëÈóÆÈ¢òÂÆåÁæéËß£ÂÜ≥‰∫ÜÂêóÔºü</h2><p>Ê≤°ÊúâÔºÅ</p><p>ËÆ∏Â§öÂõ∞Èöæ‰ªçÁÑ∂Â≠òÂú®</p><ul><li><strong>ËØçË°®Â§ñ</strong>ÁöÑÂçïËØçÂ§ÑÁêÜ</li><li>ËÆ≠ÁªÉÂíåÊµãËØïÊï∞ÊçÆ‰πãÈó¥ÁöÑ<strong>È¢ÜÂüü‰∏çÂåπÈÖç</strong></li><li>Âú®ËæÉÈïøÊñáÊú¨‰∏äÁª¥Êä§‰∏ä‰∏ãÊñá</li><li><strong>ËµÑÊ∫êËæÉ‰Ωé</strong>ÁöÑËØ≠Ë®ÄÂØπ</li></ul><p>‰ΩøÁî®Â∏∏ËØÜ‰ªçÁÑ∂ÂæàÈöæ</p><ul><li>NMTÂú®ËÆ≠ÁªÉÊï∞ÊçÆ‰∏≠ÂèëÁé∞ÂÅèÂ∑Æ</li><li>Êó†Ê≥ïËß£ÈáäÁöÑÁ≥ªÁªü‰ºöÂÅö‰∏Ä‰∫õÂ•áÊÄ™ÁöÑ‰∫ãÊÉÖ</li></ul><h1 id="Ê≥®ÊÑèÂäõÊú∫Âà∂">5.Ê≥®ÊÑèÂäõÊú∫Âà∂</h1><h2 id="sequence-to-sequenceÁì∂È¢àÈóÆÈ¢ò">5.1Sequence-to-sequenceÔºöÁì∂È¢àÈóÆÈ¢ò</h2><ul><li>Ê∫êËØ≠Âè•ÁöÑÁºñÁ†Å</li><li>ÈúÄË¶ÅÊçïËé∑ÂÖ≥‰∫éÊ∫êËØ≠Âè•ÁöÑÊâÄÊúâ‰ø°ÊÅØ</li><li>‰ø°ÊÅØÁì∂È¢àÔºÅ</li></ul><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/11.png" /></p><h2 id="Ê≥®ÊÑèÂäõ">5.2 Ê≥®ÊÑèÂäõ</h2><p><strong>Ê≥®ÊÑèÂäõ</strong>‰∏∫Áì∂È¢àÈóÆÈ¢òÊèê‰æõ‰∫Ü‰∏Ä‰∏™Ëß£ÂÜ≥ÊñπÊ°à</p><p><strong>Ê†∏ÂøÉÁêÜÂøµ</strong>ÔºöÂú®Ëß£Á†ÅÂô®ÁöÑÊØè‰∏ÄÊ≠•Ôºå‰ΩøÁî®‰∏é<strong>ÁºñÁ†ÅÂô®ÁöÑÁõ¥Êé•ËøûÊé•</strong>Êù•‰∏ìÊ≥®‰∫éÊ∫êÂ∫èÂàóÁöÑ<strong>ÁâπÂÆöÈÉ®ÂàÜ</strong></p><p>È¶ñÂÖàÊàë‰ª¨Â∞ÜÈÄöËøáÂõæË°®Â±ïÁ§∫(Ê≤°ÊúâÊñπÁ®ã)ÔºåÁÑ∂ÂêéÊàë‰ª¨Â∞ÜÁî®ÊñπÁ®ãÂ±ïÁ§∫</p><h2 id="Â∏¶Ê≥®ÊÑèÂäõÊú∫Âà∂ÁöÑÂ∫èÂàóÂà∞Â∫èÂàóÊ®°Âûã">5.3Â∏¶Ê≥®ÊÑèÂäõÊú∫Âà∂ÁöÑÂ∫èÂàóÂà∞Â∫èÂàóÊ®°Âûã</h2><ul><li>Â∞ÜËß£Á†ÅÂô®ÈÉ®ÂàÜÁöÑÁ¨¨‰∏Ä‰∏™token ‰∏éÊ∫êËØ≠Âè•‰∏≠ÁöÑÊØè‰∏Ä‰∏™Êó∂Èó¥Ê≠•ÁöÑÈöêËóèÁä∂ÊÄÅËøõË°å DotProduct ÂæóÂà∞ÊØè‰∏ÄÊó∂Èó¥Ê≠•ÁöÑÂàÜÊï∞</li></ul><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/15.png" /></p><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/16.png" /></p><ul><li>ÈÄöËøásoftmaxÂ∞ÜÂàÜÊï∞ËΩ¨Âåñ‰∏∫Ê¶ÇÁéáÂàÜÂ∏É</li><li>Âú®Ëøô‰∏™Ëß£Á†ÅÂô®Êó∂Èó¥Ê≠•Èïø‰∏äÔºåÊàë‰ª¨‰∏ªË¶ÅÂÖ≥Ê≥®Á¨¨‰∏Ä‰∏™ÁºñÁ†ÅÂô®ÈöêËóèÁä∂ÊÄÅ(‚Äúhe‚Äù)</li></ul><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/17.png" /></p><ul><li>Âà©Áî®<strong>Ê≥®ÊÑèÂäõÂàÜÂ∏É</strong>ÂØπÁºñÁ†ÅÂô®ÁöÑÈöêËóèÁä∂ÊÄÅËøõË°å<strong>Âä†ÊùÉÊ±ÇÂíå</strong></li><li>Ê≥®ÊÑèÂäõËæìÂá∫‰∏ªË¶ÅÂåÖÂê´Êù•Ëá™‰∫éÂèóÂà∞<strong>È´òÂ∫¶ÂÖ≥Ê≥®</strong>ÁöÑ<strong>ÈöêËóèÁä∂ÊÄÅ</strong>ÁöÑ‰ø°ÊÅØ</li></ul><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/18.png" /></p><p>ËøûÊé•ÁöÑ<strong>Ê≥®ÊÑèÂäõËæìÂá∫</strong>‰∏é<strong>Ëß£Á†ÅÂô®ÈöêËóèÁä∂ÊÄÅ</strong>ÔºåÁÑ∂ÂêéÁî®Êù•ËÆ°ÁÆó<span class="math inline">\(\hat{y_1}\)</span></p><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/19.png" /></p><p>ÊúâÊó∂ÔºåÊàë‰ª¨‰ªéÂâçÈù¢ÁöÑÊ≠•È™§‰∏≠ÊèêÂèñÊ≥®ÊÑèÂäõËæìÂá∫ÔºåÂπ∂Â∞ÜÂÖ∂ËæìÂÖ•Ëß£Á†ÅÂô®(ËøûÂêåÈÄöÂ∏∏ÁöÑËß£Á†ÅÂô®ËæìÂÖ•)„ÄÇÊàë‰ª¨Âú®‰Ωú‰∏ö4‰∏≠ÂÅöËøô‰∏™„ÄÇ</p><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/20.png" /></p><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/21.png" /></p><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/12.png" /></p><h2 id="Ê≥®ÊÑèÂäõÂÖ¨Âºè">5.4 Ê≥®ÊÑèÂäõÔºöÂÖ¨Âºè</h2><p>Êàë‰ª¨ÊúâÁºñÁ†ÅÂô®ÈöêËóèÁä∂ÊÄÅ<span class="math inline">\(h_{1}, \ldots, h_{N}\in \mathbb{R}^{h}\)</span></p><p>Âú®Êó∂Èó¥Ê≠•<spanclass="math inline">\(t\)</span>‰∏äÔºåÊàë‰ª¨ÊúâËß£Á†ÅÂô®ÈöêËóèÁä∂ÊÄÅ<spanclass="math inline">\(s_{t} \in \mathbb{R}^{h}\)</span></p><p>Êàë‰ª¨ÂæóÂà∞Ëøô‰∏ÄÊ≠•ÁöÑÊ≥®ÊÑèÂàÜÊï∞ <span class="math display">\[e^{t}=\left[s_{t}^{T} \boldsymbol{h}_{1}, \ldots, \boldsymbol{s}_{t}^{T}\boldsymbol{h}_{N}\right] \in \mathbb{R}^{N}\]</span> Êàë‰ª¨‰ΩøÁî®softmaxÂæóÂà∞Ëøô‰∏ÄÊ≠•ÁöÑÊ≥®ÊÑèÂàÜÂ∏É<spanclass="math inline">\(\alpha^t\)</span>(ËøôÊòØ‰∏Ä‰∏™Ê¶ÇÁéáÂàÜÂ∏ÉÔºåÂíå‰∏∫1) <spanclass="math display">\[\alpha^{t}=\operatorname{softmax}\left(e^{t}\right) \in \mathbb{R}^{N}\]</span> Êàë‰ª¨‰ΩøÁî®<spanclass="math inline">\(\alpha^t\)</span>Êù•Ëé∑ÂæóÁºñÁ†ÅÂô®ÈöêËóèÁä∂ÊÄÅÁöÑÂä†ÊùÉÂíåÔºåÂæóÂà∞Ê≥®ÊÑèÂäõËæìÂá∫<spanclass="math inline">\(\alpha^{t} \boldsymbol{a}_{t}=\sum_{i=1}^{N}\alpha_{i}^{t} \boldsymbol{h}_{i} \in \mathbb{R}^{h}\)</span></p><p>ÊúÄÂêéÔºåÊàë‰ª¨Â∞ÜÊ≥®ÊÑèËæìÂá∫<spanclass="math inline">\(\alpha^t\)</span>‰∏éËß£Á†ÅÂô®ÈöêËóèÁä∂ÊÄÅËøûÊé•Ëµ∑Êù•ÔºåÂπ∂ÊåâÁÖßÈùûÊ≥®ÊÑèseq2seq Ê®°ÂûãÁªßÁª≠ËøõË°å <span class="math display">\[\left[\boldsymbol{a}_{t} ; \boldsymbol{s}_{t}\right] \in \mathbb{R}^{2h}\]</span></p><h2 id="Ê≥®ÊÑèÂäõÂæàÊ£í">5.5 Ê≥®ÊÑèÂäõÂæàÊ£íÔºÅ</h2><p>Ê≥®ÊÑèÂäõÊòæËëóÊèêÈ´ò‰∫ÜNMTÊÄßËÉΩ</p><ul><li>ËøôÊòØÈùûÂ∏∏ÊúâÁî®ÁöÑÔºåËÆ©Ëß£Á†ÅÂô®‰∏ìÊ≥®‰∫éÊüê‰∫õÈÉ®ÂàÜÁöÑÊ∫êËØ≠Âè•</li></ul><p>Ê≥®ÊÑèÂäõËß£ÂÜ≥Áì∂È¢àÈóÆÈ¢ò</p><ul><li>Ê≥®ÊÑèÂäõÂÖÅËÆ∏Ëß£Á†ÅÂô®Áõ¥Êé•Êü•ÁúãÊ∫êËØ≠Âè•ÔºõÁªïËøáÁì∂È¢à</li></ul><p>Ê≥®ÊÑèÂäõÂ∏ÆÂä©Ê∂àÂ§±Ê¢ØÂ∫¶ÈóÆÈ¢ò</p><ul><li>Êèê‰æõ‰∫ÜÈÄöÂæÄÈÅ•ËøúÁä∂ÊÄÅÁöÑÊç∑ÂæÑ</li></ul><p>Ê≥®ÊÑèÂäõÊèê‰æõ‰∫Ü‰∏Ä‰∫õÂèØËß£ÈáäÊÄß</p><ul><li>ÈÄöËøáÊ£ÄÊü•Ê≥®ÊÑèÂäõÁöÑÂàÜÂ∏ÉÔºåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Ëß£Á†ÅÂô®Âú®ÂÖ≥Ê≥®‰ªÄ‰πà</li><li>Êàë‰ª¨ÂèØ‰ª•ÂÖçË¥πÂæóÂà∞(ËΩØ)ÂØπÈΩê</li><li>ËøôÂæàÈÖ∑ÔºåÂõ†‰∏∫Êàë‰ª¨‰ªéÊù•Ê≤°ÊúâÊòéÁ°ÆËÆ≠ÁªÉËøáÂØπÈΩêÁ≥ªÁªü</li><li>ÁΩëÁªúÂè™ÊòØËá™‰∏ªÂ≠¶‰π†‰∫ÜÂØπÈΩê</li></ul><h2 id="Ê≥®ÊÑèÂäõÊòØ‰∏ÄÁßçÊôÆÈÅçÁöÑÊ∑±Â∫¶Â≠¶‰π†ÊäÄÂ∑ß">5.6Ê≥®ÊÑèÂäõÊòØ‰∏ÄÁßçÊôÆÈÅçÁöÑÊ∑±Â∫¶Â≠¶‰π†ÊäÄÂ∑ß</h2><p>Êàë‰ª¨Â∑≤ÁªèÁúãÂà∞ÔºåÊ≥®ÊÑèÂäõÊòØÊîπËøõÊú∫Âô®ÁøªËØëÁöÑÂ∫èÂàóÂà∞Â∫èÂàóÊ®°ÂûãÁöÑ‰∏Ä‰∏™ÂæàÂ•ΩÁöÑÊñπÊ≥ï</p><p>ÁÑ∂ËÄåÔºö‰Ω†ÂèØ‰ª•Âú®<strong>ËÆ∏Â§öÁªìÊûÑ</strong>(‰∏ç‰ªÖ‰ªÖÊòØseq2seq)ÂíåËÆ∏Â§ö‰ªªÂä°(‰∏ç‰ªÖ‰ªÖÊòØMT)‰∏≠‰ΩøÁî®Ê≥®ÊÑèÂäõ</p><p>Êàë‰ª¨ÊúâÊó∂ËØ¥ <strong>query attends to the values</strong></p><p>‰æãÂ¶ÇÔºåÂú®seq2seq +attentionÊ®°Âûã‰∏≠ÔºåÊØè‰∏™Ëß£Á†ÅÂô®ÁöÑÈöêËóèÁä∂ÊÄÅ(Êü•ËØ¢)ÂÖ≥Ê≥®ÊâÄÊúâÁºñÁ†ÅÂô®ÁöÑÈöêËóèÁä∂ÊÄÅ(ÂÄº)</p><h2 id="Ê≥®ÊÑèÂäõÊòØ‰∏ÄÁßçÊôÆÈÅçÁöÑÊ∑±Â∫¶Â≠¶‰π†ÊäÄÂ∑ß-1">5.7Ê≥®ÊÑèÂäõÊòØ‰∏ÄÁßçÊôÆÈÅçÁöÑÊ∑±Â∫¶Â≠¶‰π†ÊäÄÂ∑ß</h2><p>Ê≥®ÊÑèÂäõÁöÑÊõ¥‰∏ÄËà¨ÂÆö‰πâ</p><ul><li>ÁªôÂÆö‰∏ÄÁªÑÂêëÈáè<strong>ÂÄº</strong>Âíå‰∏Ä‰∏™ÂêëÈáè<strong>Êü•ËØ¢</strong>ÔºåÊ≥®ÊÑèÂäõÊòØ‰∏ÄÁßçÊ†πÊçÆÊü•ËØ¢ÔºåËÆ°ÁÆóÂÄºÁöÑÂä†ÊùÉÂíåÁöÑÊäÄÊúØ</li></ul><p>Áõ¥Ëßâ</p><ul><li>Âä†ÊùÉÂíåÊòØÂÄº‰∏≠ÂåÖÂê´ÁöÑ‰ø°ÊÅØÁöÑ<strong>ÈÄâÊã©ÊÄßÊ±áÊÄª</strong>ÔºåÊü•ËØ¢Âú®ÂÖ∂‰∏≠Á°ÆÂÆöË¶ÅÂÖ≥Ê≥®Âì™‰∫õÂÄº</li><li>Ê≥®ÊÑèÊòØ‰∏ÄÁßçËé∑Âèñ<strong>‰ªªÊÑè‰∏ÄÁªÑË°®Á§∫(ÂÄº)ÁöÑÂõ∫ÂÆöÂ§ßÂ∞èË°®Á§∫ÁöÑÊñπÊ≥ï</strong>Ôºå‰æùËµñ‰∫éÂÖ∂‰ªñ‰∏Ä‰∫õË°®Á§∫(Êü•ËØ¢)„ÄÇ</li></ul><h2 id="ÊúâÂá†ÁßçÊ≥®ÊÑèÂäõÁöÑÂèò‰Ωì">5.8 ÊúâÂá†ÁßçÊ≥®ÊÑèÂäõÁöÑÂèò‰Ωì</h2><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/13.png" /></p><p><img src="/img/nlp/Á¨¨ÂÖ´ËÆ≤/14.png" /></p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Á¨¨‰∏ÉËÆ≤-Ê¢ØÂ∫¶Ê∂àÂ§±ÈóÆÈ¢ò‰∏éRNNÂèòÁßç</title>
    <link href="/2022/05/13/%E7%AC%AC%E4%B8%83%E8%AE%B2-%E6%A2%AF%E5%BA%A6%E6%B6%88%E5%A4%B1%E9%97%AE%E9%A2%98%E4%B8%8ERNN%E5%8F%98%E7%A7%8D/"/>
    <url>/2022/05/13/%E7%AC%AC%E4%B8%83%E8%AE%B2-%E6%A2%AF%E5%BA%A6%E6%B6%88%E5%A4%B1%E9%97%AE%E9%A2%98%E4%B8%8ERNN%E5%8F%98%E7%A7%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="Ê¢ØÂ∫¶Ê∂àÂ§±">1.Ê¢ØÂ∫¶Ê∂àÂ§±</h1><h2 id="Ê¢ØÂ∫¶Ê∂àÂ§±ÈóÆÈ¢ò">1.1 Ê¢ØÂ∫¶Ê∂àÂ§±ÈóÆÈ¢ò</h2><p>Ê¢ØÂ∫¶Ê∂àÂ§±ÈóÆÈ¢òÔºöÂΩìËøô‰∫õÊ¢ØÂ∫¶ÂæàÂ∞èÁöÑÊó∂ÂÄôÔºåÂèçÂêë‰º†Êí≠ÁöÑË∂äÊ∑±ÂÖ•ÔºåÊ¢ØÂ∫¶‰ø°Âè∑Â∞±‰ºöÂèòÂæóË∂äÊù•Ë∂äÂ∞è</p><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/1.png" /></p><h2 id="Ê¢ØÂ∫¶Ê∂àÂ§±ËØÅÊòéÁÆÄËø∞">1.2 Ê¢ØÂ∫¶Ê∂àÂ§±ËØÅÊòéÁÆÄËø∞</h2><p><span class="math display">\[\boldsymbol{h}^{(t)}=\sigma\left(\boldsymbol{W}_{h}\boldsymbol{h}^{(t-1)}+\boldsymbol{W}_{x}\boldsymbol{x}^{(t)}+\boldsymbol{b}_{1}\right)\]</span></p><p>Âõ†Ê≠§ÈÄöËøá<strong>ÈìæÂºèÊ≥ïÂàô</strong>ÂæóÂà∞Ôºö <span class="math display">\[\frac{\partial \boldsymbol{h}^{(t)}}{\partial\boldsymbol{h}^{(t-1)}}=\operatorname{diag}\left(\sigma^{\prime}\left(\boldsymbol{W}_{h}\boldsymbol{h}^{(t-1)}+\boldsymbol{W}_{x}\boldsymbol{x}^{(t)}+\boldsymbol{b}_{1}\right)\right) \boldsymbol{W}_{h}\]</span> ËÄÉËôëÁ¨¨<spanclass="math inline">\(i\)</span>Ê≠•‰∏äÁöÑÊçüÂ§±Ê¢ØÂ∫¶<spanclass="math inline">\(J^{(i)}(\theta)\)</span>ÔºåÁõ∏ÂØπ‰∫éÁ¨¨<spanclass="math inline">\(j\)</span>Ê≠•‰∏äÁöÑÈöêËóèÁä∂ÊÄÅ<spanclass="math inline">\(h^{(j)}\)</span>„ÄÇÂ¶ÇÊûúÊùÉÈáçÁü©Èòµ<spanclass="math inline">\(W_h\)</span>ÂæàÂ∞èÔºåÈÇ£‰πàËøô‰∏ÄÈ°π‰πü‰ºöÈöèÁùÄ<spanclass="math inline">\(i\)</span>Âíå<spanclass="math inline">\(j\)</span>ÁöÑË∑ùÁ¶ªË∂äÊù•Ë∂äËøúËÄåÂèòÂæóË∂äÊù•Ë∂äÂ∞è</p><p>ËÄÉËôëÁü©ÈòµÁöÑ L2 ËåÉÊï∞ <span class="math display">\[\left\|\frac{\partial J^{(i)}(\theta)}{\partial\boldsymbol{h}^{(j)}}\right\| \leq\left\|\frac{\partialJ^{(i)}(\theta)}{\partial\boldsymbol{h}^{(i)}}\right\|\left\|\boldsymbol{W}_{h}\right\|^{(i-j)}\prod_{j&lt;t \leqi}\left\|\operatorname{diag}\left(\sigma^{\prime}\left(\boldsymbol{W}_{h}\boldsymbol{h}^{(t-1)}+\boldsymbol{W}_{x}\boldsymbol{x}^{(t)}+\boldsymbol{b}_{1}\right)\right)\right\|\]</span> Pascanu et al Ë°®ÊòéÔºåÂ¶ÇÊûú<spanclass="math inline">\(W_h\)</span>ÁöÑ<strong>ÊúÄÂ§ßÁâπÂæÅÂÄº</strong>&lt;1ÔºåÊ¢ØÂ∫¶<spanclass="math inline">\(\left\|\frac{\partial J^{(i)}(\theta)}{\partial\boldsymbol{h}^{(j)}}\right\|\)</span>Â∞ÜÂëà<strong>ÊåáÊï∞Ë°∞Âáè</strong></p><ul><li>ËøôÈáåÁöÑÁïåÈôêÊòØ1Âõ†‰∏∫Êàë‰ª¨‰ΩøÁî®ÁöÑÈùûÁ∫øÊÄßÂáΩÊï∞ÊòØsigmoid</li></ul><p>Êúâ‰∏Ä‰∏™Á±ª‰ººÁöÑËØÅÊòéÂ∞Ü‰∏Ä‰∏™<strong>ÊúÄÂ§ßÁöÑÁâπÂæÅÂÄº</strong> &gt;1‰∏é<strong>Ê¢ØÂ∫¶ÁàÜÁÇ∏</strong>ËÅîÁ≥ªËµ∑Êù•</p><h2 id="‰∏∫‰ªÄ‰πàÊ¢ØÂ∫¶Ê∂àÂ§±ÊòØ‰∏™ÈóÆÈ¢ò">1.3 ‰∏∫‰ªÄ‰πàÊ¢ØÂ∫¶Ê∂àÂ§±ÊòØ‰∏™ÈóÆÈ¢òÔºü</h2><p>Êù•Ëá™ËøúÂ§ÑÁöÑÊ¢ØÂ∫¶‰ø°Âè∑‰ºö‰∏¢Â§±ÔºåÂõ†‰∏∫ÂÆÉÊØîÊù•Ëá™ËøëÂ§ÑÁöÑÊ¢ØÂ∫¶‰ø°Âè∑Â∞èÂæóÂ§ö„ÄÇÂõ†Ê≠§ÔºåÊ®°ÂûãÊùÉÈáçÂè™‰ºöÊ†πÊçÆËøëÊúüÊïàÂ∫îËÄå‰∏çÊòØÈïøÊúüÊïàÂ∫îËøõË°åÊõ¥Êñ∞„ÄÇ</p><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/2.png" /></p><p>Âè¶‰∏ÄÁßçËß£ÈáäÔºö<strong>Ê¢ØÂ∫¶</strong>ÂèØ‰ª•Ë¢´Áúã‰ΩúÊòØ<strong>ËøáÂéªÂØπÊú™Êù•ÁöÑÂΩ±Âìç</strong>ÁöÑË°°ÈáèÊ†áÂáÜ</p><p>Â¶ÇÊûúÊ¢ØÂ∫¶Âú®ËæÉÈïø‰∏ÄÊÆµË∑ùÁ¶ªÂÜÖ(‰ªéÊó∂Èó¥Ê≠•<spanclass="math inline">\(t\)</span>Âà∞<spanclass="math inline">\(t+n\)</span>)ÂèòÂæóË∂äÊù•Ë∂äÂ∞èÔºåÈÇ£‰πàÊàë‰ª¨Â∞±‰∏çËÉΩÂà§Êñ≠Ôºö</p><ul><li>Âú®Êï∞ÊçÆ‰∏≠ÔºåÊ≠•È™§<span class="math inline">\(t\)</span>Âíå<spanclass="math inline">\(t+n\)</span>‰πãÈó¥<strong>Ê≤°Êúâ‰æùËµñÂÖ≥Á≥ª</strong></li><li>Êàë‰ª¨Áî®<strong>ÈîôËØØÁöÑÂèÇÊï∞</strong>Êù•ÊçïËé∑<spanclass="math inline">\(t\)</span>Âíå<spanclass="math inline">\(t+n\)</span>‰πãÈó¥ÁöÑÁúüÊ≠£‰æùËµñÂÖ≥Á≥ª</li></ul><h2 id="Ê¢ØÂ∫¶Ê∂àÂ§±ÂØπrnnËØ≠Ë®ÄÊ®°ÂûãÁöÑÂΩ±Âìç">1.4Ê¢ØÂ∫¶Ê∂àÂ§±ÂØπRNNËØ≠Ë®ÄÊ®°ÂûãÁöÑÂΩ±Âìç</h2><p><code>LM task: When she tried to print her tickets, she found that the printer was out of toner. She went to the stationery store to buy more toner. It was very overpriced. After installing the toner into the printer, she finally printed her ________</code></p><p>‰∏∫‰∫Ü‰ªéËøô‰∏™ËÆ≠ÁªÉÁ§∫‰æã‰∏≠Â≠¶‰π†ÔºåRNN-LMÈúÄË¶ÅÂØπÁ¨¨7Ê≠•ÁöÑ <code>tickets</code>ÂíåÊúÄÂêéÁöÑÁõÆÊ†áÂçïËØç <code>tickets</code>‰πãÈó¥ÁöÑ<strong>‰æùËµñÂÖ≥Á≥ªÂª∫Ê®°</strong></p><p>‰ΩÜÊòØÂ¶ÇÊûúÊ¢ØÂ∫¶ÂæàÂ∞èÔºåÊ®°ÂûãÂ∞±<strong>‰∏çËÉΩÂ≠¶‰π†ËøôÁßç‰æùËµñÂÖ≥Á≥ª</strong></p><ul><li>Âõ†Ê≠§Ê®°ÂûãÊó†Ê≥ïÂú®ÊµãËØïÊó∂<strong>È¢ÑÊµãÁ±ª‰ººÁöÑÈïøË∑ùÁ¶ª‰æùËµñÂÖ≥Á≥ª</strong></li></ul><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/3.png" /></p><p>Correct answer: The writer of the books <u>is</u> planning asequel</p><ul><li><strong>ËØ≠Ê≥ïËøëÂõ†</strong>ÔºöThe <u>writer</u> of the books <u>is</u>ÔºàÊ≠£Á°ÆÔºâ</li><li><strong>È°∫Â∫èËøëÂõ†</strong>ÔºöThe writer of the <u>books</u> <u>is</u>Ôºà‰∏çÊ≠£Á°ÆÔºâ</li></ul><p>Áî±‰∫éÊ¢ØÂ∫¶ÁöÑÊ∂àÂ§±ÔºåRNN-LMsÊõ¥ÂñÑ‰∫é‰ªé<strong>È°∫Â∫èËøëÂõ†</strong>Â≠¶‰π†ËÄå‰∏çÊòØ<strong>ËØ≠Ê≥ïËøëÂõ†</strong>ÔºåÊâÄ‰ª•‰ªñ‰ª¨ÁäØËøôÁßçÈîôËØØÁöÑÈ¢ëÁéáÊØîÊàë‰ª¨Â∏åÊúõÁöÑË¶ÅÈ´ò[Linzenet al . 2016]</p><h2 id="Â¶Ç‰ΩïËß£ÂÜ≥Ê¢ØÂ∫¶Ê∂àÂ§±ÈóÆÈ¢ò">1.5 Â¶Ç‰ΩïËß£ÂÜ≥Ê¢ØÂ∫¶Ê∂àÂ§±ÈóÆÈ¢òÔºü</h2><p>‰∏ªË¶ÅÈóÆÈ¢òÊòØRNNÂæàÈöæÂ≠¶‰π†Âú®Â§ö‰∏™Êó∂Èó¥Ê≠•ÈïøÁöÑÊÉÖÂÜµ‰∏ã‰øùÂ≠ò‰ø°ÊÅØÔºåÂú®ÊôÆÈÄöÁöÑRNN‰∏≠ÔºåÈöêËóèÁä∂ÊÄÅ‰∏çÊñ≠Ë¢´ÈáçÂÜô„ÄÇ<span class="math display">\[\boldsymbol{h}^{(t)}=\sigma\left(\boldsymbol{W}_{h}\boldsymbol{h}^{(t-1)}+\boldsymbol{W}_{x}\boldsymbol{x}^{(t)}+\boldsymbol{b}\right)\]</span> ÊúâÊ≤°ÊúâÊõ¥Â•ΩÁªìÊûÑÁöÑRNNÔºü</p><h1 id="Ê¢ØÂ∫¶ÁàÜÁÇ∏">2.Ê¢ØÂ∫¶ÁàÜÁÇ∏</h1><h2 id="‰∏∫‰ªÄ‰πàÊ¢ØÂ∫¶ÁàÜÁÇ∏ÊòØ‰∏™ÈóÆÈ¢ò">2.1 ‰∏∫‰ªÄ‰πàÊ¢ØÂ∫¶ÁàÜÁÇ∏ÊòØ‰∏™ÈóÆÈ¢òÔºü</h2><p>Â¶ÇÊûúÊ¢ØÂ∫¶ËøáÂ§ßÔºåÂàôSGDÊõ¥Êñ∞Ê≠•È™§ËøáÂ§ßÔºåËøôÂèØËÉΩÂØºËá¥<strong>ÈîôËØØÁöÑÊõ¥Êñ∞</strong>ÔºöÊàë‰ª¨Êõ¥Êñ∞ÁöÑÂ§™Â§öÔºåÂØºËá¥ÈîôËØØÁöÑÂèÇÊï∞ÈÖçÁΩÆ(ÊçüÂ§±ÂæàÂ§ß)„ÄÇ</p><p>Âú®ÊúÄÂùèÁöÑÊÉÖÂÜµ‰∏ãÔºåËøôÂ∞ÜÂØºËá¥ÁΩëÁªú‰∏≠ÁöÑ <strong>Inf</strong> Êàñ<strong>NaN</strong>(ÁÑ∂Âêé‰Ω†ÂøÖÈ°ª‰ªéËæÉÊó©ÁöÑÊ£ÄÊü•ÁÇπÈáçÊñ∞ÂêØÂä®ËÆ≠ÁªÉ)</p><h2 id="Ê¢ØÂ∫¶Ââ™Ë£ÅÊ¢ØÂ∫¶ÁàÜÁÇ∏ÁöÑËß£ÂÜ≥ÊñπÊ°à">2.2Ê¢ØÂ∫¶Ââ™Ë£ÅÔºöÊ¢ØÂ∫¶ÁàÜÁÇ∏ÁöÑËß£ÂÜ≥ÊñπÊ°à</h2><p><strong>Ê¢ØÂ∫¶Ë£ÅÂâ™</strong>ÔºöÂ¶ÇÊûúÊ¢ØÂ∫¶ÁöÑËåÉÊï∞Â§ß‰∫éÊüê‰∏™ÈòàÂÄºÔºåÂú®Â∫îÁî®SGDÊõ¥Êñ∞‰πãÂâçÂ∞ÜÂÖ∂Áº©Â∞è</p><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/4.png" /></p><p><strong>Áõ¥Ëßâ</strong>ÔºöÊúùÁùÄÂêåÊ†∑ÁöÑÊñπÂêëËøàÂá∫‰∏ÄÊ≠•Ôºå‰ΩÜË¶ÅÂ∞è‰∏ÄÁÇπ</p><p>ËøôÊòæÁ§∫‰∫Ü‰∏Ä‰∏™ÁÆÄÂçïRNNÁöÑÊçüÂ§±Èù¢(ÈöêËóèÂ±ÇÁä∂ÊÄÅÊòØ‰∏Ä‰∏™Ê†áÈáè‰∏çÊòØ‰∏Ä‰∏™ÂêëÈáè)ÔºåÊÇ¨Â¥ñÊòØÂç±Èô©ÁöÑÔºåÂõ†‰∏∫ÊúâÈô°Âù°</p><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/5.png" /></p><p>Âú®Â∑¶ËæπÔºåÁî±‰∫éÈô°Âù°ÔºåÊ¢ØÂ∫¶‰∏ãÈôçÊúâ<strong>‰∏§‰∏™ÈùûÂ∏∏Â§ßÁöÑÊ≠•È™§</strong>ÔºåÂØºËá¥ÊîÄÁôªÊÇ¨Â¥ñÁÑ∂ÂêéÂêëÂè≥Â∞ÑÂáª(ÈÉΩÊòØ<strong>ÂùèÁöÑÊõ¥Êñ∞</strong>)</p><p>Âú®Âè≥ËæπÔºåÊ¢ØÂ∫¶Ââ™Ë£ÅÂáèÂ∞ë‰∫ÜËøô‰∫õÊ≠•È™§ÁöÑÂ§ßÂ∞èÔºåÊâÄ‰ª•ÂèÇÊï∞Ë∞ÉÊï¥‰∏ç‰ºöÊúâÂâßÁÉàÁöÑÊ≥¢Âä®</p><h1 id="ÈïøÁü≠Êó∂ËÆ∞ÂøÜÁΩëÁªúlstm">3.ÈïøÁü≠Êó∂ËÆ∞ÂøÜÁΩëÁªú(LSTM)</h1><h2 id="ÈïøÁü≠Êó∂ËÆ∞ÂøÜlstm">3.1 ÈïøÁü≠Êó∂ËÆ∞ÂøÜ(LSTM)</h2><p>HochreiterÂíåSchmidhuberÂú®1997Âπ¥ÊèêÂá∫‰∫Ü‰∏ÄÁßçRNNÔºåÁî®‰∫éËß£ÂÜ≥Ê¢ØÂ∫¶Ê∂àÂ§±ÈóÆÈ¢ò„ÄÇ</p><p>Âú®Á¨¨<spanclass="math inline">\(t\)</span>Ê≠•ÔºåÊúâ‰∏Ä‰∏™<strong>ÈöêËóèÁä∂ÊÄÅ</strong><spanclass="math inline">\(h^{(t)}\)</span>Âíå‰∏Ä‰∏™<strong>ÂçïÂÖÉÁä∂ÊÄÅ</strong><spanclass="math inline">\(c^{(t)}\)</span></p><ul><li>ÈÉΩÊòØÈïøÂ∫¶‰∏∫<span class="math inline">\(n\)</span>ÁöÑÂêëÈáè</li><li>ÂçïÂÖÉÂ≠òÂÇ®ÈïøÊúü‰ø°ÊÅØ</li><li>LSTMÂèØ‰ª•‰ªéÂçïÂÖÉ‰∏≠<strong>Êì¶Èô§</strong>„ÄÅ<strong>ÂÜôÂÖ•</strong>Âíå<strong>ËØªÂèñ‰ø°ÊÅØ</strong></li></ul><p>‰ø°ÊÅØË¢´ Êì¶Èô§ / ÂÜôÂÖ• / ËØªÂèñ ÁöÑÈÄâÊã©Áî±‰∏â‰∏™ÂØπÂ∫îÁöÑÈó®ÊéßÂà∂</p><ul><li>Èó®‰πüÊòØÈïøÂ∫¶‰∏∫<span class="math inline">\(n\)</span>ÁöÑÂêëÈáè</li><li>Âú®ÊØè‰∏™Êó∂Èó¥Ê≠•Èïø‰∏äÔºåÈó®ÁöÑÊØè‰∏™ÂÖÉÁ¥†ÂèØ‰ª•<strong>ÊâìÂºÄ</strong>(1)„ÄÅ<strong>ÂÖ≥Èó≠</strong>(0)Êàñ‰ªã‰∫é‰∏§ËÄÖ‰πãÈó¥</li><li><strong>Èó®ÊòØÂä®ÊÄÅÁöÑ</strong>ÔºöÂÆÉ‰ª¨ÁöÑÂÄºÊòØÂü∫‰∫éÂΩìÂâç‰∏ä‰∏ãÊñáËÆ°ÁÆóÁöÑ</li></ul><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/6.png" /></p><p>Êàë‰ª¨Êúâ‰∏Ä‰∏™ËæìÂÖ•Â∫èÂàó<spanclass="math inline">\(x^{(t)}\)</span>ÔºåÊàë‰ª¨Â∞ÜËÆ°ÁÆó‰∏Ä‰∏™ÈöêËóèÁä∂ÊÄÅ<spanclass="math inline">\(h^{(t)}\)</span>ÂíåÂçïÂÖÉÁä∂ÊÄÅ<spanclass="math inline">\(c^{(t)}\)</span>ÁöÑÂ∫èÂàó„ÄÇÂú®Êó∂Èó¥Ê≠•<spanclass="math inline">\(t\)</span>Êó∂</p><ul><li><p><strong>ÈÅóÂøòÈó®</strong>ÔºöÊéßÂà∂‰∏ä‰∏Ä‰∏™ÂçïÂÖÉÁä∂ÊÄÅÁöÑ‰øùÂ≠ò‰∏éÈÅóÂøò</p></li><li><p><strong>ËæìÂÖ•Èó®</strong>ÔºöÊéßÂà∂ÂÜôÂÖ•ÂçïÂÖÉÊ†ºÁöÑÊñ∞ÂçïÂÖÉÂÜÖÂÆπÁöÑÂì™‰∫õÈÉ®ÂàÜ</p></li><li><p><strong>ËæìÂá∫Èó®</strong>ÔºöÊéßÂà∂ÂçïÂÖÉÁöÑÂì™‰∫õÂÜÖÂÆπËæìÂá∫Âà∞ÈöêËóèÁä∂ÊÄÅ</p></li><li><p><strong>Êñ∞ÂçïÂÖÉÂÜÖÂÆπ</strong>ÔºöËøôÊòØË¶ÅÂÜôÂÖ•ÂçïÂÖÉÁöÑÊñ∞ÂÜÖÂÆπ</p></li><li><p><strong>ÂçïÂÖÉÁä∂ÊÄÅ</strong>ÔºöÂà†Èô§(‚ÄúÂøòËÆ∞‚Äù)‰∏äÊ¨°ÂçïÂÖÉÁä∂ÊÄÅ‰∏≠ÁöÑ‰∏Ä‰∫õÂÜÖÂÆπÔºåÂπ∂ÂÜôÂÖ•(‚ÄúËæìÂÖ•‚Äù)‰∏Ä‰∫õÊñ∞ÁöÑÂçïÂÖÉÂÜÖÂÆπ</p></li><li><p><strong>ÈöêËóèÁä∂ÊÄÅ</strong>Ôºö‰ªéÂçïÂÖÉ‰∏≠ËØªÂèñ(‚Äúoutput‚Äù)‰∏Ä‰∫õÂÜÖÂÆπ</p></li><li><p><strong>SigmoidÂáΩÊï∞</strong>ÔºöÊâÄÊúâÁöÑÈó®ÁöÑÂÄºÈÉΩÂú®0Âà∞1‰πãÈó¥</p></li><li><p>ÈÄöËøáÈÄêÂÖÉÁ¥†ÁöÑ‰πòÁßØÊù•Â∫îÁî®Èó®</p></li><li><p>Ëøô‰∫õÊòØÈïøÂ∫¶Áõ∏Âêå(<spanclass="math inline">\(n\)</span>)ÁöÑÂêëÈáè</p></li></ul><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/7.png" /></p><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/8.png" /></p><h2 id="lstmÂ¶Ç‰ΩïËß£ÂÜ≥Ê¢ØÂ∫¶Ê∂àÂ§±">3.2 LSTMÂ¶Ç‰ΩïËß£ÂÜ≥Ê¢ØÂ∫¶Ê∂àÂ§±</h2><p>RNNÁöÑLSTMÊû∂ÊûÑÊõ¥ÂÆπÊòì‰øùÂ≠òËÆ∏Â§öÊó∂Èó¥Ê≠•‰∏äÁöÑ‰ø°ÊÅØ</p><ul><li>Â¶ÇÊûúÂøòËÆ∞Èó®ËÆæÁΩÆ‰∏∫ËÆ∞ÂæóÊØè‰∏ÄÊó∂Èó¥Ê≠•‰∏äÁöÑÊâÄÊúâ‰ø°ÊÅØÔºåÈÇ£‰πàÂçïÂÖÉ‰∏≠ÁöÑ‰ø°ÊÅØË¢´Êó†ÈôêÂú∞‰øùÂ≠ò</li><li>Áõ∏ÊØî‰πã‰∏ãÔºåÊôÆÈÄöRNNÊõ¥ÈöæÂ≠¶‰π†ÈáçÂ§ç‰ΩøÁî®Âπ∂‰∏îÂú®ÈöêËóèÁä∂ÊÄÅ‰∏≠‰øùÂ≠ò‰ø°ÊÅØÁöÑÁü©Èòµ<spanclass="math inline">\(W_h\)</span></li></ul><p>LSTMÂπ∂‰∏ç‰øùËØÅÊ≤°Êúâ<strong>Ê¢ØÂ∫¶Ê∂àÂ§±/ÁàÜÁÇ∏</strong>Ôºå‰ΩÜÂÆÉÁ°ÆÂÆû‰∏∫Ê®°ÂûãÊèê‰æõ‰∫Ü‰∏ÄÁßçÊõ¥ÂÆπÊòìÁöÑÊñπÊ≥ïÊù•Â≠¶‰π†ËøúÁ®ã‰æùËµñÂÖ≥Á≥ª</p><h2 id="lstmsÁé∞ÂÆû‰∏ñÁïåÁöÑÊàêÂäü">3.3 LSTMsÔºöÁé∞ÂÆû‰∏ñÁïåÁöÑÊàêÂäü</h2><p>2013-2015Âπ¥ÔºåLSTMÂºÄÂßãÂÆûÁé∞ÊúÄÂÖàËøõÁöÑÁªìÊûú</p><ul><li>ÊàêÂäüÁöÑ‰ªªÂä°ÂåÖÊã¨ÔºöÊâãÂÜôËØÜÂà´„ÄÅËØ≠Èü≥ËØÜÂà´„ÄÅÊú∫Âô®ÁøªËØë„ÄÅËß£Êûê„ÄÅÂõæÂÉèÂ≠óÂπï</li><li><strong>LSTMÊàê‰∏∫‰∏ªÂØºÊñπÊ≥ï</strong></li></ul><p>Áé∞Âú®(2019Âπ¥)ÔºåÂÖ∂‰ªñÊñπÊ≥ï(<strong>Â¶ÇTransformers</strong>)Âú®Êüê‰∫õ‰ªªÂä°‰∏äÂèòÂæóÊõ¥Âä†‰∏ªÂØº</p><ul><li>‰æãÂ¶ÇÂú®WMT(a MT conference + competition)‰∏≠</li><li>Âú®2016Âπ¥WMT‰∏≠ÔºåÊÄªÁªìÊä•ÂëäÂåÖÂê´‚ÄúRNN‚Äù44Ê¨°</li><li>Âú®2018Âπ¥WMT‰∏≠ÔºåÊÄªÁªìÊä•ÂëäÂåÖÂê´‚ÄúRNN‚Äù9Ê¨°Ôºå‚ÄúTransformers‚Äù 63Ê¨°</li></ul><h1 id="gruÁΩëÁªú">4.GRUÁΩëÁªú</h1><h2 id="gated-recurrent-unitsgru">4.1 Gated Recurrent Units(GRU)</h2><p>ChoÁ≠â‰∫∫Âú®2014Âπ¥ÊèêÂá∫‰∫ÜLSTMÁöÑ‰∏Ä‰∏™Êõ¥ÁÆÄÂçïÁöÑÊõø‰ª£ÊñπÊ°àÔºåÂú®ÊØè‰∏™Êó∂Èó¥Ê≠•<spanclass="math inline">\(t\)</span>‰∏äÔºåÊàë‰ª¨ÈÉΩÊúâËæìÂÖ•<spanclass="math inline">\(x^{(t)}\)</span>ÂíåÈöêËóèÁä∂ÊÄÅ<spanclass="math inline">\(h^{(t)}\)</span>(Ê≤°ÊúâÂçïÂÖÉÁä∂ÊÄÅ)</p><ul><li><p><strong>Êõ¥Êñ∞Èó®</strong>ÔºöÊéßÂà∂ÈöêËóèÁä∂ÊÄÅÁöÑÂì™‰∫õÈÉ®ÂàÜË¢´Êõ¥Êñ∞ÔºåÊàñËÄÖË¢´‰øùÁïô</p></li><li><p><strong>ÈáçÁΩÆÈó®</strong>ÔºöÊéßÂà∂‰πãÂâçÈöêËóèÁä∂ÊÄÅÁöÑÂì™‰∫õÈÉ®ÂàÜË¢´Áî®‰∫éËÆ°ÁÆóÊñ∞ÂÜÖÂÆπ</p></li><li><p><strong>Êñ∞ÁöÑÈöêËóèÁä∂ÊÄÅÂÜÖÂÆπ</strong>ÔºöÈáçÁΩÆÈó®ÈÄâÊã©‰πãÂâçÈöêËóèÁä∂ÊÄÅÁöÑÊúâÁî®ÈÉ®ÂàÜ„ÄÇ‰ΩøÁî®Ëøô‰∏ÄÈÉ®ÂàÜÂíåÂΩìÂâçËæìÂÖ•Êù•ËÆ°ÁÆóÊñ∞ÁöÑÈöêËóèÁä∂ÊÄÅÂÜÖÂÆπ</p></li><li><p><strong>ÈöêËóèÁä∂ÊÄÅ</strong>ÔºöÊõ¥Êñ∞Èó®ÂêåÊó∂ÊéßÂà∂‰ªé‰ª•ÂâçÁöÑÈöêËóèÁä∂ÊÄÅ‰øùÁïôÁöÑÂÜÖÂÆπÔºå‰ª•ÂèäÊõ¥Êñ∞Âà∞Êñ∞ÁöÑÈöêËóèÁä∂ÊÄÅÂÜÖÂÆπÁöÑÂÜÖÂÆπ</p></li></ul><p>ËøôÂ¶Ç‰ΩïËß£ÂÜ≥Ê∂àÂ§±Ê¢ØÂ∫¶Ôºü</p><ul><li>‰∏éLSTMÁ±ª‰ººÔºåGRU‰ΩøÈïøÊúü‰øùÂ≠ò‰ø°ÊÅØÂèòÂæóÊõ¥ÂÆπÊòì(‰æãÂ¶ÇÔºåÂ∞ÜupdategateËÆæÁΩÆ‰∏∫0)</li></ul><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/9.png" /></p><h2 id="lstm-vs-gru">4.2 LSTM vs GRU</h2><p>Á†îÁ©∂‰∫∫ÂëòÊèêÂá∫‰∫ÜËÆ∏Â§öÈó®ÊéßRNNÂèò‰ΩìÔºåÂÖ∂‰∏≠LSTMÂíåGRUÁöÑÂ∫îÁî®ÊúÄ‰∏∫ÂπøÊ≥õ</p><p>ÊúÄÂ§ßÁöÑÂå∫Âà´ÊòØ<strong>GRUËÆ°ÁÆóÈÄüÂ∫¶Êõ¥Âø´</strong>ÔºåÂèÇÊï∞Êõ¥Â∞ë„ÄÇÊ≤°ÊúâÁ°ÆÂáøÁöÑËØÅÊçÆË°®ÊòéÂÖ∂‰∏≠‰∏Ä‰∏™ÊÄªÊòØÊØîÂè¶‰∏Ä‰∏™Ë°®Áé∞ÂæóÊõ¥Â•Ω„ÄÇ<strong>LSTM</strong>ÊòØ‰∏Ä‰∏™<strong>ÂæàÂ•ΩÁöÑÈªòËÆ§ÈÄâÊã©</strong>(ÁâπÂà´ÊòØÂΩì‰Ω†ÁöÑÊï∞ÊçÆÂÖ∑ÊúâÈùûÂ∏∏ÈïøÁöÑ‰æùËµñÂÖ≥Á≥ªÔºåÊàñËÄÖ‰Ω†ÊúâÂæàÂ§öËÆ≠ÁªÉÊï∞ÊçÆÊó∂)</p><p><strong>ÁªèÈ™åÊ≥ïÂàô</strong>Ôºö‰ªéLSTMÂºÄÂßãÔºå‰ΩÜÊòØÂ¶ÇÊûú‰Ω†ÊÉ≥Ë¶ÅÊõ¥ÊúâÊïàÁéáÔºåÂ∞±ÂàáÊç¢Âà∞GRU</p><h2 id="Ê¢ØÂ∫¶Ê∂àÂ§±ÁàÜÁÇ∏Âè™ÊòØrnnÈóÆÈ¢òÂêó">4.3 Ê¢ØÂ∫¶Ê∂àÂ§±/ÁàÜÁÇ∏Âè™ÊòØRNNÈóÆÈ¢òÂêóÔºü</h2><p><strong>Ê¢ØÂ∫¶Ê∂àÂ§±/ÁàÜÁÇ∏Âè™ÊòØRNNÈóÆÈ¢òÂêó</strong>Ôºü</p><p>Âπ∂‰∏çÊòØÔºåËøôÂØπ‰∫éÊâÄÊúâÁöÑÁ•ûÁªèÁªìÊûÑ(ÂåÖÊã¨ÂâçÈ¶àÂíåÂç∑ÁßØÁΩëÁªú)ÈÉΩÊòØ‰∏Ä‰∏™ÈóÆÈ¢òÔºåÂ∞§ÂÖ∂ÊòØÂØπ‰∫éÊ∑±Â∫¶ÁªìÊûÑ</p><ul><li>Áî±‰∫éÈìæÂºèÊ≥ïÂàô/ÈÄâÊã©ÈùûÁ∫øÊÄßÂáΩÊï∞ÔºåÂèçÂêë‰º†Êí≠Êó∂Ê¢ØÂ∫¶ÂèØ‰ª•ÂèòÂæóÂæàÂ∞èÂæàÂ∞è</li><li>Âõ†Ê≠§ÔºåËæÉ‰ΩéÂ±ÇÊ¨°ÁöÑÂ≠¶‰π†ÈùûÂ∏∏ÁºìÊÖ¢(Èöæ‰ª•ËÆ≠ÁªÉ)</li><li>Ëß£ÂÜ≥ÊñπÊ°àÔºöÂ§ßÈáèÊñ∞ÁöÑÊ∑±Â±ÇÂâçÈ¶à /Âç∑ÁßØÊû∂ÊûÑÔºå<strong>Ê∑ªÂä†Êõ¥Â§öÁöÑÁõ¥Êé•ËøûÊé•</strong>(‰ªéËÄå‰ΩøÊ¢ØÂ∫¶ÂèØ‰ª•ÊµÅÂä®)</li></ul><p>‰æãÂ¶ÇÔºö</p><ul><li>ÊÆãÂ∑ÆËøûÊé•ÂèàÂêç‚ÄúResNet‚Äù,‰πüÁß∞‰∏∫Ë∑≥ËΩ¨ËøûÊé•</li><li>ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÊ†áËØÜËøûÊé•‰øùÂ≠ò‰ø°ÊÅØ</li><li>Ëøô‰ΩøÂæóÊ∑±Â±ÇÁΩëÁªúÊõ¥ÂÆπÊòìËÆ≠ÁªÉ</li></ul><p>‰æãÂ¶ÇÔºö</p><ul><li>ÂØÜÈõÜËøûÊé•ÂèàÂêç‚ÄúDenseNet‚Äù</li><li>Áõ¥Êé•Â∞ÜÊâÄÊúâÂÜÖÂÆπËøûÊé•Âà∞ÊâÄÊúâÂÜÖÂÆπ</li></ul><p>‰æãÂ¶ÇÔºö</p><ul><li>HighwayËøûÊé•ÂèàÁß∞‚ÄúÈ´òÈÄüÁΩëÁªú‚Äù</li><li>Á±ª‰ºº‰∫éÊÆãÂ∑ÆËøûÊé•Ôºå‰ΩÜÊ†áËØÜËøûÊé•‰∏éËΩ¨Êç¢Â±ÇÁî±Âä®ÊÄÅÈó®ÊéßÂà∂</li><li>ÁÅµÊÑüÊù•Ëá™LSTMsÔºå‰ΩÜÈÄÇÁî®‰∫éÊ∑±Â∫¶ÂâçÈ¶à/Âç∑ÁßØÁΩëÁªú</li></ul><p>ÁªìËÆ∫ÔºöËôΩÁÑ∂Ê¢ØÂ∫¶Ê∂àÂ§±/ÁàÜÁÇ∏ÊòØ‰∏Ä‰∏™ÊôÆÈÅçÁöÑÈóÆÈ¢òÔºå‰ΩÜÁî±‰∫éÈáçÂ§ç‰πò‰ª•Áõ∏ÂêåÁöÑÊùÉÁü©ÈòµÔºåRNNÂ∞§ÂÖ∂‰∏çÁ®≥ÂÆö[Bengioet al, 1994]</p><h2 id="ÂèåÂêërnnÂä®Êú∫">4.4 ÂèåÂêëRNNÔºöÂä®Êú∫</h2><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/10.png" /></p><p>Êàë‰ª¨ÂèØ‰ª•ÊääËøôÁßçÈöêËóèÁä∂ÊÄÅÁúã‰ΩúÊòØËøô‰∏™Âè•Â≠ê‰∏≠ÂçïËØç‚Äúterribly‚ÄùÁöÑ‰∏ÄÁßçË°®Á§∫„ÄÇÊàë‰ª¨Áß∞‰πã‰∏∫‰∏ä‰∏ãÊñáË°®Á§∫„ÄÇ</p><p>Ëøô‰∫õ‰∏ä‰∏ãÊñáË°®Á§∫Âè™ÂåÖÂê´ÂÖ≥‰∫éÂ∑¶‰∏ä‰∏ãÊñáÁöÑ‰ø°ÊÅØ(‰æãÂ¶Ç‚Äúthe movie was‚Äù)„ÄÇ</p><p>ÈÇ£‰πàÊ≠£Á°ÆÁöÑ‰∏ä‰∏ãÊñáÂë¢?</p><ul><li>Âú®Ëøô‰∏™‰æãÂ≠ê‰∏≠Ôºå‚Äúexciting‚ÄùÂú®Âè≥‰∏ä‰∏ãÊñá‰∏≠ÔºåÂÆÉ‰øÆÈ•∞‰∫Ü‚Äúterribly‚ÄùÁöÑÊÑèÊÄù(‰ªéÂê¶ÂÆöÂèò‰∏∫ËÇØÂÆö)</li></ul><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/11.png" /></p><p>‚Äúterribly‚ÄùÁöÑ‰∏ä‰∏ãÊñáË°®Á§∫ÂêåÊó∂ÂÖ∑ÊúâÂ∑¶‰∏ä‰∏ãÊñáÂíåÂè≥‰∏ä‰∏ãÊñá</p><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/12.png" /></p><p>ËøôÊòØ‰∏Ä‰∏™Ë°®Á§∫‚ÄúËÆ°ÁÆóRNNÁöÑ‰∏Ä‰∏™ÂêëÂâçÊ≠•È™§‚ÄùÁöÑÈÄöÁî®Á¨¶Âè∑‚Äî‚ÄîÂÆÉÂèØ‰ª•ÊòØÊôÆÈÄöÁöÑ„ÄÅLSTMÊàñGRUËÆ°ÁÆó</p><p>Êàë‰ª¨ËÆ§‰∏∫ËøôÊòØ‰∏Ä‰∏™ÂèåÂêëRNNÁöÑ‚ÄúÈöêËóèÁä∂ÊÄÅ‚Äù„ÄÇËøôÂ∞±ÊòØÊàë‰ª¨‰º†ÈÄíÁªôÁΩëÁªú‰∏ã‰∏ÄÈÉ®ÂàÜÁöÑ‰∏úË•ø</p><p>‰∏ÄËà¨Êù•ËØ¥ÔºåËøô‰∏§‰∏™RNNsÊúâÂêÑËá™ÁöÑÊùÉÈáç</p><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/13.png" /></p><p>ÂèåÂêëÁÆ≠Â§¥Ë°®Á§∫ÂèåÂêëÊÄßÔºåÊâÄÊèèËø∞ÁöÑÈöêËóèÁä∂ÊÄÅÊòØÊ≠£Âêë+ÂèçÂêëÁä∂ÊÄÅÁöÑËøûÊé•</p><p>Ê≥®ÊÑèÔºöÂèåÂêëRNNsÂè™ÈÄÇÁî®‰∫éËÆøÈóÆÊï¥‰∏™ËæìÂÖ•Â∫èÂàóÁöÑÊÉÖÂÜµ</p><ul><li>ÂÆÉ‰ª¨‰∏çÈÄÇÁî®‰∫éËØ≠Ë®ÄÂª∫Ê®°ÔºåÂõ†‰∏∫Âú®LM‰∏≠Ôºå‰Ω†Âè™ÊúâÂ∑¶‰æßÁöÑ‰∏ä‰∏ãÊñáÂèØÁî®</li></ul><p>Â¶ÇÊûú‰Ω†ÊúâÂÆåÊï¥ÁöÑËæìÂÖ•Â∫èÂàó(‰æãÂ¶Ç‰ªª‰Ωï‰∏ÄÁßçÁºñÁ†Å)Ôºå<strong>ÂèåÂêëÊÄßÊòØÂº∫Â§ßÁöÑ</strong>(ÈªòËÆ§ÊÉÖÂÜµ‰∏ã‰Ω†Â∫îËØ•‰ΩøÁî®ÂÆÉ)</p><p>‰æãÂ¶ÇÔºåBERT(Êù•Ëá™transformerÁöÑÂèåÂêëÁºñÁ†ÅÂô®Ë°®Á§∫)ÊòØ‰∏Ä‰∏™Âü∫‰∫éÂèåÂêëÊÄßÁöÑÂº∫Â§ßÁöÑÈ¢ÑËÆ≠ÁªÉÁöÑ‰∏ä‰∏ãÊñáË°®Á§∫Á≥ªÁªü</p><ul><li>‰Ω†‰ºöÂú®ËØæÁ®ãÁöÑÂêéÈù¢Â≠¶Âà∞Êõ¥Â§öÂÖ≥‰∫éBERTÁöÑÁü•ËØÜ!</li></ul><h2 id="Ê∑±Â±Çrnn">4.5 Ê∑±Â±ÇRNN</h2><p>RNNsÂú®‰∏Ä‰∏™Áª¥Â∫¶‰∏äÂ∑≤ÁªèÊòØ‚Äúdeep‚Äù(ÂÆÉ‰ª¨Â±ïÂºÄÂà∞ËÆ∏Â§öÊó∂Èó¥Ê≠•Èïø)</p><p>Êàë‰ª¨ËøòÂèØ‰ª•ÈÄöËøáÂ∫îÁî®<strong>Â§ö‰∏™RNN</strong>‰ΩøÂÆÉ‰ª¨‚ÄúÊ∑±ÂÖ•‚ÄùÂà∞Âè¶‰∏Ä‰∏™Áª¥Â∫¶ÔºöËøôÊòØ‰∏Ä‰∏™Â§öÂ±ÇRNN</p><p><strong>ËæÉ‰ΩéÁöÑRNN</strong>Â∫îËØ•ËÆ°ÁÆó<strong>ËæÉ‰ΩéÁ∫ßÂà´ÁöÑÁâπÊÄß</strong>ÔºåËÄå<strong>ËæÉÈ´òÁöÑRNN</strong>Â∫îËØ•ËÆ°ÁÆó<strong>ËæÉÈ´òÁ∫ßÂà´ÁöÑÁâπÊÄß</strong></p><p>Â§öÂ±ÇRNN‰πüÁß∞‰∏∫Â†ÜÂè†RNN</p><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/14.png" /></p><p>RNNÂ±Ç<span class="math inline">\(i\)</span>ÁöÑÈöêËóèÁä∂ÊÄÅÊòØRNNÂ±Ç<spanclass="math inline">\(i+1\)</span>ÁöÑËæìÂÖ•</p><h2 id="Ê∑±Â±ÇrnnÂú®ÂÆûË∑µ‰∏≠ÁöÑÂ∫îÁî®">4.6 Ê∑±Â±ÇRNNÂú®ÂÆûË∑µ‰∏≠ÁöÑÂ∫îÁî®</h2><p>È´òÊÄßËÉΩÁöÑRNNsÈÄöÂ∏∏ÊòØÂ§öÂ±ÇÁöÑ(‰ΩÜÊ≤°ÊúâÂç∑ÁßØÊàñÂâçÈ¶àÁΩëÁªúÈÇ£‰πàÊ∑±)</p><p>‰æãÂ¶ÇÔºöÂú®2017Âπ¥ÁöÑ‰∏ÄÁØáËÆ∫ÊñáÔºåBritz et alÂèëÁé∞Âú®Á•ûÁªèÊú∫Âô®ÁøªËØë‰∏≠Ôºå2Âà∞4Â±ÇRNNÁºñÁ†ÅÂô®ÊòØÊúÄÂ•ΩÁöÑ,Âíå4Â±ÇRNNËß£Á†ÅÂô®</p><ul><li>‰ΩÜÊòØÔºå<strong>skip-connections</strong> /<strong>dense-connections</strong> ÈúÄË¶ÅËÆ≠ÁªÉÊõ¥Ê∑±RNNs(‰æãÂ¶Ç8Â±Ç)</li><li>RNNÊó†Ê≥ïÂπ∂Ë°åÂåñÔºåËÆ°ÁÆó‰ª£‰ª∑ËøáÂ§ßÔºåÊâÄ‰ª•‰∏ç‰ºöËøáÊ∑±</li></ul><p>Transformer-based ÁöÑÁΩëÁªú(Â¶ÇBERT)ÂèØ‰ª•Â§öËææ24Â±Ç</p><ul><li>BERT ÊúâÂæàÂ§öskipping-likeÁöÑËøûÊé•</li></ul><h2 id="ÊÄªÁªì">4.7 ÊÄªÁªì</h2><ul><li>LSTMÂäüËÉΩÂº∫Â§ßÔºå‰ΩÜGRUÈÄüÂ∫¶Êõ¥Âø´</li><li>Ââ™Ë£Å‰Ω†ÁöÑÊ¢ØÂ∫¶</li><li>Â∞ΩÂèØËÉΩ‰ΩøÁî®ÂèåÂêëÊÄß</li><li>Â§öÂ±ÇRNNÂäüËÉΩÂº∫Â§ßÔºå‰ΩÜÂ¶ÇÊûúÂæàÊ∑±ÂèØËÉΩÈúÄË¶ÅË∑≥Êé•/ÂØÜÈõÜËøûÊé•</li></ul><p><img src="/img/nlp/Á¨¨‰∏ÉËÆ≤/15.png" /></p><p>ÂèÇËÄÉÔºö</p><p>http://www.showmeai.tech/article-detail/241</p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Á¨¨ÂÖ≠ËÆ≤-Âæ™ÁéØÁ•ûÁªèÁΩëÁªú‰∏éËØ≠Ë®ÄÊ®°Âûã</title>
    <link href="/2022/05/12/%E7%AC%AC%E5%85%AD%E8%AE%B2-%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B8%8E%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/"/>
    <url>/2022/05/12/%E7%AC%AC%E5%85%AD%E8%AE%B2-%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E4%B8%8E%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ËØ≠Ë®ÄÊ®°Âûã">1.ËØ≠Ë®ÄÊ®°Âûã</h1><h2 id="ËØ≠Ë®ÄÊ®°Âûã-1">1.1 ËØ≠Ë®ÄÊ®°Âûã</h2><p>1„ÄÅ<strong>ËØ≠Ë®ÄÂª∫Ê®°</strong>ÁöÑ‰ªªÂä°ÊòØÈ¢ÑÊµã‰∏ã‰∏Ä‰∏™ÂçïËØçÊòØ‰ªÄ‰πà</p><p>Êõ¥Ê≠£ÂºèÁöÑËØ¥Ê≥ïÊòØÔºöÁªôÂÆö‰∏Ä‰∏™ÂçïËØçÂ∫èÂàó<spanclass="math inline">\(x^{(1)},x^{(2)},...,x^{(t)}\)</span>ÔºåËÆ°ÁÆó‰∏ã‰∏Ä‰∏™ÂçïËØç<spanclass="math inline">\(x^{(t+1)}\)</span>ÁöÑÊ¶ÇÁéáÂàÜÂ∏ÉÔºö <spanclass="math display">\[P(x^{(t+1)}| x^{(t)}, ..., x^{(1)})\]</span></p><ul><li>ÂÖ∂‰∏≠Ôºå<spanclass="math inline">\(x^{(t+1)}\)</span>ÂèØ‰ª•ÊòØËØçË°®‰∏≠ÁöÑ‰ªªÊÑèÂçïËØç<spanclass="math inline">\(V={w_1,...,w_v}\)</span></li><li>ËøôÊ†∑ÂÅöÁöÑÁ≥ªÁªüÁß∞‰∏∫ Language Model ËØ≠Ë®ÄÊ®°Âûã</li></ul><p>2„ÄÅËøòÂèØ‰ª•Â∞ÜËØ≠Ë®ÄÊ®°ÂûãÁúã‰Ωú<strong>ËØÑ‰º∞‰∏ÄÊÆµÊñáÊú¨ÊòØËá™ÁÑ∂Âè•Â≠êÔºàÈÄöÈ°∫Â∫¶ÔºâÁöÑÊ¶ÇÁéá</strong></p><p>‰æãÂ¶ÇÔºåÂ¶ÇÊûúÊàë‰ª¨Êúâ‰∏ÄÊÆµÊñáÊú¨<spanclass="math inline">\(x^{(1)},x^{(2)},...,x^{(T)}\)</span>ÔºåÂàôËøôÊÆµÊñáÊú¨ÁöÑÊ¶ÇÁéá(Ê†πÊçÆËØ≠Ë®ÄÊ®°Âûã)‰∏∫<span class="math display">\[\begin{aligned}P\left(\boldsymbol{x}^{(1)}, \ldots, \boldsymbol{x}^{(T)}\right)&amp;=P\left(\boldsymbol{x}^{(1)}\right) \timesP\left(\boldsymbol{x}^{(2)} \mid \boldsymbol{x}^{(1)}\right) \times\cdots \times P\left(\boldsymbol{x}^{(T)} \mid \boldsymbol{x}^{(T-1)},\ldots, \boldsymbol{x}^{(1)}\right) \\&amp;=\prod_{t=1}^{T} P\left(\boldsymbol{x}^{(t)} \mid\boldsymbol{x}^{(t-1)}, \ldots, \boldsymbol{x}^{(1)}\right)\end{aligned}\]</span></p><ul><li>ËØ≠Ë®ÄÊ®°ÂûãÊèê‰æõÁöÑÊòØ<span class="math inline">\(\prod_{t=1}^{T}P\left(\boldsymbol{x}^{(t)} \mid \boldsymbol{x}^{(t-1)}, \ldots,\boldsymbol{x}^{(1)}\right)\)</span></li></ul><h2 id="n-gram-ËØ≠Ë®ÄÊ®°Âûã">1.2 n-gram ËØ≠Ë®ÄÊ®°Âûã</h2><figure class="highlight fortran"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs fortran">the students <span class="hljs-keyword">opened</span> their __<br></code></pre></div></td></tr></table></figure><p><strong>ÈóÆÈ¢ò</strong>ÔºöÂ¶Ç‰ΩïÂ≠¶‰π†‰∏Ä‰∏™ËØ≠Ë®ÄÊ®°ÂûãÔºü</p><p><strong>ÂõûÁ≠î</strong>(Ê∑±Â∫¶Â≠¶‰π†‰πãÂâçÁöÑÊó∂Êúü)ÔºöÂ≠¶‰π†‰∏Ä‰∏™ n-gramËØ≠Ë®ÄÊ®°Âûã</p><p><strong>ÂÆö‰πâ</strong>Ôºön-gramÊòØ‰∏Ä‰∏™Áî±<spanclass="math inline">\(n\)</span>‰∏™ËøûÁª≠ÂçïËØçÁªÑÊàêÁöÑÂùó</p><ul><li><strong>uni</strong>grams: <code>the</code>, <code>students</code>,<code>opened</code>, <code>their</code></li><li><strong>bi</strong>grams: <code>the students</code>,<code>students opened</code>, <code>opened their</code></li><li><strong>tri</strong>grams: <code>the students opened</code>,<code>students opened their</code></li><li><strong>4-</strong>grams:<code>the students opened their</code></li></ul><p><strong>ÊÉ≥Ê≥ï</strong>ÔºöÊî∂ÈõÜÂÖ≥‰∫é‰∏çÂêå n-gramÂá∫Áé∞È¢ëÁéáÁöÑÁªüËÆ°Êï∞ÊçÆÔºåÂπ∂‰ΩøÁî®Ëøô‰∫õÊï∞ÊçÆÈ¢ÑÊµã‰∏ã‰∏Ä‰∏™ÂçïËØç</p><p>È¶ñÂÖàÔºåÊàë‰ª¨ÂÅö‰∏Ä‰∏™ÁÆÄÂåñÂÅáËÆæÔºö<spanclass="math inline">\(x^{(t+1)}\)</span>Âè™‰æùËµñ‰∫éÂâçÈù¢ÁöÑ<spanclass="math inline">\(n-1\)</span>‰∏™ÂçïËØç <span class="math display">\[P\left(\boldsymbol{x}^{(t+1)} \mid \boldsymbol{x}^{(t)}, \ldots,\boldsymbol{x}^{(1)}\right)=P(\boldsymbol{x}^{(t+1)} \mid\overbrace{\left.\boldsymbol{x}^{(t)}, \ldots,\boldsymbol{x}^{(t-n+2)}\right)}^{n-1 \text { words }}\]</span> <strong>ÈóÆÈ¢ò</strong>ÔºöÂ¶Ç‰ΩïÂæóÂà∞n-gramÂíå(n-1)-gramÁöÑÊ¶ÇÁéáÔºü</p><p><strong>ÂõûÁ≠î</strong>ÔºöÈÄöËøáÂú®‰∏Ä‰∫õÂ§ßÂûãÊñáÊú¨ËØ≠ÊñôÂ∫ì‰∏≠ËÆ°ÁÆóÂÆÉ‰ª¨(ÁªüËÆ°Ëøë‰ºº)<span class="math display">\[\approx \frac{\operatorname{count}\left(\boldsymbol{x}^{(t+1)},\boldsymbol{x}^{(t)}, \ldots,\boldsymbol{x}^{(t-n+2)}\right)}{\operatorname{count}\left(\boldsymbol{x}^{(t)},\ldots, \boldsymbol{x}^{(t-n+2)}\right)}\]</span></p><h2 id="n-gram-ËØ≠Ë®ÄÊ®°ÂûãÁ§∫‰æã">1.3 n-gram ËØ≠Ë®ÄÊ®°ÂûãÔºöÁ§∫‰æã</h2><p>ÂÅáËÆæÊàë‰ª¨Ê≠£Âú®Â≠¶‰π†‰∏Ä‰∏™ <strong>4-gram</strong> ÁöÑËØ≠Ë®ÄÊ®°Âûã</p><p><code>as the proctor started the clock, the students opened their ____</code>Êàë‰ª¨Âè™ÈúÄË¶ÅËÄÉËôë<code>students opened their _____</code></p><ul><li>‰æãÂ¶ÇÔºåÂÅáËÆæÂú®ËØ≠ÊñôÂ∫ì‰∏≠Ôºö<ul><li><code>students opened their</code> Âá∫Áé∞‰∫Ü1000Ê¨°</li><li><code>students opened their books</code> Âá∫Áé∞‰∫Ü400Ê¨°</li></ul></li></ul><p><span class="math display">\[P(books|students \ opened \ their) = 0.4\]</span></p><ul><li><code>students opened their exams</code> Âá∫Áé∞‰∫Ü100Ê¨°</li></ul><p><span class="math display">\[P(exams|students \ opened \ their) = 0.1\]</span></p><ul><li>Êàë‰ª¨Â∫îËØ•ÂøΩËßÜ‰∏ä‰∏ãÊñá‰∏≠ÁöÑproctorÂêóÔºü<ul><li>Âú®Êú¨‰æã‰∏≠Ôºå‰∏ä‰∏ãÊñáÈáåÂá∫Áé∞‰∫Ü <code>proctor</code>ÔºåÊâÄ‰ª•<code>exams</code> Âú®ËøôÈáåÁöÑ‰∏ä‰∏ãÊñá‰∏≠Â∫îËØ•ÊòØÊØî <code>books</code>Ê¶ÇÁéáÊõ¥Â§ßÁöÑ„ÄÇ</li></ul></li></ul><h2 id="n-gramËØ≠Ë®ÄÊ®°ÂûãÁöÑÁ®ÄÁñèÊÄßÈóÆÈ¢ò">1.4 n-gramËØ≠Ë®ÄÊ®°ÂûãÁöÑÁ®ÄÁñèÊÄßÈóÆÈ¢ò</h2><p><strong>ÈóÆÈ¢ò1</strong>ÔºöÂ¶ÇÊûú<code>students open their ww</code>‰ªéÊú™Âá∫Áé∞Âú®Êï∞ÊçÆ‰∏≠ÔºåÈÇ£‰πàÊ¶ÇÁéáÂÄº‰∏∫0</p><ul><li>(Partial)<strong>Ëß£ÂÜ≥ÊñπÊ°à</strong>Ôºö‰∏∫ÊØè‰∏™<spanclass="math inline">\(w\in V\)</span>Ê∑ªÂä†ÊûÅÂ∞èÊï∞<spanclass="math inline">\(\delta\)</span>ÔºåËøôÂè´ÂÅöÂπ≥Êªë„ÄÇËøô‰ΩøÂæóËØçË°®‰∏≠ÁöÑÊØè‰∏™ÂçïËØçÈÉΩËá≥Â∞ëÊúâÂæàÂ∞èÁöÑÊ¶ÇÁéá„ÄÇ</li></ul><p><strong>ÈóÆÈ¢ò2</strong>ÔºöÂ¶ÇÊûú<code>students open their</code>‰ªéÊú™Âá∫Áé∞Âú®Êï∞ÊçÆ‰∏≠ÔºåÈÇ£‰πàÊàë‰ª¨Â∞ÜÊó†Ê≥ïËÆ°ÁÆó‰ªª‰ΩïÂçïËØç<spanclass="math inline">\(w\)</span>ÁöÑÊ¶ÇÁéáÂÄº</p><ul><li><p>(Partial)<strong>Ëß£ÂÜ≥ÊñπÊ°à</strong>ÔºöÂ∞ÜÊù°‰ª∂Êîπ‰∏∫<code>open their</code>Ôºå‰πüÂè´ÂÅöÂêéÈÄÄÂ§ÑÁêÜ„ÄÇ</p></li><li><p>Note/Ê≥®ÊÑè: <spanclass="math inline">\(n\)</span>ÁöÑÂ¢ûÂä†‰ΩøÁ®ÄÁñèÊÄßÈóÆÈ¢òÂèòÂæóÊõ¥Á≥ü„ÄÇ‰∏ÄËà¨ÊÉÖÂÜµ‰∏ã<spanclass="math inline">\(n\)</span>‰∏çËÉΩÂ§ß‰∫é5„ÄÇ</p></li></ul><h2 id="n-gramËØ≠Ë®ÄÊ®°ÂûãÁöÑÂ≠òÂÇ®ÈóÆÈ¢ò">1.5 n-gramËØ≠Ë®ÄÊ®°ÂûãÁöÑÂ≠òÂÇ®ÈóÆÈ¢ò</h2><p><strong>ÈóÆÈ¢ò</strong>ÔºöÈúÄË¶ÅÂ≠òÂÇ®‰Ω†Âú®ËØ≠ÊñôÂ∫ì‰∏≠ÁúãÂà∞ÁöÑÊâÄÊúâ n-gramsÁöÑËÆ°Êï∞</p><p>Â¢ûÂä†<spanclass="math inline">\(n\)</span>ÊàñÂ¢ûÂä†ËØ≠ÊñôÂ∫ìÈÉΩ‰ºöÂ¢ûÂä†Ê®°ÂûãÂ§ßÂ∞è</p><h2 id="n-gramËØ≠Ë®ÄÊ®°ÂûãÁöÑÁîüÊàêÊñáÊú¨">1.6 n-gramËØ≠Ë®ÄÊ®°ÂûãÁöÑÁîüÊàêÊñáÊú¨</h2><ul><li><p>ÂèØ‰ª•‰ΩøÁî®ËØ≠Ë®ÄÊ®°ÂûãÊù•ÁîüÊàêÊñáÊú¨</p></li><li><p>‰ΩøÁî®trigramËøêË°å‰ª•‰∏äÁîüÊàêËøáÁ®ãÊó∂Ôºå‰ºöÂæóÂà∞‰∏äÂõæÂ∑¶‰æßÁöÑÊñáÊú¨</p></li><li><p>‰ª§‰∫∫ÊÉäËÆ∂ÁöÑÊòØÂÖ∂ÂÖ∑ÊúâËØ≠Ê≥ï‰ΩÜÊòØÊòØ‰∏çËøûË¥ØÁöÑ„ÄÇÂ¶ÇÊûúÊàë‰ª¨ÊÉ≥Ë¶ÅÂæàÂ•ΩÂú∞Ê®°ÊãüËØ≠Ë®ÄÔºåÊàë‰ª¨ÈúÄË¶ÅÂêåÊó∂ËÄÉËôë‰∏â‰∏™‰ª•‰∏äÁöÑÂçïËØç„ÄÇ‰ΩÜÂ¢ûÂä†<spanclass="math inline">\(n\)</span>‰ΩøÊ®°ÂûãÁöÑÁ®ÄÁñèÊÄßÈóÆÈ¢òÊÅ∂ÂåñÔºåÊ®°ÂûãÂ∞∫ÂØ∏Â¢ûÂ§ß</p></li></ul><h2 id="Â¶Ç‰ΩïÊê≠Âª∫‰∏Ä‰∏™Á•ûÁªèËØ≠Ë®ÄÊ®°Âûã">1.7 Â¶Ç‰ΩïÊê≠Âª∫‰∏Ä‰∏™Á•ûÁªèËØ≠Ë®ÄÊ®°ÂûãÔºü</h2><p>ÂõûÂøÜ‰∏Ä‰∏ãËØ≠Ë®ÄÊ®°Âûã‰ªªÂä°</p><ul><li><strong>ËæìÂÖ•</strong>ÔºöÂçïËØçÂ∫èÂàó<span class="math inline">\(x^{(1)},x^{(2)}, ...,x^{(t)}\)</span></li><li><strong>ËæìÂá∫</strong>Ôºö‰∏ã‰∏ÄÊ¨°ÂçïËØçÁöÑÊ¶ÇÁéá<spanclass="math inline">\(P\left(\boldsymbol{x}^{(t+1)} \mid\boldsymbol{x}^{(t)}, \ldots, \boldsymbol{x}^{(1)}\right)\)</span></li></ul><p><img src="/img/nlp/Á¨¨ÂÖ≠ËÆ≤/1.png" /></p><h2 id="Âõ∫ÂÆöÁ™óÂè£ÁöÑÁ•ûÁªèËØ≠Ë®ÄÊ®°Âûã">1.8 Âõ∫ÂÆöÁ™óÂè£ÁöÑÁ•ûÁªèËØ≠Ë®ÄÊ®°Âûã</h2><p><img src="/img/nlp/Á¨¨ÂÖ≠ËÆ≤/2.png" /></p><p>Ë∂ÖË∂ä n-gram ËØ≠Ë®ÄÊ®°ÂûãÁöÑ<strong>ÊîπËøõ</strong></p><ul><li>Ê≤°ÊúâÁ®ÄÁñèÊÄßÈóÆÈ¢ò</li><li>‰∏çÈúÄË¶ÅËßÇÂØüÂà∞ÊâÄÊúâÁöÑn-grams</li></ul><p>NNLMÂ≠òÂú®ÁöÑ<strong>ÈóÆÈ¢ò</strong></p><ul><li>Âõ∫ÂÆöÁ™óÂè£Â§™Â∞è</li><li>Êâ©Â§ßÁ™óÂè£Â∞±ÈúÄË¶ÅÊâ©Â§ßÊùÉÈáçÁü©Èòµ<spanclass="math inline">\(W\)</span></li><li>Á™óÂè£ÂÜçÂ§ß‰πü‰∏çÂ§üÁî®</li><li><span class="math inline">\(x^{(1)}\)</span>Âíå<spanclass="math inline">\(x^{(2)}\)</span>‰πò‰ª•ÂÆåÂÖ®‰∏çÂêåÁöÑÊùÉÈáç„ÄÇËæìÂÖ•ÁöÑÂ§ÑÁêÜ‰∏çÂØπÁß∞</li></ul><p>Êàë‰ª¨ÈúÄË¶Å‰∏Ä‰∏™Á•ûÁªèÁªìÊûÑÔºåÂèØ‰ª•Â§ÑÁêÜ‰ªª‰ΩïÈïøÂ∫¶ÁöÑËæìÂÖ•</p><h1 id="Âæ™ÁéØÁ•ûÁªèÁΩëÁªúrnn">2.Âæ™ÁéØÁ•ûÁªèÁΩëÁªú(RNN)</h1><h2 id="Âæ™ÁéØÁ•ûÁªèÁΩëÁªúrnn-1">2.1 Âæ™ÁéØÁ•ûÁªèÁΩëÁªú(RNN)</h2><p><img src="/img/nlp/Á¨¨ÂÖ≠ËÆ≤/3.png" /></p><p><img src="/img/nlp/Á¨¨ÂÖ≠ËÆ≤/4.png" /></p><ul><li>RNNÁöÑ‰ºòÁÇπ<ul><li>ÂèØ‰ª•Â§ÑÁêÜ<strong>‰ªªÊÑèÈïøÂ∫¶</strong>ÁöÑËæìÂÖ•</li><li>Ê≠•È™§<spanclass="math inline">\(t\)</span>ÁöÑËÆ°ÁÆó(ÁêÜËÆ∫‰∏ä)ÂèØ‰ª•‰ΩøÁî®<strong>ËÆ∏Â§öÊ≠•È™§Ââç</strong>ÁöÑ‰ø°ÊÅØ</li><li><strong>Ê®°ÂûãÂ§ßÂ∞è‰∏ç‰ºö</strong>ÈöèÁùÄËæìÂÖ•ÁöÑÂ¢ûÂä†ËÄå<strong>Â¢ûÂä†</strong></li><li>Âú®ÊØè‰∏™Êó∂Èó¥Ê≠•‰∏äÂ∫îÁî®Áõ∏ÂêåÁöÑÊùÉÈáçÔºåÂõ†Ê≠§Âú®Â§ÑÁêÜËæìÂÖ•Êó∂ÂÖ∑Êúâ<strong>ÂØπÁß∞ÊÄß</strong></li></ul></li><li>RNNÁöÑÁº∫ÁÇπ<ul><li>Âæ™ÁéØ‰∏≤Ë°åËÆ°ÁÆóÈÄüÂ∫¶ÊÖ¢</li><li>Âú®ÂÆûË∑µ‰∏≠ÔºåÂæàÈöæ‰ªéËÆ∏Â§öÊ≠•È™§ÂâçËøîÂõû‰ø°ÊÅØ</li></ul></li></ul><h2 id="ËÆ≠ÁªÉ‰∏Ä‰∏™rnnËØ≠Ë®ÄÊ®°Âûã">2.2 ËÆ≠ÁªÉ‰∏Ä‰∏™RNNËØ≠Ë®ÄÊ®°Âûã</h2><p>Ëé∑Âèñ‰∏Ä‰∏™<strong>ËæÉÂ§ßÁöÑÊñáÊú¨ËØ≠ÊñôÂ∫ì</strong>ÔºåËØ•ËØ≠ÊñôÂ∫ìÊòØ‰∏Ä‰∏™ÂçïËØçÂ∫èÂàó</p><p>ËæìÂÖ•RNN-LMÔºõËÆ°ÁÆóÊØè‰∏™Ê≠•È™§ÁöÑËæìÂá∫ÂàÜÂ∏É</p><ul><li>Âç≥È¢ÑÊµãÂà∞ÁõÆÂâç‰∏∫Ê≠¢ÁªôÂÆöÁöÑÊØè‰∏™ÂçïËØçÁöÑÊ¶ÇÁéáÂàÜÂ∏É</li></ul><p>Ê≠•È™§<spanclass="math inline">\(t\)</span>‰∏äÁöÑ<strong>ÊçüÂ§±ÂáΩ</strong>Êï∞‰∏∫È¢ÑÊµãÊ¶ÇÁéáÂàÜÂ∏É<spanclass="math inline">\(\hat{y}^{(t)}\)</span>‰∏éÁúüÂÆû‰∏ã‰∏Ä‰∏™ÂçïËØç<spanclass="math inline">\(y^{(t)}\)</span>(<spanclass="math inline">\(x^{(t+1)}\)</span>ÁöÑÁã¨ÁÉ≠ÂêëÈáè)‰πãÈó¥ÁöÑ<strong>‰∫§ÂèâÁÜµ</strong><span class="math display">\[J^{(t)}(\theta)=C E\left(\boldsymbol{y}^{(t)},\hat{\boldsymbol{y}}^{(t)}\right)=-\sum_{w \in V}\boldsymbol{y}_{w}^{(t)} \log \hat{\boldsymbol{y}}_{w}^{(t)}=-\log\hat{\boldsymbol{y}}_{\boldsymbol{x}_{t+1}}^{(t)}\]</span> Â∞ÜÂÖ∂Âπ≥ÂùáÔºåÂæóÂà∞Êï¥‰∏™ËÆ≠ÁªÉÈõÜÁöÑ<strong>ÊÄª‰ΩìÊçüÂ§±</strong> <spanclass="math display">\[J(\theta)=\frac{1}{T} \sum_{t=1}^{T} J^{(t)}(\theta)=\frac{1}{T}\sum_{t=1}^{T}-\log \hat{\boldsymbol{y}}_{\boldsymbol{x}_{t+1}}^{(t)}\]</span> <img src="/img/nlp/Á¨¨ÂÖ≠ËÆ≤/5.png" /></p><p>ÁÑ∂ËÄåÔºöËÆ°ÁÆóÊï¥‰∏™ËØ≠ÊñôÂ∫ì<spanclass="math inline">\(x^{(1)},...,x^{(T)}\)</span>ÁöÑÊçüÂ§±ÂíåÊ¢ØÂ∫¶Â§™ÊòÇË¥µ‰∫ÜÔºåÊâÄ‰ª•Âú®ÂÆûË∑µ‰∏≠ÈÄöÂ∏∏Êää<spanclass="math inline">\(x^{(1)},...,x^{(T)}\)</span>ÁúãÊàê‰∏Ä‰∏™Âè•Â≠êÊàñÊòØÊñáÊ°£</p><p>ÂõûÂøÜÔºöÈöèÊú∫Ê¢ØÂ∫¶‰∏ãÈôçÂÖÅËÆ∏Êàë‰ª¨ËÆ°ÁÆóÂ∞èÂùóÊï∞ÊçÆÁöÑÊçüÂ§±ÂíåÊ¢ØÂ∫¶ÔºåÂπ∂ËøõË°åÊõ¥Êñ∞</p><p>ËÆ°ÁÆó‰∏Ä‰∏™Âè•Â≠êÁöÑÊçüÂ§±<spanclass="math inline">\(J(\theta)\)</span>(ÂÆûÈôÖ‰∏äÊòØ‰∏ÄÊâπÂè•Â≠ê)ÔºåËÆ°ÁÆóÊ¢ØÂ∫¶ÂíåÊõ¥Êñ∞ÊùÉÈáç„ÄÇÈáçÂ§ç‰∏äËø∞Êìç‰Ωú„ÄÇ</p><h2 id="rnnÁöÑÂèçÂêë‰º†Êí≠">2.3 RNNÁöÑÂèçÂêë‰º†Êí≠</h2><p><strong>ÈóÆÈ¢ò</strong>ÔºöÂÖ≥‰∫éÈáçÂ§çÁöÑÊùÉÈáçÁü©Èòµ<spanclass="math inline">\(W_h\)</span>ÁöÑÂÅèÂØºÊï∞<spanclass="math inline">\(J^{(t)}(\theta)\)</span></p><p><strong>ÂõûÁ≠î</strong>ÔºöÈáçÂ§çÊùÉÈáçÁöÑÊ¢ØÂ∫¶ÊòØÊØèÊ¨°ÂÖ∂Âá∫Áé∞Êó∂ÁöÑÊ¢ØÂ∫¶ÁöÑÊÄªÂíå <spanclass="math display">\[\frac{\partial J^{(t)}}{\partial\boldsymbol{W}_{\boldsymbol{h}}}=\left.\sum_{i=1}^{t} \frac{\partialJ^{(t)}}{\partial \boldsymbol{W}_{\boldsymbol{h}}}\right|_{(i)}\]</span> <img src="/img/nlp/Á¨¨ÂÖ≠ËÆ≤/6.png" /></p><p><strong>ÈóÆÈ¢ò</strong>ÔºöÂ¶Ç‰ΩïËÆ°ÁÆóÔºü</p><p><strong>ÂõûÁ≠î</strong>ÔºöÂèçÂêë‰º†Êí≠ÁöÑÊó∂Èó¥Ê≠•Èïø<spanclass="math inline">\(i=t,...,0\)</span>„ÄÇÁ¥ØÂä†Ê¢ØÂ∫¶„ÄÇËøô‰∏™ÁÆóÊ≥ïÂè´ÂÅö‚Äúbackpropagation through time‚Äù</p><h2 id="rnnËØ≠Ë®ÄÊ®°ÂûãÁöÑÁîüÊàêÊñáÊú¨">2.4 RNNËØ≠Ë®ÄÊ®°ÂûãÁöÑÁîüÊàêÊñáÊú¨</h2><p>Â∞±ÂÉèn-gramËØ≠Ë®ÄÊ®°Âûã‰∏ÄÊ†∑Ôºå‰Ω†ÂèØ‰ª•‰ΩøÁî®RNNËØ≠Ë®ÄÊ®°ÂûãÈÄöËøáÈáçÂ§çÈááÊ†∑Êù•ÁîüÊàêÊñáÊú¨„ÄÇÈááÊ†∑ËæìÂá∫ÊòØ‰∏ã‰∏ÄÊ≠•ÁöÑËæìÂÖ•„ÄÇ</p><p><img src="/img/nlp/Á¨¨ÂÖ≠ËÆ≤/7.png" /></p><h1 id="ËØÑ‰º∞ËØ≠Ë®ÄÊ®°Âûã">3.ËØÑ‰º∞ËØ≠Ë®ÄÊ®°Âûã</h1><h2 id="ËØÑ‰º∞ËØ≠Ë®ÄÊ®°Âûã-1">3.1 ËØÑ‰º∞ËØ≠Ë®ÄÊ®°Âûã</h2><p>Ê†áÂáÜËØ≠Ë®ÄÊ®°ÂûãËØÑ‰º∞ÊåáÊ†áÊòØ perplexity Âõ∞ÊÉëÂ∫¶ËøôÁ≠â‰∫é‰∫§ÂèâÁÜµÊçüÂ§±<spanclass="math inline">\(J(\theta)\)</span>ÁöÑÊåáÊï∞ <spanclass="math display">\[=\prod_{t=1}^{T}\left(\frac{1}{\hat{y}_{x_{t+1}}^{(t)}}\right)^{1 /T}=\exp \left(\frac{1}{T} \sum_{t=1}^{T}-\log\hat{\boldsymbol{y}}_{\boldsymbol{x}_{t+1}}^{(t)}\right)=\exp(J(\theta))\]</span> Âõ∞ÊÉëÂ∫¶Ë∂ä‰ΩéÊïàÊûúË∂äÂ•Ω</p><h2 id="rnnÊûÅÂ§ßÂú∞ÊîπÂñÑ‰∫ÜÂõ∞ÊÉëÂ∫¶">3.2 RNNÊûÅÂ§ßÂú∞ÊîπÂñÑ‰∫ÜÂõ∞ÊÉëÂ∫¶</h2><p>ËØ≠Ë®ÄÊ®°ÂûãÊòØ‰∏ÄÈ°πÂü∫ÂáÜÊµãËØï‰ªªÂä°ÔºåÂÆÉÂ∏ÆÂä©Êàë‰ª¨Ë°°ÈáèÊàë‰ª¨Âú®ÁêÜËß£ËØ≠Ë®ÄÊñπÈù¢ÁöÑËøõÂ±ï</p><ul><li>ÁîüÊàê‰∏ã‰∏Ä‰∏™ÂçïËØçÔºåÈúÄË¶ÅËØ≠Ê≥ïÔºåÂè•Ê≥ïÔºåÈÄªËæëÔºåÊé®ÁêÜÔºåÁé∞ÂÆû‰∏ñÁïåÁöÑÁü•ËØÜÁ≠â</li></ul><p>ËØ≠Ë®ÄÂª∫Ê®°ÊòØËÆ∏Â§öNLP‰ªªÂä°ÁöÑÂ≠êÁªÑ‰ª∂ÔºåÂ∞§ÂÖ∂ÊòØÈÇ£‰∫õÊ∂âÂèäÁîüÊàêÊñáÊú¨Êàñ‰º∞ËÆ°ÊñáÊú¨Ê¶ÇÁéáÁöÑ‰ªªÂä°</p><ul><li>È¢ÑÊµãÊÄßÊâìÂ≠ó„ÄÅËØ≠Èü≥ËØÜÂà´„ÄÅÊâãÂÜôËØÜÂà´„ÄÅÊãºÂÜô/ËØ≠Ê≥ïÁ∫†Ê≠£„ÄÅ‰ΩúËÄÖËØÜÂà´„ÄÅÊú∫Âô®ÁøªËØë„ÄÅÊëòË¶Å„ÄÅÂØπËØùÁ≠âÁ≠â</li></ul><h2 id="Ë¶ÅÁÇπÂõûÈ°æ">3.3 Ë¶ÅÁÇπÂõûÈ°æ</h2><p><strong>ËØ≠Ë®ÄÊ®°Âûã</strong>ÔºàLM: LanguageModelÔºâÔºöÈ¢ÑÊµã‰∏ã‰∏Ä‰∏™ÂçïËØçÁöÑÁ≥ªÁªü</p><p>Âæ™ÁéØÁ•ûÁªèÁΩëÁªúÔºö‰∏ÄÁ≥ªÂàóÁ•ûÁªèÁΩëÁªú</p><ul><li>ÈááÁî®‰ªªÊÑèÈïøÂ∫¶ÁöÑÈ°∫Â∫èËæìÂÖ•</li><li>Âú®ÊØè‰∏ÄÊ≠•‰∏äÂ∫îÁî®Áõ∏ÂêåÁöÑÊùÉÈáç</li><li>ÂèØ‰ª•ÈÄâÊã©Âú®ÊØè‰∏ÄÊ≠•‰∏äÁîüÊàêËæìÂá∫</li></ul><p>Âæ™ÁéØÁ•ûÁªèÁΩëÁªú<spanclass="math inline">\(\ne\)</span>ËØ≠Ë®ÄÊ®°ÂûãÔºåÊàë‰ª¨Â∑≤ÁªèËØÅÊòéÔºåRNNsÊòØÊûÑÂª∫LMÁöÑ‰∏Ä‰∏™ÂæàÂ•ΩÁöÑÊñπÊ≥ïÔºå‰ΩÜRNNsÁöÑÁî®Â§ÑË¶ÅÂ§ßÂæóÂ§ö!</p><h2 id="rnnÂèØÁî®‰∫éÊâìÊ†áÁ≠æ">3.4 RNNÂèØÁî®‰∫éÊâìÊ†áÁ≠æ</h2><p><img src="/img/nlp/Á¨¨ÂÖ≠ËÆ≤/8.png" /></p><h2 id="rnnÂèØÁî®‰∫éÂè•Â≠êÂàÜÁ±ª">3.5 RNNÂèØÁî®‰∫éÂè•Â≠êÂàÜÁ±ª</h2><p>Â¶Ç‰ΩïËÆ°ÁÆóÂè•Â≠êÁºñÁ†Å</p><p><strong>Âü∫Á°ÄÊñπÂºè</strong>Ôºö‰ΩøÁî®ÊúÄÁªàÈöêÂ±ÇÁä∂ÊÄÅ</p><p><img src="/img/nlp/Á¨¨ÂÖ≠ËÆ≤/9.png" /></p><p>ÈÄöÂ∏∏Êõ¥Â•ΩÁöÑÊñπÂºèÔºö‰ΩøÁî®ÊâÄÊúâÈöêÂ±ÇÁä∂ÊÄÅÁöÑÈÄêÂÖÉÁ¥†ÊúÄÂÄºÊàñÂùáÂÄºÔºåEncoderÁöÑÁªìÊûÑÂú®NLP‰∏≠ÈùûÂ∏∏Â∏∏ËßÅ</p><p><img src="/img/nlp/Á¨¨ÂÖ≠ËÆ≤/10.png" /></p><h2 id="rnnËØ≠Ë®ÄÊ®°ÂûãÂèØÁî®‰∫éÁîüÊàêÊñáÊú¨">3.6 RNNËØ≠Ë®ÄÊ®°ÂûãÂèØÁî®‰∫éÁîüÊàêÊñáÊú¨</h2><p>ËøôÊòØ‰∏Ä‰∏™Êù°‰ª∂ËØ≠Ë®ÄÊ®°ÂûãÁöÑÁ§∫‰æã„ÄÇÊàë‰ª¨‰ΩøÁî®ËØ≠Ë®ÄÊ®°ÂûãÁªÑ‰ª∂ÔºåÂπ∂‰∏îÊúÄÂÖ≥ÈîÆÁöÑÊòØÔºåÊàë‰ª¨Ê†πÊçÆÊù°‰ª∂Êù•Ë∞ÉÊï¥ÂÆÉ</p><p><img src="/img/nlp/Á¨¨ÂÖ≠ËÆ≤/11.png" /></p><p>ÂèÇËÄÉÔºö</p><p>http://www.showmeai.tech/article-detail/240</p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Á¨¨‰∫îËÆ≤-Âè•Ê≥ïÂàÜÊûê‰∏é‰æùÂ≠òËß£Êûê</title>
    <link href="/2022/05/12/%E7%AC%AC%E4%BA%94%E8%AE%B2-%E5%8F%A5%E6%B3%95%E5%88%86%E6%9E%90%E4%B8%8E%E4%BE%9D%E5%AD%98%E8%A7%A3%E6%9E%90/"/>
    <url>/2022/05/12/%E7%AC%AC%E4%BA%94%E8%AE%B2-%E5%8F%A5%E6%B3%95%E5%88%86%E6%9E%90%E4%B8%8E%E4%BE%9D%E5%AD%98%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="Âè•Ê≥ïÁªìÊûÑÊàêÂàÜ‰∏é‰æùËµñ">1.Âè•Ê≥ïÁªìÊûÑÔºöÊàêÂàÜ‰∏é‰æùËµñ</h1><h2 id="ËØ≠Ë®ÄÁªìÊûÑÁöÑ‰∏§ÁßçËßÇÁÇπÊó†‰∏ä‰∏ãÊñáËØ≠Ê≥ï">1.1ËØ≠Ë®ÄÁªìÊûÑÁöÑ‰∏§ÁßçËßÇÁÇπÔºöÊó†‰∏ä‰∏ãÊñáËØ≠Ê≥ï</h2><p>Âè•Â≠êÊòØ‰ΩøÁî®ÈÄêÊ≠•ÂµåÂ•óÁöÑÂçïÂÖÉÊûÑÂª∫ÁöÑ</p><ul><li>ÂèØ‰ª•ÈÄöËøáCFGÔºàcontext-free grammars Êó†‰∏ä‰∏ãÊñáËØ≠Ê≥ïÔºâËßÑÂàôË°®Á§∫ËØ≠Ê≥ï</li></ul><p><strong>Ëµ∑Ê≠•ÂçïÂÖÉ</strong>ÔºöÂçïËØçË¢´Ëµã‰∫à‰∏Ä‰∏™Á±ªÂà´Ôºàpart of speech = posËØçÊÄßÔºâ</p><ul><li>the, cat, cuddly, by, door</li><li>Det, N, Adj, P, N</li></ul><p><strong>ÂçïËØç</strong>ÊåâÁ±ªÂà´ÁªÑÂêàÊàê<strong>Áü≠ËØ≠</strong></p><ul><li>the cuddly cat ÔºöNP =&gt; Det Adj N</li><li>by the door ÔºöPP =&gt;P N P</li></ul><p><strong>Áü≠ËØ≠</strong>ÂèØ‰ª•ÈÄíÂΩíÂú∞ÁªÑÂêàÊàê<strong>Êõ¥Â§ßÁöÑÁü≠ËØ≠</strong></p><ul><li>the cuddly cat by the doorÔºö=&gt; NP ‚Üí NP PP</li></ul><p>Ë°•ÂÖÖÔºö</p><ul><li><strong>Det</strong> ÊåáÁöÑÊòØ<code>Determiner</code>ÔºåÂú®ËØ≠Ë®ÄÂ≠¶‰∏≠ÁöÑÂê´‰πâ‰∏∫ <strong>ÈôêÂÆöËØç</strong></li><li><strong>NP</strong> ÊåáÁöÑÊòØ<code>Noun Phrase</code>ÔºåÂú®ËØ≠Ë®ÄÂ≠¶‰∏≠ÁöÑÂê´‰πâ‰∏∫<strong>ÂêçËØçÁü≠ËØ≠</strong></li><li><strong>VP</strong> ÊåáÁöÑÊòØ<code>Verb Phrase</code>ÔºåÂú®ËØ≠Ë®ÄÂ≠¶‰∏≠ÁöÑÂê´‰πâ‰∏∫<strong>Âä®ËØçÁü≠ËØ≠</strong></li><li><strong>P</strong> ÊåáÁöÑÊòØ<code>Preposition</code>ÔºåÂú®ËØ≠Ë®ÄÂ≠¶‰∏≠ÁöÑÂê´‰πâ‰∏∫ <strong>‰ªãËØç</strong></li><li><strong>PP</strong> ÊåáÁöÑÊòØ<code>Prepositional Phrase</code>ÔºåÂú®ËØ≠Ë®ÄÂ≠¶‰∏≠ÁöÑÂê´‰πâ‰∏∫<strong>‰ªãËØçÁü≠ËØ≠</strong></li></ul><p><img src="/img/nlp/Á¨¨‰∫îËÆ≤/1.png" /></p><h2 id="ËØ≠Ë®ÄÁªìÊûÑÁöÑ‰∏§ÁßçËßÇÁÇπ‰æùËµñÁªìÊûÑ">1.2ËØ≠Ë®ÄÁªìÊûÑÁöÑ‰∏§ÁßçËßÇÁÇπÔºö‰æùËµñÁªìÊûÑ</h2><p>‰∏çÊòØ‰ΩøÁî®ÂêÑÁßçÁ±ªÂûãÁöÑÁü≠ËØ≠ÔºåËÄåÊòØÁõ¥Êé•ÈÄöËøáÂçïËØç‰∏éÂÖ∂‰ªñÁöÑÂçïËØçÂÖ≥Á≥ªË°®Á§∫Âè•Â≠êÁöÑÁªìÊûÑÔºåÊòæÁ§∫Âì™‰∫õÂçïËØç‰æùËµñ‰∫é(‰øÆÈ•∞ÊàñÊòØÂÖ∂ÂèÇÊï∞)Âì™‰∫õÂÖ∂‰ªñÂçïËØç</p><p><img src="/img/nlp/Á¨¨‰∫îËÆ≤/2.png" /></p><ul><li><p>lookÊòØÊï¥‰∏™Âè•Â≠êÁöÑÊ†πÊ∫êÔºålook‰æùËµñ‰∫écrate(ÊàñËÄÖËØ¥crateÊòØlookÁöÑ‰æùËµñ</p><ul><li><p><code>in</code>Ôºå<code>the</code>Ôºå<code>large</code> ÈÉΩÊòØ<code>crate</code> ÁöÑ‰æùËµñ</p></li><li><p><code>in the kitchen</code> ÊòØ <code>crate</code> ÁöÑ‰øÆÈ•∞</p></li><li><p><code>in</code>Ôºå<code>the</code> ÈÉΩÊòØ <code>kitchen</code>ÁöÑ‰æùËµñ</p></li><li><p><code>by the door</code> ÊòØ <code>crate</code> ÁöÑ‰æùËµñ</p></li></ul></li></ul><h2 id="‰∏∫‰ªÄ‰πàÊàë‰ª¨ÈúÄË¶ÅÂè•Â≠êÁªìÊûÑ">1.3 ‰∏∫‰ªÄ‰πàÊàë‰ª¨ÈúÄË¶ÅÂè•Â≠êÁªìÊûÑÔºü</h2><p>‰∏∫‰∫ÜËÉΩÂ§üÊ≠£Á°ÆÂú∞Ëß£ÈáäËØ≠Ë®ÄÔºåÊàë‰ª¨ÈúÄË¶ÅÁêÜËß£Âè•Â≠êÁªìÊûÑ</p><p>‰∫∫Á±ªÈÄöËøáÂ∞ÜÂçïËØçÁªÑÂêàÊàêÊõ¥Â§ßÁöÑÂçïÂÖÉÊù•‰º†ËææÂ§çÊùÇÁöÑÊÑèÊÄùÔºå‰ªéËÄå‰∫§ÊµÅÂ§çÊùÇÁöÑÊÄùÊÉ≥</p><p>Êàë‰ª¨ÈúÄË¶ÅÁü•ÈÅì‰ªÄ‰πà‰∏é‰ªÄ‰πàÁõ∏ÂÖ≥ËÅî</p><h2 id="‰ªãËØçÁü≠ËØ≠‰æùÈôÑÊ≠ß‰πâ">1.4 ‰ªãËØçÁü≠ËØ≠‰æùÈôÑÊ≠ß‰πâ</h2><p>1„ÄÅ<code>San Jose cops kill man with knife</code></p><ul><li>Ë≠¶ÂØüÁî®ÂàÄÊùÄ‰∫ÜÈÇ£‰∏™Áî∑Â≠ê<ul><li><code>cops</code> ÊòØ <code>kill</code> ÁöÑ <code>subject</code>(subject Êåá <strong>‰∏ªËØ≠</strong>)</li><li><code>man</code> ÊòØ <code>kill</code> ÁöÑ <code>object</code> (objectÊåá <strong>ÂÆæËØ≠</strong>)</li><li><code>knife</code> ÊòØ <code>kill</code> ÁöÑ <code>modifier</code>(modifier Êåá <strong>‰øÆÈ•∞Á¨¶</strong>)</li></ul></li><li>Ë≠¶ÂØüÊùÄ‰∫ÜÈÇ£‰∏™ÊúâÂàÄÁöÑÁî∑Â≠ê<ul><li><code>knife</code> ÊòØ <code>man</code> ÁöÑ <code>modifier</code>(ÂêçËØç‰øÆÈ•∞Á¨¶ÔºåÁÆÄÁß∞‰∏∫ <code>nmod</code>)</li></ul></li></ul><p>2„ÄÅ<code>Scientists count whales from space</code></p><ul><li><code>from space</code>Ëøô‰∏Ä‰ªãËØçÁü≠ËØ≠‰øÆÈ•∞ÁöÑÊòØÂâçÈù¢ÁöÑÂä®ËØç<code>count</code>ËøòÊòØÂêçËØç<code>whales</code>?<ul><li>ËøôÂ∞±ÊòØ‰∫∫Á±ªËØ≠Ë®ÄÂíåÁºñÁ®ãËØ≠Ë®Ä‰∏≠‰∏çÂêåÁöÑÂú∞Êñπ</li></ul></li></ul><h2 id="‰ªãËØçÁü≠ËØ≠ÈôÑÂä†Ê≠ß‰πâÊàêÂÄçÂ¢ûÂä†">1.5 ‰ªãËØçÁü≠ËØ≠ÈôÑÂä†Ê≠ß‰πâÊàêÂÄçÂ¢ûÂä†</h2><p>ÂÖ≥ÈîÆÁöÑËß£ÊûêÂÜ≥Á≠ñÊòØÊàë‰ª¨Â¶Ç‰Ωï‚Äú‰æùÂ≠ò‚ÄùÂêÑÁßçÊàêÂàÜ</p><ul><li>‰ªãËØçÁü≠ËØ≠„ÄÅÁä∂ËØ≠ÊàñÂàÜËØçÁü≠ËØ≠„ÄÅ‰∏çÂÆöÂºè„ÄÅÂçèË∞ÉÁ≠â„ÄÇ</li></ul><p><code>The board approved [ its acquisition ] [ by Royal Trustco Ltd. ] [ of Toronto ] [ for $27 a share ] [ at its monthly meeting ].</code></p><ul><li><code>board</code> ÊòØ <code>approved</code>ÁöÑ‰∏ªËØ≠Ôºå<code>acquisition</code> ÊòØ <code>approved</code> ÁöÑË∞ìËØ≠</li><li><code>by Royal Trustco Ltd.</code> ÊòØ‰øÆÈ•∞ <code>acquisition</code>ÁöÑÔºåÂç≥Ëë£‰∫ã‰ºöÊâπÂáÜ‰∫ÜËøôÂÆ∂ÂÖ¨Âè∏ÁöÑÊî∂Ë¥≠</li><li><code>of Toronto</code> ÂèØ‰ª•‰øÆÈ•∞<code>approved</code>Ôºå<code>acquisition</code>Ôºå<code>Royal Trustco Ltd.</code>‰πã‰∏ÄÔºåÁªèËøáÂàÜÊûêÂèØ‰ª•ÂæóÁü•ÊòØ‰øÆÈ•∞<code>Royal Trustco Ltd.</code>ÔºåÂç≥Ë°®Á§∫ËøôÂÆ∂ÂÖ¨Âè∏ÁöÑ‰ΩçÁΩÆ</li><li><code>for $27 a share</code> ‰øÆÈ•∞ <code>acquisition</code></li><li><code>at its monthly meeting</code> ‰øÆÈ•∞<code>approved</code>ÔºåÂç≥Ë°®Á§∫ÊâπÂáÜÁöÑÊó∂Èó¥Âú∞ÁÇπ</li></ul><p>Èù¢ÂØπËøôÊ†∑Â§çÊùÇÁöÑÂè•Â≠êÁªìÊûÑÔºåÊàë‰ª¨ÈúÄË¶ÅËÄÉËôë ÊåáÊï∞Á∫ßÁöÑÂèØËÉΩÁªìÊûÑÔºåËøô‰∏™Â∫èÂàóË¢´Áß∞‰∏∫ <strong>Âç°ÁâπÂÖ∞Êï∞/Catalan numbers</strong><span class="math display">\[C_{n}=(2 n) ! /[(n+1) ! n !]\]</span></p><h2 id="ÂçèË∞ÉËåÉÂõ¥Ê®°Á≥ä">1.6 ÂçèË∞ÉËåÉÂõ¥Ê®°Á≥ä</h2><p>1„ÄÅ<code>Shuttle veteran and longtime NASA executive Fred Gregory appointed to board</code></p><ul><li>‰∏Ä‰∏™‰∫∫Ôºö<code>[[Shuttle veteran and longtime NASA executive] Fred Gregory] appointed to board</code></li><li>‰∏§‰∏™‰∫∫Ôºö<code>[Shuttle veteran] and [longtime NASA executive Fred Gregory] appointed to board</code></li></ul><p>2„ÄÅ<code>Students get first hand job experience</code></p><ul><li><code>first hand</code>Ë°®Á§∫Á¨¨‰∏ÄÊâãÁöÑÔºåÁõ¥Êé•ÁöÑÔºåÂç≥Â≠¶ÁîüËé∑Âæó‰∫ÜÁõ¥Êé•ÁöÑÂ∑•‰ΩúÁªèÈ™å<ul><li><code>first</code> ÊòØ <code>hand</code> ÁöÑÂΩ¢ÂÆπËØç‰øÆÈ•∞ËØ≠(amod)</li></ul></li><li><code>first</code> ‰øÆÈ•∞ <code>experience</code>Ôºå<code>hand</code>‰øÆÈ•∞ <code>job</code></li></ul><h2 id="Âä®ËØçÁü≠ËØ≠vp‰æùÂ≠òÊ≠ß‰πâ">1.7 Âä®ËØçÁü≠ËØ≠(VP)‰æùÂ≠òÊ≠ß‰πâ</h2><p><code>Mutilated body washes up on Rio beach to be used for Olympic beach volleyball</code></p><ul><li><code>to be used for Olympic beach volleyball</code> ÊòØ Âä®ËØçÁü≠ËØ≠(VP)</li><li>‰øÆÈ•∞ÁöÑÊòØ <code>body</code> ËøòÊòØ <code>beach</code></li></ul><h1 id="‰æùËµñËØ≠Ê≥ï‰∏éÊ†ëÂ∫ì">2.‰æùËµñËØ≠Ê≥ï‰∏éÊ†ëÂ∫ì</h1><h2 id="ËÆ∫ÊñáËß£ËØª-‰æùËµñË∑ØÂæÑËØÜÂà´ËØ≠‰πâÂÖ≥Á≥ª">2.1 #ËÆ∫ÊñáËß£ËØª#‰æùËµñË∑ØÂæÑËØÜÂà´ËØ≠‰πâÂÖ≥Á≥ª</h2><p><img src="/img/nlp/Á¨¨‰∫îËÆ≤/3.png" /></p><h2 id="‰æùÂ≠òÊñáÊ≥ïÂíå‰æùÂ≠òÁªìÊûÑ">2.2 ‰æùÂ≠òÊñáÊ≥ïÂíå‰æùÂ≠òÁªìÊûÑ</h2><p>ÂÖ≥ËÅîËØ≠Ê≥ïÂÅáËÆæÂè•Ê≥ïÁªìÊûÑÂåÖÊã¨ËØçÊ±áÈ°π‰πãÈó¥ÁöÑÂÖ≥Á≥ªÔºåÈÄöÂ∏∏ÊòØ‰∫åÂÖÉ‰∏çÂØπÁß∞ÂÖ≥Á≥ª(‚ÄúÁÆ≠Â§¥‚Äù)ÔºåÁß∞‰∏∫<strong>‰æùËµñÂÖ≥Á≥ª</strong></p><p><strong>Dependency StructureÊúâ‰∏§ÁßçË°®Áé∞ÂΩ¢Âºè</strong></p><ol type="1"><li><p><strong>‰∏ÄÁßçÊòØÁõ¥Êé•Âú®Âè•Â≠ê‰∏äÊ†áÂá∫‰æùÂ≠òÂÖ≥Á≥ªÁÆ≠Â§¥ÂèäËØ≠Ê≥ïÂÖ≥Á≥ª</strong></p></li><li><p><strong>Âè¶‰∏ÄÁßçÊòØÂ∞ÜÂÖ∂ÂÅöÊàêÊ†ëÁä∂Êú∫ÊûÑ(Dependency TreeGraph)</strong></p></li></ol><ul><li>ÁÆ≠Â§¥ÈÄöÂ∏∏Ê†áËÆ∞(type)‰∏∫ËØ≠Ê≥ïÂÖ≥Á≥ªÁöÑÂêçÁß∞(‰∏ªÈ¢ò„ÄÅ‰ªãËØçÂØπË±°„ÄÅappositionÁ≠â)</li><li>ÁÆ≠Â§¥ËøûÊé•Â§¥ÈÉ®(head)(Ë∞ÉÈÄüÂô®Ôºå‰∏äÁ∫ßÔºåregent)Âíå‰∏Ä‰∏™‰æùËµñ(‰øÆÈ•∞ËØçÔºå‰∏ãÁ∫ßÔºå‰∏ãÂ±û)</li><li>ÈÄöÂ∏∏Ôºå‰æùËµñÂÖ≥Á≥ªÂΩ¢Êàê‰∏ÄÊ£µÊ†ë(ÂçïÂ§¥ÔºåÊó†ÁéØÔºåËøûÊé•Âõæ)</li></ul><h2 id="‰æùÂ≠òËØ≠Ê≥ïËß£ÊûêÂéÜÂè≤">2.3 ‰æùÂ≠òËØ≠Ê≥ï/Ëß£ÊûêÂéÜÂè≤</h2><ul><li>‰æùËµñÁªìÊûÑÁöÑÊ¶ÇÂøµÂèØ‰ª•ËøΩÊ∫ØÂà∞Âæà‰πÖ‰ª•Ââç<ul><li>Pa·πáiniÁöÑËØ≠Ê≥ï(ÂÖ¨ÂÖÉÂâç5‰∏ñÁ∫™)</li><li>‰∏ÄÂçÉÂπ¥ÔºåÈòøÊãâ‰ºØËØ≠ÁöÑËØ≠Ê≥ïÁöÑÂü∫Êú¨ÊñπÊ≥ï</li></ul></li><li>ÈÄâÂå∫/‰∏ä‰∏ãÊñáÊó†ÂÖ≥ÊñáÊ≥ïÊòØ‰∏Ä‰∏™Êñ∞Â•áÁöÑÂèëÊòé<ul><li>20‰∏ñÁ∫™ÂèëÊòé(R.S.Wells,1947; then Chomsky)</li></ul></li><li>Áé∞‰ª£‰æùËµñÂ∑•‰ΩúÁªèÂ∏∏Ê∫ê‰∫é L. Tesni√®re(1959)<ul><li>ÊòØ20‰∏ñÁ∫™‚Äú‰∏úÊñπ‚ÄùÁöÑ‰∏ªÂØºÊñπÊ≥ï(‰øÑÁΩóÊñØÔºå‰∏≠ÂõΩÔºå‚Ä¶)<ul><li>ÊúâÂà©‰∫éÊõ¥Ëá™Áî±ÁöÑËØ≠Â∫èËØ≠Ë®Ä</li></ul></li></ul></li><li>NLP‰∏≠ÊúÄÊó©Á±ªÂûãÁöÑËß£ÊûêÂô®Âú®ÁæéÂõΩ<ul><li>David HaysÊòØÁæéÂõΩËÆ°ÁÆóËØ≠Ë®ÄÂ≠¶ÁöÑÂàõÂßã‰∫∫‰πã‰∏ÄÔºå‰ªñÂæàÊó©Â∞±(Á¨¨‰∏Ä‰∏™?)ÊûÑÂª∫‰∫Ü‰æùËµñËß£ÊûêÂô®(Hays1962)</li></ul></li></ul><h2 id="‰æùÂ≠òËØ≠Ê≥ïÂíå‰æùËµñÁªìÊûÑ">2.4 ‰æùÂ≠òËØ≠Ê≥ïÂíå‰æùËµñÁªìÊûÑ</h2><ul><li>‰∫∫‰ª¨ÂØπÁÆ≠Â§¥ÊåáÂêëÁöÑÊñπÂºè‰∏ç‰∏ÄËá¥ÔºöÊúâ‰∫õ‰∫∫ÊääÁÆ≠Â§¥Êúù‰∏Ä‰∏™ÊñπÂêëÁîªÔºõÊúâ‰∫∫ÊòØÂèçËøáÊù•ÁöÑ<ul><li>Tesni√®re ‰ªéÂ§¥ÂºÄÂßãÊåáÂêë‰æùËµñÔºåÊú¨ËØæ‰ΩøÁî®Ê≠§ÁßçÊñπÂºè</li></ul></li><li>ÈÄöÂ∏∏Ê∑ªÂä†‰∏Ä‰∏™‰º™Ê†πÊåáÂêëÊï¥‰∏™Âè•Â≠êÁöÑÂ§¥ÈÉ®ÔºåËøôÊ†∑ÊØè‰∏™ÂçïËØçÈÉΩÁ≤æÁ°ÆÂú∞‰æùËµñ‰∫éÂè¶‰∏Ä‰∏™ËäÇÁÇπ</li></ul><p><img src="/img/nlp/Á¨¨‰∫îËÆ≤/4.png" /></p><h2 id="Â∏¶Ê≥®ÈáäÊï∞ÊçÆÁöÑÂÖ¥Ëµ∑ÈÄöÁî®‰æùÂ≠òÂè•Ê≥ïÊ†ëÂ∫ì">2.5Â∏¶Ê≥®ÈáäÊï∞ÊçÆÁöÑÂÖ¥Ëµ∑ÔºöÈÄöÁî®‰æùÂ≠òÂè•Ê≥ïÊ†ëÂ∫ì</h2><p><img src="/img/nlp/Á¨¨‰∫îËÆ≤/5.png" /></p><h2 id="Â∏¶Ê≥®ÈáäÊï∞ÊçÆÁöÑÂÖ¥Ëµ∑">2.6 Â∏¶Ê≥®ÈáäÊï∞ÊçÆÁöÑÂÖ¥Ëµ∑</h2><ul><li><p><strong>‰ªé‰∏ÄÂºÄÂßãÔºåÊûÑÂª∫ treebank‰ºº‰πéÊØîÊûÑÂª∫ËØ≠Ê≥ïÊÖ¢ÂæóÂ§öÔºå‰πüÊ≤°ÊúâÈÇ£‰πàÊúâÁî®</strong></p></li><li><p>‰ΩÜÊòØ treebank ÁªôÊàë‰ª¨Êèê‰æõ‰∫ÜËÆ∏Â§ö‰∏úË•ø</p><ul><li>ÂèØÈáçÁî®ÊÄß<ul><li>ËÆ∏Â§öËß£ÊûêÂô®„ÄÅËØçÊÄßÊ†áËÆ∞Âô®Á≠âÂèØ‰ª•ÊûÑÂª∫Âú®ÂÆÉ‰πã‰∏ä</li><li>ËØ≠Ë®ÄÂ≠¶ÁöÑÂÆùË¥µËµÑÊ∫ê</li></ul></li><li>ÂπøÊ≥õÁöÑË¶ÜÁõñÈù¢ÔºåËÄå‰∏ç‰ªÖ‰ªÖÊòØ‰∏Ä‰∫õÁõ¥Ëßâ</li><li>È¢ëÁéáÂíåÂàÜÂ∏É‰ø°ÊÅØ</li><li>‰∏ÄÁßçËØÑ‰º∞Á≥ªÁªüÁöÑÊñπÊ≥ï</li></ul></li></ul><h2 id="‰æùËµñÊù°‰ª∂È¶ñÈÄâÈ°π">2.7 ‰æùËµñÊù°‰ª∂È¶ñÈÄâÈ°π</h2><p><strong>‰æùËµñÈ°πËß£ÊûêÁöÑ‰ø°ÊÅØÊù•Ê∫êÊòØ‰ªÄ‰πà</strong>Ôºü</p><p>1.<strong>Bilexical affinities</strong> (‰∏§‰∏™ÂçïËØçÈó¥ÁöÑÂØÜÂàáÂÖ≥Á≥ª) -[discussion ‚Üí issues] ÊòØÁúã‰∏äÂéªÊúâÈÅìÁêÜÁöÑ</p><p>2.<strong>Dependency distance ‰æùËµñË∑ùÁ¶ª</strong> - ‰∏ªË¶ÅÊòØ‰∏éÁõ∏ÈÇªËØç</p><p>3.<strong>Intervening material ‰ªã‰∫é‰∏≠Èó¥ÁöÑÁâ©Ë¥®</strong> -‰æùËµñÂæàÂ∞ëË∑®Ë∂ä‰ªã‰∫é‰∏≠Èó¥ÁöÑÂä®ËØçÊàñÊ†áÁÇπÁ¨¶Âè∑</p><p>4.<strong>Valency of heads</strong> - How many dependents on whichside are usual for a head?</p><p><img src="/img/nlp/Á¨¨‰∫îËÆ≤/6.png" /></p><h2 id="‰æùËµñÂÖ≥Á≥ªÂàÜÊûê">2.8 ‰æùËµñÂÖ≥Á≥ªÂàÜÊûê</h2><ul><li><p>ÈÄöËøá‰∏∫ÊØè‰∏™ÂçïËØçÈÄâÊã©ÂÆÉÊâÄ‰æùËµñÁöÑÂÖ∂‰ªñÂçïËØç(ÂåÖÊã¨Ê†π)Êù•Ëß£Êûê‰∏Ä‰∏™Âè•Â≠ê</p></li><li><p>ÈÄöÂ∏∏Êúâ‰∏Ä‰∫õÈôêÂà∂</p><ul><li>Âè™Êúâ‰∏Ä‰∏™ÂçïËØçÊòØ‰æùËµñ‰∫éÊ†πÁöÑ</li><li>‰∏çÂ≠òÂú®Âæ™ÁéØ A‚ÜíBÔºåB‚ÜíA</li></ul></li><li><p>Ëøô‰ΩøÂæó‰æùËµñÈ°πÊàê‰∏∫Ê†ë</p></li><li><p>ÊúÄÂêé‰∏Ä‰∏™ÈóÆÈ¢òÊòØÁÆ≠Â§¥ÊòØÂê¶ÂèØ‰ª•‰∫§Âèâ(ÈùûÊäïÂΩ±ÁöÑ non-projective)</p><ul><li>Ê≤°Êúâ‰∫§ÂèâÁöÑÂ∞±ÊòØnon-projectice</li></ul></li></ul><p><img src="/img/nlp/Á¨¨‰∫îËÆ≤/7.png" /></p><h2 id="Â∞ÑÂΩ±ÊÄß">2.9 Â∞ÑÂΩ±ÊÄß</h2><ul><li><p>ÂÆö‰πâÔºöÂΩìÂçïËØçÊåâÁ∫øÊÄßÈ°∫Â∫èÊéíÂàóÊó∂ÔºåÊ≤°Êúâ‰∫§ÂèâÁöÑ‰æùËµñÂºßÔºåÊâÄÊúâÁöÑÂºßÈÉΩÂú®ÂçïËØçÁöÑ‰∏äÊñπ</p></li><li><p>‰∏éCFGÊ†ëÂπ∂Ë°åÁöÑ‰æùËµñÂÖ≥Á≥ªÂøÖÈ°ªÊòØÊäïÂΩ±ÁöÑ</p><ul><li>ÈÄöËøáÂ∞ÜÊØè‰∏™Á±ªÂà´ÁöÑ‰∏Ä‰∏™Â≠êÁ±ªÂà´‰Ωú‰∏∫Â§¥Êù•ÂΩ¢Êàê‰æùËµñÂÖ≥Á≥ª</li></ul></li><li><p>‰ΩÜÊòØ‰æùËµñÁêÜËÆ∫ÈÄöÂ∏∏ÂÖÅËÆ∏ÈùûÊäïÂ∞ÑÁªìÊûÑÊù•Ëß£ÈáäÁßª‰ΩçÁöÑÊàêÂàÜ</p><ul><li>Â¶ÇÊûúÊ≤°ÊúâËøô‰∫õÈùûÊäïÂ∞Ñ‰æùËµñÂÖ≥Á≥ªÔºåÂ∞±‰∏çÂèØËÉΩÂæàÂÆπÊòìËé∑ÂæóÊüê‰∫õÁªìÊûÑÁöÑËØ≠‰πâ</li></ul></li></ul><h2 id="‰æùÂ≠òÂàÜÊûêÊñπÊ≥ï">2.10 ‰æùÂ≠òÂàÜÊûêÊñπÊ≥ï</h2><p>1.<strong>Dynamic programming</strong></p><ul><li>Eisner(1996)ÊèêÂá∫‰∫Ü‰∏ÄÁßçÂ§çÊùÇÂ∫¶‰∏∫ O(n3)ÁöÑËÅ™ÊòéÁÆóÊ≥ïÔºåÂÆÉÁîüÊàêÂ§¥ÈÉ®‰Ωç‰∫éÊú´Â∞æËÄå‰∏çÊòØ‰∏≠Èó¥ÁöÑËß£ÊûêÈ°π</li></ul><p>2.<strong>Graph algorithms</strong></p><ul><li>‰∏∫‰∏Ä‰∏™Âè•Â≠êÂàõÂª∫‰∏Ä‰∏™ÊúÄÂ∞èÁîüÊàêÊ†ë</li><li>McDonald et al.‚Äôs (2005) MSTParser‰ΩøÁî®MLÂàÜÁ±ªÂô®Áã¨Á´ãÂú∞ÂØπ‰æùËµñÈ°πËøõË°åËØÑÂàÜ(‰ªñ‰ΩøÁî®MIRAËøõË°åÂú®Á∫øÂ≠¶‰π†Ôºå‰ΩÜÂÆÉ‰πüÂèØ‰ª•ÊòØÂÖ∂‰ªñ‰∏úË•ø)</li></ul><p>3.<strong>Constraint Satisfaction</strong></p><ul><li>ÂéªÊéâ‰∏çÊª°Ë∂≥Á°¨Á∫¶ÊùüÁöÑËæπ Karlsson(1990), etc.</li></ul><p>4.<strong>‚ÄúTransition-based parsing‚Äù or ‚Äúdeterministic dependencyparsing‚Äù</strong></p><ul><li>ËâØÂ•ΩÁöÑÊú∫Âô®Â≠¶‰π†ÂàÜÁ±ªÂô® MaltParser(Nivreet al. 2008)ÊåáÂØº‰∏ãÁöÑ‰æùÂ≠òË¥™Â©™ÈÄâÊã©„ÄÇÂ∑≤ËØÅÊòéÈùûÂ∏∏ÊúâÊïà„ÄÇ</li></ul><h1 id="Âü∫‰∫éËΩ¨Êç¢ÁöÑ‰æùÂ≠òÂàÜÊûêÊ®°Âûã">3.Âü∫‰∫éËΩ¨Êç¢ÁöÑ‰æùÂ≠òÂàÜÊûêÊ®°Âûã</h1><h2 id="ËÆ∫ÊñáËß£ËØª-greedy-transition-based-parsing-nivre-2003">3.1#ËÆ∫ÊñáËß£ËØª# Greedy transition-based parsing [Nivre 2003]</h2><ul><li>Ë¥™Â©™Âà§Âà´‰æùËµñËß£ÊûêÂô®‰∏ÄÁßçÁÆÄÂçïÂΩ¢Âºè</li><li>Ëß£ÊûêÂô®ÊâßË°å‰∏ÄÁ≥ªÂàóËá™Â∫ïÂêë‰∏äÁöÑÊìç‰Ωú<ul><li>Â§ßËá¥Á±ª‰ºº‰∫éshift-reduceËß£ÊûêÂô®‰∏≠ÁöÑ‚Äúshift‚ÄùÊàñ‚Äúreduce‚ÄùÔºå‰ΩÜ‚Äúreduce‚ÄùÊìç‰Ωú‰∏ìÈó®Áî®‰∫éÂàõÂª∫Â§¥Âú®Â∑¶ÊàñÂè≥ÁöÑ‰æùËµñÈ°π</li></ul></li><li>Ëß£ÊûêÂô®Â¶Ç‰∏ãÔºö<ul><li>Ê†à<span class="math inline">\(\sigma\)</span>‰ª• ROOTÁ¨¶Âè∑ÂºÄÂßãÔºåÁî±Ëã•Âπ≤ÁªÑ<span class="math inline">\(w_i\)</span>Êàê</li><li>ÁºìÂ≠ò<spanclass="math inline">\(\beta\)</span>‰ª•ËæìÂÖ•Â∫èÂàóÂºÄÂßãÔºåÁî±Ëã•Âπ≤<spanclass="math inline">\(w_i\)</span>ÁªÑÊàê</li><li>‰∏Ä‰∏™‰æùÂ≠òÂºßÁöÑÈõÜÂêà<spanclass="math inline">\(A\)</span>Ôºå‰∏ÄÂºÄÂßã‰∏∫Á©∫„ÄÇÊØèÊù°ËæπÁöÑÂΩ¢ÂºèÊòØ<spanclass="math inline">\((w_i,r,w_j)\)</span>ÔºåÂÖ∂‰∏≠<spanclass="math inline">\(r\)</span>ÊèèËø∞‰∫ÜËäÇÁÇπÁöÑ‰æùÂ≠òÂÖ≥Á≥ª</li><li>‰∏ÄÁªÑÊìç‰Ωú</li></ul></li></ul><h2 id="Âü∫Êú¨ÁöÑÂü∫‰∫éËΩ¨Êç¢ÁöÑ‰æùÂ≠òÂÖ≥Á≥ªËß£ÊûêÂô®">3.2Âü∫Êú¨ÁöÑÂü∫‰∫éËΩ¨Êç¢ÁöÑ‰æùÂ≠òÂÖ≥Á≥ªËß£ÊûêÂô®</h2>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Á¨¨ÂõõËÆ≤-Á•ûÁªèÁΩëÁªúÂèçÂêë‰º†Êí≠‰∏éËÆ°ÁÆóÂõæ</title>
    <link href="/2022/05/08/%E7%AC%AC%E5%9B%9B%E8%AE%B2-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E4%B8%8E%E8%AE%A1%E7%AE%97%E5%9B%BE/"/>
    <url>/2022/05/08/%E7%AC%AC%E5%9B%9B%E8%AE%B2-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E4%B8%8E%E8%AE%A1%E7%AE%97%E5%9B%BE/</url>
    
    <content type="html"><![CDATA[<h1id="ÁÆÄÂçïÁ•ûÁªèÁΩëÁªúÁöÑÊ¢ØÂ∫¶Áü©Èòµ‰∏éÂª∫ËÆÆ">1.ÁÆÄÂçïÁ•ûÁªèÁΩëÁªúÁöÑÊ¢ØÂ∫¶Áü©Èòµ‰∏éÂª∫ËÆÆ</h1><h2 id="ÊùÉÈáçÁü©ÈòµÁöÑÂØºÊï∞">1.1 ÊùÉÈáçÁü©ÈòµÁöÑÂØºÊï∞</h2><ul><li><p>ËÆ©Êàë‰ª¨‰ªîÁªÜÁúãÁúãËÆ°ÁÆó<span class="math inline">\(\frac{\partials}{\partial W}\)</span></p></li><li><p>ÂÜçÊ¨°‰ΩøÁî®ÈìæÂºèÊ≥ïÂàô:</p></li><li><p><span class="math display">\[\frac{\partial s}{\partial W}=\frac{\partial s}{\partial h}\frac{\partial h}{\partial z} \frac{\partial z}{\partial W}\]</span></p></li><li><p><span class="math display">\[s=u^{T} h, \ \ \ h=f(z),\ \ \ z=Wx+b\]</span></p></li></ul><h2 id="ÂèçÂêë‰º†Êí≠Ê¢ØÂ∫¶Ê±ÇÂØº">1.2 ÂèçÂêë‰º†Êí≠Ê¢ØÂ∫¶Ê±ÇÂØº</h2><ul><li><p>Ëøô‰∏™ÂáΩÊï∞(‰ªé‰∏äÊ¨°ÂºÄÂßã)</p></li><li><p><span class="math display">\[\frac{\partial s}{\partial W}=\delta \frac{\partial z}{\partialW}=\delta \frac{\partial}{\partial W} W x+b\]</span></p></li><li><p>ËÄÉËôëÂçï‰∏™ÊùÉÈáç<spanclass="math inline">\(W_{ij}\)</span>ÁöÑÂØºÊï∞</p></li><li><p><span class="math inline">\(W_{ij}\)</span>Âè™ÂØπ<spanclass="math inline">\(z_i\)</span>ÊúâË¥°ÁåÆ</p></li></ul><p><span class="math display">\[\begin{aligned}\frac{\partial z_{i}}{\partial W_{i j}} &amp;=\frac{\partial}{\partialW_{i j}} W_{i .} x+b_{i} \\&amp;=\frac{\partial}{\partial W_{i j}} \sum_{k=1}^{d} W_{i k}x_{k}=x_{j}\end{aligned}\]</span></p><p><img src="/img/nlp/Á¨¨ÂõõËÆ≤/1.png" /></p><ul><li><p>ÂØπ‰∫éÂçï‰∏™<spanclass="math inline">\(W_{ij}\)</span>ÁöÑÂØºÊï∞</p></li><li><p><span class="math display">\[\frac{\partial s}{\partial W_{i j}}=\delta_{i} x_{j}\]</span></p></li><li><p>Êàë‰ª¨ÊÉ≥Ë¶ÅÊï¥‰∏™<spanclass="math inline">\(W\)</span>ÁöÑÊ¢ØÂ∫¶Ôºå‰ΩÜÊòØÊØèÁßçÊÉÖÂÜµÈÉΩÊòØ‰∏ÄÊ†∑ÁöÑ</p></li><li><p>Ëß£ÂÜ≥ÊñπÊ≥ïÔºö<strong>Â§ñÁßØ</strong></p></li><li><p><span class="math display">\[\begin{aligned}\frac{\partial s}{\partial W} &amp;=\delta^{T} x^{T} \\{[n \times m] } &amp;=[n \times 1][1 \times m]\end{aligned}\]</span></p></li></ul><h2 id="‰∏∫Á™óÂè£Ê®°ÂûãÊé®ÂØºÊ¢ØÂ∫¶">1.3 ‰∏∫Á™óÂè£Ê®°ÂûãÊé®ÂØºÊ¢ØÂ∫¶</h2><ul><li><p>Âà∞ËææÂπ∂Êõ¥Êñ∞ÂçïËØçÂêëÈáèÁöÑÊ¢ØÂ∫¶ÂèØ‰ª•ÁÆÄÂçïÂú∞ÂàÜËß£‰∏∫ÊØè‰∏™ÂçïËØçÂêëÈáèÁöÑÊ¢ØÂ∫¶</p></li><li><p>‰ª§<span class="math inline">\(\nabla_{x} J=W^{T}\delta=\delta_{x_{\text {window }}}\)</span></p></li><li><p><span class="math inline">\(X_{\text {window}}=\left[\begin{array}{lllll} X_{\text {museums }} &amp; X_{\text {in }}&amp; X_{\text {Paris }} &amp; X_{\text {are }} &amp; X_{\text {amazing}} \end{array}\right]\)</span></p></li><li><p>ÂàôÂæóÂà∞<span class="math inline">\(\delta_{\text {window}}=\left[\begin{array}{c} \nabla_{x_{\text {museums }}} \\\nabla_{x_{\text {in }}} \\ \nabla_{x_{\text {Pare }}} \\\nabla_{x_{\text {are }}} \\ \nabla_{x_{\text {amazing }}}\end{array}\right] \in \mathbb{R}^{5 d}\)</span></p></li><li><p>Êàë‰ª¨Â∞ÜÊ†πÊçÆÊ¢ØÂ∫¶ÈÄê‰∏™Êõ¥Êñ∞ÂØπÂ∫îÁöÑËØçÂêëÈáèÁü©Èòµ‰∏≠ÁöÑËØçÂêëÈáèÔºåÊâÄ‰ª•ÂÆûÈôÖ‰∏äÊòØÂØπËØçÂêëÈáèÁü©ÈòµÁöÑÊõ¥Êñ∞ÊòØÈùûÂ∏∏Á®ÄÁñèÁöÑ</p></li></ul><h2 id="Âú®Á™óÂè£Ê®°Âûã‰∏≠Êõ¥Êñ∞ÂçïËØçÊ¢ØÂ∫¶">1.4 Âú®Á™óÂè£Ê®°Âûã‰∏≠Êõ¥Êñ∞ÂçïËØçÊ¢ØÂ∫¶</h2><ul><li>ÂΩìÊàë‰ª¨Â∞ÜÊ¢ØÂ∫¶Êõ¥Êñ∞Âà∞ËØçÂêëÈáè‰∏≠Êó∂ÔºåËøôÂ∞ÜÊõ¥Êñ∞ÂçïËØçÂêëÈáèÔºå‰ΩøÂÆÉ‰ª¨(ÁêÜËÆ∫‰∏ä)Âú®Á°ÆÂÆöÂëΩÂêçÂÆû‰ΩìÊó∂Êõ¥ÊúâÂ∏ÆÂä©„ÄÇ</li><li>‰æãÂ¶ÇÔºåÊ®°ÂûãÂèØ‰ª•‰∫ÜËß£Âà∞ÔºåÂΩìÁúãÂà∞<spanclass="math inline">\(x_{in}\)</span>ÊòØ‰∏≠ÂøÉËØç‰πãÂâçÁöÑÂçïËØçÊó∂ÔºåÊåáÁ§∫‰∏≠ÂøÉËØçÊòØ‰∏Ä‰∏™Location</li></ul><h2 id="ÈáçÊñ∞ËÆ≠ÁªÉËØçÂêëÈáèÊó∂ÁöÑÈô∑Èò±">1.5 ÈáçÊñ∞ËÆ≠ÁªÉËØçÂêëÈáèÊó∂ÁöÑÈô∑Èò±</h2><ul><li><p><strong>ËÉåÊôØ</strong>ÔºöÊàë‰ª¨Ê≠£Âú®ËÆ≠ÁªÉ‰∏Ä‰∏™ÂçïËØçÁîµÂΩ±ËØÑËÆ∫ÊÉÖÁª™ÁöÑÈÄªËæëÂõûÂΩíÂàÜÁ±ªÊ®°Âûã</p></li><li><p>Âú®<strong>ËÆ≠ÁªÉÊï∞ÊçÆ</strong>‰∏≠ÔºåÊàë‰ª¨Êúâ‚ÄúTV‚ÄùÂíå‚Äútelly‚Äù</p></li><li><p>Âú®<strong>ÊµãËØïÊï∞ÊçÆ</strong>‰∏≠Êàë‰ª¨Êúâ‚Äútelevision‚Äù</p></li><li><p><strong>È¢ÑËÆ≠ÁªÉ</strong>ÁöÑÂçïËØçÂêëÈáèÊúâ‰∏â‰∏™Áõ∏‰ºº‰πãÂ§ÑÔºö</p><p><img src="/img/nlp/Á¨¨ÂõõËÆ≤/2.png" /></p></li><li><p><strong>ÈóÆÈ¢ò</strong>ÔºöÂΩìÊàë‰ª¨Êõ¥Êñ∞ÂêëÈáèÊó∂‰ºöÂèëÁîü‰ªÄ‰πà</p></li><li><p>ÂõûÁ≠îÔºö</p><ul><li>ÈÇ£‰∫õÂú®ËÆ≠ÁªÉÊï∞ÊçÆ‰∏≠Âá∫Áé∞ÁöÑÂçïËØç‰ºöÂõõÂ§ÑÁßªÂä®</li><li>‚ÄúTV‚ÄùÂíå‚Äútelly‚Äù</li><li>Ê≤°ÊúâÂåÖÂê´Âú®ËÆ≠ÁªÉÊï∞ÊçÆ‰∏≠ÁöÑËØçÊ±á‰øùÊåÅÂéüÊ†∑</li><li>‚Äútelevision‚Äù</li></ul></li></ul><p><img src="/img/nlp/Á¨¨ÂõõËÆ≤/3.png" /></p><h2 id="ÂÖ≥‰∫éÂÜçËÆ≠ÁªÉÁöÑÂª∫ËÆÆ">1.6 ÂÖ≥‰∫éÂÜçËÆ≠ÁªÉÁöÑÂª∫ËÆÆ</h2><ul><li><p><strong>ÈóÆÈ¢ò</strong>ÔºöÂ∫îËØ•‰ΩøÁî®ÂèØÁî®ÁöÑ‚ÄúÈ¢ÑËÆ≠ÁªÉ‚ÄùËØçÂêëÈáèÂêóÔºü</p></li><li><p>ÂõûÁ≠îÔºö</p><ul><li>Âá†‰πéÊÄªÊòØ„ÄåÂ∫îËØ•Áî®„Äç</li><li>‰ªñ‰ª¨Êé•Âèó‰∫ÜÂ§ßÈáèÁöÑÊï∞ÊçÆËÆ≠ÁªÉÔºåÊâÄ‰ª•‰ªñ‰ª¨‰ºöÁü•ÈÅìËÆ≠ÁªÉÊï∞ÊçÆ‰∏≠Ê≤°ÊúâÁöÑÂçïËØçÔºå‰πü‰ºöÁü•ÈÅìÊõ¥Â§öÂÖ≥‰∫éËÆ≠ÁªÉÊï∞ÊçÆ‰∏≠ÁöÑÂçïËØç</li><li>Êã•Êúâ‰∏ä‰∫øÁöÑÊï∞ÊçÆËØ≠ÊñôÂêóÔºüÈÇ£ÂèØ‰ª•ÈöèÊú∫ÂàùÂßãÂåñÂºÄÂßãËÆ≠ÁªÉ</li></ul></li><li><p><strong>ÈóÆÈ¢ò</strong>ÔºöÊàëÂ∫îËØ•Êõ¥Êñ∞(‚Äúfinetune‚Äù)ÊàëËá™Â∑±ÁöÑÂçïËØçÂêëÈáèÂêóÔºü</p></li><li><p>ÂõûÁ≠îÔºö</p><ul><li>Â¶ÇÊûú‰Ω†Âè™Êúâ‰∏Ä‰∏™Â∞èÁöÑËÆ≠ÁªÉÊï∞ÊçÆÈõÜÔºå‰∏çË¶ÅÂØπÈ¢ÑËÆ≠ÁªÉËØçÂêëÈáèÂÅöÂÜçËÆ≠ÁªÉ</li><li>Â¶ÇÊûúÊÇ®Êúâ‰∏Ä‰∏™Â§ßÂûãÊï∞ÊçÆÈõÜÔºåÈÇ£‰πàÂü∫‰∫é‰ªªÂä°ËÆ≠ÁªÉÊõ¥Êñ∞ËØçÂêëÈáèÔºà train = update= fine-tune ÔºâÊïàÊûú‰ºöÊõ¥Â•Ω</li></ul></li></ul><h1 id="ËÆ°ÁÆóÂõæ‰∏éÂèçÂêë‰º†Êí≠">2.ËÆ°ÁÆóÂõæ‰∏éÂèçÂêë‰º†Êí≠</h1><h2 id="ÂèçÂêë‰º†Êí≠">2.1 ÂèçÂêë‰º†Êí≠</h2><ul><li>Êàë‰ª¨Âá†‰πéÂ∑≤ÁªèÂêë‰Ω†‰ª¨Â±ïÁ§∫‰∫ÜÂèçÂêë‰º†Êí≠<ul><li>Ê±ÇÂØºÂπ∂‰ΩøÁî®(Âπø‰πâ)ÈìæÂºèÊ≥ïÂàô</li></ul></li><li>Âè¶‰∏Ä‰∏™ÊäÄÂ∑ßÔºöÂú®ËÆ°ÁÆóËæÉ‰ΩéÂ±ÇÁöÑÂØºÊï∞Êó∂ÔºåÊàë‰ª¨ÈáçÁî®ÂØπËæÉÊ∑±Â±ÇËÆ°ÁÆóÁöÑÂØºÊï∞Ôºå‰ª•ÂáèÂ∞èËÆ°ÁÆóÈáè</li></ul><h2 id="ËÆ°ÁÆóÂõæÂíåÂèçÂêë‰º†Êí≠">2.2 ËÆ°ÁÆóÂõæÂíåÂèçÂêë‰º†Êí≠</h2><ul><li>Êàë‰ª¨ÊääÁ•ûÁªèÁΩëÁªúÊñπÁ®ãË°®Á§∫Êàê‰∏Ä‰∏™Âõæ<ul><li>Ê∫êËäÇÁÇπÔºöËæìÂÖ•</li><li>ÂÜÖÈÉ®ËäÇÁÇπÔºöÊìç‰Ωú</li><li>Ëæπ‰º†ÈÄíÊìç‰ΩúÁöÑÁªìÊûú</li></ul></li></ul><p><span class="math display">\[\begin{array}{l}s=u^{T} h \\h=f(z) \\z=W x+b \\x \quad(\text { input) }\end{array}\]</span></p><p><img src="/img/nlp/Á¨¨ÂõõËÆ≤/4.png" /></p><h2 id="ÂèçÂêë‰º†Êí≠ÂçïÁ•ûÁªèÂÖÉËßÜËßí">2.3 ÂèçÂêë‰º†Êí≠ÔºöÂçïÁ•ûÁªèÂÖÉËßÜËßí</h2><ul><li>ËäÇÁÇπÊé•Êî∂‚Äú‰∏äÊ∏∏Ê¢ØÂ∫¶‚Äù<ul><li>ÁõÆÊ†áÊòØ‰º†ÈÄíÊ≠£Á°ÆÁöÑ‚Äú‰∏ãÊ∏∏Ê¢ØÂ∫¶‚Äù</li></ul></li><li>ÊØè‰∏™ËäÇÁÇπÈÉΩÊúâÂ±ÄÈÉ®Ê¢ØÂ∫¶ local gradient<ul><li>ÂÆÉËæìÂá∫ÁöÑÊ¢ØÂ∫¶ÊòØ‰∏éÂÆÉÁöÑËæìÂÖ•ÊúâÂÖ≥</li></ul></li><li>‰∏ãÊ∏∏Ê¢ØÂ∫¶ = ‰∏äÊ∏∏Ê¢ØÂ∫¶<spanclass="math inline">\(\times\)</span>Â±ÄÈÉ®Ê¢ØÂ∫¶</li></ul><p><img src="/img/nlp/Á¨¨ÂõõËÆ≤/5.png" /></p><ul><li>ÊúâÂ§ö‰∏™ËæìÂÖ•ÁöÑËäÇÁÇπÂë¢Ôºü</li></ul><p><img src="/img/nlp/Á¨¨ÂõõËÆ≤/6.png" /></p><h2 id="ÂèçÂêë‰º†Êí≠ËÆ°ÁÆóÂõæÁ§∫‰æã">2.4 ÂèçÂêë‰º†Êí≠ËÆ°ÁÆóÂõæÁ§∫‰æã</h2><p><img src="D:\blog\source\img\nlp\Á¨¨ÂõõËÆ≤\7.png" /></p><h2 id="Ê±ÇÂíåÂΩ¢ÊÄÅÁöÑÊ¢ØÂ∫¶ËÆ°ÁÆó">2.5 Ê±ÇÂíåÂΩ¢ÊÄÅÁöÑÊ¢ØÂ∫¶ËÆ°ÁÆó</h2><p>‰∏äÂõæ‰∏≠ÁöÑ<span class="math inline">\(\frac{\partial f}{\partialy}\)</span>ÁöÑÊ¢ØÂ∫¶ÁöÑËÆ°ÁÆó <span class="math display">\[\begin{array}{c}a=x+y \\b=\max (y, z) \\f=a b \\\frac{\partial f}{\partial y}=\frac{\partial f}{\partial a}\frac{\partial a}{\partial y}+\frac{\partial f}{\partial b}\frac{\partial b}{\partial y}\end{array}\]</span></p><h2 id="Áõ¥ÊåÇÁêÜËß£Á•ûÁªèÂÖÉÁöÑÊ¢ØÂ∫¶‰º†ÈÄí">2.6 Áõ¥ÊåÇÁêÜËß£Á•ûÁªèÂÖÉÁöÑÊ¢ØÂ∫¶‰º†ÈÄí</h2>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Á¨¨‰∏âËÆ≤-Á•ûÁªèÁΩëÁªúÁü•ËØÜ</title>
    <link href="/2022/05/06/%E7%AC%AC%E4%B8%89%E8%AE%B2-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/"/>
    <url>/2022/05/06/%E7%AC%AC%E4%B8%89%E8%AE%B2-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[<h1 id="Á•ûÁªèÁΩëÁªúÂü∫Á°Ä">1 Á•ûÁªèÁΩëÁªúÂü∫Á°Ä</h1><h2 id="ÂàÜÁ±ªÈóÆÈ¢òÂü∫Á°Ä">1.1 ÂàÜÁ±ªÈóÆÈ¢òÂü∫Á°Ä</h2><p>ÂØπ‰∫éÂàÜÁ±ªÈóÆÈ¢òÔºåÊàë‰ª¨ÊúâËÆ≠ÁªÉ<strong>Êï∞ÊçÆÈõÜ</strong>ÔºöÂÆÉÁî±‰∏Ä‰∫õ<strong>Ê†∑Êú¨</strong>ÁªÑÊàêÔºö<span class="math display">\[\{x_i,y_i\}^N_{i=1}\]</span></p><ul><li><spanclass="math inline">\(x_i\)</span>ÊòØ<strong>ËæìÂÖ•</strong>Ôºå‰æãÂ¶ÇÂçïËØç(Á¥¢ÂºïÊàñÊòØÂêëÈáè)ÔºåÂè•Â≠êÔºåÊñáÊ°£Á≠âÁ≠â(Áª¥Â∫¶‰∏∫d)</li><li><spanclass="math inline">\(y_i\)</span>ÊòØÊàë‰ª¨Â∞ùËØïÈ¢ÑÊµãÁöÑÊ†áÁ≠æ(C‰∏™Á±ªÂà´‰∏≠ÁöÑ‰∏Ä‰∏™)Ôºå‰æãÂ¶ÇÔºö<ul><li>Á±ªÂà´ÔºöÊÑüÊÉÖÔºåÂëΩÂêçÂÆû‰ΩìÔºåË¥≠‰π∞/ÂîÆÂá∫ÁöÑÂÜ≥ÂÆö</li><li>ÂÖ∂‰ªñÂçïËØç</li><li>Â§öËØçÂ∫èÂàó(‰πãÂêé‰ºöÊèêÂà∞)</li></ul></li></ul><h2 id="ÂàÜÁ±ªÈóÆÈ¢òÁõ¥ËßÇÁêÜËß£">1.2 ÂàÜÁ±ªÈóÆÈ¢òÁõ¥ËßÇÁêÜËß£</h2><ul><li><p>Áî®‰∏Ä‰∏™ÊúÄÁÆÄÂçïÁöÑ2Áª¥ËØçÂêëÈáèÂàÜÁ±ªÈóÆÈ¢ò‰Ωú‰∏∫Ê°à‰æã</p><ul><li>‰ΩøÁî®softmax / logisticÂõûÂΩí</li><li>ÊûÑÂª∫Á∫øÊÄßÂÜ≥Á≠ñËæπÁïå</li></ul></li><li><p><strong>‰º†ÁªüÁöÑÊú∫Âô®Â≠¶‰π†/ÁªüËÆ°Â≠¶ÊñπÊ≥ï</strong>ÔºöÂÅáËÆæ<spanclass="math inline">\(x_i\)</span>ÊòØÂõ∫ÂÆöÁöÑÔºåËÆ≠ÁªÉ softmax/logisticÂõûÂΩíÁöÑÊùÉÈáç<span class="math inline">\(W \in R^{C \timesd}\)</span>Êù•ÂÜ≥ÂÆöÂÜ≥ÂÆöËæπÁïå(Ë∂ÖÂπ≥Èù¢)</p></li><li><p><strong>È¢ÑÊµãÈò∂ÊÆµ</strong>ÔºåÂØπÊØè‰∏™<spanclass="math inline">\(x\)</span>ÔºåÈ¢ÑÊµã:</p></li></ul><p><span class="math display">\[p(y \mid x)=\frac{\exp \left(W_{y} \cdot x\right)}{\sum_{c=1}^{C} \exp\left(W_{c} \cdot x\right)}\]</span></p><h2 id="softmaxÂàÜÁ±ªÂô®ÁöÑÁªÜËäÇ">1.3 softmaxÂàÜÁ±ªÂô®ÁöÑÁªÜËäÇ</h2><p>Êàë‰ª¨ÂèØ‰ª•Â∞ÜÈ¢ÑÊµãÂáΩÊï∞ÂàÜ‰∏∫<strong>‰∏§‰∏™Ê≠•È™§</strong>Ôºö</p><h3 id="Â∞ÜwÁöÑythË°åÂíåx‰∏≠ÁöÑÂØπÂ∫îË°åÁõ∏‰πòÂæóÂà∞ÂàÜÊï∞">1 Â∞Ü<spanclass="math inline">\(W\)</span>ÁöÑ<spanclass="math inline">\(y^{th}\)</span>Ë°åÂíå<spanclass="math inline">\(x\)</span>‰∏≠ÁöÑÂØπÂ∫îË°åÁõ∏‰πòÂæóÂà∞ÂàÜÊï∞Ôºö</h3><p><span class="math display">\[W_{y} \cdot x=\sum_{i=1}^{d} W_{y i} x_{i}=f_{y}\]</span></p><p>ÂØπc=1Ôºå2Ôºå...ÔºåCËÆ°ÁÆóÊâÄÊúâÁöÑ<spanclass="math inline">\(f_y\)</span></p><h3 id="‰ΩøÁî®softmaxÂáΩÊï∞Ëé∑ÂæóÂΩí‰∏ÄÂåñÁöÑÊ¶ÇÁéá">2‰ΩøÁî®softmaxÂáΩÊï∞Ëé∑ÂæóÂΩí‰∏ÄÂåñÁöÑÊ¶ÇÁéáÔºö</h3><p><span class="math display">\[p(y \mid x)=\frac{\exp \left(f_{y}\right)}{\sum_{c=1}^{C} \exp\left(f_{c}\right)}=\operatorname{softmax}\left(f_{y}\right)\]</span></p><h2 id="softmaxÂíå‰∫§ÂèâÁÜµÊçüÂ§±">1.4 softmaxÂíå‰∫§ÂèâÁÜµÊçüÂ§±</h2><p>Âú®softmaxÂàÜÁ±ªÂô®‰∏≠ÊúÄÂ∏∏Áî®Âà∞‰∫§ÂèâÁÜµÊçüÂ§±Ôºå‰πüÊòØË¥üÂØπÊï∞Ê¶ÇÁéáÂΩ¢ÊÄÅ„ÄÇ</p><p>ÂØπ‰∫éÊØè‰∏™ËÆ≠ÁªÉÊ†∑Êú¨<spanclass="math inline">\((x,y)\)</span>ÔºåÊàë‰ª¨ÁöÑÁõÆÊ†á<strong>ÊòØÊúÄÂ§ßÂåñÊ≠£Á°ÆÁ±ª</strong><spanclass="math inline">\(y\)</span>ÁöÑÊ¶ÇÁéáÔºåÊàñËÄÖÊàë‰ª¨ÂèØ‰ª•<strong>ÊúÄÂ∞èÂåñËØ•Á±ªÁöÑË¥üÂØπÊï∞Ê¶ÇÁéá</strong>:<span class="math display">\[-\log p(y \mid x)=-\log \left(\frac{\exp\left(f_{y}\right)}{\sum_{c=1}^{C} \exp \left(f_{c}\right)}\right)\]</span></p><h2 id="‰∫§ÂèâÁÜµÊçüÂ§±ÁêÜËß£">1.5 ‰∫§ÂèâÁÜµÊçüÂ§±ÁêÜËß£</h2><ul><li>‰∫§ÂèâÁÜµÁöÑÊ¶ÇÂøµÊù•Ê∫ê‰∫é‰ø°ÊÅØËÆ∫ÔºåË°°Èáè‰∏§‰∏™ÂàÜÂ∏É‰πãÈó¥ÁöÑÂ∑ÆÂºÇÔºå‰∫§ÂèâÁÜµË∂äÂ§ßÔºåÂèòÈáèÁöÑÂèñÂÄºË∂ä‰∏çÁ°ÆÂÆöÔºåÂèç‰πãÂàôË∂äÁ°ÆÂÆö„ÄÇ</li><li>‰ª§ÁúüÂÆûÊ¶ÇÁéáÂàÜÂ∏É‰∏∫<spanclass="math inline">\(p\)</span>ÔºåÊàë‰ª¨ËÆ°ÁÆóÁöÑÊ®°ÂûãÊ¶ÇÁéáÂàÜÂ∏É‰∏∫<spanclass="math inline">\(q\)</span></li><li>‰∫§ÂèâÁÜµ‰∏∫Ôºö</li></ul><p><span class="math display">\[H(p, q)=-\sum_{c=1}^{C} p(c) \log q(c)\]</span></p><ul><li>ÂÅáËÆæÊ†áÂáÜÁ≠îÊ°àÁöÑÊ¶ÇÁéáÂàÜÂ∏ÉÊòØÔºåÂú®Ê≠£Á°ÆÁöÑÁ±ª‰∏ä‰∏∫1ÔºåÂú®ÂÖ∂‰ªñÁ±ªÂà´‰∏ä‰∏∫0Ôºö</li></ul><p><span class="math display">\[p=[0,...,0,1,...,0]\]</span></p><ul><li>Âõ†‰∏∫ÊòØÁã¨ÁÉ≠ÂêëÈáè(one-hotvector)ÔºåÊâÄ‰ª•ÂîØ‰∏ÄÂâ©‰∏ãÁöÑÈ°πÊòØÁúüÂÆûÁ±ªÁöÑË¥üÂØπÊï∞Ê¶ÇÁéá„ÄÇ</li></ul><h2 id="ÂÆåÊï¥Êï∞ÊçÆÈõÜ‰∏äÁöÑÂàÜÁ±ª">1.6 ÂÆåÊï¥Êï∞ÊçÆÈõÜ‰∏äÁöÑÂàÜÁ±ª</h2><p>Âú®Êï¥‰∏™Êï∞ÊçÆÈõÜ<spanclass="math inline">\(\{x_i,y_i\}_{i=1}^N\)</span>‰∏äÁöÑ‰∫§ÂèâÁÜµÊçüÂ§±ÂáΩÊï∞ÔºåÊòØÊâÄÊúâÊ†∑Êú¨ÁöÑ‰∫§ÂèâÁÜµÁöÑÂùáÂÄº<span class="math display">\[J(\theta)=\frac{1}{N} \sum_{i=1}^{N}-\log\left(\frac{e^{f_{y_{i}}}}{\sum_{c=1}^{C} e^{f_{c}}}\right)\]</span> ‰∏ç‰ΩøÁî® <span class="math display">\[f_{y}=f_{y}(x)=W_{y} \cdot x=\sum_{j=1}^{d} W_{y j} x_{j}\]</span> ËÄåÊòØ‰ΩøÁî®ÂêëÈáèÂåñÁöÑÂΩ¢ÊÄÅÔºåÂü∫‰∫éÁü©ÈòµÊù•Ë°®Á§∫<spanclass="math inline">\(f:f=W_x\)</span></p><h2 id="‰º†ÁªüÁöÑÊú∫Âô®Â≠¶‰π†‰ºòÂåñÁÆóÊ≥ï">1.7 ‰º†ÁªüÁöÑÊú∫Âô®Â≠¶‰π†‰ºòÂåñÁÆóÊ≥ï</h2><p>ÂØπ‰∫é‰º†ÁªüÁöÑÊú∫Âô®Â≠¶‰π†ÁÆóÊ≥ïÔºàÂ¶ÇÈÄªËæëÂõûÂΩíÔºâÊù•ËØ¥Ôºå‰∏ÄËà¨Êú∫Âô®Â≠¶‰π†ÁöÑÂèÇÊï∞<spanclass="math inline">\(\theta\)</span>ÈÄöÂ∏∏Âè™Áî±<spanclass="math inline">\(W\)</span>ÁöÑÂàóÁªÑÊàê <span class="math display">\[\theta=\left[\begin{array}{c}W_{\cdot 1} \\\vdots \\W_{\cdot d}\end{array}\right]=W(:) \in \mathbb{R}^{C d}\]</span> Âõ†Ê≠§ÔºåÊàë‰ª¨Âè™ÈÄöËøá‰ª•‰∏ãÊñπÂºè<strong>Êõ¥Êñ∞ÂÜ≥Á≠ñËæπÁïå</strong> <spanclass="math display">\[\nabla_{\theta} J(\theta)=\left[\begin{array}{c}\nabla_{W_{1}} \\\vdots \\\nabla_{W_{d}}\end{array}\right] \in \mathbb{R}^{C d}\]</span></p><h2 id="Á•ûÁªèÁΩëÁªúÂàÜÁ±ªÂô®">1.8 Á•ûÁªèÁΩëÁªúÂàÜÁ±ªÂô®</h2><ul><li>ÂçïÁã¨‰ΩøÁî®Á∫øÊÄßÂàÜÁ±ªÂô®Softmax( ‚âà logisticÂõûÂΩí)Âπ∂‰∏çÂçÅÂàÜÂº∫Â§ß</li></ul><p><img src="/img/nlp/Á¨¨‰∏âËÆ≤/1.png" /></p><ul><li>Â¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåSoftmaxÂæóÂà∞ÁöÑÊòØÁ∫øÊÄßÂÜ≥Á≠ñËæπÁïå<ul><li>ÂØπ‰∫éÂ§çÊùÇÈóÆÈ¢òÊù•ËØ¥ÔºåÂÆÉÁöÑË°®ËææËÉΩÂäõÊòØÊúâÈôêÁöÑ</li><li>Êúâ‰∏Ä‰∫õÂàÜÈîôÁöÑÁÇπÔºåÈúÄË¶ÅÊõ¥Âº∫ÁöÑÈùûÁ∫øÊÄßË°®ËææËÉΩÂäõÊù•Âå∫ÂàÜ</li></ul></li></ul><h2 id="Á•ûÁªèÁΩëÁªúÈùûÁ∫øÊÄßÂàáÂàÜ">1.9 Á•ûÁªèÁΩëÁªúÈùûÁ∫øÊÄßÂàáÂàÜ</h2><ul><li><p>Á•ûÁªèÁΩëÁªúÂèØ‰ª•Â≠¶‰π†Êõ¥Â§çÊùÇÁöÑÂáΩÊï∞ÂíåÈùûÁ∫øÊÄßÂÜ≥Á≠ñËæπÁïå</p></li><li><p>tip ÔºöÊõ¥È´òÁ∫ßÁöÑÂàÜÁ±ªÈúÄË¶Å</p><ul><li>ËØçÂêëÈáè</li><li>Êõ¥Ê∑±Â±ÇÊ¨°ÁöÑÊ∑±Â±ÇÁ•ûÁªèÁΩëÁªú</li></ul></li></ul><h2 id="Âü∫‰∫éËØçÂêëÈáèÁöÑÂàÜÁ±ªÂ∑ÆÂºÇ">1.10 Âü∫‰∫éËØçÂêëÈáèÁöÑÂàÜÁ±ªÂ∑ÆÂºÇ</h2><ul><li>‰∏ÄËà¨Âú®NLPÊ∑±Â∫¶Â≠¶‰π†‰∏≠Ôºö<ul><li>Êàë‰ª¨Â≠¶‰π†‰∫ÜÁü©Èòµ<span class="math inline">\(W\)</span>ÂíåËØçÂêëÈáè<spanclass="math inline">\(x\)</span>„ÄÇ</li><li>Êàë‰ª¨Â≠¶‰π†‰º†ÁªüÂèÇÊï∞ÂíåË°®Á§∫„ÄÇ</li><li>ËØçÂêëÈáèÊòØÂØπÁã¨ÁÉ≠ÂêëÈáèÁöÑÈáçÊñ∞Ë°®Á§∫‚Äî‚ÄîÂú®‰∏≠Èó¥Â±ÇÂêëÈáèÁ©∫Èó¥‰∏≠ÁßªÂä®ÂÆÉ‰ª¨‚Äî‚Äî‰ª•‰æø(Á∫øÊÄß)softmaxÂàÜÁ±ªÂô®ÂèØ‰ª•Êõ¥Â•ΩÂú∞ÂàÜÁ±ª„ÄÇ</li></ul></li><li>Âç≥Â∞ÜËØçÂêëÈáèÁêÜËß£‰∏∫‰∏ÄÂ±ÇÁ•ûÁªèÁΩëÁªúÔºåËæìÂÖ•ÂçïËØçÁöÑÁã¨ÁÉ≠ÂêëÈáèÂπ∂Ëé∑ÂæóÂçïËØçÁöÑËØçÂêëÈáèË°®Á§∫ÔºåÂπ∂‰∏îÊàë‰ª¨ÈúÄË¶ÅÂØπÂÖ∂ËøõË°åÊõ¥Êñ∞„ÄÇ</li></ul><p><span class="math display">\[\nabla_{\theta} J(\theta)=\left[\begin{array}{c}\nabla_{W_{1}} \\\vdots \\\nabla_{W_{\text {dardvark }}} \\\vdots \\\nabla_{x_{z e b r a}}\end{array}\right] \in \mathbb{R}^{C d+V d}\]</span></p><ul><li>ÂÖ∂‰∏≠Ôºå<span class="math inline">\(Vd\)</span>ÊòØÊï∞ÈáèÂæàÂ§ßÁöÑÂèÇÊï∞„ÄÇ</li></ul><h2 id="Á•ûÁªèËÆ°ÁÆó">1.11 Á•ûÁªèËÆ°ÁÆó</h2><ul><li>An artificial neuron<ul><li>Á•ûÁªèÁΩëÁªúÊúâËá™Â∑±ÁöÑÊúØËØ≠ÂåÖ</li><li>‰ΩÜÂ¶ÇÊûú‰Ω†‰∫ÜËß£ softmaxÊ®°ÂûãÊòØÂ¶Ç‰ΩïÂ∑•‰ΩúÁöÑÔºåÈÇ£‰πà‰Ω†Â∞±ÂèØ‰ª•ÂæàÂÆπÊòìÂú∞ÁêÜËß£Á•ûÁªèÂÖÉÁöÑÊìç‰Ωú</li></ul></li><li>Neural computationÔºöÁ•ûÁªèËÆ°ÁÆó</li><li>Neural selectivityÔºöÁ•ûÁªèÈÄâÊã©ÊÄß</li><li>Hierarchy of neural processingÔºöÁ•ûÁªèÂ§ÑÁêÜÂ±ÇÊ¨°</li></ul><h2 id="Âçï‰∏™Á•ûÁªèÂÖÉÂèØËßÜ‰Ωú‰∫åÂÖÉÈÄªËæëÂõûÂΩíÂçïÂÖÉ">1.12Âçï‰∏™Á•ûÁªèÂÖÉÔºöÂèØËßÜ‰Ωú‰∫åÂÖÉÈÄªËæëÂõûÂΩíÂçïÂÖÉ</h2><p><span class="math display">\[h_{w, b}(x)=f\left(w^{T} x+b\right)\]</span></p><p><span class="math display">\[f(z)=\frac{1}{1+e^{-z}}\]</span></p><ul><li><spanclass="math inline">\(b\)</span>ÔºöÊàë‰ª¨ÂèØ‰ª•Êúâ‰∏Ä‰∏™‚ÄúÊÄªÊòØÊâìÂºÄ‚ÄùÁöÑÁâπÊÄßÔºåÂÆÉÁªôÂá∫‰∏Ä‰∏™ÂÖàÈ™åÁ±ªÔºåÊàñËÄÖÂ∞ÜÂÆÉ‰Ωú‰∏∫‰∏Ä‰∏™ÂÅèÂêëÈ°πÂàÜÁ¶ªÂá∫Êù•„ÄÇ</li><li><span class="math inline">\(w\)</span>Ôºå<spanclass="math inline">\(b\)</span>ÊòØÁ•ûÁªèÂÖÉÁöÑÂèÇÊï∞„ÄÇ</li></ul><h2 id="‰∏Ä‰∏™Á•ûÁªèÁΩëÁªúÂ§ö‰∏™ÈÄªËæëÂõûÂΩíÁªÑÂêà">1.13‰∏Ä‰∏™Á•ûÁªèÁΩëÁªúÔºöÂ§ö‰∏™ÈÄªËæëÂõûÂΩíÁªÑÂêà</h2><ul><li>Â¶ÇÊûúÊàë‰ª¨ËæìÂÖ•‰∏Ä‰∏™ÂêëÈáèÈÄöËøá‰∏ÄÁ≥ªÂàóÈÄªËæëÂõûÂΩíÂáΩÊï∞ÔºåÈÇ£‰πàÊàë‰ª¨ÂæóÂà∞‰∏Ä‰∏™ËæìÂá∫ÂêëÈáè„ÄÇ</li><li>‰ΩÜÊòØÊàë‰ª¨‰∏çÈúÄË¶ÅÊèêÂâçÂÜ≥ÂÆöËøô‰∫õÈÄªËæëÂõûÂΩíËØïÂõæÈ¢ÑÊµãÁöÑÂèòÈáèÊòØ‰ªÄ‰πà„ÄÇ</li></ul><p><img src="/img/nlp/Á¨¨‰∏âËÆ≤/2.png" /></p><ul><li>Êàë‰ª¨ÂèØ‰ª•ËæìÂÖ•Âè¶‰∏Ä‰∏™logisticÂõûÂΩíÂáΩÊï∞„ÄÇ</li><li>ÊçüÂ§±ÂáΩÊï∞Â∞ÜÊåáÂØº‰∏≠Èó¥ÈöêËóèÂèòÈáèÂ∫îËØ•ÊòØ‰ªÄ‰πàÔºå‰ª•‰æøÊõ¥Â•ΩÂú∞È¢ÑÊµã‰∏ã‰∏ÄÂ±ÇÁöÑÁõÆÊ†á„ÄÇ</li></ul><p><img src="/img/nlp/Á¨¨‰∏âËÆ≤/3.png" /></p><p>Êàë‰ª¨Ê∑ªÂä†Êõ¥Â§öÂ±ÇÁöÑÁ•ûÁªèÁΩëÁªúÔºåÂ∞±ÂæóÂà∞‰∫ÜÂ§öÂ±ÇÊÑüÁü•Âô®„ÄÇ</p><p><img src="/img/nlp/Á¨¨‰∏âËÆ≤/4.png" /></p><h2 id="ÂçïÂ±ÇÁ•ûÁªèÁΩëÁªúÁöÑÁü©ÈòµÂΩ¢ÊÄÅË°®Á§∫">1.14 ÂçïÂ±ÇÁ•ûÁªèÁΩëÁªúÁöÑÁü©ÈòµÂΩ¢ÊÄÅË°®Á§∫</h2><p>Êàë‰ª¨ÊúâÔºö <span class="math display">\[a_{1}=f\left(W_{11} x_{1}+W_{12} x_{2}+W_{13} x_{3}+b_{1}\right)\]</span></p><p><span class="math display">\[a_{2}=f\left(W_{21} x_{1}+W_{22} x_{2}+W_{23} x_{3}+b_{2}\right)\]</span></p><p>Âú®Áü©Èòµ‰∏≠Ôºö <span class="math display">\[z=Wx+b\]</span> ÊøÄÊ¥ªÂáΩÊï∞<spanclass="math inline">\(f\)</span>Âú®ËøêÁÆóÊó∂ÊòØelement-wiseÈÄêÂÖÉÁ¥†ÁöÑ <spanclass="math display">\[f\left(\left[z_{1}, z_{2},z_{3}\right]\right)=\left[f\left(z_{1}\right), f\left(z_{2}\right),f\left(z_{3}\right)\right]\]</span> <img src="/img/nlp/Á¨¨‰∏âËÆ≤/5.png" /></p><h2 id="ÈùûÁ∫øÊÄßÂèòÊç¢ÁöÑÂøÖË¶ÅÊÄß">1.15 ÈùûÁ∫øÊÄßÂèòÊç¢ÁöÑÂøÖË¶ÅÊÄß</h2><ul><li>‰æãÂ¶ÇÔºöÂáΩÊï∞Ëøë‰ººÔºåÂ¶ÇÂõûÂΩíÊàñÂàÜÁ±ª<ul><li>Ê≤°ÊúâÈùûÁ∫øÊÄßÔºåÊ∑±Â∫¶Á•ûÁªèÁΩëÁªúÂè™ËÉΩÂÅöÁ∫øÊÄßÂèòÊç¢</li><li>Â§ö‰∏™Á∫øÊÄßÂèòÊç¢Ôºå‰πüËøòÊòØÁªÑÊàê‰∏Ä‰∏™Á∫øÊÄßÂèòÊç¢<spanclass="math inline">\(W_1W_2x=Wx\)</span></li></ul></li><li>Âõ†‰∏∫Á∫øÊÄßÂèòÊç¢ÊòØ‰ª•ÊüêÁßçÊñπÂºèÊóãËΩ¨ÂíåÊãâ‰º∏Á©∫Èó¥ÔºåÂ§öÊ¨°ÁöÑÊóãËΩ¨ÂíåÊãâ‰º∏ÂèØ‰ª•ËûçÂêà‰∏∫‰∏ÄÊ¨°Á∫øÊÄßÂèòÊç¢</li><li>ÂØπ‰∫éÈùûÁ∫øÊÄßÂáΩÊï∞ËÄåË®ÄÔºå‰ΩøÁî®Êõ¥Â§öÁöÑÂ±ÇÔºå‰ªñ‰ª¨ÂèØ‰ª•Ëøë‰ººÊõ¥Â§çÊùÇÁöÑÂáΩÊï∞</li></ul><h1 id="ÂëΩÂêçÂÆû‰ΩìËØÜÂà´">2 ÂëΩÂêçÂÆû‰ΩìËØÜÂà´</h1><h2 id="ÂëΩÂêçÂÆû‰ΩìËØÜÂà´ner">2.1 ÂëΩÂêçÂÆû‰ΩìËØÜÂà´(NER)</h2><ul><li>ÂèØËÉΩÁöÑÁî®ÈÄî<ul><li>Ë∑üË∏™ÊñáÊ°£‰∏≠ÊèêÂà∞ÁöÑÁâπÂÆöÂÆû‰Ωì(ÁªÑÁªá„ÄÅ‰∏™‰∫∫„ÄÅÂú∞ÁÇπ„ÄÅÊ≠åÊõ≤Âêç„ÄÅÁîµÂΩ±ÂêçÁ≠â)</li><li>ÂØπ‰∫éÈóÆÈ¢òÂõûÁ≠îÔºåÁ≠îÊ°àÈÄöÂ∏∏ÊòØÂëΩÂêçÂÆû‰Ωì</li><li>ËÆ∏Â§öÈúÄË¶ÅÁöÑ‰ø°ÊÅØÂÆûÈôÖ‰∏äÊòØÂëΩÂêçÂÆû‰Ωì‰πãÈó¥ÁöÑÂÖ≥ËÅî</li><li>ÂêåÊ†∑ÁöÑÊäÄÊúØÂèØ‰ª•Êâ©Â±ïÂà∞ÂÖ∂‰ªñ slot-filling ÊßΩÂ°´ÂÖÖÂàÜÁ±ª</li></ul></li><li>ÈÄöÂ∏∏ÂêéÈù¢ÊòØÂëΩÂêçÂÆû‰ΩìÈìæÊé•/ËßÑËåÉÂåñÂà∞Áü•ËØÜÂ∫ì</li></ul><h2 id="Âè•Â≠ê‰∏≠ÁöÑÂëΩÂêçÂÆû‰ΩìËØÜÂà´">2.2 Âè•Â≠ê‰∏≠ÁöÑÂëΩÂêçÂÆû‰ΩìËØÜÂà´</h2><p>Êàë‰ª¨ÈÄöËøáÂú®‰∏ä‰∏ãÊñá‰∏≠ÂØπÂçïËØçËøõË°åÂàÜÁ±ªÔºåÁÑ∂ÂêéÂ∞ÜÂÆû‰ΩìÊèêÂèñ‰∏∫ÂçïËØçÂ≠êÂ∫èÂàóÊù•È¢ÑÊµãÂÆû‰Ωì„ÄÇ</p><p><img src="/img/nlp/Á¨¨‰∏âËÆ≤/6.png" /></p><h2 id="nerÁöÑÈöæÁÇπ">2.3 NERÁöÑÈöæÁÇπ</h2><ul><li>ÂæàÈöæËÆ°ÁÆóÂá∫ÂÆû‰ΩìÁöÑËæπÁïå<ul><li>Á¨¨‰∏Ä‰∏™ÂÆû‰ΩìÊòØ ‚ÄúFirst National Bank‚Äù ËøòÊòØ ‚ÄúNational Bank‚Äù</li></ul></li><li>ÂæàÈöæÁü•ÈÅìÊüêÁâ©ÊòØÂê¶ÊòØ‰∏Ä‰∏™ÂÆû‰Ωì<ul><li>ÊòØ‰∏ÄÊâÄÂêç‰∏∫‚ÄúFuture School‚Äù ÁöÑÂ≠¶Ê†°ÔºåËøòÊòØËøôÊòØ‰∏ÄÊâÄÊú™Êù•ÁöÑÂ≠¶Ê†°Ôºü</li></ul></li><li>ÂæàÈöæÁü•ÈÅìÊú™Áü•/Êñ∞Â•áÂÆû‰ΩìÁöÑÁ±ªÂà´<ul><li>‚ÄúZig Ziglar‚Äù ? ‰∏Ä‰∏™‰∫∫</li></ul></li><li>ÂÆû‰ΩìÁ±ªÊòØÊ®°Á≥äÁöÑÔºå‰æùËµñ‰∫é‰∏ä‰∏ãÊñá<ul><li>ËøôÈáåÁöÑ‚ÄúCharles Schwab‚Äù ÊòØ PER ‰∏çÊòØ ORG</li></ul></li></ul><h1 id="Âü∫‰∫éÁ™óÂè£Êï∞ÊçÆÁöÑÂàÜÁ±ªÈ¢ÑÊµã">3.Âü∫‰∫éÁ™óÂè£Êï∞ÊçÆÁöÑÂàÜÁ±ªÈ¢ÑÊµã</h1><h2 id="ËØç-Á™óÂàÜÁ±ª">3.1. ËØç-Á™óÂàÜÁ±ª</h2><ul><li>ÊÄùË∑ØÔºö‰∏∫Âú®‰∏ä‰∏ãÊñá‰∏≠ÁöÑËØ≠Ë®ÄÊûÑÂª∫ÂàÜÁ±ªÂô®<ul><li>‰∏ÄËà¨Êù•ËØ¥ÔºåÂæàÂ∞ëÂØπÂçï‰∏™ÂçïËØçËøõË°åÂàÜÁ±ª</li></ul></li><li>‰æãÂ¶ÇÔºå‰∏ä‰∏ãÊñá‰∏≠‰∏Ä‰∏™ÂçïËØçÁöÑÂëΩÂêçÂÆû‰ΩìÂàÜÁ±ª<ul><li>‰∫∫„ÄÅÂú∞ÁÇπ„ÄÅÁªÑÁªá„ÄÅÊ≤°Êúâ</li></ul></li><li>Âú®‰∏ä‰∏ãÊñá‰∏≠ÂØπÂçïËØçËøõË°åÂàÜÁ±ªÁöÑ‰∏Ä‰∏™ÁÆÄÂçïÊñπÊ≥ïÔºåÂèØËÉΩÊòØÂØπÁ™óÂè£‰∏≠ÁöÑÂçïËØçÂêëÈáèËøõË°åÂπ≥ÂùáÔºåÂπ∂ÂØπÂπ≥ÂùáÂêëÈáèËøõË°åÂàÜÁ±ª<ul><li>ÈóÆÈ¢òÔºöËøô‰ºö‰∏¢Â§±‰ΩçÁΩÆ‰ø°ÊÅØ</li></ul></li></ul><h2 id="Á™óÂè£ÂàÜÁ±ªÂô®softmax">3.2 Á™óÂè£ÂàÜÁ±ªÂô®Ôºösoftmax</h2><ul><li><p>ËÆ≠ÁªÉsoftmaxÂàÜÁ±ªÂô®ÂØπ‰∏≠ÂøÉËØçËøõË°åÂàÜÁ±ªÔºåÊñπÊ≥ïÊòØÂú®‰∏Ä‰∏™Á™óÂè£ÂÜÖÂ∞Ü‰∏≠ÂøÉËØçÂë®Âõ¥ÁöÑËØçÂêëÈáè‰∏≤ËÅîËµ∑Êù•</p></li><li><p>‰æãÂ≠êÔºöÂú®ËøôÂè•ËØùÁöÑ‰∏ä‰∏ãÊñá‰∏≠ÂØπ‚ÄúParis‚ÄùËøõË°åÂàÜÁ±ªÔºåÁ™óÂè£ÈïøÂ∫¶‰∏∫2</p></li><li><p>ÁªìÊûúÂêëÈáè<span class="math inline">\(x_{w i n d o w}=x \in R^{5d}\)</span>ÊòØ‰∏Ä‰∏™ÂàóÂêëÈáè</p></li></ul><h2 id="ÊúÄÁÆÄÂçïÁöÑÁ™óÂè£ÂàÜÁ±ªÂô®softmax">3.3 ÊúÄÁÆÄÂçïÁöÑÁ™óÂè£ÂàÜÁ±ªÂô®ÔºöSoftmax</h2><p>ÂØπ‰∫é<spanclass="math inline">\(x=x_{window}\)</span>ÔºåÊàë‰ª¨ÂèØ‰ª•‰ΩøÁî®‰∏é‰πãÂâçÁõ∏ÂêåÁöÑsoftmaxÂàÜÁ±ªÂô®<span class="math display">\[\hat{y}_{y}=p(y \mid x)=\frac{\exp \left(\sqrt{W_{y} \cdotx}\right)}{\sum_{c=1}^{C} \exp \left(W_{c} \cdot x\right)}\]</span> <strong>Â¶Ç‰ΩïÊõ¥Êñ∞ÂêëÈáè</strong>Ôºü</p><ul><li>ÁÆÄËÄåË®Ä‰πãÔºöÂ∞±ÂÉè‰πãÂâçËÆ≤ÁöÑÈÇ£Ê†∑ÔºåÊ±ÇÂØºÂíå‰ºòÂåñ</li></ul><h2 id="Á®çÂæÆÂ§çÊùÇ‰∏ÄÁÇπÂ§öÂ±ÇÊÑüÁü•Âô®">3.4 Á®çÂæÆÂ§çÊùÇ‰∏ÄÁÇπÔºöÂ§öÂ±ÇÊÑüÁü•Âô®</h2><ul><li><p>ÂÅáËÆæÊàë‰ª¨Ë¶ÅÂØπ‰∏≠ÂøÉËØçÊòØÂê¶‰∏∫‰∏Ä‰∏™Âú∞ÁÇπÔºåËøõË°åÂàÜÁ±ª</p></li><li><p>‰∏éword2vecÁ±ª‰ººÔºåÊàë‰ª¨Â∞ÜÈÅçÂéÜËØ≠ÊñôÂ∫ì‰∏≠ÁöÑÊâÄÊúâ‰ΩçÁΩÆ„ÄÇ‰ΩÜËøô‰∏ÄÊ¨°ÔºåÂÆÉÂ∞ÜÂèóÂà∞ÁõëÁù£ÔºåÂè™Êúâ‰∏Ä‰∫õ‰ΩçÁΩÆËÉΩÂ§üÂæóÂà∞È´òÂàÜ„ÄÇ</p><ul><li>‰æãÂ¶ÇÔºåÂú®‰ªñ‰ª¨ÁöÑ‰∏≠ÂøÉÊúâ‰∏Ä‰∏™ÂÆûÈôÖÁöÑNERLocationÁöÑ‰ΩçÁΩÆÊòØ‚ÄúÁúüÂÆûÁöÑ‚Äù‰ΩçÁΩÆ‰ºöËé∑ÂæóÈ´òÂàÜ</li></ul></li></ul><h2 id="Á•ûÁªèÁΩëÁªúÂâçÈ¶àËÆ°ÁÆó">3.5 Á•ûÁªèÁΩëÁªúÂâçÈ¶àËÆ°ÁÆó</h2><p>‰ΩøÁî®Á•ûÁªèÊøÄÊ¥ª<spanclass="math inline">\(a\)</span>ÁÆÄÂçïÂú∞ÁªôÂá∫‰∏Ä‰∏™ÈùûÊ†áÂáÜÂåñÁöÑÂàÜÊï∞ <spanclass="math display">\[\operatorname{score}(x)=U^{T} a \in \mathbb{R}\]</span> Êàë‰ª¨Áî®‰∏Ä‰∏™‰∏âÂ±ÇÁ•ûÁªèÁΩëÁªúËÆ°ÁÆó‰∏Ä‰∏™Á™óÂè£ÁöÑÂæóÂàÜ</p><ul><li>s = score(‚Äúmuseums in Paris are amazing‚Äù)</li></ul><p><img src="/img/nlp/Á¨¨‰∏âËÆ≤/7.png" /></p><h2 id="ÈôÑÂä†Â±Ç">3.6 ÈôÑÂä†Â±Ç</h2><p>‰∏≠Èó¥Â±ÇÂ≠¶‰π†ËæìÂÖ•ËØçÂêëÈáè‰πãÈó¥ÁöÑÈùûÁ∫øÊÄß‰∫§‰∫í</p><p><img src="/img/nlp/Á¨¨‰∏âËÆ≤/8.png" /></p><p>‰æãÂ¶ÇÔºöÂè™ÊúâÂΩì‚Äúmuseum‚ÄùÊòØÁ¨¨‰∏Ä‰∏™ÂêëÈáèÊó∂Ôºå‚Äúin‚ÄùÊîæÂú®Á¨¨‰∫å‰∏™‰ΩçÁΩÆÊâçÈáçË¶Å</p><h1 id="Âü∫‰∫épytorchÂÆûÁé∞ÁöÑÂàÜÁ±ªÂô®">4.Âü∫‰∫épytorchÂÆûÁé∞ÁöÑÂàÜÁ±ªÂô®</h1><h2 id="Êõø‰ª£ÊúÄÂ§ßËæπÁºòÊçüÂ§±">4.1 Êõø‰ª£ÔºöÊúÄÂ§ßËæπÁºòÊçüÂ§±</h2><p>ÂÖ≥‰∫éËÆ≠ÁªÉÁõÆÊ†áÁöÑÊÉ≥Ê≥ïÔºöËÆ©ÁúüÂÆûÁ™óÂè£ÁöÑÂæóÂàÜÊõ¥È´òÔºåËÄåÂÖ∂‰ªñÁ™óÂè£ÁöÑÂæóÂàÜÊõ¥‰Ωé(Áõ¥Âà∞Ë∂≥Â§üÂ•Ω‰∏∫Ê≠¢)</p><ul><li><span class="math inline">\(s = score(museums\ in\ Paris\ are\amazing)\)</span></li><li><span class="math inline">\(s_c = socre(Not\ all\ museums\ in\Paris)\)</span></li></ul><p><strong>ÊúÄÂ∞èÂåñ</strong>Ôºö <span class="math display">\[J=max(0,1-s-s_c)\]</span> ËøôÊòØ‰∏çÂèØÂæÆÁöÑÔºå‰ΩÜÂÆÉÊòØËøûÁª≠ÁöÑ ‚Üí Êàë‰ª¨ÂèØ‰ª•Áî®SGD</p><p><strong>Ë°•ÂÖÖËß£Êûê</strong></p><ul><li>ÂçïÁ™óÂè£ÁöÑÁõÆÊ†áÂáΩÊï∞‰∏∫<spanclass="math inline">\(J=max(0,1-s-s_c)\)</span></li><li>ÊØè‰∏™‰∏≠ÂøÉÊúâNER‰ΩçÁΩÆÁöÑÁ™óÂè£ÁöÑÂæóÂàÜÂ∫îËØ•ÊØî‰∏≠ÂøÉÊ≤°Êúâ‰ΩçÁΩÆÁöÑÁ™óÂè£È´ò1ÂàÜ</li><li>Ë¶ÅËé∑ÂæóÂÆåÊï¥ÁöÑÁõÆÊ†áÂáΩÊï∞Ôºö‰∏∫ÊØè‰∏™ÁúüÁ™óÂè£ÈááÊ†∑Âá†‰∏™ÊçüÂùèÁöÑÁ™óÂè£„ÄÇÂØπÊâÄÊúâËÆ≠ÁªÉÊ†∑Êú¨Á™óÂè£Ê±ÇÂíå</li><li>Á±ª‰ºº‰∫éword2vec‰∏≠ÁöÑË¥üÊäΩÊ†∑</li></ul><h2 id="ÈöèÊú∫Ê¢ØÂ∫¶‰∏ãÈôç">4.2 ÈöèÊú∫Ê¢ØÂ∫¶‰∏ãÈôç</h2>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>NLP-Assignment2</title>
    <link href="/2022/05/06/NLP-Assignment2/"/>
    <url>/2022/05/06/NLP-Assignment2/</url>
    
    <content type="html"><![CDATA[<h1 id="assignment2">Assignment2</h1><h2 id="Ëß£Á≠îÁêÜËß£ËØçÂêëÈáè23ÂàÜ">Ëß£Á≠îÔºöÁêÜËß£ËØçÂêëÈáèÔºà23ÂàÜÔºâ</h2><p>Êàë‰ª¨ÂÖàÂø´ÈÄüÂõûÈ°æ‰∏Ä‰∏ãword2vecÁÆóÊ≥ïÔºåÂÆÉÁöÑÊ†∏ÂøÉÊÄùÊÉ≥ÊòØ‚Äú‰∏Ä‰∏™ËØçÁöÑÂê´‰πâÂèØ‰ª•Áî±ÂÆÉÂë®Âõ¥ÁöÑËØçÊù•Ë°®Á§∫‚Äù„ÄÇÂÖ∑‰ΩìÊù•ËØ¥ÔºåÊàë‰ª¨Êúâ‰∏Ä‰∏™‰∏≠ÂøÉËØçÔºàcenterwordÔºâ <em>c</em>ÔºåÂíåËøô‰∏™ËØç <em>c</em>Âë®Âõ¥‰∏ä‰∏ãÊñáÊûÑÊàêÁöÑÁ™óÂè£ÔºåËøô‰∏™Á™óÂè£ÂÜÖÁöÑÈô§‰∫Ü <em>c</em>‰πãÂ§ñÁöÑËØçÂè´ÂÅöÂ§ñÂõ¥ËØçÔºàoutsidewordsÔºâ„ÄÇÊØîÂ¶Ç‰∏ãÂõæ‰∏≠Ôºå‰∏≠ÂøÉËØçÊòØ‚Äúbanking‚ÄùÔºåÁ™óÂè£Â§ßÂ∞è‰∏∫2ÔºåÊâÄ‰ª•‰∏ä‰∏ãÊñáÁ™óÂè£ÊòØÔºö‚Äúturning‚Äù„ÄÅ‚Äùinto‚Äú„ÄÅ‚Äùcrises‚ÄúÂíå‚Äùas‚Äú„ÄÇ</p><p><img src="/img/nlp/assignment2/1.jpg"/></p><p>Skip-gramÊ®°ÂûãÔºàword2vecÊØîËæÉÂ∏∏Áî®ÁöÑ‰∏ÄÁßçÂÆûÁé∞ÔºåÂè¶‰∏ÄÁßçÊòØcbowÔºâÁõÆÁöÑÊòØÂ≠¶‰π†Ê¶ÇÁéáÂàÜÂ∏É<spanclass="math inline">\(ùëÉ(ùëÇ|ùê∂)\)</span>„ÄÇËøôÊ†∑‰∏ÄÊù•ÔºåÂ∞±ËÉΩËÆ°ÁÆóÁªôÂÆöÁöÑ‰∏Ä‰∏™ËØç<span class="math inline">\(o\)</span> ÂíåËØç <spanclass="math inline">\(c\)</span> ÁöÑÊ¶ÇÁéá <spanclass="math inline">\(ùëÉ(ùëÇ=ùëú|ùê∂=ùëê)\)</span>ÔºàÂç≥ÔºåÂú®Â∑≤Áü•ËØç <spanclass="math inline">\(c\)</span> Âá∫Áé∞ÁöÑÊÉÖÂÜµ‰∏ãÔºåËØç <spanclass="math inline">\(o\)</span> Âá∫Áé∞ÁöÑÊ¶ÇÁéáÔºâÔºå ÂÖ∂‰∏≠<spanclass="math inline">\(c\)</span> ÊòØ‰∏≠ÂøÉËØçÔºå<spanclass="math inline">\(o\)</span> ÊòØÁ™óÂè£‰∏≠Èùû‰∏≠ÂøÉÁöÑÂ§ñÂõ¥ËØç„ÄÇ</p><p>Âú®word2vec‰∏≠ÔºåËøô‰∏™Êù°‰ª∂Ê¶ÇÁéáÂàÜÂ∏ÉÊòØÈÄöËøáËÆ°ÁÆóÂêëÈáèÁÇπÁßØÔºàdot-productsÔºâÔºåÂÜçÂ∫îÁî®naive-softmaxÂáΩÊï∞ÂæóÂà∞ÁöÑÔºö<span class="math display">\[P(O=o \mid C=c)=\frac{\exp \left(\boldsymbol{u}_{o}^{\top}\boldsymbol{v}_{c}\right)}{\sum_{w \in \operatorname{Vocab}} \exp\left(\boldsymbol{u}_{w}^{\top} \boldsymbol{v}_{c}\right)}\]</span></p><p>ËøôÈáåÔºå<span class="math inline">\(ùë¢_o\)</span>ÂêëÈáè‰ª£Ë°®Â§ñÂõ¥ËØçÔºå<spanclass="math inline">\(v_c\)</span>ÂêëÈáè‰ª£Ë°®‰∏≠ÂøÉËØç„ÄÇ‰∏∫‰∫ÜÂåÖÂê´Ëøô‰∫õÂêëÈáèÔºåÊàë‰ª¨Êúâ‰∏§‰∏™Áü©Èòµ<span class="math inline">\(ùëà\)</span> Âíå <spanclass="math inline">\(ùëâ\)</span> „ÄÇ <spanclass="math inline">\(ùëà\)</span> ÁöÑÂàóÊòØÂ§ñÂõ¥ËØçÔºå <spanclass="math inline">\(V\)</span> ÁöÑÂàóÊòØ‰∏≠ÂøÉËØçÔºåËøô‰∏§Áü©ÈòµÈÉΩÊúâÊâÄÊúâËØç<spanclass="math inline">\(w \in Vocabulary\)</span>ÁöÑË°®Á§∫ „ÄÇ</p><p>ÂØπ‰∫éËØç <span class="math inline">\(c\)</span> ÂíåËØç <spanclass="math inline">\(o\)</span>ÔºåÊçüÂ§±ÂáΩÊï∞‰∏∫ÂØπÊï∞Âá†ÁéáÔºö <spanclass="math display">\[\boldsymbol{J}_{naive-softmax}(v_c, o, \boldsymbol{U}) = -log P(O=o \midC=c)\]</span></p><p>ÂèØ‰ª•‰ªé‰∫§ÂèâÁÜµÁöÑËßíÂ∫¶ÁúãËøô‰∏™ÊçüÂ§±ÂáΩÊï∞„ÄÇÁúüÂÆûÂÄº‰∏∫ <spanclass="math inline">\(y\)</span> ÔºåÊòØ‰∏Ä‰∏™Áã¨ÁÉ≠ÂêëÈáèÔºåÈ¢ÑÊµãÂÄº <spanclass="math inline">\(\hat{y}\)</span> ËÆ°ÁÆóÂæóÂà∞„ÄÇÂÖ∑‰ΩìÊù•ËØ¥Ôºå <spanclass="math inline">\(y\)</span>Â¶ÇÊûúÊòØÁ¨¨k‰∏™ÂçïËØçÔºåÈÇ£‰πàÂÆÉÁöÑÁ¨¨kÁª¥‰∏∫1ÔºåÂÖ∂‰ΩôÁª¥ÈÉΩÊòØ0ÔºåËÄå <spanclass="math inline">\(\hat{y}\)</span>ÁöÑÁ¨¨kÁª¥Ë°®Á§∫ËøôÊòØÁ¨¨k‰∏™ËØçÁöÑÊ¶ÇÁéáÂ§ßÂ∞è„ÄÇ</p><h3 id="ÈóÆÈ¢òa-3ÂàÜ">ÈóÆÈ¢ò(a) (3ÂàÜ)</h3><p>ËØÅÊòéÂÖ¨Âºè(2)ÁªôÂá∫ÁöÑnaive-softmaxÁöÑÊçüÂ§±ÂáΩÊï∞ÔºåÂíå <spanclass="math inline">\(y\)</span> ‰∏é <spanclass="math inline">\(\hat{y}\)</span>ÁöÑ‰∫§ÂèâÁÜµÊçüÂ§±ÂáΩÊï∞ÊòØ‰∏ÄÊ†∑ÁöÑÔºåÂùáÂ¶Ç‰∏ãÊâÄÁ§∫ÔºàÁ≠îÊ°àÊéßÂà∂Âú®‰∏ÄË°åÔºâ</p><p><span class="math display">\[-\sum_{w \in V o c a b} y_{w} \log\left(\hat{y}_{w}\right)=-\log \left(\hat{y}_{o}\right)\]</span></p><p><strong>Á≠îÔºö</strong>Âõ†‰∏∫Èô§‰∫Ü <span class="math inline">\(o\)</span>‰πãÂ§ñÁöÑËØçÈÉΩ‰∏çÂú®Á™óÂè£ÂÜÖÔºåÊâÄ‰ª•Âè™ÊúâËØç <span class="math inline">\(o\)</span>ÂØπÊçüÂ§±ÂáΩÊï∞ÊúâË¥°ÁåÆ</p><h3 id="ÈóÆÈ¢òb-5ÂàÜ">ÈóÆÈ¢ò(b) (5ÂàÜ)</h3><p>ËÆ°ÁÆóÊçüÂ§±ÂáΩÊï∞ <spanclass="math inline">\(\boldsymbol{J}_{naive-softmax}(v_c, o,\boldsymbol{U})\)</span> ÂØπ‰∏≠ÂøÉËØç <spanclass="math inline">\(v_c\)</span> ÁöÑÂÅèÂØºÊï∞ÔºåÁî® <spanclass="math inline">\(y\)</span> Ôºå<spanclass="math inline">\(\hat{y}\)</span>Âíå <spanclass="math inline">\(ùëà\)</span> Êù•Ë°®Á§∫„ÄÇ</p><p><strong>Á≠îÔºö</strong> <span class="math display">\[\begin{aligned}J_{\text {naive-softmax} }\left(\boldsymbol{v}_{c}, o,\boldsymbol{U}\right)&amp;=-\log P(O=o | C=c) \\&amp;= -\log \frac{\exp \left(\boldsymbol{u}_{o}^{\top}\boldsymbol{v}_{c}\right)}{\sum_{w \in \operatorname{Vocab} } \exp\left(\boldsymbol{u}_{\boldsymbol{w} }^{\top} \boldsymbol{v}_{c}\right)}\\&amp;= - {u}_{o}^{\top}{v}_{c} + \log \sum_{w \in \operatorname{Vocab} }\exp \left(\boldsymbol{u}_{\boldsymbol{w} }^{\top}\boldsymbol{v}_{c}\right)\end{aligned}\]</span></p><p><span class="math display">\[\begin{aligned}\frac{\partial J_{\text {naive-softmax} }\left(\boldsymbol{v}_{c}, o,\boldsymbol{U}\right)}{\partial  v_c}&amp;= -u_o + \sum_{o \in \operatorname{Vocab} }\frac{\exp(u_o^\topv_c)}{\sum_{w \in \operatorname{Vocab} } \exp\left(\boldsymbol{u}_{\boldsymbol{w} }^{\top} \boldsymbol{v}_{c}\right)}\frac{\partial (u_o^\top v_c)}{\partial v_c}\\&amp;=-u_o + \sum_{o \in \operatorname{Vocab} } P(O=o | C=c)  u_o \\&amp;=- U y + U \hat y \\&amp;= U(\hat y - y)\end{aligned}\]</span></p><h3 id="ÈóÆÈ¢òc-5ÂàÜ">ÈóÆÈ¢ò(c) (5ÂàÜ)</h3><p>ËÆ°ÁÆóÊçüÂ§±ÂáΩÊï∞ <spanclass="math inline">\(\boldsymbol{J}_{naive-softmax}(v_c, o,\boldsymbol{U})\)</span> ÂØπ‰∏ä‰∏ãÊñáÁ™óÂè£ÂÜÖÁöÑËØç <spanclass="math inline">\(w\)</span> ÁöÑÂÅèÂØºÊï∞ÔºåËÄÉËôë‰∏§ÁßçÊÉÖÂÜµÔºåÂç≥ <spanclass="math inline">\(w\)</span> ÊòØÂ§ñÂõ¥ËØç <spanclass="math inline">\(o\)</span>ÔºåÂíå <spanclass="math inline">\(w\)</span> ‰∏çÊòØ <spanclass="math inline">\(o\)</span>ÔºåÁî® <spanclass="math inline">\(y\)</span> Ôºå<spanclass="math inline">\(\hat{y}\)</span>Âíå <spanclass="math inline">\(v_c\)</span> Êù•Ë°®Á§∫„ÄÇ</p><p><strong>Á≠îÔºö</strong> <span class="math display">\[\begin{aligned}\frac{\partial J_{\text {naive-softmax} }\left(\boldsymbol{v}_{c}, o,\boldsymbol{U}\right)}{\partial  u_w}&amp;= -v_c 1_{\lbrace w=o \rbrace } + \frac{\exp(u_w^\top v_c)}{\sum_{w\in \operatorname{Vocab} } \exp \left(\boldsymbol{u}_{\boldsymbol{w}}^{\top} \boldsymbol{v}_{c}\right)}\frac{\partial (u_w^\top v_c)}{\partial u_w}\\&amp;=-v_c  1_{\lbrace w=o \rbrace } +  P(O=w | C=c)  v_c \\&amp;=v_c( \hat y_w -  y_w)\end{aligned}\]</span></p><h3 id="ÈóÆÈ¢òd-3ÂàÜ">ÈóÆÈ¢ò(d) (3ÂàÜ)</h3><p>sigmoidÂáΩÊï∞Â¶ÇÂÖ¨ÂºèÊâÄÁ§∫ <span class="math display">\[\sigma(\boldsymbol{x})=\frac{1}{1+e^{-\boldsymbol{x}}}=\frac{e^{\boldsymbol{x}}}{e^{\boldsymbol{x}}+1}\]</span> ËØ∑ËÆ°ÁÆóÂá∫ÂÆÉÂØπ‰∫é <span class="math inline">\(x\)</span> ÁöÑÂØºÊï∞Ôºå<span class="math inline">\(x\)</span> ÊòØ‰∏Ä‰∏™ÂêëÈáè</p><p><strong>Á≠îÔºö</strong></p><p>ËÆ°ÁÆóÈõÖÂÖãÊØîÁü©ÈòµÂèØÂæó <span class="math display">\[\begin{aligned}\frac{\partial \sigma(x_i )}{\partial x_j }&amp;= \sigma (x_i) (1 -\sigma(x_i)) 1_{\lbrace i=j\rbrace  }\end{aligned}\]</span> ÊâÄ‰ª•Êúâ <span class="math display">\[\frac{\partial \sigma(x)}{\partial  x}=\text{diag}(\sigma(x) (1- \sigma(x)))\]</span></p><h3 id="ÈóÆÈ¢òe-4ÂàÜ">ÈóÆÈ¢ò(e) (4ÂàÜ)</h3><p>Áé∞Âú®Êàë‰ª¨ËÄÉËôëË¥üÈááÊ†∑ÁöÑÊçüÂ§±ÂáΩÊï∞„ÄÇÂÅáËÆæÊúâK‰∏™Ë¥üÊ†∑Êú¨ÔºåË°®Á§∫‰∏∫<spanclass="math inline">\(w_1, w_2, ‚Ä¶, w_K\)</span>ÔºåÂÆÉ‰ª¨ÂØπÂ∫îÁöÑÂêëÈáè‰∏∫ <spanclass="math inline">\(u_1, u_2, ‚Ä¶, u_K\)</span>ÔºåÂ§ñÂõ¥ËØç <spanclass="math inline">\(o \not\in {w_1, w_2, ‚Ä¶, w_K}\)</span>ÔºåÂàôÂ§ñÂõ¥ËØç<span class="math inline">\(o\)</span> Âú®‰∏≠ÂøÉËØçÊòØ <spanclass="math inline">\(c\)</span> Êó∂‰∫ßÁîüÁöÑÊçüÂ§±ÂáΩÊï∞Â¶ÇÂÖ¨ÂºèÊâÄÁ§∫„ÄÇ <spanclass="math display">\[\boldsymbol{J}_{\text {neg-sample }}\left(\boldsymbol{v}_{c}, o,\boldsymbol{U}\right)=-\log \left(\sigma\left(\boldsymbol{u}_{o}^{\top}\boldsymbol{v}_{c}\right)\right)-\sum_{k=1}^{K} \log\left(\sigma\left(-\boldsymbol{u}_{k}^{\top}\boldsymbol{v}_{c}\right)\right)\]</span> Ê†πÊçÆËØ•ÊçüÂ§±ÂáΩÊï∞ÔºåÈáçÊñ∞ËÆ°ÁÆóÈóÆÈ¢ò(b)„ÄÅÈóÆÈ¢ò(c)ÁöÑÂÅèÂØºÊï∞ÔºåÁî® <spanclass="math inline">\(\boldsymbol{u}_o\)</span>Ôºå<spanclass="math inline">\(\boldsymbol{v}_c\)</span>Ôºå<spanclass="math inline">\(\boldsymbol{u}_k\)</span> Êù•Ë°®Á§∫„ÄÇ</p><p>ÂÆåÊàêËÆ°ÁÆóÂêéÔºåÁÆÄË¶ÅËß£Èáä‰∏∫‰ªÄ‰πàËøô‰∏™ÊçüÂ§±ÂáΩÊï∞ÊØînaive-softmaxÊïàÁéáÊõ¥È´ò„ÄÇ</p><p>Ê≥®ÊÑèÔºö‰Ω†ÂèØ‰ª•Áî®ÈóÆÈ¢ò(d)ÁöÑÁ≠îÊ°àÊù•Â∏ÆÂä©‰Ω†ËÆ°ÁÆóÂØºÊï∞</p><p><strong>Á≠îÔºö</strong> <span class="math display">\[\begin{aligned}\frac{\partial J_{\text {neg-sample} }\left(v_{c}, o,U\right)}{\partial  v_c}&amp;=-\frac{\sigma\left(\boldsymbol{u}_{o}^{\top}\boldsymbol{v}_{c}\right)\left(1- \sigma\left(\boldsymbol{u}_{o}^{\top}\boldsymbol{v}_{c}\right)\right)}{\sigma\left(\boldsymbol{u}_{o}^{\top}\boldsymbol{v}_{c}\right)}u _o-\sum_{k=1}^K\frac{\sigma\left(-\boldsymbol{u}_{k}^{\top}\boldsymbol{v}_{c}\right)\left(1- \sigma\left(-\boldsymbol{u}_{k}^{\top}\boldsymbol{v}_{c}\right)\right)}{\sigma\left(-\boldsymbol{u}_{k}^{\top}\boldsymbol{v}_{c}\right)}(-u_k)\\&amp;= -\left(1- \sigma\left(\boldsymbol{u}_{o}^{\top}\boldsymbol{v}_{c}\right)\right)u_o+ \sum_{k=1}^K  \left(1- \sigma\left(-\boldsymbol{u}_{k}^{\top}\boldsymbol{v}_{c}\right)\right)u_k\\\frac{\partial J_{\text {neg-sample} }\left(v_{c}, o,U\right)}{\partial  u_o}&amp;=-\frac{\sigma\left(\boldsymbol{u}_{o}^{\top}\boldsymbol{v}_{c}\right)\left(1- \sigma\left(\boldsymbol{u}_{o}^{\top}\boldsymbol{v}_{c}\right)\right)}{\sigma\left(\boldsymbol{u}_{o}^{\top}\boldsymbol{v}_{c}\right)}v _c\\&amp;= -\left(1- \sigma\left(\boldsymbol{u}_{o}^{\top}\boldsymbol{v}_{c}\right)\right)v_c \\\frac{\partial J_{\text {neg-sample} }\left(v_{c}, o,U\right)}{\partial  u_k}&amp;=-\frac{\sigma\left(-\boldsymbol{u}_{k}^{\top}\boldsymbol{v}_{c}\right)\left(1- \sigma\left(-\boldsymbol{u}_{k}^{\top}\boldsymbol{v}_{c}\right)\right)}{\sigma\left(-\boldsymbol{u}_{k}^{\top}\boldsymbol{v}_{c}\right)}(-v_c)\\&amp;= \left(1- \sigma\left(-\boldsymbol{u}_{k}^{\top}\boldsymbol{v}_{c}\right)\right)v_c\end{aligned}\]</span></p><ul><li><p>ÂéüÂßãÁöÑÊçüÂ§±ÂáΩÊï∞‰∏≠ÈúÄË¶ÅÊ±ÇÊåáÊï∞ÂíåÔºåÂæàÂÆπÊòìÊ∫¢Âá∫ÔºåË¥üÈááÊ†∑ÁöÑÊçüÂ§±ÂáΩÊï∞ËÉΩÂæàÂ•ΩÂú∞ËßÑÈÅøËøô‰∏™ÈóÆÈ¢ò„ÄÇ</p></li><li><p>ËØçÂ∫ì‰ªé ùëâùëúùëêùëéùëè ÂèòÊàê‰∫ÜK+1‰∏™ËØç</p></li><li><p>Âú®Ê±ÇÂÜÖÂ±ÇÂØºÊï∞ÁöÑÊó∂ÂÄôÁî®‰∫ÜsigmoidÂáΩÊï∞</p></li></ul><h3 id="ÈóÆÈ¢òf-3ÂàÜ">ÈóÆÈ¢ò(f) (3ÂàÜ)</h3><p>ÂÅáËÆæ‰∏≠ÂøÉËØçÊòØ <span class="math inline">\(c =w_t\)</span>Ôºå‰∏ä‰∏ãÊñáÁ™óÂè£ÊòØ<span class="math inline">\([w_{t-m}, ‚Ä¶,w_{t-1}, w_t, w_{t+1}, ‚Ä¶, w_{t+m}]\)</span>Ôºå<spanclass="math inline">\(m\)</span>ÊòØÁ™óÂè£Â§ßÂ∞èÔºåÂõûÈ°æskip-gramÁöÑword2vecÂÆûÁé∞ÔºåÂú®ËØ•Á™óÂè£‰∏ãÁöÑÊÄªÊçüÂ§±ÂáΩÊï∞ÊòØÔºö<span class="math display">\[\boldsymbol{J}_{\text {skip-gram }}\left(\boldsymbol{v}_{c}, w_{t-m},\ldots w_{t+m}, \boldsymbol{U}\right)=\sum_{-m \leq j \leq m \atop j\neq 0} \boldsymbol{J}\left(\boldsymbol{v}_{c}, w_{t+j},\boldsymbol{U}\right)\]</span> ËøôÈáåÔºå<spanclass="math inline">\(\boldsymbol{J}(\boldsymbol{v}_c, w_{t+j},\boldsymbol{U})\)</span>ÊòØÂ§ñÂõ¥ËØçÊòØÂ§ñÂõ¥ËØç<spanclass="math inline">\(w_{t+j}\)</span>Âú®‰∏≠ÂøÉËØçÂú®‰∏≠ÂøÉËØç<spanclass="math inline">\(c=w_t\)</span>‰∏ã‰∫ßÁîüÁöÑÊçüÂ§±ÔºåÊçüÂ§±ÂáΩÊï∞ÂèØ‰ª•ÊòØnaive-softmaxÊàñËÄÖÊòØneg-sampleÔºàË¥üÈááÊ†∑ÔºâÔºåËøôÂèñÂÜ≥‰∫éÂÖ∑‰ΩìÂÆûÁé∞„ÄÇ</p><p>ËÆ°ÁÆóÔºö</p><ol type="i"><li><p>ÊçüÂ§±ÂáΩÊï∞ÂØπ <span class="math inline">\(U\)</span>ÁöÑÂÅèÂØºÊï∞</p></li><li><p>ÊçüÂ§±ÂáΩÊï∞ÂØπ <span class="math inline">\(\boldsymbol{v}_c\)</span>ÁöÑÂÅèÂØºÊï∞</p></li><li><p>ÊçüÂ§±ÂáΩÊï∞ÂØπ <span class="math inline">\(\boldsymbol{v}_w\)</span>ÁöÑÂÅèÂØºÊï∞</p></li></ol><strong>Á≠îÔºö</strong> $$<span class="math display">\[\begin{aligned}\partial \boldsymbol{J}_{\text {skip-gram } }\left(\boldsymbol{v}_{c},w_{t-m}, \dots w_{t+m}, \boldsymbol{U}\right) / \partial \boldsymbol{U}&amp;=\sum_{-m \leq j \leq m \atop j \neq 0} \partial\boldsymbol{J}\left(\boldsymbol{v}_{c}, w_{t+j}, \boldsymbol{U}\right) /\partial \boldsymbol{U} \\\partial \boldsymbol{J}_{\text {skip-gram } }\left(\boldsymbol{v}_{c},w_{t-m}, \dots w_{t+m}, \boldsymbol{U}\right) / \partial\boldsymbol{v_c}&amp;=\sum_{-m \leq j \leq m \atop j \neq 0} \partial\boldsymbol{J}\left(\boldsymbol{v}_{c}, w_{t+j}, \boldsymbol{U}\right) /\partial  \boldsymbol{v_c} \\\partial \boldsymbol{J}_{\text {skip-gram } }\left(\boldsymbol{v}_{c},w_{t-m}, \dots w_{t+m}, \boldsymbol{U}\right) / \partial\boldsymbol{v_w}&amp;=\sum_{-m \leq j \leq m \atop j \neq 0} \partial\boldsymbol{J}\left(\boldsymbol{v}_{c}, w_{t+j}, \boldsymbol{U}\right) /\partial  \boldsymbol{v_w} \\\end{aligned}\]</span><p>$$</p><h2 id="‰ª£Á†ÅÂÆûÁé∞word2vec20ÂàÜ">‰ª£Á†ÅÔºöÂÆûÁé∞word2vecÔºà20ÂàÜÔºâ</h2><p>ÁÇπÂáª <ahref="http://web.stanford.edu/class/cs224n/assignments/a2.zip">Ê≠§Â§Ñ</a>‰∏ãËΩΩ‰ª£Á†ÅÔºåpythonÁâàÊú¨ &gt;=3.5ÔºåÈúÄË¶ÅÂÆâË£ÖnumpyÔºå‰Ω†Âà©Áî®condaÊù•ÈÖçÁΩÆÁéØÂ¢ÉÔºö</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">conda env create -f env.yml<br>conda activate a2<br></code></pre></div></td></tr></table></figure><p>ÂÜôÂÆå‰ª£Á†ÅÂêéÔºåËøêË°åÔºö</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">conda deactivate<br></code></pre></div></td></tr></table></figure><h3 id="ÈóÆÈ¢òa-12ÂàÜ">ÈóÆÈ¢ò(a) (12ÂàÜ)</h3><p>È¶ñÂÖàÔºåÂÆûÁé∞ word2vec.py ÈáåÁöÑsigmoidÂáΩÊï∞ÔºåË¶ÅÊîØÊåÅÂêëÈáèËæìÂÖ•„ÄÇÊé•ÁùÄÂÆûÁé∞Âêå‰∏Ä‰∏™Êñá‰ª∂ÈáåÁöÑ softmax„ÄÅË¥üÈááÊ†∑ÊçüÂ§±ÂíåÂØºÊï∞„ÄÇÁÑ∂ÂêéÂÆûÁé∞skip-gramÁöÑÊçüÂ§±ÂáΩÊï∞ÂíåÂØºÊï∞„ÄÇÂÖ®ÈÉ®ÂÅöÂÆå‰πãÂêéÔºåËøêË°åpythonword2vec.pyÊù•Ê£ÄÊü•ÊòØÂê¶Ê≠£Á°Æ„ÄÇ</p><p><strong>Á≠îÔºö</strong></p><h4 id="sigmoid">sigmoid</h4><p>numpyÂÖ∑Â§áÂπøÊí≠ÁâπÊÄßÔºåÊúÄÁªàÂæóÂà∞ÂêëÈáèËæìÂá∫</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">sigmoid</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Compute the sigmoid function for the input here.</span><br><span class="hljs-string">    Arguments:</span><br><span class="hljs-string">    x -- A scalar or numpy array.</span><br><span class="hljs-string">    Return:</span><br><span class="hljs-string">    s -- sigmoid(x)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-comment">### YOUR CODE HERE</span><br>    s = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + np.exp(-x))<br><br>    <span class="hljs-comment">### END YOUR CODE</span><br><br>    <span class="hljs-keyword">return</span> s<br></code></pre></div></td></tr></table></figure><h4 id="naivesoftmaxlossandgradient">naiveSoftmaxLossAndGradient</h4><p>Ëøô‰∏™Ê®°ÂûãÂÖ∂ÂÆûÂ∞±ÊòØ‰∏Ä‰∏™‰∏âÂ±ÇÁöÑÂâçÈ¶àÁ•ûÁªèÁΩëÁªúÔºåÂè™ÈúÄË¶ÅÊ≥®ÊÑèÁª¥Â∫¶Âç≥ÂèØÔºåÊ≥®ÈáäÈáåÂ∑≤ÁªèÊ†áËÆ∞Âá∫‰∫ÜÁª¥Â∫¶„ÄÇ</p><p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂçïËØçË°®Á§∫ÊòØÂú®Ë°åÔºåËÄå‰∏çÊòØÂàó„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">### YOUR CODE HERE</span><br><br><span class="hljs-comment">### Please use the provided softmax function (imported earlier in this file)</span><br><span class="hljs-comment">### This numerically stable implementation helps you avoid issues pertaining</span><br><span class="hljs-comment">### to integer overflow. </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    centerWordVec: 1 * d</span><br><span class="hljs-string">    outsideVectors: n * d</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br><span class="hljs-comment">#1 * n</span><br>vec = centerWordVec.dot(outsideVectors.T)<br><span class="hljs-comment">#1 * n</span><br>prob = softmax(vec)<br>loss = -np.log(prob[outsideWordIdx])<br><span class="hljs-comment">#1 * d</span><br>gradCenterVec = -outsideVectors[outsideWordIdx] + prob.dot(outsideVectors)<br><span class="hljs-comment">#n * d</span><br>gradOutsideVecs = prob.reshape(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).dot(centerWordVec.reshape(<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>))<br><span class="hljs-comment">#n * d</span><br>gradOutsideVecs[outsideWordIdx] -= centerWordVec<br><span class="hljs-comment">### END YOUR CODE</span><br></code></pre></div></td></tr></table></figure><h4 id="negsamplinglossandgradient">negSamplingLossAndGradient</h4><p>‰∏énative-softmax‰∏çÂêåÁöÑÊòØÔºö</p><ul><li>Âè™ÈÄâÂèñK‰∏™ÈùûÂ§ñÂõ¥ËØç‰Ωú‰∏∫Ë¥üÊ†∑Êú¨ÔºåÂä†‰∏ä1‰∏™Ê≠£Á°ÆÁöÑÂ§ñÂõ¥ËØçÔºåÂÖ±K+1‰∏™ËæìÂá∫</li><li>ÊúÄÂêé‰∏ÄÂ±Ç‰ΩøÁî®sigmoidËæìÂá∫ÔºåËÄå‰∏çÊòØsoftmax</li></ul><p>Ê≥®ÊÑèÔºåÂèçÂêë‰º†Êí≠ÂæóÂà∞ÁöÑÊòØËøôK+1‰∏™ËØçÁöÑÊ¢ØÂ∫¶ÔºåÊâÄ‰ª•ÈúÄË¶ÅÊå®‰∏™Êõ¥Êñ∞Âà∞<em>Ê¢ØÂ∫¶Áü©Èòµ</em> ‰∏≠Âéª</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">### Please use your implementation of sigmoid in here.</span><br><br><span class="hljs-comment"># indices might have same index</span><br><span class="hljs-comment"># extract W</span><br>W = np.zeros((<span class="hljs-built_in">len</span>(indices), outsideVectors.shape[<span class="hljs-number">1</span>]))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(indices)):<br>    W[i] = outsideVectors[indices[i]]<br><br><span class="hljs-comment"># forward</span><br>a = centerWordVec<br>a = a.reshape((a.shape[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>))<br><br>z = np.dot(W, a) <span class="hljs-comment"># (K+1, 1)</span><br>preds = sigmoid(z)<br><br><span class="hljs-comment"># backprop</span><br>y = np.zeros((preds.shape[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>))<br>y[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span> <span class="hljs-comment"># index 0 is target</span><br><br>loss = -(y*np.log(preds) + (<span class="hljs-number">1</span> - y)*np.log(<span class="hljs-number">1</span> - preds)).<span class="hljs-built_in">sum</span>()<br><br>delta = preds - y<br>gradCenterVec = np.dot(W.T, delta) <span class="hljs-comment"># (V, 1)</span><br>gradW = np.dot(delta, a.T) <span class="hljs-comment"># (K+1, V)</span><br>gradCenterVec = gradCenterVec.flatten()<br><br><span class="hljs-comment"># apply gradW into gradOutsideVecs</span><br>gradOutsideVecs = np.zeros_like(outsideVectors)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(indices)):<br>    oi = indices[i]<br>    gradOutsideVecs[oi] += gradW[i]<br></code></pre></div></td></tr></table></figure><h4 id="skipgram">skipgram</h4><p>ÈÅçÂéÜÊâÄÊúâÁöÑÂ§ñÂõ¥ËØçÔºåÊ±ÇÂíåÊçüÂ§±ÂáΩÊï∞</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">ci = word2Ind[currentCenterWord]<br>vc = centerWordVectors[ci]<br><br><span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> outsideWords:<br>    oi = word2Ind[o]<br>    loss_, gradVc, gradUo = word2vecLossAndGradient(vc, oi, outsideVectors, dataset)<br>    gradCenterVecs[ci] += gradVc<br>    gradOutsideVectors += gradUo<br>    loss += loss_<br></code></pre></div></td></tr></table></figure><h3 id="ÈóÆÈ¢òb-4ÂàÜ">ÈóÆÈ¢ò(b) (4ÂàÜ)</h3><p>ÂÆåÊàêsgd.pyÊñá‰ª∂ÁöÑSGD‰ºòÂåñÂô®ÔºåËøêË°åpython sgd.pyÊù•Ê£ÄÊü•ÊòØÂê¶Ê≠£Á°Æ„ÄÇ</p><p><strong>Á≠î</strong>Ôºö</p><h4 id="sgd">sgd</h4><p>Ë∞ÉÁî®ÂáΩÊï∞ÂæóÂà∞ÊçüÂ§±ÂÄºÂíåÊ¢ØÂ∫¶ÔºåÊõ¥Êñ∞Âç≥ÂèØ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">### YOUR CODE HERE</span><br>loss, grad = f(x)<br>x -= step * grad<br><br><span class="hljs-comment">### END YOUR CODE</span><br></code></pre></div></td></tr></table></figure><h3 id="ÈóÆÈ¢òc-4ÂàÜ">ÈóÆÈ¢ò(c) (4ÂàÜ)</h3><p>Ëá≥Ê≠§ÊâÄÊúâÁöÑ‰ª£Á†ÅÈÉΩÂÜôÂÆå‰∫ÜÔºåÊé•‰∏ãÊù•ÊòØ‰∏ãËΩΩÊï∞ÊçÆÈõÜÔºåËøôÈáåÊàë‰ª¨‰ΩøÁî®StanformSentimentTreebank(SST)Êï∞ÊçÆÈõÜÔºåÂÆÉÂèØ‰ª•Áî®Âú®ÁÆÄÂçïÁöÑËØ≠‰πâÂàÜÊûê‰ªªÂä°‰∏≠Âéª„ÄÇÈÄöËøáËøêË°å shget_datasets.sh ÂèØ‰ª•Ëé∑ÂæóËØ•Êï∞ÊçÆÈõÜÔºå‰∏ãËΩΩÂÆåÊàêÂêéËøêË°å python run.pyÂç≥ÂèØ„ÄÇ</p><p>Ê≥®ÊÑèÔºöËÆ≠ÁªÉÁöÑÊó∂Èó¥ÂèñÂÜ≥‰∫é‰ª£Á†ÅÊòØÂê¶È´òÊïàÔºàÂç≥‰æøÊòØÈ´òÊïàÁöÑÂÆûÁé∞Ôºå‰πüË¶ÅË∑ëÊé•Ëøë‰∏Ä‰∏™Â∞èÊó∂Ôºâ</p><p>ÁªèËøá40,000Ê¨°Ëø≠‰ª£ÂêéÔºåÊúÄÁªàÁªìÊûú‰ºö‰øùÂ≠òÂà∞ word_vectors.png Èáå„ÄÇ</p><p><strong>Á≠îÔºö</strong></p><p><img src="http://ww1.sinaimg.cn/large/0060yMmAly1gsz2rwoc9sj30hs0dc3zy.jpg" referrerpolicy="no-referrer" /></p><ul><li>Âú®‰∏äÂõæ‰∏≠ÂèØ‰ª•ËßÇÂØüÂà∞Ôºåmale-&gt;famale Âíå king -&gt; queenËøô‰∏§Êù°ÂêëÈáèÊòØÂπ≥Ë°åÁöÑ</li><li>(women, famale)Ôºå(enjoyable,annoying) Ëøô‰∫õÂê´‰πâÊé•ËøëÁöÑËØçË∑ùÁ¶ªÂæàËøë</li></ul>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>NLP-Assignment1</title>
    <link href="/2022/05/05/NLP-Assignment1/"/>
    <url>/2022/05/05/NLP-Assignment1/</url>
    
    <content type="html"><![CDATA[<h1 id="assignment1">Assignment1</h1><p>ÊâÄÊúâ‰ΩøÁî®Âà∞ÁöÑÂ§¥Êñá‰ª∂Â¶Ç‰∏ãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># All Import Statements Defined Here</span><br><span class="hljs-comment"># Note: Do not add to this list.</span><br><span class="hljs-comment"># ----------------</span><br><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">assert</span> sys.version_info[<span class="hljs-number">0</span>]==<span class="hljs-number">3</span><br><span class="hljs-keyword">assert</span> sys.version_info[<span class="hljs-number">1</span>] &gt;= <span class="hljs-number">5</span><br><br><span class="hljs-keyword">from</span> gensim.models <span class="hljs-keyword">import</span> KeyedVectors<br><span class="hljs-keyword">from</span> gensim.test.utils <span class="hljs-keyword">import</span> datapath<br><span class="hljs-keyword">import</span> pprint<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br>plt.rcParams[<span class="hljs-string">&#x27;figure.figsize&#x27;</span>] = [<span class="hljs-number">10</span>, <span class="hljs-number">5</span>]<br><span class="hljs-keyword">import</span> nltk<br>nltk.download(<span class="hljs-string">&#x27;reuters&#x27;</span>)<br><span class="hljs-keyword">from</span> nltk.corpus <span class="hljs-keyword">import</span> reuters<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> scipy <span class="hljs-keyword">as</span> sp<br><span class="hljs-keyword">from</span> sklearn.decomposition <span class="hljs-keyword">import</span> TruncatedSVD<br><span class="hljs-keyword">from</span> sklearn.decomposition <span class="hljs-keyword">import</span> PCA<br><br>START_TOKEN = <span class="hljs-string">&#x27;&lt;START&gt;&#x27;</span><br>END_TOKEN = <span class="hljs-string">&#x27;&lt;END&gt;&#x27;</span><br><br>np.random.seed(<span class="hljs-number">0</span>)<br>random.seed(<span class="hljs-number">0</span>)<br><span class="hljs-comment"># ----------------</span><br></code></pre></div></td></tr></table></figure><h2 id="part-1Âü∫‰∫éËÆ°Êï∞ÁöÑËØçÂêëÈáè">Part 1ÔºöÂü∫‰∫éËÆ°Êï∞ÁöÑËØçÂêëÈáè</h2><p>Â§ßÂ§öÊï∞ËØçÂêëÈáèÊ®°ÂûãÈÉΩÊòØÂü∫‰∫é‰∏Ä‰∏™ËßÇÁÇπÔºö</p><p><strong>You shall know a word by the company it keeps (<ahref="https://en.wikipedia.org/wiki/John_Rupert_Firth">Firth, J. R.1957:11</a>)</strong></p><p>Â§ßÂ§öÊï∞ËØçÂêëÈáèÁöÑÂÆûÁé∞ÁöÑÊ†∏ÂøÉÊòØ <em>Áõ∏‰ººËØç</em>Ôºå‰πüÂ∞±ÊòØÂêå‰πâËØçÔºåÂõ†‰∏∫ÂÆÉ‰ª¨ÊúâÁõ∏‰ººÁöÑ‰∏ä‰∏ãÊñá„ÄÇËøôÈáåÊàë‰ª¨‰ªãÁªç‰∏ÄÁßçÁ≠ñÁï•Âè´ÂÅö<em>ÂÖ±Áé∞Áü©Èòµ</em> (Êõ¥Â§ö‰ø°ÊÅØÂèØ‰ª•Êü•Áúã <ahref="http://web.stanford.edu/class/cs124/lec/vectorsemantics.video.pdf">ËøôÈáå</a>Êàñ <ahref="https://medium.com/data-science-group-iitr/word-embedding-2d05d270b285">ËøôÈáå</a>)</p><p>ËøôÈÉ®ÂàÜË¶ÅÂÆûÁé∞ÁöÑÊòØÔºåÁªôÂÆöËØ≠ÊñôÂ∫ìÔºåÊ†πÊçÆÂÖ±Áé∞Áü©ÈòµËÆ°ÁÆóËØçÂêëÈáèÔºåÂæóÂà∞ËØ≠ÊñôÂ∫ì‰∏≠ÊØè‰∏™ËØçÁöÑËØçÂêëÈáèÔºåÊµÅÁ®ãÂ¶Ç‰∏ãÔºö</p><ul><li>ËÆ°ÁÆóËØ≠ÊñôÂ∫ìÁöÑÂçïËØçÈõÜ</li><li>ËÆ°ÁÆóÂÖ±Áé∞Áü©Èòµ</li><li>‰ΩøÁî®SVDÈôçÁª¥</li><li>ÂàÜÊûêËØçÂêëÈáè</li></ul><h3 id="ÈóÆÈ¢ò1.1ÂÆûÁé∞-dicintct_words">ÈóÆÈ¢ò1.1ÔºöÂÆûÁé∞ dicintct_words</h3><p>ËÆ°ÁÆóËØ≠ÊñôÂ∫ìÁöÑÂçïËØçÊï∞Èáè„ÄÅÂçïËØçÈõÜ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">distinct_words</span>(<span class="hljs-params">corpus</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; Determine a list of distinct words for the corpus.</span><br><span class="hljs-string">        Params:</span><br><span class="hljs-string">            corpus (list of list of strings): corpus of documents</span><br><span class="hljs-string">        Return:</span><br><span class="hljs-string">            corpus_words (list of strings): list of distinct words across the corpus, sorted (using python &#x27;sorted&#x27; function)</span><br><span class="hljs-string">            num_corpus_words (integer): number of distinct words across the corpus</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    corpus_words = []<br>    num_corpus_words = -<span class="hljs-number">1</span><br>    <br>    <span class="hljs-comment"># ------------------</span><br>    <span class="hljs-comment"># Write your implementation here.</span><br>    corpus_words =  <span class="hljs-built_in">sorted</span>(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>([word <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> corpus <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> sentence])))<br>    num_corpus_words = <span class="hljs-built_in">len</span>(corpus_words)<br><br>    <span class="hljs-comment"># ------------------</span><br><br>    <span class="hljs-keyword">return</span> corpus_words, num_corpus_words<br></code></pre></div></td></tr></table></figure><p>ÊµãËØïÁî®‰æãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ---------------------</span><br><span class="hljs-comment"># Run this sanity check</span><br><span class="hljs-comment"># Note that this not an exhaustive check for correctness.</span><br><span class="hljs-comment"># ---------------------</span><br><br><span class="hljs-comment"># Define toy corpus</span><br>test_corpus = [<span class="hljs-string">&quot;&#123;&#125; All that glitters isn&#x27;t gold &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(START_TOKEN, END_TOKEN).split(<span class="hljs-string">&quot; &quot;</span>), <span class="hljs-string">&quot;&#123;&#125; All&#x27;s well that ends well &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(START_TOKEN, END_TOKEN).split(<span class="hljs-string">&quot; &quot;</span>)]<br>test_corpus_words, num_corpus_words = distinct_words(test_corpus)<br><br><span class="hljs-comment"># Correct answers</span><br>ans_test_corpus_words = <span class="hljs-built_in">sorted</span>([START_TOKEN, <span class="hljs-string">&quot;All&quot;</span>, <span class="hljs-string">&quot;ends&quot;</span>, <span class="hljs-string">&quot;that&quot;</span>, <span class="hljs-string">&quot;gold&quot;</span>, <span class="hljs-string">&quot;All&#x27;s&quot;</span>, <span class="hljs-string">&quot;glitters&quot;</span>, <span class="hljs-string">&quot;isn&#x27;t&quot;</span>, <span class="hljs-string">&quot;well&quot;</span>, END_TOKEN])<br>ans_num_corpus_words = <span class="hljs-built_in">len</span>(ans_test_corpus_words)<br><br><span class="hljs-comment"># Test correct number of words</span><br><span class="hljs-keyword">assert</span>(num_corpus_words == ans_num_corpus_words), <span class="hljs-string">&quot;Incorrect number of distinct words. Correct: &#123;&#125;. Yours: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(ans_num_corpus_words, num_corpus_words)<br><br><span class="hljs-comment"># Test correct words</span><br><span class="hljs-keyword">assert</span> (test_corpus_words == ans_test_corpus_words), <span class="hljs-string">&quot;Incorrect corpus_words.\nCorrect: &#123;&#125;\nYours:   &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">str</span>(ans_test_corpus_words), <span class="hljs-built_in">str</span>(test_corpus_words))<br><br><span class="hljs-comment"># Print Success</span><br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Passed All Tests!&quot;</span>)<br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">80</span>)<br></code></pre></div></td></tr></table></figure><h3id="ÈóÆÈ¢ò1.2ÂÆûÁé∞compute_co_occurrence_matrix">ÈóÆÈ¢ò1.2ÔºöÂÆûÁé∞compute_co_occurrence_matrix</h3><p>ËÆ°ÁÆóÁªôÂÆöËØ≠ÊñôÂ∫ìÁöÑÂÖ±Áé∞Áü©Èòµ„ÄÇÂÖ∑‰ΩìÊù•ËØ¥ÔºåÂØπ‰∫éÊØè‰∏Ä‰∏™ËØç<code>w</code>ÔºåÁªüËÆ°Ââç„ÄÅÂêéÊñπ <code>window_size</code> ‰∏™ËØçÁöÑÂá∫Áé∞Ê¨°Êï∞</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_co_occurrence_matrix</span>(<span class="hljs-params">corpus, window_size=<span class="hljs-number">4</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot; Compute co-occurrence matrix for the given corpus and window_size (default of 4).</span><br><span class="hljs-string">    </span><br><span class="hljs-string">        Note: Each word in a document should be at the center of a window. Words near edges will have a smaller</span><br><span class="hljs-string">              number of co-occurring words.</span><br><span class="hljs-string">              </span><br><span class="hljs-string">              For example, if we take the document &quot;START All that glitters is not gold END&quot; with window size of 4,</span><br><span class="hljs-string">              &quot;All&quot; will co-occur with &quot;START&quot;, &quot;that&quot;, &quot;glitters&quot;, &quot;is&quot;, and &quot;not&quot;.</span><br><span class="hljs-string">    </span><br><span class="hljs-string">        Params:</span><br><span class="hljs-string">            corpus (list of list of strings): corpus of documents</span><br><span class="hljs-string">            window_size (int): size of context window</span><br><span class="hljs-string">        Return:</span><br><span class="hljs-string">            M (numpy matrix of shape (number of corpus words, number of corpus words)): </span><br><span class="hljs-string">                Co-occurence matrix of word counts. </span><br><span class="hljs-string">                The ordering of the words in the rows/columns should be the same as the ordering of the words given by the distinct_words function.</span><br><span class="hljs-string">            word2Ind (dict): dictionary that maps word to index (i.e. row/column number) for matrix M.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    words, num_words = distinct_words(corpus)<br>    M = np.zeros((num_words, num_words))<br>    word2Ind = <span class="hljs-built_in">dict</span>([(word, index) <span class="hljs-keyword">for</span> index, word <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(words)])<br>    <br>    <span class="hljs-comment"># ------------------</span><br>    <span class="hljs-comment"># Write your implementation here.</span><br>    <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> corpus:<br>        current_index = <span class="hljs-number">0</span><br>        sentence_len = <span class="hljs-built_in">len</span>(sentence)<br>        indices = [word2Ind[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sentence]<br>        <span class="hljs-keyword">while</span> current_index &lt; sentence_len:<br>            left  = <span class="hljs-built_in">max</span>(current_index - window_size, <span class="hljs-number">0</span>)<br>            right = <span class="hljs-built_in">min</span>(current_index + window_size + <span class="hljs-number">1</span>, sentence_len) <br>            current_word = sentence[current_index]<br>            current_word_index = word2Ind[current_word]<br>            words_around = indices[left:current_index] + indices[current_index+<span class="hljs-number">1</span>:right]<br>            <br>            <span class="hljs-keyword">for</span> ind <span class="hljs-keyword">in</span> words_around:<br>                M[current_word_index, ind] += <span class="hljs-number">1</span><br>            <br>            current_index += <span class="hljs-number">1</span><br><br>    <span class="hljs-comment"># ------------------</span><br><br>    <span class="hljs-keyword">return</span> M, word2Ind<br></code></pre></div></td></tr></table></figure><p>ÊµãËØïÁî®‰æãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ---------------------</span><br><span class="hljs-comment"># Run this sanity check</span><br><span class="hljs-comment"># Note that this is not an exhaustive check for correctness.</span><br><span class="hljs-comment"># ---------------------</span><br><br><span class="hljs-comment"># Define toy corpus and get student&#x27;s co-occurrence matrix</span><br>test_corpus = [<span class="hljs-string">&quot;&#123;&#125; All that glitters isn&#x27;t gold &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(START_TOKEN, END_TOKEN).split(<span class="hljs-string">&quot; &quot;</span>), <span class="hljs-string">&quot;&#123;&#125; All&#x27;s well that ends well &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(START_TOKEN, END_TOKEN).split(<span class="hljs-string">&quot; &quot;</span>)]<br>M_test, word2ind_test = compute_co_occurrence_matrix(test_corpus, window_size=<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># Correct M and word2ind</span><br>M_test_ans = np.array( <br>    [[<span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>,],<br>     [<span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>,],<br>     [<span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>,],<br>     [<span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>,],<br>     [<span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>,],<br>     [<span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>,],<br>     [<span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>,],<br>     [<span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>,],<br>     [<span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>,],<br>     [<span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>,]]<br>)<br>ans_test_corpus_words = <span class="hljs-built_in">sorted</span>([START_TOKEN, <span class="hljs-string">&quot;All&quot;</span>, <span class="hljs-string">&quot;ends&quot;</span>, <span class="hljs-string">&quot;that&quot;</span>, <span class="hljs-string">&quot;gold&quot;</span>, <span class="hljs-string">&quot;All&#x27;s&quot;</span>, <span class="hljs-string">&quot;glitters&quot;</span>, <span class="hljs-string">&quot;isn&#x27;t&quot;</span>, <span class="hljs-string">&quot;well&quot;</span>, END_TOKEN])<br>word2ind_ans = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(ans_test_corpus_words, <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(ans_test_corpus_words))))<br><br><span class="hljs-comment"># Test correct word2ind</span><br><span class="hljs-keyword">assert</span> (word2ind_ans == word2ind_test), <span class="hljs-string">&quot;Your word2ind is incorrect:\nCorrect: &#123;&#125;\nYours: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(word2ind_ans, word2ind_test)<br><br><span class="hljs-comment"># Test correct M shape</span><br><span class="hljs-keyword">assert</span> (M_test.shape == M_test_ans.shape), <span class="hljs-string">&quot;M matrix has incorrect shape.\nCorrect: &#123;&#125;\nYours: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(M_test.shape, M_test_ans.shape)<br><br><span class="hljs-comment"># Test correct M values</span><br><span class="hljs-keyword">for</span> w1 <span class="hljs-keyword">in</span> word2ind_ans.keys():<br>    idx1 = word2ind_ans[w1]<br>    <span class="hljs-keyword">for</span> w2 <span class="hljs-keyword">in</span> word2ind_ans.keys():<br>        idx2 = word2ind_ans[w2]<br>        student = M_test[idx1, idx2]<br>        correct = M_test_ans[idx1, idx2]<br>        <span class="hljs-keyword">if</span> student != correct:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Correct M:&quot;</span>)<br>            <span class="hljs-built_in">print</span>(M_test_ans)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Your M: &quot;</span>)<br>            <span class="hljs-built_in">print</span>(M_test)<br>            <span class="hljs-keyword">raise</span> AssertionError(<span class="hljs-string">&quot;Incorrect count at index (&#123;&#125;, &#123;&#125;)=(&#123;&#125;, &#123;&#125;) in matrix M. Yours has &#123;&#125; but should have &#123;&#125;.&quot;</span>.<span class="hljs-built_in">format</span>(idx1, idx2, w1, w2, student, correct))<br><br><span class="hljs-comment"># Print Success</span><br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Passed All Tests!&quot;</span>)<br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">80</span>)<br></code></pre></div></td></tr></table></figure><h3 id="ÈóÆÈ¢ò1.3ÂÆûÁé∞-reduce_to_k_dim">ÈóÆÈ¢ò1.3ÔºöÂÆûÁé∞ reduce_to_k_dim</h3><p>Ëøô‰∏ÄÊ≠•ÊòØÈôçÁª¥„ÄÇÂú®ÈóÆÈ¢ò1.2ÂæóÂà∞ÁöÑÊòØ‰∏Ä‰∏™N xNÁöÑÁü©ÈòµÔºàNÊòØÂçïËØçÈõÜÁöÑÂ§ßÂ∞èÔºâÔºå‰ΩøÁî®scikit-learnÂÆûÁé∞ÁöÑSVDÔºàÂ•áÂºÇÂÄºÂàÜËß£ÔºâÔºå‰ªéËøô‰∏™Â§ßÁü©ÈòµÈáåÂàÜËß£Âá∫‰∏Ä‰∏™Âê´k‰∏™ÁâπÂà∂ÁöÑNx k Â∞èÁü©Èòµ„ÄÇ</p><p><strong>Ê≥®ÊÑè</strong>ÔºöÂú®numpy„ÄÅscipyÂíåscikit-learnÈÉΩÊèê‰æõ‰∫Ü‰∏Ä‰∫õSVDÁöÑÂÆûÁé∞Ôºå‰ΩÜÊòØÂè™Êúâscipy„ÄÅsklearnÊúâTruncatedSVDÔºåÂπ∂‰∏îÂè™ÊúâsklearnÊèê‰æõ‰∫ÜËÆ°ÁÆóÂ§ßËßÑÊ®°SVDÁöÑÈ´òÊïàÁöÑrandomizedÁÆóÊ≥ïÔºåËØ¶ÊÉÖÂèÇËÄÉ<ahref="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.TruncatedSVD.html">sklearn.decomposition.TruncatedSVD</a>„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">reduce_to_k_dim</span>(<span class="hljs-params">M, k=<span class="hljs-number">2</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot; Reduce a co-occurence count matrix of dimensionality (num_corpus_words, num_corpus_words)</span><br><span class="hljs-string">        to a matrix of dimensionality (num_corpus_words, k) using the following SVD function from Scikit-Learn:</span><br><span class="hljs-string">            - http://scikit-learn.org/stable/modules/generated/sklearn.decomposition.TruncatedSVD.html</span><br><span class="hljs-string">    </span><br><span class="hljs-string">        Params:</span><br><span class="hljs-string">            M (numpy matrix of shape (number of corpus words, number of corpus words)): co-occurence matrix of word counts</span><br><span class="hljs-string">            k (int): embedding size of each word after dimension reduction</span><br><span class="hljs-string">        Return:</span><br><span class="hljs-string">            M_reduced (numpy matrix of shape (number of corpus words, k)): matrix of k-dimensioal word embeddings.</span><br><span class="hljs-string">                    In terms of the SVD from math class, this actually returns U * S</span><br><span class="hljs-string">    &quot;&quot;&quot;</span>    <br>    n_iters = <span class="hljs-number">10</span>     <span class="hljs-comment"># Use this parameter in your call to `TruncatedSVD`</span><br>    M_reduced = <span class="hljs-literal">None</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Running Truncated SVD over %i words...&quot;</span> % (M.shape[<span class="hljs-number">0</span>]))<br>    <br>    <span class="hljs-comment"># ------------------</span><br>    <span class="hljs-comment"># Write your implementation here.</span><br>    TSVD = TruncatedSVD(n_components=k, n_iter=n_iters)<br>    M_reduced = TSVD.fit_transform(M)<br><br>    <span class="hljs-comment"># ------------------</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Done.&quot;</span>)<br>    <span class="hljs-keyword">return</span> M_reduced<br></code></pre></div></td></tr></table></figure><p>ÊµãËØïÁî®‰æãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ---------------------</span><br><span class="hljs-comment"># Run this sanity check</span><br><span class="hljs-comment"># Note that this is not an exhaustive check for correctness </span><br><span class="hljs-comment"># In fact we only check that your M_reduced has the right dimensions.</span><br><span class="hljs-comment"># ---------------------</span><br><br><span class="hljs-comment"># Define toy corpus and run student code</span><br>test_corpus = [<span class="hljs-string">&quot;&#123;&#125; All that glitters isn&#x27;t gold &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(START_TOKEN, END_TOKEN).split(<span class="hljs-string">&quot; &quot;</span>), <span class="hljs-string">&quot;&#123;&#125; All&#x27;s well that ends well &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(START_TOKEN, END_TOKEN).split(<span class="hljs-string">&quot; &quot;</span>)]<br>M_test, word2ind_test = compute_co_occurrence_matrix(test_corpus, window_size=<span class="hljs-number">1</span>)<br>M_test_reduced = reduce_to_k_dim(M_test, k=<span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># Test proper dimensions</span><br><span class="hljs-keyword">assert</span> (M_test_reduced.shape[<span class="hljs-number">0</span>] == <span class="hljs-number">10</span>), <span class="hljs-string">&quot;M_reduced has &#123;&#125; rows; should have &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(M_test_reduced.shape[<span class="hljs-number">0</span>], <span class="hljs-number">10</span>)<br><span class="hljs-keyword">assert</span> (M_test_reduced.shape[<span class="hljs-number">1</span>] == <span class="hljs-number">2</span>), <span class="hljs-string">&quot;M_reduced has &#123;&#125; columns; should have &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(M_test_reduced.shape[<span class="hljs-number">1</span>], <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># Print Success</span><br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Passed All Tests!&quot;</span>)<br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">80</span>)<br></code></pre></div></td></tr></table></figure><h3 id="ÈóÆÈ¢ò1.4-ÂÆûÁé∞-plot_embeddings">ÈóÆÈ¢ò1.4 ÂÆûÁé∞ plot_embeddings</h3><p>Âü∫‰∫ématplotlibÔºåÁî®<code>scatter</code> Áîª ‚Äú√ó‚ÄùÔºåÁî® <code>text</code>ÂÜôÂ≠ó</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">plot_embeddings</span>(<span class="hljs-params">M_reduced, word2Ind, words</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; Plot in a scatterplot the embeddings of the words specified in the list &quot;words&quot;.</span><br><span class="hljs-string">        NOTE: do not plot all the words listed in M_reduced / word2Ind.</span><br><span class="hljs-string">        Include a label next to each point.</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        Params:</span><br><span class="hljs-string">            M_reduced (numpy matrix of shape (number of unique words in the corpus , k)): matrix of k-dimensioal word embeddings</span><br><span class="hljs-string">            word2Ind (dict): dictionary that maps word to indices for matrix M</span><br><span class="hljs-string">            words (list of strings): words whose embeddings we want to visualize</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-comment"># ------------------</span><br>    <span class="hljs-comment"># Write your implementation here.</span><br>    <br>    <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> words:<br>        index = word2Ind[w]<br>        embedding = M_reduced[index]<br>        x, y  = embedding[<span class="hljs-number">0</span>], embedding[<span class="hljs-number">1</span>]<br>        plt.scatter(x, y, marker=<span class="hljs-string">&#x27;x&#x27;</span>, color=<span class="hljs-string">&#x27;red&#x27;</span>)<br>        plt.text(x, y, word, fontsize=<span class="hljs-number">9</span>)<br>    plt.show()<br>    <span class="hljs-comment"># ------------------</span><br></code></pre></div></td></tr></table></figure><p>ÊµãËØïÁî®‰æãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ---------------------</span><br><span class="hljs-comment"># Run this sanity check</span><br><span class="hljs-comment"># Note that this is not an exhaustive check for correctness.</span><br><span class="hljs-comment"># The plot produced should look like the &quot;test solution plot&quot; depicted below. </span><br><span class="hljs-comment"># ---------------------</span><br><br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">80</span>)<br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;Outputted Plot:&quot;</span>)<br><br>M_reduced_plot_test = np.array([[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>], [-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>], [<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>], [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]])<br>word2ind_plot_test = &#123;<span class="hljs-string">&#x27;test1&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;test2&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;test3&#x27;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;test4&#x27;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&#x27;test5&#x27;</span>: <span class="hljs-number">4</span>&#125;<br>words = [<span class="hljs-string">&#x27;test1&#x27;</span>, <span class="hljs-string">&#x27;test2&#x27;</span>, <span class="hljs-string">&#x27;test3&#x27;</span>, <span class="hljs-string">&#x27;test4&#x27;</span>, <span class="hljs-string">&#x27;test5&#x27;</span>]<br>plot_embeddings(M_reduced_plot_test, word2ind_plot_test, words)<br><br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">80</span>)<br></code></pre></div></td></tr></table></figure><p>ÊïàÊûúÔºö</p><p><img src="/img/nlp/assignment1/1.jpg"/></p><h3 id="ÈóÆÈ¢ò1.5ÂÖ±Áé∞ÊâìÂç∞ÂàÜÊûê">ÈóÆÈ¢ò1.5ÔºöÂÖ±Áé∞ÊâìÂç∞ÂàÜÊûê</h3><p>Â∞ÜËØçÂµåÂÖ•Âà∞2‰∏™Áª¥Â∫¶‰∏äÔºåÂΩí‰∏ÄÂåñÔºåÊúÄÁªàËØçÂêëÈáè‰ºöËêΩÂà∞‰∏Ä‰∏™Âçï‰ΩçÂúÜÂÜÖÔºåÂú®ÂùêÊ†áÁ≥ª‰∏äÂØªÊâæÁõ∏ËøëÁöÑËØç„ÄÇ</p><p>ÊµãËØïÁî®‰æãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># -----------------------------</span><br><span class="hljs-comment"># Run This Cell to Produce Your Plot</span><br><span class="hljs-comment"># ------------------------------</span><br>reuters_corpus = read_corpus()<br>M_co_occurrence, word2ind_co_occurrence = compute_co_occurrence_matrix(reuters_corpus)<br>M_reduced_co_occurrence = reduce_to_k_dim(M_co_occurrence, k=<span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># Rescale (normalize) the rows to make them each of unit-length</span><br>M_lengths = np.linalg.norm(M_reduced_co_occurrence, axis=<span class="hljs-number">1</span>)<br>M_normalized = M_reduced_co_occurrence / M_lengths[:, np.newaxis] <span class="hljs-comment"># broadcasting</span><br><br>words = [<span class="hljs-string">&#x27;barrels&#x27;</span>, <span class="hljs-string">&#x27;bpd&#x27;</span>, <span class="hljs-string">&#x27;ecuador&#x27;</span>, <span class="hljs-string">&#x27;energy&#x27;</span>, <span class="hljs-string">&#x27;industry&#x27;</span>, <span class="hljs-string">&#x27;kuwait&#x27;</span>, <span class="hljs-string">&#x27;oil&#x27;</span>, <span class="hljs-string">&#x27;output&#x27;</span>, <span class="hljs-string">&#x27;petroleum&#x27;</span>, <span class="hljs-string">&#x27;iraq&#x27;</span>]<br><br>plot_embeddings(M_normalized, word2ind_co_occurrence, words)<br></code></pre></div></td></tr></table></figure><p><img src="/img/nlp/assignment1/2.jpg"/></p><h2 id="part-2Âü∫‰∫éÈ¢ÑÊµãÁöÑËØçÂêëÈáè">Part 2ÔºöÂü∫‰∫éÈ¢ÑÊµãÁöÑËØçÂêëÈáè</h2><p>ÁõÆÂâçÔºåÂü∫‰∫éÈ¢ÑÊµãÁöÑËØçÂêëÈáèÊòØÊúÄÊµÅË°åÁöÑÔºåÊØîÂ¶Çword2vec„ÄÇÁé∞Âú®Êàë‰ª¨Êù•Êé¢Á¥¢word2vecÁîüÊàêÁöÑËØçÂêëÈáèÔºåÂ¶ÇÊûúÊÉ≥Ë¶ÅÊ∑±ÂÖ•‰∫ÜËß£ÔºåÂèØ‰ª•ËØª‰∏ÄËØª<ahref="https://papers.nips.cc/paper/5021-distributed-representations-of-words-and-phrases-and-their-compositionality.pdf">ÂéüÂßãËÆ∫Êñá</a>„ÄÇ</p><p>Ëøô‰∏ÄÈÉ®ÂàÜ‰∏ªË¶ÅÊòØ‰ΩøÁî®gensimÊé¢Á¥¢ËØçÂêëÈáèÔºå‰∏çÊòØËá™Â∑±ÂÆûÁé∞word2vecÔºåÊâÄ‰ΩøÁî®ÁöÑËØçÂêëÈáèÁª¥Â∫¶ÊòØ300ÔºåÁî±googleÂèëÂ∏É„ÄÇ</p><p>È¶ñÂÖà‰ΩøÁî®SVDÈôçÁª¥ÔºåÂ∞Ü300Áª¥Èôç2Áª¥ÔºåÊñπ‰æøÊâìÂç∞Êü•Áúã„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_embedding_model</span>():<br>    <span class="hljs-string">&quot;&quot;&quot; Load GloVe Vectors</span><br><span class="hljs-string">        Return:</span><br><span class="hljs-string">            wv_from_bin: All 400000 embeddings, each lengh 200</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">import</span> gensim.downloader <span class="hljs-keyword">as</span> api<br>    wv_from_bin = api.load(<span class="hljs-string">&quot;glove-wiki-gigaword-200&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Loaded vocab size %i&quot;</span> % <span class="hljs-built_in">len</span>(wv_from_bin.vocab.keys()))<br>    <span class="hljs-keyword">return</span> wv_from_bin<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># -----------------------------------</span><br><span class="hljs-comment"># Run Cell to Load Word Vectors</span><br><span class="hljs-comment"># Note: This will take a couple minutes</span><br><span class="hljs-comment"># -----------------------------------</span><br>wv_from_bin = load_embedding_model()<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_matrix_of_vectors</span>(<span class="hljs-params">wv_from_bin, required_words=[<span class="hljs-string">&#x27;barrels&#x27;</span>, <span class="hljs-string">&#x27;bpd&#x27;</span>, <span class="hljs-string">&#x27;ecuador&#x27;</span>, <span class="hljs-string">&#x27;energy&#x27;</span>, <span class="hljs-string">&#x27;industry&#x27;</span>, <span class="hljs-string">&#x27;kuwait&#x27;</span>, <span class="hljs-string">&#x27;oil&#x27;</span>, <span class="hljs-string">&#x27;output&#x27;</span>, <span class="hljs-string">&#x27;petroleum&#x27;</span>, <span class="hljs-string">&#x27;iraq&#x27;</span>]</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; Put the GloVe vectors into a matrix M.</span><br><span class="hljs-string">        Param:</span><br><span class="hljs-string">            wv_from_bin: KeyedVectors object; the 400000 GloVe vectors loaded from file</span><br><span class="hljs-string">        Return:</span><br><span class="hljs-string">            M: numpy matrix shape (num words, 200) containing the vectors</span><br><span class="hljs-string">            word2ind: dictionary mapping each word to its row number in M</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">import</span> random<br>    words = <span class="hljs-built_in">list</span>(wv_from_bin.vocab.keys())<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Shuffling words ...&quot;</span>)<br>    random.seed(<span class="hljs-number">224</span>)<br>    random.shuffle(words)<br>    words = words[:<span class="hljs-number">10000</span>]<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Putting %i words into word2ind and matrix M...&quot;</span> % <span class="hljs-built_in">len</span>(words))<br>    word2ind = &#123;&#125;<br>    M = []<br>    curInd = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> words:<br>        <span class="hljs-keyword">try</span>:<br>            M.append(wv_from_bin.word_vec(w))<br>            word2ind[w] = curInd<br>            curInd += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">except</span> KeyError:<br>            <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> required_words:<br>        <span class="hljs-keyword">if</span> w <span class="hljs-keyword">in</span> words:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">try</span>:<br>            M.append(wv_from_bin.word_vec(w))<br>            word2ind[w] = curInd<br>            curInd += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">except</span> KeyError:<br>            <span class="hljs-keyword">continue</span><br>    M = np.stack(M)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Done.&quot;</span>)<br>    <span class="hljs-keyword">return</span> M, word2ind<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># -----------------------------------------------------------------</span><br><span class="hljs-comment"># Run Cell to Reduce 200-Dimensional Word Embeddings to k Dimensions</span><br><span class="hljs-comment"># Note: This should be quick to run</span><br><span class="hljs-comment"># -----------------------------------------------------------------</span><br>M, word2ind = get_matrix_of_vectors(wv_from_bin)<br>M_reduced = reduce_to_k_dim(M, k=<span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># Rescale (normalize) the rows to make them each of unit-length</span><br>M_lengths = np.linalg.norm(M_reduced, axis=<span class="hljs-number">1</span>)<br>M_reduced_normalized = M_reduced / M_lengths[:, np.newaxis] <span class="hljs-comment"># broadcasting</span><br></code></pre></div></td></tr></table></figure><h3 id="ÈóÆÈ¢ò2.1word2vecÊâìÂç∞ÂàÜÊûê">ÈóÆÈ¢ò2.1Ôºöword2vecÊâìÂç∞ÂàÜÊûê</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">words = [<span class="hljs-string">&#x27;barrels&#x27;</span>, <span class="hljs-string">&#x27;bpd&#x27;</span>, <span class="hljs-string">&#x27;ecuador&#x27;</span>, <span class="hljs-string">&#x27;energy&#x27;</span>, <span class="hljs-string">&#x27;industry&#x27;</span>, <span class="hljs-string">&#x27;kuwait&#x27;</span>, <span class="hljs-string">&#x27;oil&#x27;</span>, <span class="hljs-string">&#x27;output&#x27;</span>, <span class="hljs-string">&#x27;petroleum&#x27;</span>, <span class="hljs-string">&#x27;iraq&#x27;</span>]<br>plot_embeddings(M_reduced_normalized, word2ind, words)<br></code></pre></div></td></tr></table></figure><p>ÂíåÈóÆÈ¢ò1.5‰∏ÄÊ†∑</p><h3 id="ÈóÆÈ¢ò2.2‰∏ÄËØçÂ§ö‰πâ">ÈóÆÈ¢ò2.2Ôºö‰∏ÄËØçÂ§ö‰πâ</h3><p>ÊâæÂà∞‰∏Ä‰∏™ÊúâÂ§ö‰∏™Âê´‰πâÁöÑËØçÔºàÊØîÂ¶Ç‚Äúleaves‚ÄùÔºå‚Äùscoop‚ÄùÔºâÔºåËøôÁßçËØçÁöÑtop-10Áõ∏‰ººËØçÔºàÊ†πÊçÆ‰ΩôÂº¶Áõ∏‰ººÂ∫¶ÔºâÈáåÊúâ‰∏§‰∏™ËØçÁöÑÊÑèÊÄù‰∏ç‰∏ÄÊ†∑„ÄÇÊØîÂ¶Ç‚Äùleaves‚ÄùÔºàÂè∂Â≠êÔºåËä±Áì£ÔºâÁöÑtop-10ËØçÈáåÊúâ‚Äùvanishes‚ÄùÔºàÊ∂àÂ§±ÔºâÂíå‚Äùstalks‚ÄùÔºàËåéÁßÜÔºâ„ÄÇ</p><p><strong>Note</strong>: You should use the<code>wv_from_bin.most_similar(word)</code> function to get the top 10similar words. This function ranks all other words in the vocabularywith respect to their cosine similarity to the given word. For furtherassistance, please check the <strong><ahref="https://radimrehurek.com/gensim/models/keyedvectors.html#gensim.models.keyedvectors.FastTextKeyedVectors.most_similar">GenSimdocumentation</a></strong>.</p><p>ËøôÈáåÊàëÊâæÂà∞ÁöÑËØçÊòØ‚Äùcolumn‚ÄùÔºàÂàóÔºâÔºåÂÆÉÁöÑtop-10ÈáåÊúâ‚Äùcolumnist‚ÄùÔºà‰∏ìÊ†è‰ΩúÂÆ∂ÔºâÂíå‚Äùarticle‚ÄùÔºàÊñáÁ´†Ôºâ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ------------------</span><br><span class="hljs-comment"># Write your polysemous word exploration code here.</span><br><br>wv_from_bin.most_similar(<span class="hljs-string">&quot;column&quot;</span>)<br><br><span class="hljs-comment"># ------------------</span><br></code></pre></div></td></tr></table></figure><p>ËæìÂá∫Ôºö</p><figure class="highlight scheme"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs scheme">[(<span class="hljs-symbol">&#x27;columns</span>&#x27;, <span class="hljs-number">0.767943263053894</span>),<br> (<span class="hljs-symbol">&#x27;columnist</span>&#x27;, <span class="hljs-number">0.6541407108306885</span>),<br> (<span class="hljs-symbol">&#x27;article</span>&#x27;, <span class="hljs-number">0.651928186416626</span>),<br> (<span class="hljs-symbol">&#x27;columnists</span>&#x27;, <span class="hljs-number">0.617466926574707</span>),<br> (<span class="hljs-symbol">&#x27;syndicated_column</span>&#x27;, <span class="hljs-number">0.599014401435852</span>),<br> (<span class="hljs-symbol">&#x27;op_ed</span>&#x27;, <span class="hljs-number">0.588202714920044</span>),<br> (<span class="hljs-symbol">&#x27;Op_Ed</span>&#x27;, <span class="hljs-number">0.5801560282707214</span>),<br> (<span class="hljs-symbol">&#x27;op_ed_column</span>&#x27;, <span class="hljs-number">0.5779396891593933</span>),<br> (<span class="hljs-symbol">&#x27;nationally_syndicated_column</span>&#x27;, <span class="hljs-number">0.572504997253418</span>),<br> (<span class="hljs-symbol">&#x27;colum</span>&#x27;, <span class="hljs-number">0.5595961213111877</span>)]<br></code></pre></div></td></tr></table></figure><h3 id="ÈóÆÈ¢ò2.3Ëøë‰πâËØçÂíåÂèç‰πâËØç">ÈóÆÈ¢ò2.3ÔºöËøë‰πâËØçÂíåÂèç‰πâËØç</h3><p>ÊâæÂà∞‰∏â‰∏™ËØç(w1, w2,w3)ÔºåÂÖ∂‰∏≠w1Âíåw2ÊòØËøë‰πâËØçÔºåw1Âíåw3ÊòØÂèç‰πâËØçÔºå‰ΩÜÊòØw1Âíåw3ÁöÑË∑ùÁ¶ª&lt;w1Âíåw2ÁöÑË∑ùÁ¶ª„ÄÇ‰æãÂ¶ÇÔºöw1=‚Äùhappy‚ÄùÔºåw2=‚Äùcheerful‚ÄùÔºåw3=‚Äùsad‚Äù</p><p>You should use the the <code>wv_from_bin.distance(w1, w2)</code>function here in order to compute the cosine distance between two words.Please see the <strong><ahref="https://radimrehurek.com/gensim/models/keyedvectors.html#gensim.models.keyedvectors.FastTextKeyedVectors.distance">GenSimdocumentation</a></strong> for further assistance.</p><p>‰∏∫‰ªÄ‰πàÂèç‰πâËØçÁöÑÁõ∏‰ººÂ∫¶ÂèçËÄåÊõ¥Â§ßÂë¢ÔºàË∑ùÁ¶ªË∂äÂ∞èËØ¥ÊòéË∂äÁõ∏‰ººÔºâÔºüÂõ†‰∏∫‰ªñ‰ª¨ÁöÑ‰∏ä‰∏ãÊñáÈÄöÂ∏∏ÈùûÂ∏∏‰∏ÄËá¥</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ------------------</span><br><span class="hljs-comment"># Write your synonym &amp; antonym exploration code here.</span><br><br>w1 = <span class="hljs-string">&quot;love&quot;</span><br>w2 = <span class="hljs-string">&quot;like&quot;</span><br>w3 = <span class="hljs-string">&quot;hate&quot;</span><br>w1_w2_dist = wv_from_bin.distance(w1, w2)<br>w1_w3_dist = wv_from_bin.distance(w1, w3)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Synonyms &#123;&#125;, &#123;&#125; have cosine distance: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(w1, w2, w1_w2_dist))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Antonyms &#123;&#125;, &#123;&#125; have cosine distance: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(w1, w3, w1_w3_dist))<br><br><span class="hljs-comment"># ------------------</span><br></code></pre></div></td></tr></table></figure><p>ËæìÂá∫Ôºö</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">Synonyms</span> love, like have cosine distance: <span class="hljs-number">0</span>.<span class="hljs-number">6328612565994263</span><br><span class="hljs-attribute">Antonyms</span> love, hate have cosine distance: <span class="hljs-number">0</span>.<span class="hljs-number">39960432052612305</span><br></code></pre></div></td></tr></table></figure><h3 id="ÈóÆÈ¢ò2.4Á±ªÊØî">ÈóÆÈ¢ò2.4ÔºöÁ±ªÊØî</h3><p>man ÂØπ‰∫ékingÔºåÁõ∏ÂΩì‰∫éwomanÂØπ‰∫é___ÔºåËøôÊ†∑ÁöÑÈóÆÈ¢ò‰πüÂèØ‰ª•Áî®word2vecÊù•Ëß£ÂÜ≥ÔºåÂÖ≥‰∫émost_similarÁöÑËØ¶ÁªÜÁî®Ê≥ïÂèØ‰ª•ÂèÇËÄÉ<ahref="https://radimrehurek.com/gensim/models/keyedvectors.html#gensim.models.keyedvectors.FastTextKeyedVectors.most_similar">GenSimÊñáÊ°£</a>„ÄÇ</p><p>ËøôÈáåÊàë‰ª¨ÊâæÂè¶Â§ñ‰∏ÄÁªÑÁ±ªÊØî</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ------------------</span><br><span class="hljs-comment"># Write your analogy exploration code here.</span><br><span class="hljs-comment"># man : him :: woman : her</span><br>pprint.pprint(wv_from_bin.most_similar(positive=[<span class="hljs-string">&#x27;woman&#x27;</span>, <span class="hljs-string">&#x27;him&#x27;</span>], negative=[<span class="hljs-string">&#x27;man&#x27;</span>]))<br><br><span class="hljs-comment"># ------------------</span><br></code></pre></div></td></tr></table></figure><p>ËæìÂá∫Ôºö</p><figure class="highlight scheme"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs scheme">[(<span class="hljs-symbol">&#x27;her</span>&#x27;, <span class="hljs-number">0.694490909576416</span>),<br> (<span class="hljs-symbol">&#x27;she</span>&#x27;, <span class="hljs-number">0.6385233402252197</span>),<br> (<span class="hljs-symbol">&#x27;me</span>&#x27;, <span class="hljs-number">0.628451406955719</span>),<br> (<span class="hljs-symbol">&#x27;herself</span>&#x27;, <span class="hljs-number">0.6239798665046692</span>),<br> (<span class="hljs-symbol">&#x27;them</span>&#x27;, <span class="hljs-number">0.5843966007232666</span>),<br> (<span class="hljs-symbol">&#x27;She</span>&#x27;, <span class="hljs-number">0.5237804651260376</span>),<br> (<span class="hljs-symbol">&#x27;myself</span>&#x27;, <span class="hljs-number">0.4885627031326294</span>),<br> (<span class="hljs-symbol">&#x27;saidshe</span>&#x27;, <span class="hljs-number">0.48337966203689575</span>),<br> (<span class="hljs-symbol">&#x27;he</span>&#x27;, <span class="hljs-number">0.48184287548065186</span>),<br> (<span class="hljs-symbol">&#x27;Gail_Quets</span>&#x27;, <span class="hljs-number">0.4784894585609436</span>)]<br></code></pre></div></td></tr></table></figure><p>ÂèØ‰ª•ÁúãÂà∞Ê≠£Á°ÆÁöÑËÆ°ÁÆóÂá∫‰∫Ü‚Äùher‚Äù</p><h3 id="ÈóÆÈ¢ò2.5ÈîôËØØÁöÑÁ±ªÊØî">ÈóÆÈ¢ò2.5ÔºöÈîôËØØÁöÑÁ±ªÊØî</h3><p>ÊâæÂà∞‰∏Ä‰∏™ÈîôËØØÁöÑÁ±ªÊØîÔºåÊ†ëÔºöÊ†ëÂè∂ ÔºöÔºöËä±ÔºöËä±Áì£</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ------------------</span><br><span class="hljs-comment"># Write your incorrect analogy exploration code here.</span><br><span class="hljs-comment"># tree : leaf :: flower : petal</span><br>pprint.pprint(wv_from_bin.most_similar(positive=[<span class="hljs-string">&#x27;leaf&#x27;</span>, <span class="hljs-string">&#x27;flower&#x27;</span>], negative=[<span class="hljs-string">&#x27;tree&#x27;</span>]))<br><br><span class="hljs-comment"># ------------------</span><br></code></pre></div></td></tr></table></figure><p>ËæìÂá∫Ôºö</p><figure class="highlight scheme"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs scheme">[(<span class="hljs-symbol">&#x27;floral</span>&#x27;, <span class="hljs-number">0.5532568693161011</span>),<br> (<span class="hljs-symbol">&#x27;marigold</span>&#x27;, <span class="hljs-number">0.5291938185691833</span>),<br> (<span class="hljs-symbol">&#x27;tulip</span>&#x27;, <span class="hljs-number">0.521312952041626</span>),<br> (<span class="hljs-symbol">&#x27;rooted_cuttings</span>&#x27;, <span class="hljs-number">0.5189826488494873</span>),<br> (<span class="hljs-symbol">&#x27;variegation</span>&#x27;, <span class="hljs-number">0.5136324763298035</span>),<br> (<span class="hljs-symbol">&#x27;Asiatic_lilies</span>&#x27;, <span class="hljs-number">0.5132641792297363</span>),<br> (<span class="hljs-symbol">&#x27;gerberas</span>&#x27;, <span class="hljs-number">0.5106234550476074</span>),<br> (<span class="hljs-symbol">&#x27;gerbera_daisies</span>&#x27;, <span class="hljs-number">0.5101010203361511</span>),<br> (<span class="hljs-symbol">&#x27;Verbena_bonariensis</span>&#x27;, <span class="hljs-number">0.5070016980171204</span>),<br> (<span class="hljs-symbol">&#x27;violet</span>&#x27;, <span class="hljs-number">0.5058108568191528</span>)]<br></code></pre></div></td></tr></table></figure><p>ÁªìÊûúËæìÂá∫ÁöÑÈáåÈù¢Ê≤°Êúâ‚ÄúËä±Áì£‚Äù</p><h3 id="ÈóÆÈ¢ò2.6ÂÅèËßÅÂàÜÊûê">ÈóÆÈ¢ò2.6ÔºöÂÅèËßÅÂàÜÊûê</h3><p>Ê≥®ÊÑèÂÅèËßÅÊòØÂæàÈáçË¶ÅÁöÑÊØîÂ¶ÇÊÄßÂà´Ê≠ßËßÜ„ÄÅÁßçÊóèÊ≠ßËßÜÁ≠âÔºåÊâßË°å‰∏ãÈù¢‰ª£Á†ÅÔºåÂàÜÊûê‰∏§‰∏™ÈóÆÈ¢òÔºö</p><ol type="a"><li><p>Âì™‰∏™ËØç‰∏é‚Äúwoman‚ÄùÂíå‚Äúboss‚ÄùÊúÄÁõ∏‰ººÔºåÂíå‚Äúman‚ÄùÊúÄ‰∏çÁõ∏‰ºº?</p></li><li><p>Âì™‰∏™ËØç‰∏é‚Äúman‚ÄùÂíå‚Äúboss‚ÄùÊúÄÁõ∏‰ººÔºåÂíå‚Äúwoman‚ÄùÊúÄ‰∏çÁõ∏‰ºº?</p></li></ol><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Run this cell</span><br><span class="hljs-comment"># Here `positive` indicates the list of words to be similar to and `negative` indicates the list of words to be</span><br><span class="hljs-comment"># most dissimilar from.</span><br>pprint.pprint(wv_from_bin.most_similar(positive=[<span class="hljs-string">&#x27;woman&#x27;</span>, <span class="hljs-string">&#x27;boss&#x27;</span>], negative=[<span class="hljs-string">&#x27;man&#x27;</span>]))<br><span class="hljs-built_in">print</span>()<br>pprint.pprint(wv_from_bin.most_similar(positive=[<span class="hljs-string">&#x27;man&#x27;</span>, <span class="hljs-string">&#x27;boss&#x27;</span>], negative=[<span class="hljs-string">&#x27;woman&#x27;</span>]))<br></code></pre></div></td></tr></table></figure><p>ËæìÂá∫Ôºö</p><figure class="highlight scheme"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs scheme">[(<span class="hljs-symbol">&#x27;bosses</span>&#x27;, <span class="hljs-number">0.5522644519805908</span>),<br> (<span class="hljs-symbol">&#x27;manageress</span>&#x27;, <span class="hljs-number">0.49151360988616943</span>),<br> (<span class="hljs-symbol">&#x27;exec</span>&#x27;, <span class="hljs-number">0.45940813422203064</span>),<br> (<span class="hljs-symbol">&#x27;Manageress</span>&#x27;, <span class="hljs-number">0.45598435401916504</span>),<br> (<span class="hljs-symbol">&#x27;receptionist</span>&#x27;, <span class="hljs-number">0.4474116563796997</span>),<br> (<span class="hljs-symbol">&#x27;Jane_Danson</span>&#x27;, <span class="hljs-number">0.44480544328689575</span>),<br> (<span class="hljs-symbol">&#x27;Fiz_Jennie_McAlpine</span>&#x27;, <span class="hljs-number">0.44275766611099243</span>),<br> (<span class="hljs-symbol">&#x27;Coronation_Street_actress</span>&#x27;, <span class="hljs-number">0.44275566935539246</span>),<br> (<span class="hljs-symbol">&#x27;supremo</span>&#x27;, <span class="hljs-number">0.4409853219985962</span>),<br> (<span class="hljs-symbol">&#x27;coworker</span>&#x27;, <span class="hljs-number">0.43986251950263977</span>)]<br><br>[(<span class="hljs-symbol">&#x27;supremo</span>&#x27;, <span class="hljs-number">0.6097398400306702</span>),<br> (<span class="hljs-symbol">&#x27;MOTHERWELL_boss</span>&#x27;, <span class="hljs-number">0.5489562153816223</span>),<br> (<span class="hljs-symbol">&#x27;CARETAKER_boss</span>&#x27;, <span class="hljs-number">0.5375303626060486</span>),<br> (<span class="hljs-symbol">&#x27;Bully_Wee_boss</span>&#x27;, <span class="hljs-number">0.5333974361419678</span>),<br> (<span class="hljs-symbol">&#x27;YEOVIL_Town_boss</span>&#x27;, <span class="hljs-number">0.5321705341339111</span>),<br> (<span class="hljs-symbol">&#x27;head_honcho</span>&#x27;, <span class="hljs-number">0.5281980037689209</span>),<br> (<span class="hljs-symbol">&#x27;manager_Stan_Ternent</span>&#x27;, <span class="hljs-number">0.525971531867981</span>),<br> (<span class="hljs-symbol">&#x27;Viv_Busby</span>&#x27;, <span class="hljs-number">0.5256162881851196</span>),<br> (<span class="hljs-symbol">&#x27;striker_Gabby_Agbonlahor</span>&#x27;, <span class="hljs-number">0.5250812768936157</span>),<br> (<span class="hljs-symbol">&#x27;BARNSLEY_boss</span>&#x27;, <span class="hljs-number">0.5238943099975586</span>)]<br></code></pre></div></td></tr></table></figure><p>Á¨¨‰∏Ä‰∏™Á±ªÊØî Áî∑‰∫∫:Â•≥‰∫∫ ::ËÄÅÊùø:___ÔºåÊúÄÂêàÈÄÇÁöÑËØçÂ∫îËØ•ÊòØ‚Äùlandlady‚ÄùÔºàËÄÅÊùøÂ®òÔºâ‰πãÁ±ªÁöÑÔºå‰ΩÜÊòØtop-10ÈáåÂè™Êúâ‚Äùmanageress‚ÄùÔºàÂ•≥ÁªèÁêÜÔºâÔºå‚Äùreceptionist‚ÄùÔºàÊé•ÂæÖÂëòÔºâ‰πãÁ±ªÁöÑËØç„ÄÇ</p><p>Á¨¨‰∫å‰∏™Á±ªÊØî Â•≥‰∫∫:Áî∑‰∫∫ :: ËÄÅÊùø:___ÔºåËæìÂá∫ÁöÑ‰∏çÁü•ÈÅìÊòØ‰∫õ‰ªÄ‰πà‰∏úË•ø/ÊçÇËÑ∏</p><h3 id="ÈóÆÈ¢ò2.7Ëá™Ë°åÂàÜÊûêÂÅèËßÅ">ÈóÆÈ¢ò2.7ÔºöËá™Ë°åÂàÜÊûêÂÅèËßÅ</h3><p>ËøôÈáåÊàëÊâæÁöÑ‰æãÂ≠êÊòØÔºö</p><ul><li>Áî∑‰∫∫:Â•≥‰∫∫ :: ÂåªÁîü:___</li><li>Â•≥‰∫∫:Áî∑‰∫∫ :: ÂåªÁîü:___</li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ------------------</span><br><span class="hljs-comment"># Write your bias exploration code here.</span><br><br>pprint.pprint(wv_from_bin.most_similar(positive=[<span class="hljs-string">&#x27;woman&#x27;</span>, <span class="hljs-string">&#x27;doctor&#x27;</span>], negative=[<span class="hljs-string">&#x27;man&#x27;</span>]))<br><span class="hljs-built_in">print</span>()<br>pprint.pprint(wv_from_bin.most_similar(positive=[<span class="hljs-string">&#x27;man&#x27;</span>, <span class="hljs-string">&#x27;doctor&#x27;</span>], negative=[<span class="hljs-string">&#x27;woman&#x27;</span>]))<br><br><span class="hljs-comment"># ------------------</span><br></code></pre></div></td></tr></table></figure><p>ËæìÂá∫Ôºö</p><figure class="highlight scheme"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs scheme">[(<span class="hljs-symbol">&#x27;gynecologist</span>&#x27;, <span class="hljs-number">0.7093892097473145</span>),<br> (<span class="hljs-symbol">&#x27;nurse</span>&#x27;, <span class="hljs-number">0.647728681564331</span>),<br> (<span class="hljs-symbol">&#x27;doctors</span>&#x27;, <span class="hljs-number">0.6471461057662964</span>),<br> (<span class="hljs-symbol">&#x27;physician</span>&#x27;, <span class="hljs-number">0.64389967918396</span>),<br> (<span class="hljs-symbol">&#x27;pediatrician</span>&#x27;, <span class="hljs-number">0.6249487996101379</span>),<br> (<span class="hljs-symbol">&#x27;nurse_practitioner</span>&#x27;, <span class="hljs-number">0.6218312978744507</span>),<br> (<span class="hljs-symbol">&#x27;obstetrician</span>&#x27;, <span class="hljs-number">0.6072014570236206</span>),<br> (<span class="hljs-symbol">&#x27;ob_gyn</span>&#x27;, <span class="hljs-number">0.5986712574958801</span>),<br> (<span class="hljs-symbol">&#x27;midwife</span>&#x27;, <span class="hljs-number">0.5927063226699829</span>),<br> (<span class="hljs-symbol">&#x27;dermatologist</span>&#x27;, <span class="hljs-number">0.5739566683769226</span>)]<br><br>[(<span class="hljs-symbol">&#x27;physician</span>&#x27;, <span class="hljs-number">0.6463665962219238</span>),<br> (<span class="hljs-symbol">&#x27;doctors</span>&#x27;, <span class="hljs-number">0.5858404040336609</span>),<br> (<span class="hljs-symbol">&#x27;surgeon</span>&#x27;, <span class="hljs-number">0.5723941326141357</span>),<br> (<span class="hljs-symbol">&#x27;dentist</span>&#x27;, <span class="hljs-number">0.552364706993103</span>),<br> (<span class="hljs-symbol">&#x27;cardiologist</span>&#x27;, <span class="hljs-number">0.5413815975189209</span>),<br> (<span class="hljs-symbol">&#x27;neurologist</span>&#x27;, <span class="hljs-number">0.5271126627922058</span>),<br> (<span class="hljs-symbol">&#x27;neurosurgeon</span>&#x27;, <span class="hljs-number">0.5249835848808289</span>),<br> (<span class="hljs-symbol">&#x27;urologist</span>&#x27;, <span class="hljs-number">0.5247740149497986</span>),<br> (<span class="hljs-symbol">&#x27;Doctor</span>&#x27;, <span class="hljs-number">0.5240625143051147</span>),<br> (<span class="hljs-symbol">&#x27;internist</span>&#x27;, <span class="hljs-number">0.5183224081993103</span>)]<br></code></pre></div></td></tr></table></figure><p>Á¨¨‰∏Ä‰∏™Á±ªÊØî‰∏≠ÔºåÊàë‰ª¨ÁúãÂà∞‰∫Ü‚Äùnurse‚ÄùÔºàÊä§Â£´ÔºâÔºåËøôÊòØ‰∏Ä‰∏™ÊúâÂÅèËßÅÁöÑÁ±ªÊØî</p><h3 id="ÈóÆÈ¢ò2.8ÊÄùËÄÉÂÅèËßÅÈóÆÈ¢ò">ÈóÆÈ¢ò2.8ÔºöÊÄùËÄÉÂÅèËßÅÈóÆÈ¢ò</h3><p>‰ªÄ‰πà‰ºöÂØºËá¥ËØçÂêëÈáèÈáåÁöÑÂÅèËßÅÔºü</p><p>Âõ†‰∏∫Êï∞ÊçÆÈõÜ‰∏≠ÊúâÂÅèËßÅ</p><h2 id="ÂèÇËÄÉ">ÂèÇËÄÉ</h2><p>[1] CS224n: Natural Language Processing with Deep Learning,2019-03-12. http://web.stanford.edu/class/cs224n.</p><p>[2]https://github.com/ShowMeAI-Hub/awesome-AI-courses-notes-cheatsheets/tree/main/CS224n-Natural-Language-Processing-with-Deep-Learning/assignment-solutions/Assignment1</p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Á¨¨‰∫åËÆ≤-ËØçÂêëÈáèËøõÈò∂</title>
    <link href="/2022/05/05/%E7%AC%AC%E4%BA%8C%E8%AE%B2-%E8%AF%8D%E5%90%91%E9%87%8F%E8%BF%9B%E9%98%B6/"/>
    <url>/2022/05/05/%E7%AC%AC%E4%BA%8C%E8%AE%B2-%E8%AF%8D%E5%90%91%E9%87%8F%E8%BF%9B%E9%98%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="ÁÆóÊ≥ï‰ºòÂåñÂü∫Á°Ä">1 ÁÆóÊ≥ï‰ºòÂåñÂü∫Á°Ä</h1><h2 id="ËØçÂêëÈáèÊ¢ØÂ∫¶‰∏ãÈôçÁÆóÊ≥ï">1.1 ËØçÂêëÈáèÊ¢ØÂ∫¶‰∏ãÈôçÁÆóÊ≥ï</h2><p>ÈóÆÈ¢òÔºöÊ¢ØÂ∫¶‰∏ãÈôç‰ºö‰∏ÄÊ¨°ÊÄß‰ΩøÁî®ÊâÄÊúâÊï∞ÊçÆÊ†∑Êú¨ËøõË°åÂèÇÊï∞Êõ¥Êñ∞ÔºåÂØπÂ∫îÂà∞Êàë‰ª¨ÂΩìÂâçÁöÑËØçÂêëÈáèÂª∫Ê®°ÈóÆÈ¢òÔºåÂ∞±ÊòØ<spanclass="math inline">\(J(\theta)\)</span>ÁöÑËÆ°ÁÆóÈúÄË¶ÅÂü∫‰∫éËØ≠ÊñôÂ∫ìÊâÄÊúâÁöÑÊ†∑Êú¨(Á™óÂè£)ÔºåÊï∞ÊçÆËßÑÊ®°ÈùûÂ∏∏Â§ßÔºö</p><ul><li>ËÆ°ÁÆóÈùûÂ∏∏ËÄóËµÑÊ∫ê</li><li>ËÆ°ÁÆóÊó∂Èó¥Èïø</li></ul><p>Ëß£ÂÜ≥ÊñπÊ°àÔºöÈöèÊú∫Ê¢ØÂ∫¶‰∏ãÈôçÁÆóÊ≥ï Stochastic Gradient DescentÔºàSGDÔºâ</p><ul><li>Âú®Âçï‰∏™Ê†∑Êú¨‰∏≠ËÆ°ÁÆóÂíåÊõ¥Êñ∞ÂèÇÊï∞ÔºåÂπ∂ÈÅçÂéÜÊâÄÊúâÊ†∑Êú¨</li></ul><p>‰ΩÜÂü∫‰∫éÂçï‰∏™Ê†∑Êú¨Êõ¥Êñ∞‰ºöË°®Áé∞‰∏∫ÂèÇÊï∞ÈúáËç°ÂæàÂéâÂÆ≥ÔºåÊî∂ÊïõËøáÁ®ãÂπ∂‰∏çÂπ≥Á®≥ÔºåÊâÄ‰ª•ÂæàÂ§öÊó∂ÂÄôÊàë‰ª¨‰ºöÊîπ‰∏∫‰ΩøÁî®<strong>mini-batchgradient descent</strong></p><h2 id="ËØçÂêëÈáèÂª∫Ê®°‰∏≠ÁöÑÈöèÊú∫Ê¢ØÂ∫¶‰∏ãÈôç">1.2 ËØçÂêëÈáèÂª∫Ê®°‰∏≠ÁöÑÈöèÊú∫Ê¢ØÂ∫¶‰∏ãÈôç</h2><ul><li>Â∫îÁî®ÈöèÊú∫Ê¢ØÂ∫¶‰∏ãÈôçÔºåÂú®ÊØè‰∏™Á™óÂè£ËÆ°ÁÆóÂíåÊõ¥Êñ∞ÂèÇÊï∞ÔºåÈÅçÂéÜÊâÄÊúâÊ†∑Êú¨</li><li>Âú®ÊØè‰∏™Á™óÂè£ÂÜÖÔºåÊàë‰ª¨ÊúÄÂ§öÂè™Êúâ<spanclass="math inline">\(2m+1\)</span>‰∏™ËØçÔºåÂõ†Ê≠§<spanclass="math inline">\(\nabla_{\theta}J_{t}(\theta)\)</span>ÊòØÈùûÂ∏∏Á®ÄÁñèÁöÑ</li></ul><p><span class="math display">\[\nabla_{\theta} J_{t}(\theta)=\left[\begin{array}{l}0 \\\vdots \\\nabla_{v_{\text {like }}} \\\vdots \\0 \\\nabla_{u_{I}} \\\vdots \\\nabla_{u_{\text {learning }}} \\\vdots\end{array}\right] \in \mathbb{R}^{2 d V}\]</span></p><p>‰∏äÈù¢ÊèêÂà∞ÁöÑÁ®ÄÁñèÊÄßÈóÆÈ¢òÔºå‰∏ÄÁßçËß£ÂÜ≥ÊñπÂºèÊòØÊàë‰ª¨<strong>Âè™Êõ¥Êñ∞ÂÆûÈôÖÂá∫Áé∞ÁöÑÂêëÈáè</strong></p><ul><li>ÈúÄË¶ÅÁ®ÄÁñèÁü©ÈòµÊõ¥Êñ∞Êìç‰ΩúÊù•Âè™Êõ¥Êñ∞Áü©Èòµ<spanclass="math inline">\(U\)</span>Âíå<spanclass="math inline">\(V\)</span>‰∏≠ÁöÑÁâπÂÆöË°å</li><li>ÈúÄË¶Å‰øùÁïôÂçïËØçÂêëÈáèÁöÑÂìàÂ∏å/Êï£Âàó</li></ul><p>Â¶ÇÊûúÊúâÊï∞Áôæ‰∏á‰∏™ÂçïËØçÂêëÈáèÔºåÂπ∂‰∏îËøõË°åÂàÜÂ∏ÉÂºèËÆ°ÁÆóÔºåÊàë‰ª¨Êó†ÈúÄÂÜç‰º†ËæìÂ∑®Â§ßÁöÑÊõ¥Êñ∞‰ø°ÊÅØÔºàÊï∞ÊçÆ‰º†ËæìÊúâÊàêÊú¨Ôºâ</p><h2 id="word2vecÁöÑÊõ¥Â§öÁªÜËäÇ">1.3 Word2vecÁöÑÊõ¥Â§öÁªÜËäÇ</h2><p>word2vecÊúâ‰∏§‰∏™Ê®°ÂûãÂèò‰ΩìÔºö</p><ul><li>1.Skip-grams (SG)ÔºöËæìÂÖ•‰∏≠ÂøÉËØçÂπ∂È¢ÑÊµã‰∏ä‰∏ãÊñá‰∏≠ÁöÑÂçïËØç</li><li>2.Continuous Bag of Words(CBOW)ÔºöËæìÂÖ•‰∏ä‰∏ãÊñá‰∏≠ÁöÑÂçïËØçÂπ∂È¢ÑÊµã‰∏≠ÂøÉËØç</li></ul><p>‰πãÂâç‰∏ÄÁõ¥‰ΩøÁî®naiveÁöÑsoftmax(ÁÆÄÂçï‰ΩÜ‰ª£‰ª∑ÂæàÈ´òÁöÑËÆ≠ÁªÉÊñπÊ≥ï)ÔºåÂÖ∂ÂÆûÂèØ‰ª•‰ΩøÁî®Ë¥üÈááÊ†∑ÊñπÊ≥ïÂä†Âø´ËÆ≠ÁªÉÈÄüÁéá</p><h2 id="Ë¥ü‰æãÈááÊ†∑ÁöÑskip-gramÊ®°Âûã‰Ωú‰∏ö2">1.4Ë¥ü‰æãÈááÊ†∑ÁöÑskip-gramÊ®°ÂûãÔºà‰Ωú‰∏ö2Ôºâ</h2><p>softmax‰∏≠Áî®‰∫éÂΩí‰∏ÄÂåñÁöÑÂàÜÊØçÁöÑËÆ°ÁÆó‰ª£‰ª∑Â§™È´ò</p><ul><li>Êàë‰ª¨Â∞ÜÂú®‰Ωú‰∏ö2‰∏≠ÂÆûÁé∞‰ΩøÁî® negative sampling/Ë¥ü‰æãÈááÊ†∑ÊñπÊ≥ïÁöÑ skip-gramÊ®°Âûã„ÄÇ</li><li>‰ΩøÁî®‰∏Ä‰∏™ true pair (‰∏≠ÂøÉËØçÂèäÂÖ∂‰∏ä‰∏ãÊñáÁ™óÂè£‰∏≠ÁöÑËØç)‰∏éÂá†‰∏™ noise pair(‰∏≠ÂøÉËØç‰∏éÈöèÊú∫ËØçÊê≠ÈÖç) ÂΩ¢ÊàêÁöÑÊ†∑Êú¨ÔºåËÆ≠ÁªÉ‰∫åÂÖÉÈÄªËæëÂõûÂΩí„ÄÇ</li></ul><p>ÂéüÊñá‰∏≠ÁöÑ(ÊúÄÂ§ßÂåñ)ÁõÆÊ†áÂáΩÊï∞ÊòØÔºö<spanclass="math inline">\(J(\theta)=\frac{1}{T} \sum_{t=1}^{T}J_{t}(\theta)\)</span> <span class="math display">\[J_{t}(\theta)=\log \sigma\left(u_{o}^{T} v_{c}\right)+\sum_{i=1}^{k}\mathbb{E}_{j \sim P(w)}\left[\log \sigma\left(-u_{j}^{T}v_{c}\right)\right]\]</span></p><ul><li>Â∑¶‰æß‰∏∫sigmoidÂáΩÊï∞(Â§ßÂÆ∂‰ºöÂú®ÂêéÁª≠ÁöÑÂÜÖÂÆπÈáåÁªèÂ∏∏ËßÅÂà∞ÂÆÉ)</li><li>Êàë‰ª¨Ë¶ÅÊúÄÂ§ßÂåñ2‰∏™ËØçÂÖ±Áé∞ÁöÑÊ¶ÇÁéá</li></ul><p>Êú¨ËØæ‰ª•Âèä‰Ωú‰∏ö‰∏≠ÁöÑÁõÆÊ†áÂáΩÊï∞ÊòØ: <span class="math display">\[J_{n e g-s a m p l e}\left(\boldsymbol{o}, \boldsymbol{v}_{c},\boldsymbol{U}\right)=-\log \left(\sigma\left(\boldsymbol{u}_{o}^{\top}\boldsymbol{v}_{c}\right)\right)-\sum_{k=1}^{K} \log\left(\sigma\left(-\boldsymbol{u}_{k}^{\top}\boldsymbol{v}_{c}\right)\right)\]</span></p><ul><li>Êàë‰ª¨Âèñ<span class="math inline">\(K\)</span>‰∏™Ë¥ü‰æãÈááÊ†∑</li><li>ÊúÄÂ§ßÂåñÁ™óÂè£‰∏≠ÂåÖÂõ¥„Äå‰∏≠ÂøÉËØç„ÄçÁöÑËøô‰∫õËØçËØ≠Âá∫Áé∞ÁöÑÊ¶ÇÁéáÔºåËÄåÊúÄÂ∞èÂåñÂÖ∂‰ªñÊ≤°ÊúâÂá∫Áé∞ÁöÑÈöèÊú∫ËØçÁöÑÊ¶ÇÁéá</li><li><span class="math inline">\(P(w)=U(w)^{3 / 4} /Z\)</span>Êàë‰ª¨Áî®Â∑¶‰æßÁöÑÂÖ¨ÂºèËøõË°åÊäΩÊ†∑ÔºåÂÖ∂‰∏≠<spanclass="math inline">\(U(w)\)</span>‚ÄãÊòØ unigram ÂàÜÂ∏É</li><li>ÈÄöËøá 3/4 Ê¨°ÊñπÔºåÁõ∏ÂØπÂáèÂ∞ëÂ∏∏ËßÅÂçïËØçÁöÑÈ¢ëÁéáÔºåÂ¢ûÂ§ßÁ®ÄÊúâËØçÁöÑÊ¶ÇÁéá</li><li><span class="math inline">\(Z\)</span>Áî®‰∫éÁîüÊàêÊ¶ÇÁéáÂàÜÂ∏É</li></ul><h1 id="ËÆ°Êï∞‰∏éÂÖ±Á∫øÁü©Èòµ">2 ËÆ°Êï∞‰∏éÂÖ±Á∫øÁü©Èòµ</h1><h2 id="ÂÖ±Áé∞Áü©Èòµ‰∏éËØçÂêëÈáèÊûÑÂª∫">2.1 ÂÖ±Áé∞Áü©Èòµ‰∏éËØçÂêëÈáèÊûÑÂª∫</h2><p>Âú®Ëá™ÁÑ∂ËØ≠Ë®ÄÂ§ÑÁêÜÈáåÂè¶Â§ñ‰∏Ä‰∏™ÊûÑÂª∫ËØçÂêëÈáèÁöÑÊÄùË∑ØÊòØÂÄüÂä©‰∫é<strong>ÂÖ±Áé∞Áü©Èòµ</strong>ÔºàÊàë‰ª¨ËÆæÂÖ∂‰∏∫<spanclass="math inline">\(X\)</span>ÔºâÔºåÊàë‰ª¨Êúâ‰∏§ÁßçÊñπÂºèÔºåÂèØ‰ª•Âü∫‰∫éÁ™óÂè£ÔºàwindowÔºâÊàñËÄÖÂÖ®ÊñáÊ°£Ôºàfulldocument)ÁªüËÆ°Ôºö</p><ul><li><strong>Window</strong>Ôºö‰∏éword2vecÁ±ª‰ººÔºåÂú®ÊØè‰∏™ÂçïËØçÂë®Âõ¥ÈÉΩ‰ΩøÁî®WindowÔºåÂåÖÊã¨ËØ≠Ê≥ï(POS)ÂíåËØ≠‰πâ‰ø°ÊÅØ</li><li><strong>Word-document</strong>ÂÖ±Áé∞Áü©ÈòµÁöÑÂü∫Êú¨ÂÅáËÆæÊòØÂú®Âêå‰∏ÄÁØáÊñáÁ´†‰∏≠Âá∫Áé∞ÁöÑÂçïËØçÊõ¥ÊúâÂèØËÉΩÁõ∏‰∫íÂÖ≥ËÅî„ÄÇÂÅáËÆæÂçïËØç<spanclass="math inline">\(i\)</span>Âá∫Áé∞Âú®ÊñáÁ´†<spanclass="math inline">\(j\)</span>‰∏≠ÔºåÂàôÁü©ÈòµÂÖÉÁ¥†<spanclass="math inline">\(X_{ij}\)</span>Âä†‰∏ÄÔºåÂΩìÊàë‰ª¨Â§ÑÁêÜÂÆåÊï∞ÊçÆÂ∫ì‰∏≠ÁöÑÊâÄÊúâÊñáÁ´†ÂêéÔºåÂ∞±ÂæóÂà∞‰∫ÜÁü©Èòµ<spanclass="math inline">\(X\)</span>ÔºåÂÖ∂Â§ßÂ∞è‰∏∫<spanclass="math inline">\(|V| \times M\)</span>ÔºåÂÖ∂‰∏≠<spanclass="math inline">\(|V|\)</span>‰∏∫ËØçÊ±áÈáèÔºåËÄå<spanclass="math inline">\(M\)</span>‰∏∫ÊñáÁ´†Êï∞„ÄÇËøô‰∏ÄÊûÑÂª∫ÂçïËØçÊñáÁ´†co-occurrencematrixÁöÑÊñπÊ≥ï‰πüÊòØÁªèÂÖ∏ÁöÑLatent SemanticAnalysisÊâÄÈááÁî®ÁöÑ„ÄêËØ≠‰πâÂàÜÊûê„Äë„ÄÇ</li></ul><h2 id="Âü∫‰∫éÁ™óÂè£ÁöÑÂÖ±Áé∞Áü©ÈòµÁ§∫‰æã">2.2 Âü∫‰∫éÁ™óÂè£ÁöÑÂÖ±Áé∞Áü©ÈòµÁ§∫‰æã</h2><p>Âà©Áî®Êüê‰∏™ÂÆöÈïøÁ™óÂè£(ÈÄöÂ∏∏Âèñ5-10)‰∏≠ÂçïËØç‰∏éÂçïËØçÂêåÊó∂Âá∫Áé∞ÁöÑÊ¨°Êï∞ÔºåÊù•‰∫ßÁîüÂü∫‰∫éÁ™óÂè£ÁöÑÂÖ±Áé∞Áü©Èòµ„ÄÇ</p><p>‰∏ãÈù¢‰ª•Á™óÂè£ÈïøÂ∫¶‰∏∫1Êù•‰∏æ‰æãÔºåÂÅáËÆæÊàë‰ª¨ÁöÑÊï∞ÊçÆÂåÖÂê´‰ª•‰∏ãÂá†‰∏™Âè•Â≠êÔºö</p><ul><li>I like deep learning.</li><li>I like NLP.</li><li>I enjoy flying.</li></ul><p>Êàë‰ª¨ÂèØ‰ª•ÂæóÂà∞Â¶Ç‰∏ãÁöÑËØçËØçÂÖ±Áé∞Áü©ÈòµÔºàword-word co-occurrence matrixÔºâ</p><p><img src="/img/nlp/Á¨¨‰∫åËÆ≤/1.png" /></p><h2 id="Âü∫‰∫éÁõ¥Êé•ÁöÑÂÖ±Áé∞Áü©ÈòµÊûÑÂª∫ËØçÂêëÈáèÁöÑÈóÆÈ¢ò">2.3Âü∫‰∫éÁõ¥Êé•ÁöÑÂÖ±Áé∞Áü©ÈòµÊûÑÂª∫ËØçÂêëÈáèÁöÑÈóÆÈ¢ò</h2><p>Áõ¥Êé•Âü∫‰∫éÂÖ±Áé∞Áü©ÈòµÊûÑÂª∫ËØçÂêëÈáèÔºå‰ºöÊúâ‰∏Ä‰∫õÊòéÊòæÁöÑÈóÆÈ¢òÔºåÂ¶Ç‰∏ãÔºö</p><ul><li>‰ΩøÁî®ÂÖ±Áé∞Ê¨°Êï∞Ë°°ÈáèÂçïËØçÁöÑÁõ∏‰ººÊÄßÔºå‰ΩÜÊòØ‰ºöÈöèÁùÄËØçÊ±áÈáèÁöÑÂ¢ûÂä†ËÄåÂ¢ûÂ§ßÁü©ÈòµÁöÑÂ§ßÂ∞è„ÄÇ</li><li>ÈúÄË¶ÅÂæàÂ§öÁ©∫Èó¥Êù•Â≠òÂÇ®Ëøô‰∏ÄÈ´òÁª¥Áü©Èòµ„ÄÇ</li><li>ÂêéÁª≠ÁöÑÂàÜÁ±ªÊ®°Âûã‰πü‰ºöÁî±‰∫éÁü©ÈòµÁöÑÁ®ÄÁñèÊÄßËÄåÂ≠òÂú®Á®ÄÁñèÊÄßÈóÆÈ¢òÔºå‰ΩøÂæóÊïàÊûú‰∏ç‰Ω≥„ÄÇ</li></ul><h2 id="Ëß£ÂÜ≥ÊñπÊ°à‰ΩéÁª¥ÂêëÈáè">2.4 Ëß£ÂÜ≥ÊñπÊ°àÔºö‰ΩéÁª¥ÂêëÈáè</h2><p>ÈíàÂØπ‰∏äËø∞ÈóÆÈ¢òÔºåÊàë‰ª¨ÁöÑ‰∏Ä‰∏™Â§ÑÁêÜÊñπÂºèÊòØÈôçÁª¥ÔºåËé∑Âæó‰ΩéÁª¥Á®†ÂØÜÂêëÈáè„ÄÇ</p><ul><li>ÈÄöÂ∏∏ÈôçÁª¥Âà∞(25-1000)Áª¥ÔºåÂíåword2vecÁ±ª‰ºº</li></ul><p>Â¶Ç‰ΩïÈôçÁª¥Âë¢Ôºü</p><h2 id="ÊñπÊ≥ï1ÂØπxËøõË°åÈôçÁª¥‰Ωú‰∏ö1">2.5 ÊñπÊ≥ï1ÔºöÂØπXËøõË°åÈôçÁª¥Ôºà‰Ωú‰∏ö1Ôºâ</h2><p>ÂèØ‰ª•‰ΩøÁî®Â•áÂºÇÂÄºÂàÜËß£ÔºàSVDÔºâÊñπÊ≥ïÂ∞ÜÂÖ±Áé∞Áü©Èòµ<spanclass="math inline">\(X\)</span>ÂàÜËß£‰∏∫<span class="math inline">\(U\Sigma V^{T}\)</span>ÔºåÂÖ∂‰∏≠Ôºö</p><ul><li><spanclass="math inline">\(\Sigma\)</span>ÊòØÂØπËßíÁ∫øÁü©ÈòµÔºåÂØπËßíÁ∫ø‰∏äÁöÑÂÄºÊòØÁü©ÈòµÁöÑÂ•áÂºÇÂÄº</li><li><span class="math inline">\(U\)</span>Ôºå<spanclass="math inline">\(V\)</span>ÊòØÂØπÂ∫î‰∫éË°åÂíåÂàóÁöÑÊ≠£‰∫§Âü∫</li></ul><p>‰∏∫‰∫ÜÂáèÂ∞ëÂ∞∫Â∫¶ÂêåÊó∂Â∞ΩÈáè‰øùÂ≠òÊúâÊïà‰ø°ÊÅØÔºåÂèØ‰øùÁïôÂØπËßíÁü©ÈòµÁöÑÊúÄÂ§ßÁöÑ<spanclass="math inline">\(k\)</span>‰∏™ÂÄºÔºåÂπ∂Â∞ÜÁü©Èòµ<spanclass="math inline">\(U\)</span>Ôºå<spanclass="math inline">\(V\)</span>ÁöÑÁõ∏Â∫îÁöÑË°åÂàó‰øùÁïô„ÄÇ</p><ul><li>ËøôÊòØÁªèÂÖ∏ÁöÑÁ∫øÊÄß‰ª£Êï∞ÁÆóÊ≥ïÔºåÂØπ‰∫éÂ§ßÂûãÁü©ÈòµËÄåË®ÄÔºåËÆ°ÁÆó‰ª£‰ª∑ÊòÇË¥µ„ÄÇ</li></ul><h2 id="ËØçÂêëÈáèsvdÂàÜËß£ÁöÑpython‰ª£Á†ÅÁ§∫‰æã">2.6ËØçÂêëÈáèSVDÂàÜËß£ÁöÑpython‰ª£Á†ÅÁ§∫‰æã</h2><p><img src="/img/nlp/Á¨¨‰∫åËÆ≤/2.png" /></p><p>Â∞ÜÂêëÈáèËøõË°åÂèØËßÜÂåñ</p><p><img src="/img/nlp/Á¨¨‰∫åËÆ≤/3.png" /></p><h2 id="ËÆ∫ÊñáËÆ≤Ëß£">2.7 ËÆ∫ÊñáËÆ≤Ëß£</h2><h3 id="hacks-to-x-several-used-in-rohde-et-al.-2005">Hacks to X(several used in Rohde et al. 2005)</h3><p>ÊåâÊØî‰æãË∞ÉÊï¥ counts ‰ºöÂæàÊúâÊïà</p><ul><li>ÂØπÈ´òÈ¢ëËØçËøõË°åÁº©Êîæ(ËØ≠Ê≥ïÊúâÂ§™Â§öÁöÑÂΩ±Âìç)<ul><li>‰ΩøÁî®logËøõË°åÁº©Êîæ</li><li><span class="math inline">\(\min (X, t), t \approx 100\)</span></li><li>Áõ¥Êé•ÂÖ®ÈÉ®ÂøΩËßÜ</li></ul></li><li>Âú®Âü∫‰∫éwindowÁöÑËÆ°Êï∞‰∏≠ÔºåÊèêÈ´òÊõ¥Âä†Êé•ËøëÁöÑÂçïËØçÁöÑËÆ°Êï∞</li><li>‰ΩøÁî®PersonÁõ∏ÂÖ≥Á≥ªÊï∞</li></ul><h2 id="ËØçÂêëÈáèÂàÜÂ∏ÉÊé¢Á©∂">2.8 ËØçÂêëÈáèÂàÜÂ∏ÉÊé¢Á©∂</h2><p>Â¶ÇÊûúÂØπËØçÂêëÈáèËøõË°åÁ©∫Èó¥ÂàÜÂ∏ÉÔºå‰ºöÂèëÁé∞Âêå‰∏Ä‰∏™ËØçÊ±áÁöÑÈôÑËøëÂàÜÂ∏ÉÁùÄÂÆÉ‰∏çÂêåÊó∂ÊÄÅËØ≠ÊÄÅÁöÑÂçïËØçÔºö</p><ul><li><span class="math inline">\(dirve \to deriver\)</span></li><li><span class="math inline">\(swim \to swimmer\)</span></li><li><span class="math inline">\(teach \to teacher\)</span></li></ul><p>Âú®ÂêëÈáè‰∏≠Âá∫Áé∞ÁöÑÊúâË∂£ÁöÑÂè•Ê≥ïÊ®°ÂºèÔºöËØ≠‰πâÂêëÈáèÂü∫Êú¨‰∏äÊòØÁ∫øÊÄßÁªÑ‰ª∂ÔºåËôΩÁÑ∂Êúâ‰∏Ä‰∫õÊëÜÂä®Ôºå‰ΩÜÊòØÂü∫Êú¨ÊòØÂ≠òÂú®Âä®ËØçÂíåÂä®ËØçÂÆûÊñΩËÄÖÁöÑÊñπÂêë„ÄÇ</p><h2 id="Âü∫‰∫éËÆ°Êï∞-vs.-Âü∫‰∫éÈ¢Ñ‰º∞">2.9 Âü∫‰∫éËÆ°Êï∞ VS. Âü∫‰∫éÈ¢Ñ‰º∞</h2><p>Êàë‰ª¨Êù•ÊÄªÁªì‰∏Ä‰∏ãÂü∫‰∫éÂÖ±Áé∞Áü©ÈòµËÆ°Êï∞ÂíåÂü∫‰∫éÈ¢Ñ‰º∞Ê®°Âûã‰∏§ÁßçÂæóÂà∞ËØçÂêëÈáèÁöÑÊñπÂºè</p><p><strong>Âü∫‰∫éËÆ°Êï∞</strong>Ôºö‰ΩøÁî®Êï¥‰∏™Áü©ÈòµÁöÑÂÖ®Â±ÄÁªüËÆ°Êï∞ÊçÆÊù•Áõ¥Êé•‰º∞ËÆ°</p><ul><li><strong>‰ºòÁÇπ</strong>ÔºöËÆ≠ÁªÉÂø´ÈÄüÔºõÁªüËÆ°Êï∞ÊçÆÈ´òÊïàÂà©Áî®</li><li><strong>Áº∫ÁÇπ</strong>Ôºö‰∏ªË¶ÅÁî®‰∫éÊçïÊçâÂçïËØçÁõ∏‰ººÊÄßÔºõÂØπÂ§ßÈáèÊï∞ÊçÆÁªô‰∫àÊØî‰æãÂ§±Ë∞ÉÁöÑÈáçËßÜ</li></ul><p><strong>Âü∫‰∫éÈ¢Ñ‰º∞Ê®°Âûã</strong>ÔºöÂÆö‰πâÊ¶ÇÁéáÂàÜÂ∏ÉÂπ∂ËØïÂõæÈ¢ÑÊµãÂçïËØç</p><ul><li><strong>‰ºòÁÇπ</strong>ÔºöÊèêÈ´òÂÖ∂‰ªñ‰ªªÂä°ÁöÑÊÄßËÉΩÔºõËÉΩÊçïËé∑Èô§‰∫ÜÂçïËØçÁõ∏‰ººÊÄß‰ª•Â§ñÁöÑÂ§çÊùÇÁöÑÊ®°Âºè</li><li><strong>Áº∫ÁÇπ</strong>ÔºöÈöèËØ≠ÊñôÂ∫ìÂ¢ûÂ§ß‰ºöÂ¢ûÂ§ßËßÑÊ®°ÔºõÁªüËÆ°Êï∞ÊçÆÁöÑ‰ΩéÊïà‰ΩøÁî®ÔºàÈááÊ†∑ÊòØÂØπÁªüËÆ°Êï∞ÊçÆÁöÑ‰ΩéÊïà‰ΩøÁî®Ôºâ</li></ul><h1 id="gloveÊ®°Âûã">3 GloVeÊ®°Âûã</h1><h2 id="ËÆ∫ÊñáËÆ≤Ëß£-1">3.1 ËÆ∫ÊñáËÆ≤Ëß£</h2><h3 id="encoding-meaning-in-vector-differences">3.1.1 Encoding meaningin vector differences</h3><p>GloVeÊ®°ÂûãÂÖ≥ÈîÆÊÄùÊÉ≥ÔºöÂÖ±Áé∞Ê¶ÇÁéáÁöÑÊØîÂÄºÂèØ‰ª•ÂØπmeaningcomponentËøõË°åÁºñÁ†Å„ÄÇÂ∞Ü‰∏§‰∏™ÊµÅÊ¥æÁöÑÊÉ≥Ê≥ïÁªìÂêàËµ∑Êù•ÔºåÂú®Á•ûÁªèÁΩëÁªú‰∏≠‰ΩøÁî®ËÆ°Êï∞Áü©Èòµ„ÄÇ</p><p><img src="/img/nlp/Á¨¨‰∫åËÆ≤/4.png" /></p><p>‰æãÂ¶ÇÊàë‰ª¨ÊÉ≥Âå∫ÂàÜÁÉ≠ÂäõÂ≠¶‰∏ä‰∏§Áßç‰∏çÂêåÁä∂ÊÄÅiceÂÜ∞‰∏éËí∏Ê±ΩsteamÔºåÂ¶ÇÊûúÂè™ÊòØÁúãÊ¶ÇÁéáÂàôÊï∞ÂÄºÂæàÂ∞èÔºå‰∏çËÉΩÈÄèÈú≤ÊúâÊïàÁöÑ‰ø°ÊÅØÔºå‰ΩÜÊòØ‰ªñ‰ª¨ÁöÑÊØîÂÄºÊØîËæÉÂ§ßÔºåÊâÄ‰ª•‰ΩøÁî®ÊØîÂÄºÊõ¥ËÉΩ‰ΩìÁé∞‰ø°ÊÅØ„ÄÇÂõæ‰∏≠ÂèØ‰ª•ÁúãÂá∫solidÊõ¥Â∏∏Êù•ÊèèËø∞iceÁöÑÁä∂ÊÄÅËÄå‰∏çÊòØsteamÔºåÊâÄ‰ª•solidÂú®iceÁöÑ‰∏ä‰∏ãÊñá‰∏≠Âá∫Áé∞ÁöÑÂá†ÁéáÊõ¥Â§ß„ÄÇÂØπ‰∫égasÂàôÊÅ∞ÊÅ∞Áõ∏ÂèçÔºåËÄåÂØπ‰∫éwaterËøôÁßçÊèèËø∞ice‰∏ésteamÂùáÂèØÊàñËÄÖfashionËøôÁßç‰∏é‰∏§ËÄÖÈÉΩÊ≤°‰ªÄ‰πàËÅîÁ≥ªÁöÑÂçïËØçÔºåÂàôÊØîÂÄºÊé•Ëøë‰∫é1„ÄÇÊâÄ‰ª•Áõ∏ËæÉ‰∫éÂçïÁ∫ØÁöÑÂÖ±Áé∞Ê¶ÇÁéáÔºåÂÆûÈôÖ‰∏äÂÖ±Áé∞Ê¶ÇÁéáÁöÑÁõ∏ÂØπÊØîÂÄºÊõ¥ÊúâÊÑè‰πâ„ÄÇ</p><h3id="combining-the-best-of-both-worlds-glove-pennington-et-al.-emnlp-2014">3.1.2Combining the best of both worlds GloVe [Pennington et al., EMNLP2014]</h3><p><span class="math display">\[w_i \cdot w_j = \log P(i|j)\]</span></p><p><span class="math display">\[J=\sum_{i, j=1}^{V} f\left(X_{i j}\right)\left(w_{i}^{T}\tilde{w}_{j}+b_{i}+\tilde{b}_{j}-\log X_{i j}\right)^{2}\]</span></p><ul><li>ËÆ≠ÁªÉÂø´ÈÄü</li><li>ÂèØ‰ª•Êâ©Â±ïÂà∞Â§ßÂûãËØ≠ÊñôÂ∫ì</li><li>Âç≥‰ΩøÊòØÂ∞èËØ≠ÊñôÂ∫ìÂíåÂ∞èÂêëÈáèÔºåÊÄßËÉΩ‰πüÂæàÂ•Ω</li></ul><h2 id="gloveÁöÑ‰∏Ä‰∫õÁªìÊûúÂ±ïÁ§∫">3.2 GloVeÁöÑ‰∏Ä‰∫õÁªìÊûúÂ±ïÁ§∫</h2><p>‰∏ãÂõæÊòØ‰∏Ä‰∏™GloVeËØçÂêëÈáèÁ§∫‰æãÔºåÊàë‰ª¨ÈÄöËøáGloVeÂæóÂà∞ÁöÑËØçÂêëÈáèÔºåÊàë‰ª¨ÂèØ‰ª•ÊâæÂà∞frogÔºàÈùíËõôÔºâÊúÄÊé•ËøëÁöÑ‰∏Ä‰∫õËØçÊ±áÔºåÂèØ‰ª•ÁúãÂá∫ÂÆÉ‰ª¨Êú¨Ë∫´ÊòØÂæàÁ±ª‰ººÁöÑÂä®Áâ©„ÄÇ</p><p><img src="/img/nlp/Á¨¨‰∫åËÆ≤/5.png" /></p><h1 id="ËØçÂêëÈáè‰º∞ËÆ°">4 ËØçÂêëÈáè‰º∞ËÆ°</h1><h2 id="Â¶Ç‰ΩïËØÑ‰º∞ËØçÂêëÈáè">4.1 Â¶Ç‰ΩïËØÑ‰º∞ËØçÂêëÈáèÔºü</h2><p>Êàë‰ª¨Â¶Ç‰ΩïËØÑ‰º∞ËØçÂêëÈáèÂë¢ÔºåÊúâÂÜÖÂú®ÂíåÂ§ñÂú®‰∏§ÁßçÊñπÂºèÔºö</p><ul><li><strong>ÂÜÖÂú®ËØÑ‰º∞ÊñπÂºè</strong><ul><li>ÂØπÁâπÂÆö/‰∏≠Èó¥Â≠ê‰ªªÂä°ËøõË°åËØÑ‰º∞</li><li>ËÆ°ÁÆóÈÄüÂ∫¶Âø´</li><li>ÊúâÂä©‰∫éÁêÜËß£Ëøô‰∏™Á≥ªÁªü</li><li>‰∏çÊ∏ÖÊ•öÊòØÂê¶ÁúüÁöÑÊúâÁî®ÔºåÈô§Èùû‰∏éÂÆûÈôÖ‰ªªÂä°Âª∫Á´ã‰∫ÜÁõ∏ÂÖ≥ÊÄß</li></ul></li><li><strong>Â§ñÈÉ®‰ªªÂä°ÊñπÂºè</strong><ul><li>ÂØπÁúüÂÆû‰ªªÂä°ÔºàÂ¶Ç‰∏ãÊ∏∏NLP‰ªªÂä°ÔºâÁöÑËØÑ‰º∞</li><li>ËÆ°ÁÆóÁ≤æÁ°ÆÂ∫¶ÂèØËÉΩÈúÄË¶ÅÂæàÈïøÊó∂Èó¥</li><li>‰∏çÊ∏ÖÊ•öÂ≠êÁ≥ªÁªüÈóÆÈ¢òÊâÄÂú®ÔºåÊòØ‰∫§‰∫íËøòÊòØÂÖ∂‰ªñÂ≠êÁ≥ªÁªüÈóÆÈ¢ò</li><li>Â¶ÇÊûúÁî®Âè¶‰∏Ä‰∏™Â≠êÁ≥ªÁªüÊõøÊç¢‰∏Ä‰∏™Â≠êÁ≥ªÁªüÂèØ‰ª•ÊèêÈ´òÁ≤æÁ°ÆÂ∫¶</li></ul></li></ul><h2 id="ÂÜÖÂú®ËØçÂêëÈáèËØÑ‰º∞">4.2 ÂÜÖÂú®ËØçÂêëÈáèËØÑ‰º∞</h2><p>‰∏ÄÁßçÂÜÖÂú®ËØçÂêëÈáèËØÑ‰º∞ÊñπÂºèÊòØ„Äå<strong>ËØçÂêëÈáèÁ±ªÊØî</strong>„ÄçÔºöÂØπ‰∫éÂÖ∑Â§áÊüêÁßçÂÖ≥Á≥ªÁöÑËØçÂØπa,bÔºåÂú®ÁªôÂÆöËØçcÁöÑÊÉÖÂÜµ‰∏ãÔºåÊâæÂà∞ÂÖ∑Â§áÁ±ª‰ººÂÖ≥Á≥ªÁöÑËØçd<span class="math display">\[a: b:: c: ? \rightarrow d=\arg \max _{i}\frac{\left(x_{b}-x_{a}+x_{c}\right)^{T}x_{i}}{\left\|x_{b}-x_{a}+x_{c}\right\|}\]</span></p><ul><li>ÈÄöËøáÂä†Ê≥ïÂêéÁöÑ‰ΩôÂº¶Ë∑ùÁ¶ªÊòØÂê¶ËÉΩÂæàÂ•ΩÂú∞ÊçïÊçâÂà∞Áõ¥ËßÇÁöÑËØ≠‰πâÂíåÂè•Ê≥ïÁ±ªÊØîÈóÆÈ¢òÊù•ËØÑ‰º∞ÂçïËØçÂêëÈáè</li><li>‰ªéÊêúÁ¥¢‰∏≠‰∏¢ÂºÉËæìÂÖ•ÁöÑÂçïËØç</li><li>ÈóÆÈ¢ò:Â¶ÇÊûúÊúâ‰ø°ÊÅØ‰ΩÜ‰∏çÊòØÁ∫øÊÄßÁöÑÊÄé‰πàÂäûÔºü</li></ul><h2 id="gloveÂèØËßÜÂåñÊïàÊûú">4.3 GloveÂèØËßÜÂåñÊïàÊûú</h2><p>‰∏ãÂõæ‰∏∫GloVeÂæóÂà∞ÁöÑËØçÂêëÈáèÁ©∫Èó¥ÂàÜÂ∏ÉÔºåÊàë‰ª¨ÂØπËØçÂêëÈáèËøõË°åÂáèÊ≥ïËÆ°ÁÆóÔºåÂèØ‰ª•ÂèëÁé∞Á±ªÊØîÁöÑËØçÂØπÊúâÁõ∏‰ººÁöÑË∑ùÁ¶ª„ÄÇ</p><p>brother ‚Äì sister, man ‚Äì woman, king - queen</p><p><img src="/img/nlp/Á¨¨‰∫åËÆ≤/6.png" /></p><h2 id="Á±ªÊØî‰ªªÂä°ËØÑ‰º∞‰∏éË∂ÖÂèÇÊï∞">4.4 Á±ªÊØî‰ªªÂä°ËØÑ‰º∞‰∏éË∂ÖÂèÇÊï∞</h2><p><img src="/img/nlp/Á¨¨‰∫åËÆ≤/7.png" /></p><p><img src="/img/nlp/Á¨¨‰∫åËÆ≤/8.png" /></p><ul><li>Êï∞ÊçÆÈõÜË∂äÂ§ßË∂äÂ•ΩÔºåÂπ∂‰∏îÁª¥Âü∫ÁôæÁßëÊï∞ÊçÆÈõÜÊØîÊñ∞ÈóªÊñáÊú¨Êï∞ÊçÆÈõÜË¶ÅÂ•Ω</li><li>300ÊòØ‰∏Ä‰∏™ÂæàÂ•ΩÁöÑËØçÂêëÈáèÁª¥Â∫¶</li></ul><h2 id="Âè¶‰∏Ä‰∏™ÂÜÖÂú®ÁöÑËØçÂêëÈáèËØÑ‰º∞">4.5 Âè¶‰∏Ä‰∏™ÂÜÖÂú®ÁöÑËØçÂêëÈáèËØÑ‰º∞</h2><p><img src="/img/nlp/Á¨¨‰∫åËÆ≤/9.png" /></p><h2 id="Áõ∏ÂÖ≥ÊÄßËØÑ‰º∞">4.6 Áõ∏ÂÖ≥ÊÄßËØÑ‰º∞</h2><h3 id="section"><img src="/img/nlp/Á¨¨‰∫åËÆ≤/10.png" /></h3><h1 id="word-senses">5 word senses</h1><h2 id="ËØç‰πâ‰∏éËØç‰πâÊ≠ß‰πâ">5.1 ËØç‰πâ‰∏éËØç‰πâÊ≠ß‰πâ</h2><p>Â§ßÂ§öÊï∞ÂçïËØçÈÉΩÊòØÂ§ö‰πâÁöÑ</p><ul><li>ÁâπÂà´ÊòØÂ∏∏ËßÅÂçïËØç</li><li>ÁâπÂà´ÊòØÂ≠òÂú®Â∑≤‰πÖÁöÑÂçïËØç</li></ul><p>‰æãÂ¶ÇÔºöpike</p><p>ÈÇ£‰πàÔºåËØçÂêëÈáèÊòØÊÄª‰ΩìÊçïÊçâ‰∫ÜÊâÄÊúâËøô‰∫õ‰ø°ÊÅØÔºåËøòÊòØÊùÇ‰π±Âú®‰∏ÄËµ∑‰∫ÜÂë¢Ôºü</p><h2 id="pikeÁöÑ‰∏çÂêåÂê´‰πâÁ§∫‰æã">5.2 pikeÁöÑ‰∏çÂêåÂê´‰πâÁ§∫‰æã</h2><p><img src="/img/nlp/Á¨¨‰∫åËÆ≤/11.png" /></p><h2 id="ËÆ∫ÊñáËÆ≤Ëß£-2">5.3 ËÆ∫ÊñáËÆ≤Ëß£</h2><h3id="improving-word-representations-via-global-context-and-multiple-word-prototypes-huang-et-al.-2012">5.3.1Improving Word Representations Via Global Context And Multiple WordPrototypes (Huang et al. 2012)</h3><p><img src="/img/nlp/Á¨¨‰∫åËÆ≤/12.png" /></p><p>Â∞ÜÂ∏∏Áî®ËØçÁöÑÊâÄÊúâ‰∏ä‰∏ãÊñáËøõË°åËÅöÁ±ªÔºåÈÄöËøáËØ•ËØçÂæóÂà∞‰∏Ä‰∫õÊ∏ÖÊô∞ÁöÑÁ∞áÔºå‰ªéËÄåÂ∞ÜËøô‰∏™Â∏∏Áî®ËØçÂàÜËß£‰∏∫Â§ö‰∏™ÂçïËØçÔºå‰æãÂ¶Çbank1„ÄÅbank2</p><h3id="linear-algebraic-structure-of-word-senses-with-applications-to-polysemy">5.3.2Linear Algebraic Structure of Word Senses, with Applications toPolysemy</h3><ul><li>ÂçïËØçÂú®Ê†áÂáÜÂçïËØçÂµåÂÖ•(Â¶Çword2vec)‰∏≠ÁöÑ‰∏çÂêåÂê´‰πâ‰ª•Á∫øÊÄßÂè†Âä†(Âä†ÊùÉÂíå)ÁöÑÂΩ¢ÂºèÂ≠òÂú®</li></ul><p><span class="math display">\[v_{pike} = \alpha_1 v_{pike_1} + \alpha_2 v_{pike_2} + \alpha_3v_{pike_3}\]</span></p><ul><li>ÂÖ∂‰∏≠Ôºå<span class="math inline">\(\alpha =\frac{f_{1}}{f_{1}+f_{2}+f_{3}}\)</span></li></ul><p>‰ª§‰∫∫ÊÉäËÆ∂ÁöÑÁªìÊûúÔºö</p><ul><li>Âè™ÊòØÂä†ÊùÉÂπ≥ÂùáÂÄºÂ∞±Â∑≤ÁªèÂèØ‰ª•Ëé∑ÂæóÂæàÂ•ΩÁöÑÊïàÊûú</li><li>Áî±‰∫é‰ªéÁ®ÄÁñèÁºñÁ†Å‰∏≠ÂæóÂà∞ÁöÑÊ¶ÇÂøµÔºå‰Ω†ÂÆûÈôÖ‰∏äÂèØ‰ª•Â∞ÜÊÑüÂÆòÂàÜÁ¶ªÂá∫Êù•(ÂâçÊèêÊòØÂÆÉ‰ª¨Áõ∏ÂØπÊØîËæÉÂ∏∏ËßÅ)</li></ul><h2 id="Â§ñÂêëËØçÂêëÈáèËØÑ‰º∞">5.4 Â§ñÂêëËØçÂêëÈáèËØÑ‰º∞</h2><ul><li>ÂçïËØçÂêëÈáèÁöÑÂ§ñÈÉ®ËØÑ‰º∞ÔºöËØçÂêëÈáèÂèØ‰ª•Â∫îÁî®‰∫éNLPÁöÑÂæàÂ§ö‰∏ãÊ∏∏‰ªªÂä°</li><li>‰∏Ä‰∏™‰æãÂ≠êÊòØÂú®ÂëΩÂêçÂÆû‰ΩìËØÜÂà´‰ªªÂä°‰∏≠ÔºåÂØªÊâæ‰∫∫Âêç„ÄÅÊú∫ÊûÑÂêç„ÄÅÂú∞ÁêÜ‰ΩçÁΩÆÂêçÔºåËØçÂêëÈáèÈùûÂ∏∏ÊúâÂ∏ÆÂä©</li></ul><p><img src="/img/nlp/Á¨¨‰∫åËÆ≤/13.png" /></p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ÂõûÊ∫Ø</title>
    <link href="/2022/05/03/%E5%9B%9E%E6%BA%AF/"/>
    <url>/2022/05/03/%E5%9B%9E%E6%BA%AF/</url>
    
    <content type="html"><![CDATA[<h2 id="ÁîµËØùÂè∑Á†ÅÁöÑÂ≠óÊØçÁªÑÂêà">17„ÄÅÁîµËØùÂè∑Á†ÅÁöÑÂ≠óÊØçÁªÑÂêà</h2><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/17.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">letterCombinations</span>(<span class="hljs-params">self, digits: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:<br>        <span class="hljs-keyword">if</span> digits == <span class="hljs-string">&#x27;&#x27;</span>:<br>            <span class="hljs-keyword">return</span> []<br><br>        phoneMap = &#123;<br>        <span class="hljs-string">&#x27;2&#x27;</span>: <span class="hljs-string">&#x27;abc&#x27;</span>,<br>        <span class="hljs-string">&#x27;3&#x27;</span>: <span class="hljs-string">&#x27;def&#x27;</span>,<br>        <span class="hljs-string">&#x27;4&#x27;</span>: <span class="hljs-string">&#x27;ghi&#x27;</span>,<br>        <span class="hljs-string">&#x27;5&#x27;</span>: <span class="hljs-string">&#x27;jkl&#x27;</span>,<br>        <span class="hljs-string">&#x27;6&#x27;</span>: <span class="hljs-string">&#x27;mno&#x27;</span>,<br>        <span class="hljs-string">&#x27;7&#x27;</span>: <span class="hljs-string">&#x27;pqrs&#x27;</span>,<br>        <span class="hljs-string">&#x27;8&#x27;</span>: <span class="hljs-string">&#x27;tuv&#x27;</span>,<br>        <span class="hljs-string">&#x27;9&#x27;</span>: <span class="hljs-string">&#x27;wxyz&#x27;</span>,   <br>        &#125;<br>        <br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">backtrack</span>(<span class="hljs-params">index: <span class="hljs-built_in">int</span></span>):<span class="hljs-comment"># ÂõûÊ∫Ø</span><br>            <span class="hljs-keyword">if</span> index == <span class="hljs-built_in">len</span>(digits):<br>                combinations.append(<span class="hljs-string">&#x27;&#x27;</span>.join(combination))<br>            <span class="hljs-keyword">else</span>:<br>                digit = digits[index]<br>                <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> phoneMap[digit]:<br>                    combination.append(ch)<br>                    backtrack(index + <span class="hljs-number">1</span>)<br>                    combination.pop()<br><br>        combination = <span class="hljs-built_in">list</span>()<br>        combinations = <span class="hljs-built_in">list</span>()<br>        backtrack(<span class="hljs-number">0</span>)<br><br>        <span class="hljs-keyword">return</span> combinations<br></code></pre></div></td></tr></table></figure><h2 id="Êã¨Âè∑ÁîüÊàê">22„ÄÅÊã¨Âè∑ÁîüÊàê</h2><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/22.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generateParenthesis</span>(<span class="hljs-params">self, n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:<br>        ans = []<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">backtrack</span>(<span class="hljs-params">S, left, right</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(S) == <span class="hljs-number">2</span> * n:<br>                ans.append(<span class="hljs-string">&#x27;&#x27;</span>.join(S))<br>                <span class="hljs-keyword">return</span><br>            <span class="hljs-keyword">if</span> left &lt; n:<br>                S.append(<span class="hljs-string">&#x27;(&#x27;</span>)<br>                backtrack(S, left + <span class="hljs-number">1</span>, right)<br>                S.pop()<br>            <span class="hljs-keyword">if</span> right &lt; left:<br>                S.append(<span class="hljs-string">&#x27;)&#x27;</span>)<br>                backtrack(S, left, right + <span class="hljs-number">1</span>)<br>                S.pop()<br>        backtrack([], <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="ÁªÑÂêàÊÄªÂíå">39„ÄÅÁªÑÂêàÊÄªÂíå</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/39.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">combinationSum</span>(<span class="hljs-params">self, candidates: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], target: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]]:<br>        candidates.sort()<br>        n = <span class="hljs-built_in">len</span>(candidates)<br>        res = []<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">backtrack</span>(<span class="hljs-params">i, tmp_sum, tmp</span>):<br>            <span class="hljs-keyword">if</span>  tmp_sum &gt; target <span class="hljs-keyword">or</span> i == n:<br>                <span class="hljs-keyword">return</span> <br>            <span class="hljs-keyword">if</span> tmp_sum == target:<br>                res.append(tmp)<br>                <span class="hljs-keyword">return</span> <br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i, n):<br>                <span class="hljs-keyword">if</span> tmp_sum + candidates[j] &gt; target:<br>                    <span class="hljs-keyword">break</span><br>                backtrack(j, tmp_sum+candidates[j], tmp+[candidates[j]])<br>        backtrack(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, [])<br>        <span class="hljs-keyword">return</span> res<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>LeetCode</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Á¨¨‰∏ÄËÆ≤-NLP‰ªãÁªç‰∏éËØçÂêëÈáèÂàùÊ≠•</title>
    <link href="/2022/05/01/%E7%AC%AC%E4%B8%80%E8%AE%B2-NLP%E4%BB%8B%E7%BB%8D%E4%B8%8E%E8%AF%8D%E5%90%91%E9%87%8F%E5%88%9D%E6%AD%A5/"/>
    <url>/2022/05/01/%E7%AC%AC%E4%B8%80%E8%AE%B2-NLP%E4%BB%8B%E7%BB%8D%E4%B8%8E%E8%AF%8D%E5%90%91%E9%87%8F%E5%88%9D%E6%AD%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="Ëá™ÁÑ∂ËØ≠Ë®Ä‰∏éËØçÊ±áÂê´‰πâ">1 Ëá™ÁÑ∂ËØ≠Ë®Ä‰∏éËØçÊ±áÂê´‰πâ</h1><h2 id="Â¶Ç‰ΩïÂú®ËÆ°ÁÆóÊú∫ÈáåË°®ËææËØçÁöÑÊÑè‰πâ">1.1 Â¶Ç‰ΩïÂú®ËÆ°ÁÆóÊú∫ÈáåË°®ËææËØçÁöÑÊÑè‰πâ</h2><p>Ë¶Å‰ΩøÁî®ËÆ°ÁÆóÊú∫Â§ÑÁêÜÊñáÊú¨ËØçÊ±áÔºå‰∏ÄÁßçÂ§ÑÁêÜÊñπÂºèÊòØ<strong>WordNet</strong>ÔºöÂç≥ÊûÑÂª∫‰∏Ä‰∏™ÂåÖÂê´Âêå‰πâËØçÈõÜÂíå‰∏ä‰ΩçËØç(‚Äúisa‚ÄùÂÖ≥Á≥ª)ÁöÑÂàóË°®ÁöÑËæûÂÖ∏„ÄÇËã±ÊñáÂΩì‰∏≠Á°ÆÂÆûÊúâËøôÊ†∑‰∏Ä‰∏™wordnetÔºåÊàë‰ª¨Âú®ÂÆâË£ÖÂÆåNLTKÂ∑•ÂÖ∑Â∫ìÂíå‰∏ãËΩΩÊï∞ÊçÆÂåÖÂêéÂèØ‰ª•‰ΩøÁî®ÔºåÂØπÂ∫îÁöÑ python‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> nltk.corpus <span class="hljs-keyword">import</span> wordnet <span class="hljs-keyword">as</span> wn<br>poses = &#123; <span class="hljs-string">&#x27;n&#x27;</span>:<span class="hljs-string">&#x27;noun&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>:<span class="hljs-string">&#x27;verb&#x27;</span>, <span class="hljs-string">&#x27;s&#x27;</span>:<span class="hljs-string">&#x27;adj (s)&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>:<span class="hljs-string">&#x27;adj&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>:<span class="hljs-string">&#x27;adv&#x27;</span>&#125;<br><span class="hljs-keyword">for</span> synset <span class="hljs-keyword">in</span> wn.synsets(<span class="hljs-string">&quot;good&quot;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(poses[synset.pos()], <span class="hljs-string">&quot;, &quot;</span>.join([l.name() <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> synset.lemmas()])))<br>        <br><span class="hljs-keyword">from</span> nltk.corpus <span class="hljs-keyword">import</span> wordnet <span class="hljs-keyword">as</span> wn<br>panda = wn.synset(<span class="hljs-string">&quot;panda.n.01&quot;</span>)<br>hyper = <span class="hljs-keyword">lambda</span> s: s.hypernyms()<br><span class="hljs-built_in">list</span>(panda.closure(hyper))<br></code></pre></div></td></tr></table></figure><p>ËøêË°åÁªìÊûúÂ¶Ç‰∏ãÔºö</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">noun: good<br>noun: good, goodness<br>noun: good, goodness<br>noun: commodity, trade_good, good<br>adj: good<br>adj (sat): full, good<br>adj: good<br>adj (sat): estimable, good, honorable, respectable<br>adj (sat): beneficial, good<br>adj (sat): good<br>adj (sat): good, just, upright<br>‚Ä¶<br>adverb: well, good<br>adverb: thoroughly, soundly, good<br></code></pre></div></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">[Synset(&#x27;procyonid.n.01&#x27;),<br>Synset(&#x27;carnivore.n.01&#x27;),<br>Synset(&#x27;placental.n.01&#x27;),<br>Synset(&#x27;mammal.n.01&#x27;),<br>Synset(&#x27;vertebrate.n.01&#x27;),<br>Synset(&#x27;chordate.n.01&#x27;),<br>Synset(&#x27;animal.n.01&#x27;),<br>Synset(&#x27;organism.n.01&#x27;),<br>Synset(&#x27;living_thing.n.01&#x27;),<br>Synset(&#x27;whole.n.02&#x27;),<br>Synset(&#x27;object.n.01&#x27;),<br>Synset(&#x27;physical_entity.n.01&#x27;),<br>Synset(&#x27;entity.n.01&#x27;)]<br></code></pre></div></td></tr></table></figure><h2 id="wordnetÁöÑÈóÆÈ¢ò">1.2 WordNetÁöÑÈóÆÈ¢ò</h2><ul><li><p>‰Ωú‰∏∫‰∏Ä‰∏™ËµÑÊ∫êÂæàÂ•ΩÔºå‰ΩÜÂøΩÁï•‰∫ÜÁªÜÂæÆÂ∑ÆÂà´„ÄÇ‰æãÂ¶Ç‚Äúproficient‚ÄùË¢´Âàó‰∏∫‚Äúgood‚ÄùÁöÑÂêå‰πâËØçÔºåËøôÂè™ÊòØÂú®‰∏Ä‰∫õ‰∏ä‰∏ãÊñá‰∏≠ÊòØÊ≠£Á°ÆÁöÑ„ÄÇ</p></li><li><p>Áº∫Â∞ëÂçïËØçÁöÑÊñ∞Âê´‰πâÔºåÈöæ‰ª•ÊåÅÁª≠Êõ¥Êñ∞„ÄÇ</p></li><li><p>ÊòØ‰∏ªËßÇÁöÑÔºåÈúÄË¶Å‰∫∫‰ª¨Êù•ÂàõÈÄ†ÂíåË∞ÉÊï¥ÔºåÊó†Ê≥ïËÆ°ÁÆóÂçïËØçÁõ∏‰ººÂ∫¶„ÄÇ</p></li></ul><h2 id="ÊñáÊú¨ËØçÊ±áÁöÑÁ¶ªÊï£Ë°®ÂæÅ">1.3 ÊñáÊú¨(ËØçÊ±á)ÁöÑÁ¶ªÊï£Ë°®ÂæÅ</h2><p>Âú®‰º†ÁªüÁöÑËá™ÁÑ∂ËØ≠Ë®ÄÂ§ÑÁêÜ‰∏≠ÔºåÊàë‰ª¨‰ºöÂØπÊñáÊú¨ÂÅöÁ¶ªÊï£Ë°®ÂæÅÔºåÊääËØçËØ≠Áúã‰ΩúÁ¶ªÊï£ÁöÑÁ¨¶Âè∑Ôºö‰æãÂ¶Çhotel„ÄÅconference„ÄÅmotelÁ≠â„ÄÇ</p><p>one-hot vectorÊòØÂè™Êúâ‰∏Ä‰∏™1ÔºåÂÖ∂‰ΩôÂÖ®‰∏∫Èõ∂ÁöÑÁ®ÄÁñèÂêëÈáèÔºåÂçïËØçÂèØ‰ª•ÈÄöËøáone-hotvectorÊù•Ë°®Á§∫Ôºö <span class="math display">\[\text { motel }=\left[\begin{array}{lllllllllllllll}0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\end{array}\right]\]</span></p><p><span class="math display">\[\text { hotel }=\left[\begin{array}{lllllllllllllll}0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp;0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\end{array}\right]\]</span></p><p>Âú®one-hot vector‰∏≠ÂêëÈáèÁª¥Â∫¶ = ËØçÊ±áÈáèÔºàÂ¶Ç500Ôºå000Ôºâ</p><h2 id="Á¶ªÊï£Ë°®ÂæÅÁöÑÈóÆÈ¢ò">1.4 Á¶ªÊï£Ë°®ÂæÅÁöÑÈóÆÈ¢ò</h2><p>Âú®‰∏äËø∞ÁöÑÁã¨ÁÉ≠ÂêëÈáèÁ¶ªÊï£Ë°®ÂæÅÈáåÔºåÊâÄÊúâËØçÂêëÈáèÊòØÊ≠£‰∫§ÁöÑÔºåËøôÊòØ‰∏Ä‰∏™ÂæàÂ§ßÁöÑÈóÆÈ¢ò„ÄÇÂØπ‰∫éÁã¨ÁÉ≠ÂêëÈáèÔºåÊ≤°ÊúâÂÖ≥‰∫éÁõ∏‰ººÊÄßÊ¶ÇÂøµÔºåÂπ∂‰∏îÂêëÈáèÁª¥Â∫¶ËøáÂ§ß„ÄÇ</p><p>ÂØπ‰∫é‰∏äËø∞ÈóÆÈ¢òÊúâ‰∏Ä‰∫õËß£ÂÜ≥ÊÄùË∑ØÔºö</p><ul><li>‚ë†‰ΩøÁî®Á±ª‰ººWordNetÁöÑÂ∑•ÂÖ∑‰∏≠ÁöÑÂàóË°®ÔºåËé∑ÂæóÁõ∏‰ººÂ∫¶Ôºå‰ΩÜ‰ºöÂõ†‰∏çÂ§üÂÆåÊï¥ËÄåÂ§±Ë¥•</li><li>‚ë° ÈÄöËøáÂ§ßÈáèÊï∞ÊçÆÂ≠¶‰π†ËØçÂêëÈáèÊú¨Ë∫´Áõ∏‰ººÊÄßÔºåËé∑ÂæóÊõ¥Á≤æÁ°ÆÁöÑÁ®†ÂØÜËØçÂêëÈáèÁºñÁ†Å</li></ul><h2 id="Âü∫‰∫é‰∏ä‰∏ãÊñáÁöÑËØçÊ±áË°®ÂæÅ">1.5 Âü∫‰∫é‰∏ä‰∏ãÊñáÁöÑËØçÊ±áË°®ÂæÅ</h2><p><strong>ËøëÂπ¥Êù•Âú®Ê∑±Â∫¶Â≠¶‰π†‰∏≠ÊØîËæÉÊúâÊïàÁöÑÊñπÂºèÊòØÂü∫‰∫é‰∏ä‰∏ãÊñáÁöÑËØçÊ±áË°®ÂæÅ</strong>„ÄÇÂÆÉÁöÑ<strong>Ê†∏ÂøÉÊÉ≥Ê≥ï</strong>ÊòØÔºö‰∏Ä‰∏™ÂçïËØçÁöÑÊÑèÊÄùÊòØÁî±ÁªèÂ∏∏Âá∫Áé∞Âú®ÂÆÉÈôÑËøëÁöÑÂçïËØçÁªôÂá∫ÁöÑ</p><p>ËøôÊòØÁé∞‰ª£ÁªüËÆ°NLPÊúÄÊàêÂäüÁöÑÁêÜÂøµ‰πã‰∏ÄÔºåÊÄª‰ΩìÊÄùË∑ØÊúâÁÇπÁâ©‰ª•Á±ªËÅöÔºå‰∫∫‰ª•Áæ§ÂàÜÁöÑÊÑüËßâ„ÄÇ</p><ul><li>ÂΩì‰∏Ä‰∏™ÂçïËØç<spanclass="math inline">\(w\)</span>Âá∫Áé∞Âú®ÊñáÊú¨‰∏≠Êó∂ÔºåÂÆÉÁöÑ‰∏ä‰∏ãÊñáÊòØÂá∫Áé∞Âú®ÂÖ∂ÈôÑËøëÁöÑ‰∏ÄÁªÑÂçïËØç(Âú®‰∏Ä‰∏™Âõ∫ÂÆöÂ§ßÂ∞èÁöÑÁ™óÂè£‰∏≠)</li><li>Âü∫‰∫éÊµ∑ÈáèÊï∞ÊçÆÔºå‰ΩøÁî®<spanclass="math inline">\(w\)</span>ÁöÑËÆ∏Â§ö‰∏ä‰∏ãÊñáÊù•ÊûÑÂª∫<spanclass="math inline">\(w\)</span>ÁöÑË°®Á§∫</li></ul><h1 id="word-vectors">2 Word Vectors</h1><h2 id="ËØçÂêëÈáèË°®Á§∫">2.1 ËØçÂêëÈáèË°®Á§∫</h2><p><strong>Word2vec</strong> (Mikolov et al.2013)ÊòØ‰∏Ä‰∏™Â≠¶‰π†ËØçÂêëÈáèË°®ÂæÅÁöÑÊ°ÜÊû∂„ÄÇ</p><ul><li><strong>Ê†∏ÂøÉÊÄùË∑Ø</strong>Â¶Ç‰∏ãÔºö<ul><li>Âü∫‰∫éÊµ∑ÈáèÊñáÊú¨ËØ≠ÊñôÂ∫ìÊûÑÂª∫</li><li>ËØçÊ±áË°®‰∏≠ÁöÑÊØè‰∏™ÂçïËØçÈÉΩÁî±‰∏Ä‰∏™ÂêëÈáèË°®Á§∫ÔºàÂ≠¶‰π†ÂÆåÊàêÂêé‰ºöÂõ∫ÂÆöÔºâ</li><li>ÂØπÂ∫îËØ≠ÊñôÂ∫ìÊñáÊú¨‰∏≠ÁöÑÊØè‰∏™‰ΩçÁΩÆ<spanclass="math inline">\(t\)</span>ÔºåÊúâ‰∏Ä‰∏™‰∏≠ÂøÉËØç<spanclass="math inline">\(c\)</span>Âíå‰∏Ä‰∫õ‰∏ä‰∏ãÊñá(‚ÄúÂ§ñÈÉ®‚Äù)ÂçïËØç<spanclass="math inline">\(o\)</span></li><li>‰ΩøÁî®<span class="math inline">\(c\)</span>Âíå<spanclass="math inline">\(o\)</span>ÁöÑËØçÂêëÈáèÊù•ËÆ°ÁÆóÊ¶ÇÁéá<spanclass="math inline">\(P(o|c)\)</span>ÔºåÂç≥ÁªôÂÆö‰∏≠ÂøÉËØçÊé®Êñ≠‰∏ä‰∏ãÊñáËØçÊ±áÁöÑÊ¶ÇÁéáÔºàÂèç‰πã‰∫¶ÁÑ∂Ôºâ</li><li>‰∏çÊñ≠Ë∞ÉÊï¥ËØçÂêëÈáèÊù•ÊúÄÂ§ßÂåñËøô‰∏™Ê¶ÇÁéá</li></ul></li></ul><p><img src="/img/nlp/3.png" /></p><h1 id="word2vec-ÁõÆÊ†áÂáΩÊï∞">3 Word2vec ÁõÆÊ†áÂáΩÊï∞</h1><h2 id="‰ººÁÑ∂ÂáΩÊï∞">3.1 ‰ººÁÑ∂ÂáΩÊï∞</h2><p>ÂØπ‰∫éÊØè‰∏™‰ΩçÁΩÆt = 1, ‚Ä¶ , T, Âú®Â§ßÂ∞è‰∏∫<spanclass="math inline">\(m\)</span>ÁöÑÂõ∫ÂÆöÁ™óÂè£ÂÜÖÈ¢ÑÊµã‰∏ä‰∏ãÊñáÂçïËØçÔºåÁªôÂÆö‰∏≠ÂøÉËØç<spanclass="math inline">\(w_j\)</span>Ôºå‰ººÁÑ∂ÂáΩÊï∞ÂèØ‰ª•Ë°®Á§∫‰∏∫Ôºö <spanclass="math display">\[Likelihood = L(\theta) = \prod_{t=1}^{T} \prod_{\substack{-m \leq j \leqm \\ j \neq 0}}P(w_{t+j}|w_t;\theta)\]</span></p><p>‰∏äËø∞ÂÖ¨Âºè‰∏≠Ôºå<spanclass="math inline">\(\theta\)</span>‰∏∫Ê®°ÂûãÂåÖÂê´ÁöÑÊâÄÊúâÂæÖ‰ºòÂåñÊùÉÈáçÂèòÈáè</p><h2 id="ÁõÆÊ†áÂáΩÊï∞">3.2 ÁõÆÊ†áÂáΩÊï∞</h2><p>ÂØπÂ∫î‰∏äËø∞‰ººÁÑ∂ÂáΩÊï∞ÁöÑÁõÆÊ†áÂáΩ<spanclass="math inline">\(J(\theta)\)</span>ÂèØ‰ª•Âèñ‰Ωú(Âπ≥Âùá)Ë¥üÂØπÊï∞‰ººÁÑ∂Ôºö <spanclass="math display">\[Likelihood=-\frac1T \log L(\theta)=-\frac1T \sum_{t=1}^{T}\sum_{\substack{-m \leq j \leq m \\ j \neq 0}} \logP(w_{t+j}|w_t;\theta)\]</span></p><p>Ê≥®ÊÑèÔºö</p><ul><li>ÁõÆÊ†áÂáΩÊï∞<spanclass="math inline">\(J(\theta)\)</span>ÊúâÊó∂‰πüË¢´Áß∞‰∏∫‚Äú<strong>‰ª£‰ª∑ÂáΩÊï∞</strong>‚ÄùÊàñ‚Äú<strong>ÊçüÂ§±ÂáΩÊï∞</strong>‚Äù</li><li>ÊúÄÂ∞èÂåñÁõÆÊ†áÂáΩÊï∞‰∏éÊúÄÂ§ßÂåñ‰ººÁÑ∂ÂáΩÊï∞ÔºàÈ¢ÑÊµãÊ¶ÇÁéá/Á≤æÂ∫¶Ôºâ<strong>‰∏§ËÄÖÁ≠â‰ª∑</strong></li></ul><p>ÂæóÂà∞ÁõÆÊ†áÂáΩÊï∞ÂêéÔºåÊàë‰ª¨Â∏åÊúõÊúÄÂ∞èÂåñÁõÆÊ†áÂáΩÊï∞ÔºåÈÇ£Êàë‰ª¨Â¶Ç‰ΩïËÆ°ÁÆó<spanclass="math inline">\(P(w_{t+j}|w_t;\theta)\)</span>?</p><p>ÂØπ‰∫éÊØè‰∏™ËØç<span class="math inline">\(w\)</span>ÈÉΩ‰ºöÁî®‰∏§‰∏™ÂêëÈáèÔºö</p><ul><li>ÂΩì<spanclass="math inline">\(w\)</span>ÊòØ‰∏≠ÂøÉËØçÊó∂ÔºåÊàë‰ª¨Ê†áËÆ∞ËØçÂêëÈáè‰∏∫<spanclass="math inline">\(v_w\)</span></li><li>ÂΩì<spanclass="math inline">\(w\)</span>ÊòØ‰∏ä‰∏ãÊñáËØçÊó∂ÔºåÊàë‰ª¨Ê†áËÆ∞ËØçÂêëÈáè‰∏∫<spanclass="math inline">\(u_w\)</span></li></ul><p>ÂàôÂØπ‰∫é‰∏Ä‰∏™‰∏≠ÂøÉËØç<spanclass="math inline">\(c\)</span>Âíå‰∏Ä‰∏™‰∏ä‰∏ãÊñáËØç<spanclass="math inline">\(o\)</span>ÔºåÊàë‰ª¨ÊúâÂ¶Ç‰∏ãÊ¶ÇÁéáËÆ°ÁÆóÂÖ¨Âºè <spanclass="math display">\[P(o \mid c)=\frac{\exp \left(u_{o}^{T} v_{c}\right)}{\sum_{w \in V} \exp\left(u_{w}^{T} v_{c}\right)}\]</span></p><ul><li>ÂØπ<spanclass="math inline">\(u_o^Tv_c\)</span>ÊòØÂ∞Ü‰∏§‰∏™ÂêëÈáèËøõË°åÁÇπÁßØÔºå‰∏∫‰∫ÜËÆ°ÁÆó‰∏§‰∏™ËØçÂêëÈáèÁöÑÁõ∏‰ººÂ∫¶ÔºåÁÇπÁßØÁöÑÁªìÊûúË∂äÂ§ßÔºåÈÇ£‰πàÁõ∏‰ººÂ∫¶Ë∂äÂ§ß„ÄÇ</li><li>Ê®°ÂûãÁöÑËÆ≠ÁªÉÊ≠£ÊòØ‰∏∫‰∫Ü‰ΩøÂæóÂÖ∑ÊúâÁõ∏‰ºº‰∏ä‰∏ãÊñáÁöÑÂçïËØçÔºåÂÖ∑ÊúâÁõ∏‰ººÁöÑÂêëÈáè</li><li>ÁÇπÁßØÊòØËÆ°ÁÆóÁõ∏‰ººÊÄßÁöÑ‰∏ÄÁßçÁÆÄÂçïÊñπÊ≥ïÔºåÂú®Ê≥®ÊÑèÂäõÊú∫Âà∂‰∏≠Â∏∏‰ΩøÁî®ÁÇπÁßØËÆ°ÁÆóScore</li></ul><h1 id="word2vecÈ¢ÑÊµãÂáΩÊï∞">4 Word2vecÈ¢ÑÊµãÂáΩÊï∞</h1><p>Ëøô‰πüÂ∞±ÊòØsoftmax function(<spanclass="math inline">\(R^n\Rightarrow(0,1)^n\)</span>‚Äã)ÁöÑ‰∏Ä‰∏™‰æãÂ≠êÔºåÂ∞Ü<spanclass="math inline">\(x_i\)</span>Êò†Â∞ÑÂà∞<spanclass="math inline">\(p_i\)</span>Ôºö <span class="math display">\[\operatorname{softmax}\left(x_{i}\right)=\frac{\exp\left(x_{i}\right)}{\sum_{j=1}^{n} \exp \left(x_{j}\right)}=p_{i}\]</span> ‰∏∫‰∫ÜËÆ≠ÁªÉÊ®°ÂûãÔºåÊàë‰ª¨Â∞±Ë¶ÅÊâæÂá∫ÂèÇÊï∞ÊúÄÂ∞èÂåñlossÂáΩÊï∞</p><ul><li><p>RecallÔºö<spanclass="math inline">\(\theta\)</span>ÈÄöËøá‰∏Ä‰∏™ÈïøÂêëÈáèÊù•‰ª£Ë°®ÊâÄÊúâÁöÑÊ®°ÂûãÂèÇÊï∞</p></li><li><p>Âú®Êàë‰ª¨ÁöÑ‰æãÂ≠ê‰∏≠ÔºåÂØπ‰∫édÁª¥ÂêëÈáèÂíåV‰∏™ÂçïËØçÔºåÊàë‰ª¨ÂæóÂá∫Ôºö</p></li><li><p><span class="math display">\[\theta=\left[\begin{array}{l}v_{\text {aardvark }} \\v_{a} \\\vdots \\v_{z e b r a} \\u_{a a r d v a r k} \\u_{a} \\\vdots \\u_{z e b r a}\end{array}\right] \in \mathbb{R}^{2 d V}\]</span></p></li><li><p>ÊâÄ‰ª•Êàë‰ª¨ÊØè‰∏™ÂçïËØçÊúâ‰∏§‰∏™ÂêëÈáè</p></li></ul><p>Êàë‰ª¨Â∞±ÈúÄË¶ÅËÆ°ÁÆóÊâÄÊúâÂêëÈáèÁöÑÊ¢ØÂ∫¶ËøõË°åÊ¢ØÂ∫¶‰∏ãÈôçÁÆóÊ≥ïÊù•ÊúÄÂ∞èÂåñlossÂáΩÊï∞</p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>NLP</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ÂèåÊåáÈíà</title>
    <link href="/2022/05/01/%E5%8F%8C%E6%8C%87%E9%92%88/"/>
    <url>/2022/05/01/%E5%8F%8C%E6%8C%87%E9%92%88/</url>
    
    <content type="html"><![CDATA[<h2 id="ÁõõÊ∞¥ÊúÄÂ§öÁöÑÂÆπÂô®">11„ÄÅÁõõÊ∞¥ÊúÄÂ§öÁöÑÂÆπÂô®</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/3.png" /></p><p>Êàë‰ª¨‰ΩøÁî®ÂèåÊåáÈíàÁöÑÊÄùÊÉ≥Ôºå‰∏§‰∏™ÊåáÈíàÂàÜÂà´‰∏∫Êï∞ÁªÑÁöÑÂ§¥Â∞æÁªìÁÇπÔºåÊØèËΩÆÈÉΩËøõË°åÈù¢ÁßØÁöÑËÆ°ÁÆóÔºåÂπ∂‰∏îÊØèËΩÆÂè™ÁßªÂä®ËæÉÂ∞èÁªìÁÇπÁöÑÊåáÈíà„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">maxArea</span>(<span class="hljs-params">self, height: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:<br>        n = <span class="hljs-built_in">len</span>(height)<br>        left = <span class="hljs-number">0</span>    <span class="hljs-comment"># Â∑¶ÊåáÈíà</span><br>        right = n - <span class="hljs-number">1</span>   <span class="hljs-comment"># Âè≥ÊåáÈíà</span><br>        max_s = <span class="hljs-number">0</span>   <span class="hljs-comment"># Èù¢ÁßØÊúÄÂ§ßÂÄº</span><br>        s = <span class="hljs-number">0</span>   <span class="hljs-comment"># Èù¢ÁßØ</span><br>        l = <span class="hljs-number">0</span>   <span class="hljs-comment"># ËæπÈïø</span><br>        <span class="hljs-keyword">while</span> right &gt; left:<br>            <span class="hljs-keyword">if</span> height[left] &gt; height[right]:<br>                l = height[right]<br>            <span class="hljs-keyword">else</span>:<br>                l = height[left]<br>            s = (right - left) * l<br>            <span class="hljs-keyword">if</span> s &gt; max_s:<br>                max_s = s<br>            <span class="hljs-keyword">if</span> height[left] &gt; height[right]:<br>                right = right - <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                left = left + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> max_s<br></code></pre></div></td></tr></table></figure><h2 id="‰∏âÊï∞‰πãÂíå">15„ÄÅ‰∏âÊï∞‰πãÂíå</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/15.png" /></p><p>ÈááÁî®ÂèåÊåáÈíàÁöÑÊÄùÊÉ≥Ôºå‰∏∫‰∫Ü‰∏ç‰Ωø‰∏âÂÖÉÁªÑÈáçÂ§çÔºåÂÖàÂØπÊï∞ÁªÑËøõË°åÊéíÂ∫è„ÄÇÂΩìÁ°ÆÂÆö‰∫ÜÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÂè™ÈúÄË¶ÅÂØπÂâ©‰∏ãÂÖÉÁ¥†ËøõË°åËÆæÁΩÆÂ∑¶ÊåáÈíàÂíåÂè≥ÊåáÈíàÔºåÂ¶ÇÊûú‰∏âÂÖÉÁªÑÂ§ß‰∏é0ÔºåÂè≥ÊåáÈíàÂ∞±Â∑¶Áßª‰∏Ä‰ΩçÔºåÂèç‰πã‰∫¶ÁÑ∂„ÄÇÂ¶ÇÊûú‰∏âÂÖÉÁªÑ‰πãÂíåÂàöÂ•ΩÁ≠â‰∫é0ÔºåÂ∞±ÈúÄË¶ÅÂ∑¶ÊåáÈíàÂíåÂè≥ÊåáÈíàÈÉΩÁßªÂä®‰∏Ä‰Ωç„ÄÇËøôÊó∂ÂÄôËøò‰ºöÂá∫Áé∞ÈáçÂ§çÈóÆÈ¢òÔºåÊâÄ‰ª•ÈúÄË¶ÅÂà§Êñ≠Ê≠§Êó∂ÈÅçÂéÜÁöÑÂÖÉÁ¥†Âíå‰πãÂâçÁöÑÊòØÂê¶Áõ∏ÂêåÔºåÂ¶ÇÊûúÁõ∏ÂêåÂ∞±Ë¶ÅË∑≥Ëøá„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">threeSum</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]]:<br>        nums.sort()<br>        n = <span class="hljs-built_in">len</span>(nums)<br>        ans = <span class="hljs-built_in">list</span>()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<span class="hljs-comment"># Âõ∫ÂÆöÂÖ∂‰∏≠‰∏Ä‰∏™ÂÖÉÁ¥†</span><br>            <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> nums[i] != nums[i - <span class="hljs-number">1</span>]:<br>                k = n - <span class="hljs-number">1</span><br>                j = i + <span class="hljs-number">1</span><br>                <span class="hljs-keyword">while</span> k &gt; j:<span class="hljs-comment"># ËøõË°åÂèåÊåáÈíàÈÅçÂéÜ</span><br>                    <span class="hljs-keyword">if</span> k != n - <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> nums[k] == nums[k + <span class="hljs-number">1</span>]:<span class="hljs-comment"># Â¶ÇÊûúÂè≥ÊåáÈíà‰πãÂâçÂá∫Áé∞ËøáÂ∞±Ë∑≥Ëøá</span><br>                        k = k - <span class="hljs-number">1</span><br>                        <span class="hljs-keyword">continue</span><br>                    <span class="hljs-keyword">if</span> j != i + <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> nums[j] == nums[j - <span class="hljs-number">1</span>]:<span class="hljs-comment"># Â¶ÇÊûúÂ∑¶ÊåáÈíà‰πãÂâçÂá∫Áé∞ËøáÂ∞±Ë∑≥Ëøá</span><br>                        j = j + <span class="hljs-number">1</span><br>                        <span class="hljs-keyword">continue</span><br>                    s = nums[i] + nums[j] + nums[k]<br>                    <span class="hljs-keyword">if</span> s == <span class="hljs-number">0</span>:<br>                        ans.append([nums[i], nums[j], nums[k]])<br>                        k = k - <span class="hljs-number">1</span><br>                        j = j + <span class="hljs-number">1</span><br>                    <span class="hljs-keyword">elif</span> s &gt; <span class="hljs-number">0</span>:<br>                        k = k - <span class="hljs-number">1</span><br>                    <span class="hljs-keyword">elif</span> s &lt; <span class="hljs-number">0</span>:<br>                        j = j + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="ÊúÄÊé•ËøëÁöÑ‰∏âÊï∞‰πãÂíå">16„ÄÅÊúÄÊé•ËøëÁöÑ‰∏âÊï∞‰πãÂíå</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/16.png" /></p><p>ÈááÁî®ÂèåÊåáÈíàÁöÑÊÄùÊÉ≥ÔºåÂÖàÂØπÊï∞ÁªÑËøõË°åÊéíÂ∫è„ÄÇÂΩìÁ°ÆÂÆö‰∫ÜÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÂè™ÈúÄË¶ÅÂØπÂâ©‰∏ãÂÖÉÁ¥†ËøõË°åËÆæÁΩÆÂ∑¶ÊåáÈíàÂíåÂè≥ÊåáÈíàÔºåÂ¶ÇÊûú‰∏âÂÖÉÁªÑ‰πãÂíåÂ§ß‰∫étargetÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÂ∞ÜÂè≥ËäÇÁÇπÂ∑¶Áßª‰∏Ä‰ΩçÔºåÁõ∏Âèç‰∫¶ÁÑ∂„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">threeSumClosest</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], target: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>        n = <span class="hljs-built_in">len</span>(nums)<br>        nums.sort()<br>        min_num = <span class="hljs-number">10</span>**<span class="hljs-number">9</span><br>        ans = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-keyword">if</span> i != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> nums[i] == nums[i - <span class="hljs-number">1</span>]:<br>                <span class="hljs-keyword">continue</span><br>            k = n - <span class="hljs-number">1</span><br>            j = i + <span class="hljs-number">1</span><br>            <span class="hljs-keyword">while</span> k &gt; j:<br>                s = nums[i] + nums[j] + nums[k]<br>                <span class="hljs-keyword">if</span> s == target:<br>                    <span class="hljs-keyword">return</span> s<br>                <span class="hljs-keyword">if</span> s &gt; target:<br>                    <span class="hljs-keyword">if</span> s - target &lt; min_num:<br>                        min_num = s - target<br>                        ans = s<br>                    k = k - <span class="hljs-number">1</span><br>                <span class="hljs-keyword">elif</span> s &lt; target:<br>                    <span class="hljs-keyword">if</span> target - s &lt; min_num:<br>                        min_num = target - s<br>                        ans = s<br>                    j = j + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="ÂõõÊï∞‰πãÂíå">18„ÄÅÂõõÊï∞‰πãÂíå</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/18.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fourSum</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], target: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]]:<br>        n = <span class="hljs-built_in">len</span>(nums)<br>        <span class="hljs-keyword">if</span> nums == [] <span class="hljs-keyword">or</span> n &lt; <span class="hljs-number">4</span>:<br>            <span class="hljs-keyword">return</span> []<br>        nums.sort()<br>        ans = <span class="hljs-built_in">list</span>()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">3</span>):<br>            <span class="hljs-keyword">if</span> i != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> nums[i] == nums[i - <span class="hljs-number">1</span>]:<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">if</span> nums[i] + nums[i + <span class="hljs-number">1</span>] + nums[i + <span class="hljs-number">2</span>] + nums[i + <span class="hljs-number">3</span>] &gt; target:<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">if</span> nums[i] + nums[n - <span class="hljs-number">1</span>] + nums[n - <span class="hljs-number">2</span>] + nums[n - <span class="hljs-number">3</span>] &lt; target:<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, n - <span class="hljs-number">2</span>):<br>                <span class="hljs-keyword">if</span> j != i + <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> nums[j] == nums[j - <span class="hljs-number">1</span>]:<br>                    <span class="hljs-keyword">continue</span><br>                <span class="hljs-keyword">if</span> nums[i] + nums[j] + nums[j + <span class="hljs-number">1</span>] + nums[j + <span class="hljs-number">2</span>] &gt; target:<br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">if</span> nums[i] + nums[n - <span class="hljs-number">1</span>] + nums[n - <span class="hljs-number">2</span>] + nums[n - <span class="hljs-number">3</span>] &lt; target:<br>                    <span class="hljs-keyword">continue</span><br>                k = j + <span class="hljs-number">1</span><br>                l = n - <span class="hljs-number">1</span><br>                <span class="hljs-keyword">while</span> k &lt; l:<br>                    <span class="hljs-built_in">sum</span> = nums[i] + nums[j] + nums[k] + nums[l]<br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">sum</span> &lt; target:<br>                        k = k + <span class="hljs-number">1</span><br>                    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">sum</span> &gt; target:<br>                        l = l - <span class="hljs-number">1</span><br>                    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">sum</span> == target:<br>                        ans.append([nums[i], nums[j], nums[k], nums[l]])<br>                        <span class="hljs-keyword">while</span> k &lt; l <span class="hljs-keyword">and</span> nums[k] == nums[k + <span class="hljs-number">1</span>]:<br>                            k = k + <span class="hljs-number">1</span><br>                        k = k + <span class="hljs-number">1</span><br>                        <span class="hljs-keyword">while</span> k &lt; l <span class="hljs-keyword">and</span> nums[l] == nums[l - <span class="hljs-number">1</span>]:<br>                            l = l - <span class="hljs-number">1</span><br>                        l = l - <span class="hljs-number">1</span> <br><br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="Âà†Èô§ÈìæË°®ÁöÑÂÄíÊï∞Á¨¨n‰∏™ÁªìÁÇπ">19„ÄÅÂà†Èô§ÈìæË°®ÁöÑÂÄíÊï∞Á¨¨N‰∏™ÁªìÁÇπ</h2><p><img src="/img/LeetCode/ÈìæË°®/19.png" /></p><p>ÈááÁî®ÂèåÊåáÈíàÁöÑÊÄùÊÉ≥ÔºåÂ∑¶Âè≥ÊåáÈíàÈÉΩ‰∏∫ÊåáÂêëÂ§¥ËäÇÁÇπÔºåÈ¶ñÂÖàÂè≥ÊåáÈíàÂêëÂêéÈÅçÂéÜn‰∏™ÁªìÁÇπÔºåÊúÄÂêéËÆ©Â∑¶Âè≥‰∏ÄËµ∑ÂêëÂêéÈÅçÂéÜÁõ¥Ëá≥Âè≥ÊåáÈíàÊåáÂêëÁöÑ‰∏∫ÊúÄÂêé‰∏Ä‰∏™ÁªìÁÇπÔºåËøôÊó∂ÂÄôÂ∑¶ÊåáÈíàÊåáÂêëÁöÑÂ∞±ÊòØÂÄíÊï∞Á¨¨n‰∏™ÁªìÁÇπÁöÑÂâç‰∏Ä‰∏™ÁªìÁÇπÔºåÂ∞±ÂèØ‰ª•ËøõË°åÂà†Èô§ÁöÑÊìç‰Ωú‰∫Ü„ÄÇ</p><p>‰ΩÜÊòØÊúâ‰∏Ä‰∏™ÁâπÊÆäÊÉÖÂÜµÔºåÂ¶ÇÊûúÂà†Èô§ÁöÑÊòØÂ§¥ÁªìÁÇπÔºå‰∏äËø∞‰∏çÊàêÁ´ãÔºåÊâÄ‰ª•Ë¶ÅÂçïÁã¨ËøõË°å‰∏Ä‰∏™ifÂà§Êñ≠ÔºåÂ¶ÇÊûúÂè≥ÊåáÈíàÂêëÂêéÈÅçÂéÜn‰∏™ÁªìÁÇπÂêé‰∏∫Á©∫ÔºåÈÇ£‰πàÂà†Èô§ÁöÑÂ∞±ÊòØÂ§¥ÁªìÁÇπ„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Definition for singly-linked list.</span><br><span class="hljs-comment"># class ListNode:</span><br><span class="hljs-comment">#     def __init__(self, val=0, next=None):</span><br><span class="hljs-comment">#         self.val = val</span><br><span class="hljs-comment">#         self.next = next</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">removeNthFromEnd</span>(<span class="hljs-params">self, head: ListNode, n: <span class="hljs-built_in">int</span></span>) -&gt; ListNode:<br>        right = head<br>        left = head<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            right = right.<span class="hljs-built_in">next</span><br>        <span class="hljs-keyword">if</span> right == <span class="hljs-literal">None</span>:<span class="hljs-comment"># Â¶ÇÊûúË¶ÅÂà†Èô§ÁöÑÊòØÂ§¥ÁªìÁÇπ</span><br>            left = left.<span class="hljs-built_in">next</span><br>            <span class="hljs-keyword">return</span> left<br>        <span class="hljs-keyword">while</span> right.<span class="hljs-built_in">next</span> != <span class="hljs-literal">None</span>:<br>            left = left.<span class="hljs-built_in">next</span><br>            right = right.<span class="hljs-built_in">next</span><br>        left.<span class="hljs-built_in">next</span> = left.<span class="hljs-built_in">next</span>.<span class="hljs-built_in">next</span><br>        <span class="hljs-keyword">return</span> head<br></code></pre></div></td></tr></table></figure><h2 id="Âà†Èô§ÊúâÂ∫èÊï∞ÁªÑ‰∏≠ÁöÑÈáçÂ§çÈ°π">26„ÄÅÂà†Èô§ÊúâÂ∫èÊï∞ÁªÑ‰∏≠ÁöÑÈáçÂ§çÈ°π</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/26.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">removeDuplicates</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:<br>        <span class="hljs-keyword">if</span> nums == []:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        n = <span class="hljs-built_in">len</span>(nums)<br>        left, right = <span class="hljs-number">1</span>, <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> right &lt; n:<br>            <span class="hljs-keyword">if</span> nums[right] != nums[right - <span class="hljs-number">1</span>]:<br>                nums[left] = nums[right]<br>                left = left + <span class="hljs-number">1</span><br>            right = right + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> left<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>LeetCode</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Âä®ÊÄÅËßÑÂàí</title>
    <link href="/2022/04/29/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
    <url>/2022/04/29/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/</url>
    
    <content type="html"><![CDATA[<h2 id="ÊúÄÈïøÂõûÊñáÂ≠ê‰∏≤">4„ÄÅÊúÄÈïøÂõûÊñáÂ≠ê‰∏≤</h2><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/2.png" /></p><p>Êú¨È¢ò‰ΩøÁî®ÁöÑÂä®ÊÄÅËßÑÂàíÁöÑÊÄùÊÉ≥Ôºå‰πüÂ∞±ÊòØËØ¥Âè™Êúâs[i+1:j-1]<em>s</em>[<em>i</em>+1:<em>j</em>‚àí1] ÊòØÂõûÊñá‰∏≤ÔºåÂπ∂‰∏îs<em>s</em> ÁöÑÁ¨¨ i<em>i</em> Âíå j<em>j</em>‰∏™Â≠óÊØçÁõ∏ÂêåÊó∂Ôºås[i:j]<em>s</em>[<em>i</em>:<em>j</em>] Êâç‰ºöÊòØÂõûÊñá‰∏≤„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">longestPalindrome</span>(<span class="hljs-params">self, s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>        n = <span class="hljs-built_in">len</span>(s)<br>        <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:  <span class="hljs-comment"># Â¶ÇÊûúÂ≠óÁ¨¶‰∏≤Èïø‰∏∫1</span><br>            <span class="hljs-keyword">return</span> s<br>        <br>        <span class="hljs-built_in">max</span> = <span class="hljs-number">1</span><br>        left = <span class="hljs-number">0</span><br>        <span class="hljs-comment"># dp[i][j]‰ª£Ë°®ÊòØs[i...j]ÊòØÂê¶‰∏∫ÂõûÊñá‰∏≤</span><br>        dp = [[<span class="hljs-literal">False</span>] * n <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            dp[i][i] = <span class="hljs-literal">True</span><br><br>        <span class="hljs-keyword">for</span> L <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, n + <span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>                right = L + i - <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> right &gt;= n:<br>                    <span class="hljs-keyword">break</span><br>                <br>                <span class="hljs-keyword">if</span> s[i] != s[right]:<br>                    dp[i][right] = <span class="hljs-literal">False</span><br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-keyword">if</span> right - i &lt; <span class="hljs-number">3</span>:<br>                        dp[i][right] = <span class="hljs-literal">True</span><br>                    <span class="hljs-keyword">else</span>:<br>                        dp[i][right] = dp[i + <span class="hljs-number">1</span>][right - <span class="hljs-number">1</span>]<br><br>                <span class="hljs-keyword">if</span> dp[i][right] <span class="hljs-keyword">and</span> L &gt; <span class="hljs-built_in">max</span>:<br>                    <span class="hljs-built_in">max</span> = L<br>                    left = i<br>        <span class="hljs-keyword">return</span> s[left:left+<span class="hljs-built_in">max</span>]<br></code></pre></div></td></tr></table></figure><h2 id="ÊúÄÂ§ßÂ≠êÊï∞ÁªÑÂíå">53„ÄÅÊúÄÂ§ßÂ≠êÊï∞ÁªÑÂíå</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/53.png" /></p><p>ÁúãÂà∞ËøôÁßçÂå∫Èó¥ÁöÑÔºåÂèØ‰ª•ÊÉ≥Âà∞Âä®ÊÄÅËßÑÂàí</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">maxSubArray</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(nums)):<br>            nums[i] += <span class="hljs-built_in">max</span>(nums[i - <span class="hljs-number">1</span>], <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(nums)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>LeetCode</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Â≠óÁ¨¶‰∏≤</title>
    <link href="/2022/04/29/%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    <url>/2022/04/29/%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
    
    <content type="html"><![CDATA[<h2 id="Êó†ÈáçÂ§çÂ≠óÁ¨¶ÁöÑÊúÄÈïøÂ≠ê‰∏≤">3„ÄÅÊó†ÈáçÂ§çÂ≠óÁ¨¶ÁöÑÊúÄÈïøÂ≠ê‰∏≤</h2><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/1.png" /></p><p>ÊñπÊ≥ï‰∏ÄÔºöÊö¥ÂäõËß£</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lengthOfLongestSubstring</span>(<span class="hljs-params">self, s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>        occ = <span class="hljs-built_in">set</span>()<br>        n = <span class="hljs-built_in">len</span>(s)<br>        <span class="hljs-comment"># rk‰∏∫Â∑¶ÊåáÈíàÔºåans‰∏∫Êó†ÈáçÂ§çÂ≠ê‰∏≤ÈïøÂ∫¶</span><br>        rk, ans = -<span class="hljs-number">1</span>, <span class="hljs-number">0</span><br>        flag = <span class="hljs-number">0</span>    <span class="hljs-comment"># Âæ™ÁéØ‰∏≠Êó†ÈáçÂ§çÂ≠ê‰∏≤ÈïøÂ∫¶</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            rk = i<br>            flag = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">while</span> rk &lt; n <span class="hljs-keyword">and</span> s[rk] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> occ:<br>                occ.add(s[rk])<br>                flag = flag + <span class="hljs-number">1</span><br>                rk = rk + <span class="hljs-number">1</span><br>            ans = flag <span class="hljs-keyword">if</span> flag &gt; ans <span class="hljs-keyword">else</span> ans<br>            occ.clear()<br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><p>ÊñπÊ≥ï‰∫åÔºö</p><p>ÊØèÊ¨°Âæ™ÁéØÊ≤°ÂøÖË¶ÅÊääÈõÜÂêàÈáåÁöÑÂÖÉÁ¥†ÂÖ®ÈÉ®Âà†Èô§ÔºåÂèØ‰ª•ÊØèÊ¨°Âè™Âà†Èô§‰∏ä‰∏ÄËΩÆÂæ™ÁéØÁöÑÊúÄÂ∑¶ËæπÁªìÁÇπ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lengthOfLongestSubstring</span>(<span class="hljs-params">self, s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>        occ = <span class="hljs-built_in">set</span>()<br>        n = <span class="hljs-built_in">len</span>(s)<br>        <span class="hljs-comment"># rk‰∏∫Â∑¶ÊåáÈíàÔºåans‰∏∫Êó†ÈáçÂ§çÂ≠ê‰∏≤ÈïøÂ∫¶</span><br>        rk, ans = <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>        flag = <span class="hljs-number">0</span>    <span class="hljs-comment"># Âæ™ÁéØ‰∏≠Êó†ÈáçÂ§çÂ≠ê‰∏≤ÈïøÂ∫¶</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-keyword">if</span> i &gt; <span class="hljs-number">0</span>:<br>                occ.remove(s[i - <span class="hljs-number">1</span>])<br>                flag = flag - <span class="hljs-number">1</span><br>            <span class="hljs-keyword">while</span> rk &lt; n <span class="hljs-keyword">and</span> s[rk] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> occ:<br>                occ.add(s[rk])<br>                rk = rk + <span class="hljs-number">1</span><br>                flag = flag + <span class="hljs-number">1</span><br>            ans = flag <span class="hljs-keyword">if</span> flag &gt; ans <span class="hljs-keyword">else</span> ans<br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="ÊúÄÈïøÂõûÊñáÂ≠ê‰∏≤">4„ÄÅÊúÄÈïøÂõûÊñáÂ≠ê‰∏≤</h2><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/2.png" /></p><p>Êú¨È¢ò‰ΩøÁî®ÁöÑÂä®ÊÄÅËßÑÂàíÁöÑÊÄùÊÉ≥Ôºå‰πüÂ∞±ÊòØËØ¥Âè™Êúâs[i+1:j-1]<em>s</em>[<em>i</em>+1:<em>j</em>‚àí1] ÊòØÂõûÊñá‰∏≤ÔºåÂπ∂‰∏îs<em>s</em> ÁöÑÁ¨¨ i<em>i</em> Âíå j<em>j</em>‰∏™Â≠óÊØçÁõ∏ÂêåÊó∂Ôºås[i:j]<em>s</em>[<em>i</em>:<em>j</em>] Êâç‰ºöÊòØÂõûÊñá‰∏≤„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">longestPalindrome</span>(<span class="hljs-params">self, s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>        n = <span class="hljs-built_in">len</span>(s)<br>        <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:  <span class="hljs-comment"># Â¶ÇÊûúÂ≠óÁ¨¶‰∏≤Èïø‰∏∫1</span><br>            <span class="hljs-keyword">return</span> s<br>        <br>        <span class="hljs-built_in">max</span> = <span class="hljs-number">1</span><br>        left = <span class="hljs-number">0</span><br>        <span class="hljs-comment"># dp[i][j]‰ª£Ë°®ÊòØs[i...j]ÊòØÂê¶‰∏∫ÂõûÊñá‰∏≤</span><br>        dp = [[<span class="hljs-literal">False</span>] * n <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            dp[i][i] = <span class="hljs-literal">True</span><br><br>        <span class="hljs-keyword">for</span> L <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, n + <span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>                right = L + i - <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> right &gt;= n:<br>                    <span class="hljs-keyword">break</span><br>                <br>                <span class="hljs-keyword">if</span> s[i] != s[right]:<br>                    dp[i][right] = <span class="hljs-literal">False</span><br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-keyword">if</span> right - i &lt; <span class="hljs-number">3</span>:<br>                        dp[i][right] = <span class="hljs-literal">True</span><br>                    <span class="hljs-keyword">else</span>:<br>                        dp[i][right] = dp[i + <span class="hljs-number">1</span>][right - <span class="hljs-number">1</span>]<br><br>                <span class="hljs-keyword">if</span> dp[i][right] <span class="hljs-keyword">and</span> L &gt; <span class="hljs-built_in">max</span>:<br>                    <span class="hljs-built_in">max</span> = L<br>                    left = i<br>        <span class="hljs-keyword">return</span> s[left:left+<span class="hljs-built_in">max</span>]<br></code></pre></div></td></tr></table></figure><h2 id="zÂ≠óÂΩ¢ÂèòÊç¢">6„ÄÅZÂ≠óÂΩ¢ÂèòÊç¢</h2><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/3.png" /></p><p>‰ΩøÁî®‰∫åÁª¥Áü©ÈòµËøõË°åÊ®°ÊãüÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">convert</span>(<span class="hljs-params">self, s: <span class="hljs-built_in">str</span>, numRows: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>        n = <span class="hljs-built_in">len</span>(s)<br>        <span class="hljs-keyword">if</span> numRows == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> numRows &gt;= n:<br>            <span class="hljs-keyword">return</span> s<br>        t = <span class="hljs-number">2</span> * numRows - <span class="hljs-number">2</span><br>        col = (n + t - <span class="hljs-number">1</span>) // t * (numRows - <span class="hljs-number">1</span>)<br>        matrix = [[<span class="hljs-string">&#x27;&#x27;</span>] * col <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(numRows)]<br>        x, y = <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i, ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(s):<br>            matrix[x][y] = ch<br>            <span class="hljs-keyword">if</span> i % t &lt; numRows - <span class="hljs-number">1</span>:<br>                x = x + <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                x = x - <span class="hljs-number">1</span><br>                y = y + <span class="hljs-number">1</span><br>        ans = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(numRows):<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(col):<br>                <span class="hljs-keyword">if</span> matrix[i][j]:<br>                    ans = ans + matrix[i][j]<br><br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="Â≠óÁ¨¶‰∏≤ËΩ¨Êç¢Êï¥Êï∞">7„ÄÅÂ≠óÁ¨¶‰∏≤ËΩ¨Êç¢Êï¥Êï∞</h2><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/4.png" /></p><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/5.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">myAtoi</span>(<span class="hljs-params">self, s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>        flag = <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">if</span> s == <span class="hljs-string">&#x27;&#x27;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i, ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(s):<br>            <span class="hljs-keyword">if</span> ch != <span class="hljs-string">&#x27; &#x27;</span>:<br>                s = s[i:]<br>                <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">if</span> s[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;-&#x27;</span>:<br>            flag = <span class="hljs-literal">True</span><br>            s = s[<span class="hljs-number">1</span>:]<br>        <span class="hljs-keyword">elif</span> s[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;+&#x27;</span>:<br>            s = s[<span class="hljs-number">1</span>:]<br>        a = <span class="hljs-number">0</span><br>        ans = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i, ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(s):<br>            <span class="hljs-keyword">if</span> ch.isdigit() == <span class="hljs-literal">False</span>:<br>                <span class="hljs-keyword">break</span><br>            a = <span class="hljs-built_in">int</span>(ch)<br>            ans = ans * <span class="hljs-number">10</span> + a<br>        <span class="hljs-keyword">if</span> flag:<br>            ans = -<span class="hljs-number">1</span> * ans<br>        <span class="hljs-keyword">if</span> ans &gt; <span class="hljs-number">2</span> ** <span class="hljs-number">31</span> - <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> ** <span class="hljs-number">31</span> - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> ans &lt; -(<span class="hljs-number">2</span> ** <span class="hljs-number">31</span>):<br>            <span class="hljs-keyword">return</span> -(<span class="hljs-number">2</span> ** <span class="hljs-number">31</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="ÊúÄÈïøÂÖ¨ÂÖ±ÂâçÁºÄ">14„ÄÅÊúÄÈïøÂÖ¨ÂÖ±ÂâçÁºÄ</h2><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/6.png" /></p><p>ÊÉ≥Ê≥ï‰∏∫Ê®™ÂêëÂØπÊØîÔºåÊåâÁÖßÂàóË°®È°∫Â∫èÂºÄÂßãÈÄêÊ≠•ÁÆóÊ≥ïÂâçx‰∏™Â≠óÁ¨¶‰∏≤ÁöÑÊúÄÈïøÂâçÁºÄÔºåÁõ¥Ëá≥ÂæóÂà∞ÊúÄÁªàÁöÑÊúÄÈïøÂâçÁºÄ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">longestCommonPrefix</span>(<span class="hljs-params">self, strs: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        flag = strs[<span class="hljs-number">0</span>]<span class="hljs-comment"># ÂâçÂá†‰∏™Â≠óÁ¨¶‰∏≤ÁöÑÊúÄÈïøÂâçÁºÄ</span><br>        a = <span class="hljs-string">&quot;&quot;</span><span class="hljs-comment"># Êú¨Â≠óÁ¨¶‰∏≤‰∏éflagÁöÑÊúÄÈïøÂâçÁºÄ</span><br>        ans = <span class="hljs-string">&quot;&quot;</span><br>        n = <span class="hljs-built_in">len</span>(strs)<br>        <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span>:<span class="hljs-comment"># Â¶ÇÊûúÂè™Êúâ‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÔºåÈÇ£Â∞±Áõ¥Êé•ËæìÂá∫</span><br>            <span class="hljs-keyword">return</span> strs[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">for</span> i, s <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(strs):<br>            <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>:<span class="hljs-comment"># Â¶ÇÊûúÊòØÁ¨¨‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÈÇ£Â∞±Ë∑≥Ëøá</span><br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">for</span> j, ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(s):<span class="hljs-comment"># Êú¨Â≠óÁ¨¶‰∏≤‰∏éflagËøõË°åÊØîÂØπ</span><br>                <span class="hljs-keyword">if</span> j &lt; <span class="hljs-built_in">len</span>(flag) <span class="hljs-keyword">and</span> ch == flag[j]:<br>                    a = a + ch<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-keyword">break</span><br>            flag = a<br>            a = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-keyword">if</span> i == n - <span class="hljs-number">1</span>:<span class="hljs-comment"># Â¶ÇÊûúÊòØÊúÄÂêé‰∏Ä‰∏™ÁªìÁÇπÔºåÈÇ£Â∞±ÊòØÊúÄÁªàÊúÄÈïøÂâçÁºÄ‰∫Ü</span><br>                ans = flag<br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="ÁîµËØùÂè∑Á†ÅÁöÑÂ≠óÊØçÁªÑÂêà">17„ÄÅÁîµËØùÂè∑Á†ÅÁöÑÂ≠óÊØçÁªÑÂêà</h2><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/17.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">letterCombinations</span>(<span class="hljs-params">self, digits: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:<br>        <span class="hljs-keyword">if</span> digits == <span class="hljs-string">&#x27;&#x27;</span>:<br>            <span class="hljs-keyword">return</span> []<br><br>        phoneMap = &#123;<br>        <span class="hljs-string">&#x27;2&#x27;</span>: <span class="hljs-string">&#x27;abc&#x27;</span>,<br>        <span class="hljs-string">&#x27;3&#x27;</span>: <span class="hljs-string">&#x27;def&#x27;</span>,<br>        <span class="hljs-string">&#x27;4&#x27;</span>: <span class="hljs-string">&#x27;ghi&#x27;</span>,<br>        <span class="hljs-string">&#x27;5&#x27;</span>: <span class="hljs-string">&#x27;jkl&#x27;</span>,<br>        <span class="hljs-string">&#x27;6&#x27;</span>: <span class="hljs-string">&#x27;mno&#x27;</span>,<br>        <span class="hljs-string">&#x27;7&#x27;</span>: <span class="hljs-string">&#x27;pqrs&#x27;</span>,<br>        <span class="hljs-string">&#x27;8&#x27;</span>: <span class="hljs-string">&#x27;tuv&#x27;</span>,<br>        <span class="hljs-string">&#x27;9&#x27;</span>: <span class="hljs-string">&#x27;wxyz&#x27;</span>,   <br>        &#125;<br>        <br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">backtrack</span>(<span class="hljs-params">index: <span class="hljs-built_in">int</span></span>):<span class="hljs-comment"># ÂõûÊ∫Ø</span><br>            <span class="hljs-keyword">if</span> index == <span class="hljs-built_in">len</span>(digits):<br>                combinations.append(<span class="hljs-string">&#x27;&#x27;</span>.join(combination))<br>            <span class="hljs-keyword">else</span>:<br>                digit = digits[index]<br>                <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> phoneMap[digit]:<br>                    combination.append(ch)<br>                    backtrack(index + <span class="hljs-number">1</span>)<br>                    combination.pop()<br><br>        combination = <span class="hljs-built_in">list</span>()<br>        combinations = <span class="hljs-built_in">list</span>()<br>        backtrack(<span class="hljs-number">0</span>)<br><br>        <span class="hljs-keyword">return</span> combinations<br></code></pre></div></td></tr></table></figure><h2 id="ÊúâÊïàÁöÑÊã¨Âè∑">20„ÄÅÊúâÊïàÁöÑÊã¨Âè∑</h2><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/20.png" /></p><p>ÈááÁî®‰∫ÜÊ†àÁöÑÊÄùÊÉ≥ÔºåÂ∞ÜÁ¨¶Âè∑‰æùÊ¨°ÂÖ•Ê†àËøõË°åÂà§Êñ≠</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">isValid</span>(<span class="hljs-params">self, s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:<br>        stack = <span class="hljs-built_in">list</span>()<br>        <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> s:<br>            <span class="hljs-keyword">if</span> ch == <span class="hljs-string">&#x27;)&#x27;</span>:<br>                <span class="hljs-keyword">if</span> stack == []:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>                temp = stack.pop()<br>                <span class="hljs-keyword">if</span> temp != <span class="hljs-string">&#x27;(&#x27;</span>:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">elif</span> ch == <span class="hljs-string">&#x27;&#125;&#x27;</span>:<br>                <span class="hljs-keyword">if</span> stack == []:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>                temp = stack.pop()<br>                <span class="hljs-keyword">if</span> temp != <span class="hljs-string">&#x27;&#123;&#x27;</span>:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">elif</span> ch == <span class="hljs-string">&#x27;]&#x27;</span>:<br>                <span class="hljs-keyword">if</span> stack == []:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>                temp = stack.pop()<br>                <span class="hljs-keyword">if</span> temp != <span class="hljs-string">&#x27;[&#x27;</span>:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">else</span>:<br>                stack.append(ch)<br>        <span class="hljs-keyword">if</span> stack:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br></code></pre></div></td></tr></table></figure><h2 id="ÂêàÂπ∂‰∏§‰∏™ÊúâÂ∫èÈìæË°®">21„ÄÅÂêàÂπ∂‰∏§‰∏™ÊúâÂ∫èÈìæË°®</h2><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/21.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Definition for singly-linked list.</span><br><span class="hljs-comment"># class ListNode:</span><br><span class="hljs-comment">#     def __init__(self, val=0, next=None):</span><br><span class="hljs-comment">#         self.val = val</span><br><span class="hljs-comment">#         self.next = next</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mergeTwoLists</span>(<span class="hljs-params">self, list1: <span class="hljs-type">Optional</span>[ListNode], list2: <span class="hljs-type">Optional</span>[ListNode]</span>) -&gt; <span class="hljs-type">Optional</span>[ListNode]:<br>        head = ListNode(<span class="hljs-number">0</span>, <span class="hljs-literal">None</span>)<br>        temp = head<br>        first = list1<br>        second = list2<br>        <span class="hljs-keyword">while</span> first <span class="hljs-keyword">and</span> second:<br>            <span class="hljs-keyword">if</span> first.val &lt;= second.val:<br>                temp.<span class="hljs-built_in">next</span> = first<br>                temp = temp.<span class="hljs-built_in">next</span><br>                first = first.<span class="hljs-built_in">next</span><br>            <span class="hljs-keyword">elif</span> first.val &gt; second.val:<br>                temp.<span class="hljs-built_in">next</span> = second<br>                temp = temp.<span class="hljs-built_in">next</span><br>                second = second.<span class="hljs-built_in">next</span><br>        <br>        temp.<span class="hljs-built_in">next</span> = first <span class="hljs-keyword">if</span> first <span class="hljs-keyword">else</span> second<br>        <br>        <span class="hljs-keyword">return</span> head.<span class="hljs-built_in">next</span><br></code></pre></div></td></tr></table></figure><h2 id="Êã¨Âè∑ÁîüÊàê">22„ÄÅÊã¨Âè∑ÁîüÊàê</h2><p><img src="/img/LeetCode/Â≠óÁ¨¶‰∏≤/22.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generateParenthesis</span>(<span class="hljs-params">self, n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:<br>        ans = []<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">backtrack</span>(<span class="hljs-params">S, left, right</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(S) == <span class="hljs-number">2</span> * n:<br>                ans.append(<span class="hljs-string">&#x27;&#x27;</span>.join(S))<br>                <span class="hljs-keyword">return</span><br>            <span class="hljs-keyword">if</span> left &lt; n:<br>                S.append(<span class="hljs-string">&#x27;(&#x27;</span>)<br>                backtrack(S, left + <span class="hljs-number">1</span>, right)<br>                S.pop()<br>            <span class="hljs-keyword">if</span> right &lt; left:<br>                S.append(<span class="hljs-string">&#x27;)&#x27;</span>)<br>                backtrack(S, left, right + <span class="hljs-number">1</span>)<br>                S.pop()<br>        backtrack([], <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>LeetCode</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ÂìàÂ∏åË°®</title>
    <link href="/2022/04/28/%E5%93%88%E5%B8%8C%E8%A1%A8/"/>
    <url>/2022/04/28/%E5%93%88%E5%B8%8C%E8%A1%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="‰∏§Êï∞Áõ∏Âä†">1„ÄÅ‰∏§Êï∞Áõ∏Âä†</h2><p><img src="/img/LeetCode/ÂìàÂ∏åË°®/1.png" /></p><p>ËøôÊ†∑Êàë‰ª¨ÂàõÂª∫‰∏Ä‰∏™ÂìàÂ∏åË°®ÔºåÂØπ‰∫éÊØè‰∏Ä‰∏™<code>x</code>ÔºåÊàë‰ª¨È¶ñÂÖàÊü•ËØ¢ÂìàÂ∏åË°®‰∏≠ÊòØÂê¶Â≠òÂú®<code>target - x</code>ÔºåÁÑ∂ÂêéÂ∞Ü <code>x</code>ÊèíÂÖ•Âà∞ÂìàÂ∏åË°®‰∏≠ÔºåÂç≥ÂèØ‰øùËØÅ‰∏ç‰ºöËÆ© <code>x</code> ÂíåËá™Â∑±ÂåπÈÖç„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">twoSum</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], target: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>        hashtable = <span class="hljs-built_in">dict</span>()<br>        <span class="hljs-keyword">for</span> i, num <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(nums):<br>            <span class="hljs-keyword">if</span> target - num <span class="hljs-keyword">in</span> hashtable:<br>                <span class="hljs-keyword">return</span> [hashtable[target - num], i]<br>            <span class="hljs-keyword">else</span>:<br>                hashtable[num] = i<br>        <span class="hljs-keyword">return</span> []<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>LeetCode</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ÈìæË°®</title>
    <link href="/2022/04/28/%E9%93%BE%E8%A1%A8/"/>
    <url>/2022/04/28/%E9%93%BE%E8%A1%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="‰∏§Êï∞Áõ∏Âä†">2„ÄÅ‰∏§Êï∞Áõ∏Âä†</h2><p><img src="/img/LeetCode/ÈìæË°®/2.png" /></p><p>ÈááÁî®ÈÄíÂΩíÁöÑÊÄùÊÉ≥ÔºåÂΩìÊüê‰∏™ÈìæË°®ÂΩìÂâçËäÇÁÇπÂ≠òÂú®‰∏ã‰∏Ä‰∏™ËäÇÁÇπÊàñËøõ‰ΩçÁ¨¶‰∏∫1Êó∂ÔºåÂæÄ‰∏ãÈÄíÂΩí„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Definition for singly-linked list.</span><br><span class="hljs-comment"># class ListNode:</span><br><span class="hljs-comment">#     def __init__(self, val=0, next=None):</span><br><span class="hljs-comment">#         self.val = val</span><br><span class="hljs-comment">#         self.next = next</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">addTwoNumbers</span>(<span class="hljs-params">self, l1: <span class="hljs-type">Optional</span>[ListNode], l2: <span class="hljs-type">Optional</span>[ListNode], carryflag = <span class="hljs-number">0</span></span>) -&gt; <span class="hljs-type">Optional</span>[ListNode]:<br>        n1, n2 = l1.val <span class="hljs-keyword">if</span> l1 <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>, l2.val <span class="hljs-keyword">if</span> l2 <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>        s = n1 + n2 + carryflag<br>        val, carry_flag = s % <span class="hljs-number">10</span>, <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> s &gt; <span class="hljs-number">9</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>        next1, next2 = l1.<span class="hljs-built_in">next</span> <span class="hljs-keyword">if</span> l1 <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>, l2.<span class="hljs-built_in">next</span> <span class="hljs-keyword">if</span> l2 <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">if</span> next1 <span class="hljs-keyword">or</span> next2 <span class="hljs-keyword">or</span> carry_flag:<br>            <span class="hljs-keyword">return</span> ListNode(val, self.addTwoNumbers(next1, next2, carry_flag))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> ListNode(val)<br></code></pre></div></td></tr></table></figure><h2 id="Âà†Èô§ÈìæË°®ÁöÑÂÄíÊï∞Á¨¨n‰∏™ÁªìÁÇπ">19„ÄÅÂà†Èô§ÈìæË°®ÁöÑÂÄíÊï∞Á¨¨N‰∏™ÁªìÁÇπ</h2><p><img src="/img/LeetCode/ÈìæË°®/19.png" /></p><p>ÈááÁî®ÂèåÊåáÈíàÁöÑÊÄùÊÉ≥ÔºåÂ∑¶Âè≥ÊåáÈíàÈÉΩ‰∏∫ÊåáÂêëÂ§¥ËäÇÁÇπÔºåÈ¶ñÂÖàÂè≥ÊåáÈíàÂêëÂêéÈÅçÂéÜn‰∏™ÁªìÁÇπÔºåÊúÄÂêéËÆ©Â∑¶Âè≥‰∏ÄËµ∑ÂêëÂêéÈÅçÂéÜÁõ¥Ëá≥Âè≥ÊåáÈíàÊåáÂêëÁöÑ‰∏∫ÊúÄÂêé‰∏Ä‰∏™ÁªìÁÇπÔºåËøôÊó∂ÂÄôÂ∑¶ÊåáÈíàÊåáÂêëÁöÑÂ∞±ÊòØÂÄíÊï∞Á¨¨n‰∏™ÁªìÁÇπÁöÑÂâç‰∏Ä‰∏™ÁªìÁÇπÔºåÂ∞±ÂèØ‰ª•ËøõË°åÂà†Èô§ÁöÑÊìç‰Ωú‰∫Ü„ÄÇ</p><p>‰ΩÜÊòØÊúâ‰∏Ä‰∏™ÁâπÊÆäÊÉÖÂÜµÔºåÂ¶ÇÊûúÂà†Èô§ÁöÑÊòØÂ§¥ÁªìÁÇπÔºå‰∏äËø∞‰∏çÊàêÁ´ãÔºåÊâÄ‰ª•Ë¶ÅÂçïÁã¨ËøõË°å‰∏Ä‰∏™ifÂà§Êñ≠ÔºåÂ¶ÇÊûúÂè≥ÊåáÈíàÂêëÂêéÈÅçÂéÜn‰∏™ÁªìÁÇπÂêé‰∏∫Á©∫ÔºåÈÇ£‰πàÂà†Èô§ÁöÑÂ∞±ÊòØÂ§¥ÁªìÁÇπ„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Definition for singly-linked list.</span><br><span class="hljs-comment"># class ListNode:</span><br><span class="hljs-comment">#     def __init__(self, val=0, next=None):</span><br><span class="hljs-comment">#         self.val = val</span><br><span class="hljs-comment">#         self.next = next</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">removeNthFromEnd</span>(<span class="hljs-params">self, head: ListNode, n: <span class="hljs-built_in">int</span></span>) -&gt; ListNode:<br>        right = head<br>        left = head<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            right = right.<span class="hljs-built_in">next</span><br>        <span class="hljs-keyword">if</span> right == <span class="hljs-literal">None</span>:<span class="hljs-comment"># Â¶ÇÊûúË¶ÅÂà†Èô§ÁöÑÊòØÂ§¥ÁªìÁÇπ</span><br>            left = left.<span class="hljs-built_in">next</span><br>            <span class="hljs-keyword">return</span> left<br>        <span class="hljs-keyword">while</span> right.<span class="hljs-built_in">next</span> != <span class="hljs-literal">None</span>:<br>            left = left.<span class="hljs-built_in">next</span><br>            right = right.<span class="hljs-built_in">next</span><br>        left.<span class="hljs-built_in">next</span> = left.<span class="hljs-built_in">next</span>.<span class="hljs-built_in">next</span><br>        <span class="hljs-keyword">return</span> head<br></code></pre></div></td></tr></table></figure><h2 id="‰∫Æ‰∫Æ‰∫§Êç¢ÈìæË°®‰∏≠ÁöÑÁªìÁÇπ">24„ÄÅ‰∫Æ‰∫Æ‰∫§Êç¢ÈìæË°®‰∏≠ÁöÑÁªìÁÇπ</h2><p><img src="/img/LeetCode/ÈìæË°®/24.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Definition for singly-linked list.</span><br><span class="hljs-comment"># class ListNode:</span><br><span class="hljs-comment">#     def __init__(self, val=0, next=None):</span><br><span class="hljs-comment">#         self.val = val</span><br><span class="hljs-comment">#         self.next = next</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">swapPairs</span>(<span class="hljs-params">self, head: ListNode</span>) -&gt; ListNode:<br>        <span class="hljs-keyword">if</span> head == <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> head<br>        temp = ListNode(<span class="hljs-number">0</span>, head)<br>        first = temp<br>        second = temp.<span class="hljs-built_in">next</span><br><br>        <span class="hljs-keyword">while</span> second <span class="hljs-keyword">and</span> second.<span class="hljs-built_in">next</span>:<br>            first.<span class="hljs-built_in">next</span> = second.<span class="hljs-built_in">next</span><br>            second.<span class="hljs-built_in">next</span> = second.<span class="hljs-built_in">next</span>.<span class="hljs-built_in">next</span><br>            first.<span class="hljs-built_in">next</span>.<span class="hljs-built_in">next</span> = second<br>            <br>            first = second<br>            second = second.<span class="hljs-built_in">next</span><br>        <span class="hljs-keyword">return</span> temp.<span class="hljs-built_in">next</span><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>LeetCode</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Êï∞ÁªÑÂèäÊï∞Â≠¶</title>
    <link href="/2022/04/28/%E6%95%B0%E7%BB%84%E5%8F%8A%E6%95%B0%E5%AD%A6/"/>
    <url>/2022/04/28/%E6%95%B0%E7%BB%84%E5%8F%8A%E6%95%B0%E5%AD%A6/</url>
    
    <content type="html"><![CDATA[<h2 id="Êï¥Êï∞ÂèçËΩ¨">7„ÄÅÊï¥Êï∞ÂèçËΩ¨</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/1.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">self, x: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>        ans = <span class="hljs-number">0</span><br>        flag = <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">if</span> x &lt; <span class="hljs-number">0</span>:<br>            flag = <span class="hljs-literal">True</span><br>            x = -<span class="hljs-number">1</span> * x<br>        a = <span class="hljs-number">0</span>   <span class="hljs-comment"># Èô§Ê≥ï‰ΩôÊï∞</span><br>        <span class="hljs-keyword">while</span> x != <span class="hljs-number">0</span>:<br>            a = x % <span class="hljs-number">10</span><br>            x = x // <span class="hljs-number">10</span><br>            ans = ans * <span class="hljs-number">10</span> + a<br>        <span class="hljs-keyword">if</span> flag:<br>            ans = -<span class="hljs-number">1</span> * ans<br>        <span class="hljs-keyword">if</span> ans &gt; <span class="hljs-number">2</span> ** <span class="hljs-number">31</span> - <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> ans &lt; -(<span class="hljs-number">2</span> ** <span class="hljs-number">31</span>):<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="ÂõûÊñáÊï∞">9„ÄÅÂõûÊñáÊï∞</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/2.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">isPalindrome</span>(<span class="hljs-params">self, x: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">bool</span>:<br>        <span class="hljs-keyword">if</span> x &lt; <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        a = self.reverse(x) <span class="hljs-comment"># Êï¥Êï∞ÂèçËΩ¨</span><br>        <span class="hljs-keyword">if</span> a == x:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">self, x: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>        ans = <span class="hljs-number">0</span><br>        a = <span class="hljs-number">0</span>   <span class="hljs-comment"># Èô§Ê≥ï‰ΩôÊï∞</span><br>        <span class="hljs-keyword">while</span> x != <span class="hljs-number">0</span>:<br>            a = x % <span class="hljs-number">10</span><br>            x = x // <span class="hljs-number">10</span><br>            ans = ans * <span class="hljs-number">10</span> + a<br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="ÁõõÊ∞¥ÊúÄÂ§öÁöÑÂÆπÂô®">11„ÄÅÁõõÊ∞¥ÊúÄÂ§öÁöÑÂÆπÂô®</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/3.png" /></p><p>Êàë‰ª¨‰ΩøÁî®ÂèåÊåáÈíàÁöÑÊÄùÊÉ≥Ôºå‰∏§‰∏™ÊåáÈíàÂàÜÂà´‰∏∫Êï∞ÁªÑÁöÑÂ§¥Â∞æÁªìÁÇπÔºåÊØèËΩÆÈÉΩËøõË°åÈù¢ÁßØÁöÑËÆ°ÁÆóÔºåÂπ∂‰∏îÊØèËΩÆÂè™ÁßªÂä®ËæÉÂ∞èÁªìÁÇπÁöÑÊåáÈíà„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">maxArea</span>(<span class="hljs-params">self, height: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:<br>        n = <span class="hljs-built_in">len</span>(height)<br>        left = <span class="hljs-number">0</span>    <span class="hljs-comment"># Â∑¶ÊåáÈíà</span><br>        right = n - <span class="hljs-number">1</span>   <span class="hljs-comment"># Âè≥ÊåáÈíà</span><br>        max_s = <span class="hljs-number">0</span>   <span class="hljs-comment"># Èù¢ÁßØÊúÄÂ§ßÂÄº</span><br>        s = <span class="hljs-number">0</span>   <span class="hljs-comment"># Èù¢ÁßØ</span><br>        l = <span class="hljs-number">0</span>   <span class="hljs-comment"># ËæπÈïø</span><br>        <span class="hljs-keyword">while</span> right &gt; left:<br>            <span class="hljs-keyword">if</span> height[left] &gt; height[right]:<br>                l = height[right]<br>            <span class="hljs-keyword">else</span>:<br>                l = height[left]<br>            s = (right - left) * l<br>            <span class="hljs-keyword">if</span> s &gt; max_s:<br>                max_s = s<br>            <span class="hljs-keyword">if</span> height[left] &gt; height[right]:<br>                right = right - <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                left = left + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> max_s<br></code></pre></div></td></tr></table></figure><h2 id="Êï¥Êï∞ËΩ¨ÁΩóÈ©¨Êï∞Â≠ó">12„ÄÅÊï¥Êï∞ËΩ¨ÁΩóÈ©¨Êï∞Â≠ó</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/4.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    A = [<br>        (<span class="hljs-number">1000</span>, <span class="hljs-string">&quot;M&quot;</span>),<br>        (<span class="hljs-number">900</span>, <span class="hljs-string">&quot;CM&quot;</span>),<br>        (<span class="hljs-number">500</span>, <span class="hljs-string">&quot;D&quot;</span>),<br>        (<span class="hljs-number">400</span>, <span class="hljs-string">&quot;CD&quot;</span>),<br>        (<span class="hljs-number">100</span>, <span class="hljs-string">&quot;C&quot;</span>),<br>        (<span class="hljs-number">90</span>, <span class="hljs-string">&quot;XC&quot;</span>),<br>        (<span class="hljs-number">50</span>, <span class="hljs-string">&quot;L&quot;</span>),<br>        (<span class="hljs-number">40</span>, <span class="hljs-string">&quot;XL&quot;</span>),<br>        (<span class="hljs-number">10</span>, <span class="hljs-string">&quot;X&quot;</span>),<br>        (<span class="hljs-number">9</span>, <span class="hljs-string">&quot;IX&quot;</span>),<br>        (<span class="hljs-number">5</span>, <span class="hljs-string">&quot;V&quot;</span>),<br>        (<span class="hljs-number">4</span>, <span class="hljs-string">&quot;IV&quot;</span>),<br>        (<span class="hljs-number">1</span>, <span class="hljs-string">&quot;I&quot;</span>),<br>    ]<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">intToRoman</span>(<span class="hljs-params">self, num: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>        ans = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-keyword">for</span> value, s <span class="hljs-keyword">in</span> self.A:<br>            <span class="hljs-keyword">while</span> num &gt;= value:<br>                num = num - value<br>                ans = ans + s<br>            <span class="hljs-keyword">if</span> num == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">break</span><br>        <br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="ÁΩóÈ©¨Êï∞Â≠óËΩ¨Êï¥Êï∞">13„ÄÅÁΩóÈ©¨Êï∞Â≠óËΩ¨Êï¥Êï∞</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/5.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    A = &#123;<br>        <span class="hljs-string">&#x27;I&#x27;</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-string">&#x27;V&#x27;</span>: <span class="hljs-number">5</span>,<br>        <span class="hljs-string">&#x27;X&#x27;</span>: <span class="hljs-number">10</span>,<br>        <span class="hljs-string">&#x27;L&#x27;</span>: <span class="hljs-number">50</span>,<br>        <span class="hljs-string">&#x27;C&#x27;</span>: <span class="hljs-number">100</span>,<br>        <span class="hljs-string">&#x27;D&#x27;</span>: <span class="hljs-number">500</span>,<br>        <span class="hljs-string">&#x27;M&#x27;</span>: <span class="hljs-number">1000</span>,<br>    &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">romanToInt</span>(<span class="hljs-params">self, s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>        ans = <span class="hljs-number">0</span><br>        n = <span class="hljs-built_in">len</span>(s)<br>        <span class="hljs-keyword">for</span> i, ch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(s):<br>            <span class="hljs-keyword">if</span> i &lt; n - <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> self.A[ch] &lt; self.A[s[i+<span class="hljs-number">1</span>]]:<br>                ans = ans - self.A[ch]<br>            <span class="hljs-keyword">else</span>:<br>                ans = ans + self.A[ch]<br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="‰∏âÊï∞‰πãÂíå">15„ÄÅ‰∏âÊï∞‰πãÂíå</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/15.png" /></p><p>ÈááÁî®ÂèåÊåáÈíàÁöÑÊÄùÊÉ≥Ôºå‰∏∫‰∫Ü‰∏ç‰Ωø‰∏âÂÖÉÁªÑÈáçÂ§çÔºåÂÖàÂØπÊï∞ÁªÑËøõË°åÊéíÂ∫è„ÄÇÂΩìÁ°ÆÂÆö‰∫ÜÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÂè™ÈúÄË¶ÅÂØπÂâ©‰∏ãÂÖÉÁ¥†ËøõË°åËÆæÁΩÆÂ∑¶ÊåáÈíàÂíåÂè≥ÊåáÈíàÔºåÂ¶ÇÊûú‰∏âÂÖÉÁªÑÂ§ß‰∏é0ÔºåÂè≥ÊåáÈíàÂ∞±Â∑¶Áßª‰∏Ä‰ΩçÔºåÂèç‰πã‰∫¶ÁÑ∂„ÄÇÂ¶ÇÊûú‰∏âÂÖÉÁªÑ‰πãÂíåÂàöÂ•ΩÁ≠â‰∫é0ÔºåÂ∞±ÈúÄË¶ÅÂ∑¶ÊåáÈíàÂíåÂè≥ÊåáÈíàÈÉΩÁßªÂä®‰∏Ä‰Ωç„ÄÇËøôÊó∂ÂÄôËøò‰ºöÂá∫Áé∞ÈáçÂ§çÈóÆÈ¢òÔºåÊâÄ‰ª•ÈúÄË¶ÅÂà§Êñ≠Ê≠§Êó∂ÈÅçÂéÜÁöÑÂÖÉÁ¥†Âíå‰πãÂâçÁöÑÊòØÂê¶Áõ∏ÂêåÔºåÂ¶ÇÊûúÁõ∏ÂêåÂ∞±Ë¶ÅË∑≥Ëøá„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">threeSum</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]]:<br>        nums.sort()<br>        n = <span class="hljs-built_in">len</span>(nums)<br>        ans = <span class="hljs-built_in">list</span>()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<span class="hljs-comment"># Âõ∫ÂÆöÂÖ∂‰∏≠‰∏Ä‰∏™ÂÖÉÁ¥†</span><br>            <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> nums[i] != nums[i - <span class="hljs-number">1</span>]:<br>                k = n - <span class="hljs-number">1</span><br>                j = i + <span class="hljs-number">1</span><br>                <span class="hljs-keyword">while</span> k &gt; j:<span class="hljs-comment"># ËøõË°åÂèåÊåáÈíàÈÅçÂéÜ</span><br>                    <span class="hljs-keyword">if</span> k != n - <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> nums[k] == nums[k + <span class="hljs-number">1</span>]:<span class="hljs-comment"># Â¶ÇÊûúÂè≥ÊåáÈíà‰πãÂâçÂá∫Áé∞ËøáÂ∞±Ë∑≥Ëøá</span><br>                        k = k - <span class="hljs-number">1</span><br>                        <span class="hljs-keyword">continue</span><br>                    <span class="hljs-keyword">if</span> j != i + <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> nums[j] == nums[j - <span class="hljs-number">1</span>]:<span class="hljs-comment"># Â¶ÇÊûúÂ∑¶ÊåáÈíà‰πãÂâçÂá∫Áé∞ËøáÂ∞±Ë∑≥Ëøá</span><br>                        j = j + <span class="hljs-number">1</span><br>                        <span class="hljs-keyword">continue</span><br>                    s = nums[i] + nums[j] + nums[k]<br>                    <span class="hljs-keyword">if</span> s == <span class="hljs-number">0</span>:<br>                        ans.append([nums[i], nums[j], nums[k]])<br>                        k = k - <span class="hljs-number">1</span><br>                        j = j + <span class="hljs-number">1</span><br>                    <span class="hljs-keyword">elif</span> s &gt; <span class="hljs-number">0</span>:<br>                        k = k - <span class="hljs-number">1</span><br>                    <span class="hljs-keyword">elif</span> s &lt; <span class="hljs-number">0</span>:<br>                        j = j + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="ÊúÄÊé•ËøëÁöÑ‰∏âÊï∞‰πãÂíå">16„ÄÅÊúÄÊé•ËøëÁöÑ‰∏âÊï∞‰πãÂíå</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/16.png" /></p><p>ÈááÁî®ÂèåÊåáÈíàÁöÑÊÄùÊÉ≥ÔºåÂÖàÂØπÊï∞ÁªÑËøõË°åÊéíÂ∫è„ÄÇÂΩìÁ°ÆÂÆö‰∫ÜÁ¨¨‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÂè™ÈúÄË¶ÅÂØπÂâ©‰∏ãÂÖÉÁ¥†ËøõË°åËÆæÁΩÆÂ∑¶ÊåáÈíàÂíåÂè≥ÊåáÈíàÔºåÂ¶ÇÊûú‰∏âÂÖÉÁªÑ‰πãÂíåÂ§ß‰∫étargetÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÂ∞ÜÂè≥ËäÇÁÇπÂ∑¶Áßª‰∏Ä‰ΩçÔºåÁõ∏Âèç‰∫¶ÁÑ∂„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">threeSumClosest</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], target: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>        n = <span class="hljs-built_in">len</span>(nums)<br>        nums.sort()<br>        min_num = <span class="hljs-number">10</span>**<span class="hljs-number">9</span><br>        ans = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-keyword">if</span> i != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> nums[i] == nums[i - <span class="hljs-number">1</span>]:<br>                <span class="hljs-keyword">continue</span><br>            k = n - <span class="hljs-number">1</span><br>            j = i + <span class="hljs-number">1</span><br>            <span class="hljs-keyword">while</span> k &gt; j:<br>                s = nums[i] + nums[j] + nums[k]<br>                <span class="hljs-keyword">if</span> s == target:<br>                    <span class="hljs-keyword">return</span> s<br>                <span class="hljs-keyword">if</span> s &gt; target:<br>                    <span class="hljs-keyword">if</span> s - target &lt; min_num:<br>                        min_num = s - target<br>                        ans = s<br>                    k = k - <span class="hljs-number">1</span><br>                <span class="hljs-keyword">elif</span> s &lt; target:<br>                    <span class="hljs-keyword">if</span> target - s &lt; min_num:<br>                        min_num = target - s<br>                        ans = s<br>                    j = j + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="ÂõõÊï∞‰πãÂíå">18„ÄÅÂõõÊï∞‰πãÂíå</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/18.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fourSum</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], target: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]]:<br>        n = <span class="hljs-built_in">len</span>(nums)<br>        <span class="hljs-keyword">if</span> nums == [] <span class="hljs-keyword">or</span> n &lt; <span class="hljs-number">4</span>:<br>            <span class="hljs-keyword">return</span> []<br>        nums.sort()<br>        ans = <span class="hljs-built_in">list</span>()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">3</span>):<br>            <span class="hljs-keyword">if</span> i != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> nums[i] == nums[i - <span class="hljs-number">1</span>]:<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">if</span> nums[i] + nums[i + <span class="hljs-number">1</span>] + nums[i + <span class="hljs-number">2</span>] + nums[i + <span class="hljs-number">3</span>] &gt; target:<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">if</span> nums[i] + nums[n - <span class="hljs-number">1</span>] + nums[n - <span class="hljs-number">2</span>] + nums[n - <span class="hljs-number">3</span>] &lt; target:<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, n - <span class="hljs-number">2</span>):<br>                <span class="hljs-keyword">if</span> j != i + <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> nums[j] == nums[j - <span class="hljs-number">1</span>]:<br>                    <span class="hljs-keyword">continue</span><br>                <span class="hljs-keyword">if</span> nums[i] + nums[j] + nums[j + <span class="hljs-number">1</span>] + nums[j + <span class="hljs-number">2</span>] &gt; target:<br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">if</span> nums[i] + nums[n - <span class="hljs-number">1</span>] + nums[n - <span class="hljs-number">2</span>] + nums[n - <span class="hljs-number">3</span>] &lt; target:<br>                    <span class="hljs-keyword">continue</span><br>                k = j + <span class="hljs-number">1</span><br>                l = n - <span class="hljs-number">1</span><br>                <span class="hljs-keyword">while</span> k &lt; l:<br>                    <span class="hljs-built_in">sum</span> = nums[i] + nums[j] + nums[k] + nums[l]<br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">sum</span> &lt; target:<br>                        k = k + <span class="hljs-number">1</span><br>                    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">sum</span> &gt; target:<br>                        l = l - <span class="hljs-number">1</span><br>                    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">sum</span> == target:<br>                        ans.append([nums[i], nums[j], nums[k], nums[l]])<br>                        <span class="hljs-keyword">while</span> k &lt; l <span class="hljs-keyword">and</span> nums[k] == nums[k + <span class="hljs-number">1</span>]:<br>                            k = k + <span class="hljs-number">1</span><br>                        k = k + <span class="hljs-number">1</span><br>                        <span class="hljs-keyword">while</span> k &lt; l <span class="hljs-keyword">and</span> nums[l] == nums[l - <span class="hljs-number">1</span>]:<br>                            l = l - <span class="hljs-number">1</span><br>                        l = l - <span class="hljs-number">1</span> <br><br>        <span class="hljs-keyword">return</span> ans<br></code></pre></div></td></tr></table></figure><h2 id="Âà†Èô§ÊúâÂ∫èÊï∞ÁªÑ‰∏≠ÁöÑÈáçÂ§çÈ°π">26„ÄÅÂà†Èô§ÊúâÂ∫èÊï∞ÁªÑ‰∏≠ÁöÑÈáçÂ§çÈ°π</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/26.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">removeDuplicates</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:<br>        <span class="hljs-keyword">if</span> nums == []:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        n = <span class="hljs-built_in">len</span>(nums)<br>        left, right = <span class="hljs-number">1</span>, <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> right &lt; n:<br>            <span class="hljs-keyword">if</span> nums[right] != nums[right - <span class="hljs-number">1</span>]:<br>                nums[left] = nums[right]<br>                left = left + <span class="hljs-number">1</span><br>            right = right + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> left<br></code></pre></div></td></tr></table></figure><h2 id="‰∏ã‰∏Ä‰∏™ÊéíÂàó">31„ÄÅ‰∏ã‰∏Ä‰∏™ÊéíÂàó</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/31.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">nextPermutation</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        Do not return anything, modify nums in-place instead.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        i = <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">2</span><br>        <span class="hljs-keyword">while</span> i &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> nums[i] &gt;= nums[i + <span class="hljs-number">1</span>]:<br>            i -= <span class="hljs-number">1</span><br>        j = <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> i &gt;= <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">while</span> j &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> nums[i] &gt;= nums[j]:<br>                j -= <span class="hljs-number">1</span><br>            nums[i], nums[j] = nums[j], nums[i]<br>        left, right = i + <span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> left &lt; right:<br>            nums[left], nums[right] = nums[right], nums[left]<br>            left += <span class="hljs-number">1</span><br>            right -= <span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><h2 id="ÊêúÁ¥¢ÊóãËΩ¨ÊéíÂ∫èÊï∞ÁªÑ">33„ÄÅÊêúÁ¥¢ÊóãËΩ¨ÊéíÂ∫èÊï∞ÁªÑ</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/33.png" /></p><p>ÁúãÂà∞ÊúâÂ∫èÁöÑÊï∞ÁªÑÔºåÁÑ∂ÂêéÂØπÂÖ∂Êü•ÊâæÔºå‰∏ÄËà¨ÊúÄÂÖàË¶ÅÊÉ≥Âà∞ÁöÑÊòØ‰∫åÂàÜÊü•Êâæ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], target: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> nums:<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>        i = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">if</span> nums[<span class="hljs-number">0</span>] &gt; nums[<span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span>]:<br>            <span class="hljs-keyword">while</span> i &lt; <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> nums[i] &lt; nums[i + <span class="hljs-number">1</span>]:<br>             i += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> target &gt; nums[<span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span>]:<br>                left = <span class="hljs-number">0</span><br>                right = i<br>            <span class="hljs-keyword">elif</span> target &lt; nums[<span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span>]:<br>                left = i + <span class="hljs-number">1</span><br>                right = <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span><br>            <span class="hljs-keyword">elif</span> target == nums[<span class="hljs-built_in">len</span>(nums) -<span class="hljs-number">1</span>]:<br>                <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            left, right = <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span><br>        <br>        <span class="hljs-keyword">while</span> left &lt;= right:<br>            mid = (left + right) // <span class="hljs-number">2</span><br>            <span class="hljs-keyword">if</span> target == nums[mid]:<br>                <span class="hljs-keyword">return</span> mid<br>            <span class="hljs-keyword">elif</span> target &lt; nums[mid]:<br>                right = mid - <span class="hljs-number">1</span><br>            <span class="hljs-keyword">elif</span> target &gt; nums[mid]:<br>                left = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><h2id="Âú®ÊéíÂ∫èÊï∞ÁªÑ‰∏≠Êü•ÊâæÂÖÉÁ¥†ÁöÑÁ¨¨‰∏Ä‰∏™ÂíåÊúÄÂêé‰∏Ä‰∏™">34„ÄÅÂú®ÊéíÂ∫èÊï∞ÁªÑ‰∏≠Êü•ÊâæÂÖÉÁ¥†ÁöÑÁ¨¨‰∏Ä‰∏™ÂíåÊúÄÂêé‰∏Ä‰∏™</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/34.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">searchRange</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], target: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> nums:<br>            <span class="hljs-keyword">return</span> [-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">binarySearch</span>(<span class="hljs-params">nums, target</span>):<br>            left, right = <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span><br>            <span class="hljs-keyword">while</span> left &lt;= right:<br>                mid = (left + right) // <span class="hljs-number">2</span><br>                <span class="hljs-keyword">if</span> nums[mid] &gt;= target:<br>                    right = mid - <span class="hljs-number">1</span><br>                <span class="hljs-keyword">elif</span> nums[mid] &lt; target:<br>                    left = mid + <span class="hljs-number">1</span><br>            <span class="hljs-keyword">return</span> left<br>        a = binarySearch(nums, target)<br>        b = binarySearch(nums, target + <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">if</span> a == <span class="hljs-built_in">len</span>(nums) <span class="hljs-keyword">or</span> nums[a] != target:<br>            <span class="hljs-keyword">return</span>[-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span>[a, b - <span class="hljs-number">1</span>]<br></code></pre></div></td></tr></table></figure><h2 id="powx-n">50„ÄÅPow(x, n)</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/50.png" /></p><p>‰ΩøÁî®ÈÄíÂΩíÁöÑÊÄùÊÉ≥ÔºåÁõ¥Êé•Âæ™ÁéØ‰ºöÂØºËá¥ËøêË°åÊó∂Èó¥ËøáÈïø</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">myPow</span>(<span class="hljs-params">self, x: <span class="hljs-built_in">float</span>, n: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">float</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">quickPow</span>(<span class="hljs-params">N</span>):<br>            <span class="hljs-keyword">if</span> N == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span><br>            y = quickPow(N // <span class="hljs-number">2</span>)<br>            <span class="hljs-keyword">return</span> y * y <span class="hljs-keyword">if</span> N % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> y * y * x<br>        <span class="hljs-keyword">return</span> quickPow(n) <span class="hljs-keyword">if</span> n &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">1.0</span> / quickPow(-n)<br></code></pre></div></td></tr></table></figure><h2 id="ÊúÄÂ§ßÂ≠êÊï∞ÁªÑÂíå">53„ÄÅÊúÄÂ§ßÂ≠êÊï∞ÁªÑÂíå</h2><p><img src="/img/LeetCode/Êï∞ÁªÑÂèäÊï∞Â≠¶/53.png" /></p><p>ÁúãÂà∞ËøôÁßçÂå∫Èó¥ÁöÑÔºåÂèØ‰ª•ÊÉ≥Âà∞Âä®ÊÄÅËßÑÂàí</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">maxSubArray</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(nums)):<br>            nums[i] += <span class="hljs-built_in">max</span>(nums[i - <span class="hljs-number">1</span>], <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(nums)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>LeetCode</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pytorch</title>
    <link href="/2022/04/27/pytorch/"/>
    <url>/2022/04/27/pytorch/</url>
    
    <content type="html"><![CDATA[<h1 id="pytorch">PyTorch</h1><h2 id="dataset">1„ÄÅDataSet</h2><p>DataSetÔºöÊèê‰æõ‰∏ÄÁßçÊñπÊ≥ïÂéªËé∑ÂèñÊï∞ÊçÆÂèäÂÖ∂label</p><p>‰ΩøÁî®ÁöÑÊï∞ÊçÆÈõÜ‰∏∫ËúúËúÇ‰∏éËöÇËöÅÁöÑÂõæÂÉèÊï∞ÊçÆÈõÜÔºåÂàÜÂà´‰øùÂ≠òÂú®dataset/train/bees‰ª•Âèädataset/train/ants</p><p>DataSetÈúÄË¶ÅÈÄöËøáÁªßÊâøÈáçËΩΩÊâçËÉΩ‰ΩøÁî®Ôºå‰ΩøÁî®ÊñπÊ≥ïÂ¶Ç‰∏ãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyData</span>(<span class="hljs-title class_ inherited__">Dataset</span>):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, root_dir, label_dir</span>):<span class="hljs-comment"># read data &amp; preprocess</span><br>        self.root_dir = root_dir    <span class="hljs-comment"># Ê†πÁõÆÂΩï</span><br>        self.label_dir = label_dir  <span class="hljs-comment"># Ê†áËÆ∞ÁõÆÂΩï</span><br>        self.path = os.path.join(self.root_dir, self.label_dir)     <span class="hljs-comment"># Âú∞ÂùÄÁõ∏Âä†</span><br>        self.img_path = os.listdir(self.path)   <span class="hljs-comment"># ÁîüÊàêÂõæÁâáÊñá‰ª∂ÂàóË°®</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, index</span>):<span class="hljs-comment"># returns one sample at a time</span><br>        img_name = self.img_path[index]   <span class="hljs-comment"># Êñá‰ª∂Âêç</span><br>        img_item_path = os.path.join(self.root_dir, self.label_dir, img_name)<br>        img = Image.<span class="hljs-built_in">open</span>(img_item_path)<br>        label = self.label_dir<br>        <span class="hljs-keyword">return</span> img, label<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<span class="hljs-comment"># returns the size of the dataset</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.img_path)<br><br><br><span class="hljs-comment"># ËØªÂèñËöÇËöÅÂíåËúúËúÇÁöÑÂõæÁâáÊï∞ÊçÆÈõÜ</span><br>root_dir = <span class="hljs-string">&quot;dataset/train&quot;</span><br>ants_label_dir = <span class="hljs-string">&quot;ants&quot;</span><br>bees_label_dir = <span class="hljs-string">&quot;bees&quot;</span><br>ants_dataset = MyData(root_dir, ants_label_dir)<br>bees_dataset = MyData(root_dir, bees_label_dir)<br><br><span class="hljs-comment"># Â∞Ü‰∏§‰∏™Êï∞ÊçÆÈõÜËøõË°åÂêàÂπ∂ÔºåÊàê‰∏∫ËÆ≠ÁªÉÊï∞ÊçÆÈõÜ</span><br>train_dataset = ants_dataset + bees_dataset<br></code></pre></div></td></tr></table></figure><h2 id="dataloader">2„ÄÅDataLoader</h2><p>DataSetÂ∞±Áõ∏ÂΩì‰∫éÊòØ‰∏ÄÊï¥‰∏™Êï∞ÊçÆÈõÜÔºåËÄåDataLoaderÊòØÂèñÂá∫ÂÖ∂‰∏≠‰∏ÄÈÉ®ÂàÜÂà∞Á•ûÁªèÁΩëÁªú‰∏≠ËøõË°å‰ΩøÁî®„ÄÇ</p><p>‰ΩøÁî®ÁöÑÊòØtorchvisionÊâÄÊèê‰æõÁöÑÊï∞ÊçÆÈõÜ„ÄÇDataLoader‰∏≠ÁöÑÂèÇÊï∞ÂàÜÂà´Èáä‰πâÂ¶Ç‰∏ãÔºö</p><ul><li>datasetÔºöÊàë‰ª¨ÊâÄ‰ΩøÁî®ÁöÑÊï∞ÊçÆÈõÜÔºåÂç≥datasetÁ±ªÂûãÊï∞ÊçÆ</li><li>batch_sizeÔºö‰∏ÄÊ¨°ÊäìÂèñÂ§öÂ∞ë‰∏™Êï∞ÊçÆ</li><li>shuffleÔºöÊäìÂèñÊó∂ÊòØÂê¶Êâì‰π±È°∫Â∫è</li><li>num_workersÔºö‰ª£Ë°®ÂàõÂª∫‰∫ÜÂ§öÂ∞ë‰∏™workerËøõÁ®ãÔºå0Ë°®Á§∫Âè™Êúâ‰∏ªËøõÁ®ãÂéªÂä†ËΩΩbatchÊï∞ÊçÆÔºå1Ë°®Á§∫Êúâ‰∏Ä‰∏™workerËøõÁ®ãÂä†ËΩΩbatchÊï∞ÊçÆ</li><li>drop_lastÔºöÊó†Ê≥ïÊï¥Èô§Êó∂ÔºåÊúÄÂêéÂâ©‰ΩôÁöÑÂá†Êù°Êï∞ÊçÆË¶Å‰∏çË¶ÅÂéªÈô§</li></ul><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torchvision<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader<br><br><span class="hljs-comment"># ÂáÜÂ§áÁöÑÊµãËØïÊï∞ÊçÆÈõÜ</span><br><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br><br>test_data = torchvision.datasets.CIFAR10(<span class="hljs-string">&quot;./dataset&quot;</span>, train=<span class="hljs-literal">False</span>, transform=torchvision.transforms.ToTensor(), download=<span class="hljs-literal">True</span>)<br><br>test_loader = DataLoader(dataset=test_data, batch_size=<span class="hljs-number">64</span>, shuffle=<span class="hljs-literal">True</span>, num_workers=<span class="hljs-number">0</span>, drop_last=<span class="hljs-literal">False</span>)<br><br>writer = SummaryWriter(<span class="hljs-string">&quot;dataloader&quot;</span>)<br>step = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> test_loader:<br>    imgs, targets = data<br>    writer.add_images(<span class="hljs-string">&quot;test_data&quot;</span>, imgs, step)<br>    step = step + <span class="hljs-number">1</span><br><br>writer.close()<br></code></pre></div></td></tr></table></figure><p>ÊúÄÂêéÊòæÁ§∫ÁªìÊûúÂ¶Ç‰∏ãÔºö</p><p><img src="/img/pytorch/1.png" /></p><h2 id="tensorboard">3„ÄÅTensorBoard</h2><p>Êàë‰ª¨ÂèØ‰ª•ÈÄöËøáTensorBoardÂèØ‰ª•Êü•ÁúãÂõæÂÉè</p><h3 id="ËæìÂá∫ÂáΩÊï∞ÂõæÂÉè">3.1ËæìÂá∫ÂáΩÊï∞ÂõæÂÉè</h3><p>È¶ñÂÖàÊàë‰ª¨ÈÄöËøáTensorBoardÊù•ÁªòÂà∂y=xÁöÑÂõæÂÉèÔºåÊàë‰ª¨ÈúÄË¶ÅÂÖàÁîüÊàê‰∏Ä‰∏™ÂÆû‰æãÔºåÈöèÂêéÈÄöËøáadd_scalar()ÊñπÊ≥ïÊù•Ê∑ªÂä†ÔºåÂèÇÊï∞ÂàÜÂà´‰∏∫ÂêçÁß∞ÔºåyËΩ¥ÁöÑÂÄºÔºåxËΩ¥ÁöÑÂÄº„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br><br><span class="hljs-comment"># ÂàõÂª∫‰∏Ä‰∏™ÂÆû‰æã,Â≠òÂÇ®Âú®logsÊñá‰ª∂Â§π‰∏ã</span><br>writer = SummaryWriter(<span class="hljs-string">&quot;logs&quot;</span>)<br><br><span class="hljs-comment"># y = xÂõæÂÉè</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>    writer.add_scalar(<span class="hljs-string">&quot;y=x&quot;</span>, i, i)<br><br>writer.close()<br></code></pre></div></td></tr></table></figure><p>ÂÆåÊàêÂêéÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÊéßÂà∂Âè∞ËæìÂÖ•Â¶Ç‰∏ãÊåá‰ª§Êù•ËßÇÁúãÂõæÂÉè</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">tensorboard --logdir=logs<br></code></pre></div></td></tr></table></figure><p>ËøôÊó∂ÂÄôÊàë‰ª¨ÂèØ‰ª•ÈÄöËøá6006Á´ØÂè£Êù•Êü•ÁúãÂõæÂÉèÔºå‰ΩÜÊòØÂ¶ÇÊûúÊúâÂæàÂ§ötensorboardÈÉΩË¶ÅÊü•ÁúãÂë¢ÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄâÊã©Ëá™ÂÆö‰πâÁ´ØÂè£Êü•ÁúãÔºå‰æãÂ¶ÇÊàë‰ª¨Ë¶ÅÈÄâÊã©6007Á´ØÂè£Êù•Êü•ÁúãÔºåÊåá‰ª§Â¶Ç‰∏ãÔºö</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">tensorboard --logdir=logs --port=6007<br></code></pre></div></td></tr></table></figure><p><img src="/img/pytorch/2.png" /></p><p>ËøôÊó∂ÂÄôÊàë‰ª¨Â∞±ÂèØ‰ª•ÁúãÂà∞y=xÁöÑÂõæÂÉè</p><p>Â¶ÇÊûúÊòØy=2xÁöÑÂõæÂÉèÂàôÈúÄË¶Å‰øÆÊîπ‰ª£Á†Å‰∏∫Ôºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># y = 2xÂõæÂÉè</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>    writer.add_scalar(<span class="hljs-string">&quot;y=2x&quot;</span>, <span class="hljs-number">2</span>*i, i)<br></code></pre></div></td></tr></table></figure><h3 id="ËæìÂá∫ÂõæÁâá">3.2ËæìÂá∫ÂõæÁâá</h3><p>Êàë‰ª¨‰πüÂèØ‰ª•ÈÄöËøáTensorBoardÊù•ÊòæÁ§∫Êàë‰ª¨ÁöÑÂõæÁâáÔºåÈÄöËøáTensorBoardÁöÑadd_image()ÊñπÊ≥ïÔºåÂèÇÊï∞ÂàÜÂà´‰∏∫ÂêçÁß∞„ÄÅÂõæÁâáÔºàÈúÄË¶Å‰∏∫tensorÁ±ªÂûãÊàñËÄÖnumpyÁ±ªÂûãÔºâ„ÄÅglobal_step„ÄÅÁ±ªÂûãÔºàÂõ†‰∏∫ÈªòËÆ§ÁöÑÁ±ªÂûã‰∏∫ÊòØÔºà3ÔºåHÔºåWÔºâÂç≥ÈÄöÈÅì(channel)‰∏∫3ÔºåH‰∏∫È´òÂ∫¶ÔºåW‰∏∫ÂÆΩÂ∫¶ÔºâÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br><span class="hljs-comment"># ÂàõÂª∫‰∏Ä‰∏™ÂÆû‰æã,Â≠òÂÇ®Âú®logsÊñá‰ª∂Â§π‰∏ã</span><br>writer = SummaryWriter(<span class="hljs-string">&quot;logs&quot;</span>)<br>image_path = <span class="hljs-string">&quot;dataset/train/ants/0013035.jpg&quot;</span><br>img_PIL = Image.<span class="hljs-built_in">open</span>(image_path)<br>img_array = np.array(img_PIL)<br><br>writer.add_image(<span class="hljs-string">&quot;test&quot;</span>, img_array, <span class="hljs-number">1</span>, dataformats=<span class="hljs-string">&#x27;HWC&#x27;</span>)<br><br>writer.close()<br></code></pre></div></td></tr></table></figure><h2 id="Á•ûÁªèÁΩëÁªúÁöÑÂü∫Êú¨È™®Êû∂">4„ÄÅÁ•ûÁªèÁΩëÁªúÁöÑÂü∫Êú¨È™®Êû∂</h2><p>Âü∫Êú¨È™®Êû∂ÊòØÈÄöËøáÂØπnn.ModuleÁöÑÁªßÊâøÈáçÂÜôÂÆûÁé∞ÁöÑÔºåÂ§ß‰ΩìÂÆûÁé∞Â¶Ç‰∏ãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModel</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span></span>):<br>        output = <span class="hljs-built_in">input</span> + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> output<br><br>res = MyModel()<br>x = torch.tensor(<span class="hljs-number">1.0</span>)<br>output = res(x)<span class="hljs-comment"># Êúâ__call__ÊñπÊ≥ïÊù•Ë∞ÉÁî®ÔºåÊâÄ‰ª•ÂèØ‰ª•Áõ¥Êé•Â∞ÜxËæìÂÖ•Ôºå‰∏çÁî®Êàë‰ª¨Êù•Ë∞ÉÁî®forward()ÊñπÊ≥ï</span><br><span class="hljs-built_in">print</span>(output)<br><br></code></pre></div></td></tr></table></figure><p>ÊúÄÂêéÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ÊéßÂà∂Âè∞ËæìÂá∫‰∏∫Ôºö</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">tensor(2.)<br></code></pre></div></td></tr></table></figure><h2 id="Âç∑ÁßØÂ±Ç">5„ÄÅÂç∑ÁßØÂ±Ç</h2><p>È¶ñÂÖàÂØπ‰∫éÂç∑ÁßØÂ±ÇÁöÑÂ≠¶‰π†ÔºåË¶Å‰∫ÜËß£Âç∑ÁßØÂ±ÇÁöÑ‰ΩøÁî®ÔºåÊàë‰ª¨ÂÖà‰ΩøÁî®torch.nn.functional‰∏≠ÁöÑÊñπÊ≥ïÔºà‰∏ÄËà¨ÈÉΩÊòØ‰ΩøÁî®torch.nnÔºåÂÖ∂ÂØπfunctionalËøõË°å‰∫ÜÂ∞ÅË£ÖÔºåËøôÈáåÊòØ‰∏∫‰∫Ü‰∫ÜËß£Â¶Ç‰ΩïÂç∑ÁßØÔºâËøõË°åÂ≠¶‰π†ÔºåÈ¶ñÂÖàË¶ÅÂØπconv2dÁöÑstrideÂèÇÊï∞ËøõË°å‰∫ÜËß£ÔºåstrideÊó∂ËÆ°ÁÆóÂç∑ÁßØÊó∂ÁßªÂä®ÁöÑÊ≠•ÈïøÔºåÊàë‰ª¨ÂèØ‰ª•‰ΩøÁî®‰ª£Á†ÅÊù•‰∫ÜËß£Ôºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br><span class="hljs-built_in">input</span> = torch.tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>],<br>                      [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>],<br>                      [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],<br>                      [<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>],<br>                      [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]])<br><br>kernel = torch.tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>],<br>                       [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>],<br>                       [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>]])<br><br><span class="hljs-built_in">input</span> = torch.reshape(<span class="hljs-built_in">input</span>, (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>))<br>kernel = torch.reshape(kernel, (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>))<br><br>output = F.conv2d(<span class="hljs-built_in">input</span>, kernel, stride=<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(output)<br><br>output2 = F.conv2d(<span class="hljs-built_in">input</span>, kernel, stride=<span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span>(output2)<br></code></pre></div></td></tr></table></figure><p>ËæìÂá∫ÁªìÊûú‰∏∫Ôºö</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">tensor([[[[10, 12, 12],<br>          [18, 16, 16],<br>          [13,  9,  3]]]])<br>tensor([[[[10, 12],<br>          [13,  3]]]])<br></code></pre></div></td></tr></table></figure><p>ÂõæÁ§∫‰∏∫Ôºö</p><p><img src="/img/pytorch/4.png" /></p><p>ÈöèÂêéÊàë‰ª¨Ë¶ÅÂ≠¶‰π†ÁöÑÊòØconv2d‰∏≠ÁöÑpaddingÂèÇÊï∞ÔºåÂÆÉÊòØÂØπËæìÂÖ•ÂõæÂÉèÁöÑÂë®Âõ¥ËøõË°åÂ°´ÂÖÖÔºåÂπ∂ËÆæÁΩÆÂ°´ÂÖÖÂÄºÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">output3 = F.conv2d(<span class="hljs-built_in">input</span>, kernel, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(output3)<br></code></pre></div></td></tr></table></figure><p>ËæìÂá∫ÁªìÊûú‰∏∫Ôºö</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">tensor([[[[ 1,  3,  4, 10,  8],<br>          [ 5, 10, 12, 12,  6],<br>          [ 7, 18, 16, 16,  8],<br>          [11, 13,  9,  3,  4],<br>          [14, 13,  9,  7,  4]]]])<br></code></pre></div></td></tr></table></figure><p>ÂõæÁ§∫‰∏∫Ôºö</p><p><img src="/img/pytorch/5.png" /></p><p>Áé∞Âú®ÂØπÂç∑ÁßØÂ±ÇÁöÑÁü•ËØÜËøõË°å‰∫ÜÂ≠¶‰π†ÂêéÊ≠£ÂºèÊù•Êó∂Â≠¶‰π†Âç∑ÁßØÂ±ÇÊòØÂ¶Ç‰ΩïÊê≠Âª∫ÁöÑÔºåÊàë‰ª¨Ë¶Å‰ΩøÁî®ÁöÑÊòØtorch.nn‰∏≠ÁöÑconv2dÊñπÊ≥ïÔºåÂÖ∂ÊñπÊ≥ïÁöÑÂèÇÊï∞Ëß£ÈáäÂú®ÂÆòÊñπÊñáÊ°£‰∏≠Â¶Ç‰∏ãÔºö</p><ul><li><strong>in_channels</strong> (<ahref="https://docs.python.org/3/library/functions.html#int"><em>int</em></a>)‚Äì Number of channels in the input image</li><li><strong>out_channels</strong> (<ahref="https://docs.python.org/3/library/functions.html#int"><em>int</em></a>)‚Äì Number of channels produced by the convolution</li><li><strong>kernel_size</strong> (<ahref="https://docs.python.org/3/library/functions.html#int"><em>int</em></a><em>or</em> <ahref="https://docs.python.org/3/library/stdtypes.html#tuple"><em>tuple</em></a>)‚Äì Size of the convolving kernel</li><li><strong>stride</strong> (<ahref="https://docs.python.org/3/library/functions.html#int"><em>int</em></a><em>or</em> <ahref="https://docs.python.org/3/library/stdtypes.html#tuple"><em>tuple</em></a><em>,</em><em>optional</em>) ‚Äì Stride of the convolution. Default: 1</li><li><strong>padding</strong> (<ahref="https://docs.python.org/3/library/functions.html#int"><em>int</em></a><em>,</em><ahref="https://docs.python.org/3/library/stdtypes.html#tuple"><em>tuple</em></a><em>or</em> <ahref="https://docs.python.org/3/library/stdtypes.html#str"><em>str</em></a><em>,</em><em>optional</em>) ‚Äì Padding added to all four sides of the input.Default: 0</li><li><strong>padding_mode</strong> (*string**,* <em>optional</em>) ‚Äì<code>'zeros'</code>, <code>'reflect'</code>, <code>'replicate'</code>or <code>'circular'</code>. Default: <code>'zeros'</code></li><li><strong>dilation</strong> (<ahref="https://docs.python.org/3/library/functions.html#int"><em>int</em></a><em>or</em> <ahref="https://docs.python.org/3/library/stdtypes.html#tuple"><em>tuple</em></a><em>,</em><em>optional</em>) ‚Äì Spacing between kernel elements. Default: 1</li><li><strong>groups</strong> (<ahref="https://docs.python.org/3/library/functions.html#int"><em>int</em></a><em>,</em><em>optional</em>) ‚Äì Number of blocked connections from input channelsto output channels. Default: 1</li><li><strong>bias</strong> (<ahref="https://docs.python.org/3/library/functions.html#bool"><em>bool</em></a><em>,</em><em>optional</em>) ‚Äì If <code>True</code>, adds a learnable bias to theoutput. Default: <code>True</code></li></ul><p><img src="/img/pytorch/3.png" /></p><p>Êàë‰ª¨ÁÆÄÂçïÁöÑÂØπÂõæÂÉèËøõË°åÂç∑ÁßØÂ§ÑÁêÜÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torchvision<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn<br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> Conv2d<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader<br><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br><br>test_data = torchvision.datasets.CIFAR10(<span class="hljs-string">&quot;./dataset&quot;</span>, train=<span class="hljs-literal">False</span>, transform=torchvision.transforms.ToTensor(),<br>                                         download=<span class="hljs-literal">True</span>)<br>dataloader = DataLoader(dataset=test_data, batch_size=<span class="hljs-number">64</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModel</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(MyModel, self).__init__()<br>        self.conv1 = Conv2d(in_channels=<span class="hljs-number">3</span>, out_channels=<span class="hljs-number">6</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = self.conv1(x)<br>        <span class="hljs-keyword">return</span> x<br><br><br>myModel = MyModel()<br><br>writer = SummaryWriter(<span class="hljs-string">&quot;logs&quot;</span>)<br>step = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> dataloader:<br>    imgs, targets = data<br>    output = myModel(imgs)<br>    <span class="hljs-comment"># print(imgs.shape)</span><br>    <span class="hljs-comment"># print(output.shape)</span><br><br>    <span class="hljs-comment"># torch.Size([64, 3, 32, 32])</span><br>    writer.add_images(<span class="hljs-string">&quot;input&quot;</span>, imgs, step)<br>    <span class="hljs-comment"># torch.Size([64, 6, 32, 32]) -&gt; [xxx, 3, 32, 32]ÔºåÂõ†‰∏∫out_channels‰∏∫6Ê≤°ÂäûÊ≥ïaddËøõÂéª</span><br>    output = torch.reshape(output, (-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">30</span>, <span class="hljs-number">30</span>))<br>    writer.add_images(<span class="hljs-string">&quot;output&quot;</span>, output, step)<br><br>    step = step + <span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><p>ËøêË°åÁªìÊûúÂú®tensorboard‰∏äÊòæÁ§∫‰∏∫Ôºö</p><p><img src="/img/pytorch/6.png" /></p><p><img src="/img/pytorch/7.png" /></p><h2 id="Ê±†ÂåñÂ±Ç">6„ÄÅÊ±†ÂåñÂ±Ç</h2><p>Êàë‰ª¨Ë¶Å‰ΩøÁî®ÁöÑÊòØtorch.nn‰∏≠ÁöÑMaxPool2dÊñπÊ≥ïÔºåÂÖ∂‰∏≠ÂèÇÊï∞Ëß£Èáä‰∏∫Ôºö</p><ul><li><strong>kernel_size</strong> ‚Äì the size of the window to take a maxover</li><li><strong>stride</strong> ‚Äì the stride of the window. Default value is<code>kernel_size</code></li><li><strong>padding</strong> ‚Äì implicit zero padding to be added on bothsides</li><li><strong>dilation</strong> ‚Äì a parameter that controls the stride ofelements in the window</li><li><strong>return_indices</strong> ‚Äì if <code>True</code>, will returnthe max indices along with the outputs. Useful for <ahref="https://pytorch.org/docs/stable/generated/torch.nn.MaxUnpool2d.html#torch.nn.MaxUnpool2d"><code>torch.nn.MaxUnpool2d</code></a>later</li><li><strong>ceil_mode</strong> ‚Äì when True, will use ceil instead offloor to compute the output shape</li></ul><p>ÂØπ‰∫éceil_modeÁöÑ‰∏§ÁßçÊÉÖÂÜµÂ¶Ç‰∏ãÂõæÁ§∫ÊÑèÔºö</p><p><img src="/img/pytorch/8.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn<br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> MaxPool2d<br><br><span class="hljs-built_in">input</span> = torch.tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>],<br>                      [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>],<br>                      [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],<br>                      [<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>],<br>                      [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]], dtype=torch.float32)<br><span class="hljs-built_in">input</span> = torch.reshape(<span class="hljs-built_in">input</span>, (-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>))<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModel</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(MyModel, self).__init__()<br>        self.maxpool1 = MaxPool2d(kernel_size=<span class="hljs-number">3</span>, ceil_mode=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span></span>):<br>        output = self.maxpool1(<span class="hljs-built_in">input</span>)<br>        <span class="hljs-keyword">return</span> output<br><br><br>myModel = MyModel()<br>output = myModel(<span class="hljs-built_in">input</span>)<br><span class="hljs-built_in">print</span>(output)<br></code></pre></div></td></tr></table></figure><p>ËøêË°åÁªìÊûúÔºö</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">tensor([[[[2., 3.],<br>          [5., 1.]]]])<br></code></pre></div></td></tr></table></figure><p>ÂΩìÊàë‰ª¨Â∞Üceil_mode‰øÆÊîπ‰∏∫FalseÂêéÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">self.maxpool1 = MaxPool2d(kernel_size=<span class="hljs-number">3</span>, ceil_mode=<span class="hljs-literal">False</span>)<br></code></pre></div></td></tr></table></figure><p>ÁªìÊûú‰∏∫Ôºö</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">tensor([[[[2.]]]])<br></code></pre></div></td></tr></table></figure><p>Êàë‰ª¨ÂèØ‰ª•Áõ¥ËßÇÁöÑÊÑüÂèó‰∏Ä‰∏ãÊúÄÂ§ßÊ±†ÂåñÂêéÁöÑÁªìÊûúÔºåÊàë‰ª¨ÂèØ‰ª•Â∞ÜËæìÂÖ•Êç¢ÊàêÊàë‰ª¨ÁöÑÊï∞ÊçÆÈõÜÔºåÂú®tensorboard‰∏äÊü•ÁúãËæìÂÖ•ËæìÂá∫ÁöÑÂ∑ÆÂà´Ôºö</p><p><img src="/img/pytorch/9.png" /></p><h2 id="ÈùûÁ∫øÊÄßÊøÄÊ¥ª">7„ÄÅÈùûÁ∫øÊÄßÊøÄÊ¥ª</h2><p>È¶ñÂÖàÊàë‰ª¨Ë¶Å‰ΩøÁî®ÁöÑÊòØtorch.nn‰∏≠ÁöÑReLUÊñπÊ≥ï</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn<br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> ReLU<br><br><span class="hljs-built_in">input</span> = torch.tensor([[<span class="hljs-number">1</span>, -<span class="hljs-number">0.5</span>],<br>                      [-<span class="hljs-number">1</span>, <span class="hljs-number">3</span>]])<br><br><span class="hljs-built_in">input</span> = torch.reshape(<span class="hljs-built_in">input</span>, (-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>))<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModel</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(MyModel, self).__init__()<br>        self.relu1 = ReLU()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span></span>):<br>        output = self.relu1(<span class="hljs-built_in">input</span>)<br>        <span class="hljs-keyword">return</span> output<br><br><br>myModel = MyModel()<br>output = myModel(<span class="hljs-built_in">input</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">input</span>)<br><span class="hljs-built_in">print</span>(output)<br></code></pre></div></td></tr></table></figure><p>ÁªìÊûú‰∏∫Ôºö</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">tensor([[[[ 1.0000, -0.5000],<br>          [-1.0000,  3.0000]]]])<br>tensor([[[[1., 0.],<br>          [0., 3.]]]])<br></code></pre></div></td></tr></table></figure><p>ÁÑ∂ÂêéÊàë‰ª¨‰ΩøÁî®torch.nn‰∏≠ÁöÑSigmoidÊñπÊ≥ïÊõ¥Áõ¥ËßÇÁöÑÊù•Êü•ÁúãÁªìÊûúÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torchvision<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn<br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> Sigmoid<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader<br><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br><br>test_data = torchvision.datasets.CIFAR10(<span class="hljs-string">&quot;./dataset&quot;</span>, train=<span class="hljs-literal">False</span>, transform=torchvision.transforms.ToTensor(),<br>                                         download=<span class="hljs-literal">True</span>)<br>dataloader = DataLoader(dataset=test_data, batch_size=<span class="hljs-number">64</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModel</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(MyModel, self).__init__()<br>        self.sigmoid1 = Sigmoid()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span></span>):<br>        output = self.sigmoid1(<span class="hljs-built_in">input</span>)<br>        <span class="hljs-keyword">return</span> output<br><br>myModel = MyModel()<br>writer = SummaryWriter(<span class="hljs-string">&quot;logs_sigmoid&quot;</span>)<br>step = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> dataloader:<br>    imgs, target = data<br>    output = myModel(imgs)<br>    writer.add_images(<span class="hljs-string">&quot;input&quot;</span>, imgs, step)<br>    writer.add_images(<span class="hljs-string">&quot;output&quot;</span>, output, step)<br>    step = step + <span class="hljs-number">1</span><br><br>writer.close()<br></code></pre></div></td></tr></table></figure><p>Âú®tensorboard‰∏≠Êü•ÁúãËøêË°åÁªìÊûúÔºö</p><p><img src="/img/pytorch/10.png" /></p><h2 id="Á∫øÊÄßÂ±Ç-ÂèäÂÖ∂‰ªñÂ±Ç">8„ÄÅÁ∫øÊÄßÂ±Ç ÂèäÂÖ∂‰ªñÂ±Ç</h2><p>‰∏ªË¶ÅËøòÊòØÊü•ÁúãÂÆòÊñπÊñáÊ°£„ÄÇ</p><h2id="Êê≠Âª∫Â∞èÂÆû‰æãÂíåsequentialÁöÑ‰ΩøÁî®">9„ÄÅÊê≠Âª∫Â∞èÂÆû‰æãÂíåSequentialÁöÑ‰ΩøÁî®</h2><p>Êàë‰ª¨‰ΩøÁî®‰πãÂâçÂ≠¶‰π†ËøáÁöÑÂü∫Á°ÄÊù•Êê≠Âª∫‰∏Ä‰∏™ÁÆÄÂçïÁöÑÁ•ûÁªèÁΩëÁªúÔºå‰æãÂ¶ÇÊàë‰ª¨Êù•Êê≠Âª∫cifar10ÁöÑÊ®°ÂûãÔºåÂÖ∂Â¶Ç‰∏ãÂõæÊâÄÁ§∫</p><p><img src="/img/pytorch/11.png" /></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModel</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(MyModel, self).__init__()<br>        self.conv1 = Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">32</span>, <span class="hljs-number">5</span>, padding=<span class="hljs-number">2</span>)<br>        self.maxpool1 = MaxPool2d(<span class="hljs-number">2</span>)<br>        self.conv2 = Conv2d(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">5</span>, padding=<span class="hljs-number">2</span>)<br>        self.maxpool2 = MaxPool2d(<span class="hljs-number">2</span>)<br>        self.conv3 = Conv2d(<span class="hljs-number">32</span>, <span class="hljs-number">64</span>, <span class="hljs-number">5</span>, padding=<span class="hljs-number">2</span>)<br>        self.maxpool3 = MaxPool2d(<span class="hljs-number">2</span>)<br>        self.flatten = Flatten()<br>        self.linear1 = Linear(<span class="hljs-number">1024</span>, <span class="hljs-number">64</span>)<br>        self.linear2 = Linear(<span class="hljs-number">64</span>, <span class="hljs-number">10</span>)<br><br>        self.model1 = Sequential(<br>            Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">32</span>, <span class="hljs-number">5</span>, padding=<span class="hljs-number">2</span>)<br>        )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = self.conv1(x)<br>        x = self.maxpool1(x)<br>        x = self.conv2(x)<br>        x = self.maxpool2(x)<br>        x = self.conv2(x)<br>        x = self.maxpool2(x)<br>        x = self.flatten(x)<br>        x = self.linear1(x)<br>        x = self.linear2(x)<br>        <span class="hljs-keyword">return</span> x<br></code></pre></div></td></tr></table></figure><p>ÂºïÂÖ•‰∫ÜSequentialÊñπÊ≥ïÂêéÂèØ‰ª•Â∞ÜÊàë‰ª¨Êê≠Âª∫ÁöÑÊ®°ÂûãÁÆÄÂÜôÂá∫Êù•</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModel</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.model1 = Sequential(<br>            Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">32</span>, <span class="hljs-number">5</span>, padding=<span class="hljs-number">2</span>),<br>            MaxPool2d(<span class="hljs-number">2</span>),<br>            Conv2d(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">5</span>, padding=<span class="hljs-number">2</span>),<br>            MaxPool2d(<span class="hljs-number">2</span>),<br>            Conv2d(<span class="hljs-number">32</span>, <span class="hljs-number">64</span>, <span class="hljs-number">5</span>, padding=<span class="hljs-number">2</span>),<br>            MaxPool2d(<span class="hljs-number">2</span>),<br>            Flatten(),<br>            Linear(<span class="hljs-number">1024</span>, <span class="hljs-number">64</span>),<br>            Linear(<span class="hljs-number">64</span>, <span class="hljs-number">10</span>)<br>        )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = self.model1(x)<br>        <span class="hljs-keyword">return</span> x<br></code></pre></div></td></tr></table></figure><h2 id="ÊçüÂ§±ÂáΩÊï∞‰∏éÂèçÂêë‰º†Êí≠">10„ÄÅÊçüÂ§±ÂáΩÊï∞‰∏éÂèçÂêë‰º†Êí≠</h2><p>Êàë‰ª¨ÂèØ‰ª•‰ΩøÁî®torch.nn‰∏≠ÁöÑL1Loss‰ª•ÂèäMSELossÊñπÊ≥ïÊù•ÊûÑÈÄ†ÊçüÂ§±ÂáΩÊï∞Ôºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-built_in">input</span> = torch.tensor([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], dtype=torch.float32)<br>target = torch.tensor([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>], dtype=torch.float32)<br><br><span class="hljs-built_in">input</span> = torch.reshape(<span class="hljs-built_in">input</span>, (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>))<br>target = torch.reshape(target, (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>))<br><br>loss = L1Loss(reduction=<span class="hljs-string">&#x27;sum&#x27;</span>)<br>result = loss(<span class="hljs-built_in">input</span>, target)<br><br>loss_mse = nn.MSELoss()<br>result_mse = loss_mse(<span class="hljs-built_in">input</span>, target)<br><br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-built_in">print</span>(result_mse)<br></code></pre></div></td></tr></table></figure><p>ËøêË°åÁªìÊûú‰∏∫Ôºö</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">tensor(2.)<br>tensor(1.3333)<br></code></pre></div></td></tr></table></figure><p>Êàë‰ª¨ÂèØ‰ª•Âà©Áî®‰∫§ÂèâÁÜµ‰Ωú‰∏∫ÊçüÂ§±ÂáΩÊï∞Êù•ËøõË°åÂèçÂêë‰º†Êí≠ÔºåÂà©Áî®backwardÊñπÊ≥ïÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">myModel = MyModel()<br>loss = nn.CrossEntropyLoss()<br><span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> dataloader:<br>    imgs, targets = data<br>    output = myModel(imgs)<br>    result_loss = loss(output, targets)<br>    result_loss.backward()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ok&quot;</span>)<br></code></pre></div></td></tr></table></figure><h2 id="‰ºòÂåñÂô®">11„ÄÅ‰ºòÂåñÂô®</h2><p>‰ΩøÁî®torch.optim‰∏≠ÁöÑ‰ºòÂåñÂô®:</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">myModel = MyModel()<br>loss = nn.CrossEntropyLoss()<br>optim = torch.optim.SGD(myModel.parameters(), lr=<span class="hljs-number">0.01</span>)<br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>    runing_loss = <span class="hljs-number">0.0</span><br>    <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> dataloader:<br>        imgs, targets = data<br>        output = myModel(imgs)<br>        result_loss = loss(output, targets)<br>        optim.zero_grad()<span class="hljs-comment"># Â∞ÜÊ¢ØÂ∫¶ÂàùÂßãÂåñ‰∏∫0</span><br>        result_loss.backward()<br>        optim.step()<span class="hljs-comment"># ËøõË°å‰ºòÂåñ</span><br>        runing_loss = runing_loss + result_loss<br>    <span class="hljs-built_in">print</span>(runing_loss)<br></code></pre></div></td></tr></table></figure><p>ËøêË°åÁªìÊûúÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">tensor(<span class="hljs-number">18666.8984</span>, grad_fn=&lt;AddBackward0&gt;)<br>tensor(<span class="hljs-number">16161.6846</span>, grad_fn=&lt;AddBackward0&gt;)<br>tensor(<span class="hljs-number">15338.8057</span>, grad_fn=&lt;AddBackward0&gt;)<br>...<br></code></pre></div></td></tr></table></figure><p><code>torch.optim.lr_scheduler</code>Ê®°ÂùóÊèê‰æõ‰∫Ü‰∏Ä‰∫õÊ†πÊçÆepochËÆ≠ÁªÉÊ¨°Êï∞Êù•Ë∞ÉÊï¥Â≠¶‰π†ÁéáÔºàlearningrateÔºâÁöÑÊñπÊ≥ï„ÄÇ‰∏ÄËà¨ÊÉÖÂÜµ‰∏ãÊàë‰ª¨‰ºöËÆæÁΩÆÈöèÁùÄepochÁöÑÂ¢ûÂ§ßËÄåÈÄêÊ∏êÂáèÂ∞èÂ≠¶‰π†Áéá‰ªéËÄåËææÂà∞Êõ¥Â•ΩÁöÑËÆ≠ÁªÉÊïàÊûú„ÄÇ</p><p><code>torch.optim.lr_scheduler.LambdaLR</code>‰∏≠Â§ßÈÉ®ÂàÜË∞ÉÊï¥Â≠¶‰π†ÁéáÁöÑÊñπÊ≥ïÈÉΩÊòØÊ†πÊçÆepochËÆ≠ÁªÉÊ¨°Êï∞</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">torch</span>.optim.lr_scheduler.LambdaLR(optimizer, lr_lambda, last_epoch=-<span class="hljs-number">1</span>)<br></code></pre></div></td></tr></table></figure><p>Êõ¥Êñ∞Á≠ñÁï•Ôºö <span class="math display">\[new\_lr=\lambda \times initial\_lr\]</span> ÂÖ∂‰∏≠new_lrÊòØÂæóÂà∞ÁöÑÊñ∞ÁöÑÂ≠¶‰π†ÁéáÔºåinitial_lrÊòØÂàùÂßãÁöÑÂ≠¶‰π†ÁéáÔºå<spanclass="math inline">\(\lambda\)</span>ÊòØÈÄöËøáÂèÇÊï∞lr_lambdaÂíåepochÂæóÂà∞ÁöÑ„ÄÇ</p><p>ÂèÇÊï∞Ôºö</p><p>optimizer ÔºàOptimizerÔºâÔºöË¶ÅÊõ¥ÊîπÂ≠¶‰π†ÁéáÁöÑ‰ºòÂåñÂô®Ôºõ lr_lambdaÔºàfunctionor listÔºâÔºöÊ†πÊçÆepochËÆ°ÁÆó<spanclass="math inline">\(\lambda\)</span>ÁöÑÂáΩÊï∞ÔºõÊàñËÄÖÊòØ‰∏Ä‰∏™listÁöÑËøôÊ†∑ÁöÑfunctionÔºåÂàÜÂà´ËÆ°ÁÆóÂêÑ‰∏™parametergroupsÁöÑÂ≠¶‰π†ÁéáÊõ¥Êñ∞Áî®Âà∞ÁöÑ<span class="math inline">\(\lambda\)</span>Ôºõlast_epochÔºàintÔºâÔºöÊúÄÂêé‰∏Ä‰∏™epochÁöÑindexÔºåÂ¶ÇÊûúÊòØËÆ≠ÁªÉ‰∫ÜÂæàÂ§ö‰∏™epochÂêé‰∏≠Êñ≠‰∫ÜÔºåÁªßÁª≠ËÆ≠ÁªÉÔºåËøô‰∏™ÂÄºÂ∞±Á≠â‰∫éÂä†ËΩΩÁöÑÊ®°ÂûãÁöÑepoch„ÄÇÈªòËÆ§‰∏∫-1Ë°®Á§∫‰ªéÂ§¥ÂºÄÂßãËÆ≠ÁªÉÔºåÂç≥‰ªéepoch=1ÂºÄÂßã„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">net_1 = model()<br><br>optimizer_1 = torch.optim.Adam(net_1.parameters(), lr = initial_lr)<br>scheduler_1 = LambdaLR(optimizer_1, lr_lambda=<span class="hljs-keyword">lambda</span> epoch: <span class="hljs-number">1</span>/(epoch+<span class="hljs-number">1</span>))<br></code></pre></div></td></tr></table></figure><h2 id="Áé∞ÊúâÁΩëÁªúÊ®°ÂûãÁöÑ‰ΩøÁî®‰∏é‰øÆÊîπ">12„ÄÅÁé∞ÊúâÁΩëÁªúÊ®°ÂûãÁöÑ‰ΩøÁî®‰∏é‰øÆÊîπ</h2><p>Êàë‰ª¨‰ΩøÁî®torchvision‰∏≠Áé∞ÊúâÁöÑvgg16Ê®°ÂûãËøõË°å‰ΩøÁî®Ôºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">vgg16_true = torchvison.models.vgg16(pretrained=<span class="hljs-literal">True</span>)<br><span class="hljs-comment"># Ê∑ªÂä†Â±Ç</span><br>vgg16_true.classifier.add_module(<span class="hljs-string">&#x27;add_linear&#x27;</span>, nn.Linear(<span class="hljs-number">1000</span>, <span class="hljs-number">10</span>))<br><span class="hljs-comment"># ‰øÆÊîπÂ±Ç</span><br>vgg16_true.classifier[<span class="hljs-number">6</span>] = nn.Linear(<span class="hljs-number">4096</span>, <span class="hljs-number">10</span>)<br></code></pre></div></td></tr></table></figure><h2 id="ÁΩëÁªúÊ®°ÂûãÁöÑ‰øùÂ≠ò‰∏éËØªÂèñ">13„ÄÅÁΩëÁªúÊ®°ÂûãÁöÑ‰øùÂ≠ò‰∏éËØªÂèñ</h2><p>‰øùÂ≠òÊñπÊ≥ïÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">vgg16 = torchvision.models.vgg16(pretrained=<span class="hljs-literal">False</span>)<br><span class="hljs-comment"># ‰øùÂ≠òÊñπÊ≥ï1</span><br>torch.save(vgg16, <span class="hljs-string">&quot;vgg16_method1.pth&quot;</span>)<br><br><span class="hljs-comment"># ‰øùÂ≠òÊñπÊ≥ï‰∫åÔºåÂ∞ÜÊ®°ÂûãÂèÇÊï∞‰øùÂ≠ò‰∏∫Â≠óÂÖ∏ÔºàÂÆòÊñπÊé®ËçêÔºâ</span><br>torch.save(vgg16.state_dict(), <span class="hljs-string">&quot;vgg16_method2.pth&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>ËØªÂèñÊñπÊ≥ïÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ÊñπÊ≥ï1‰øùÂ≠òÁöÑÊ®°ÂûãËøõË°åËØªÂèñ</span><br>model = torch.load(<span class="hljs-string">&quot;vgg16_method1.pth&quot;</span>)<br><br><span class="hljs-comment"># ÊñπÊ≥ï2‰øùÂ≠òÁöÑÊ®°ÂûãËøõË°åËØªÂèñ</span><br>vgg16 = vgg16 = torchvision.models.vgg16(pretrained=<span class="hljs-literal">False</span>)<br>vgg16.load_state_dict(torch.load(<span class="hljs-string">&quot;vgg16_method1.pth&quot;</span>))<br></code></pre></div></td></tr></table></figure><h2 id="ÂÆåÊï¥ÁöÑÊ®°ÂûãËÆ≠ÁªÉ">14„ÄÅÂÆåÊï¥ÁöÑÊ®°ÂûãËÆ≠ÁªÉ</h2><p>model.pyÔºöÁî®‰∫é‰øùÂ≠òÁΩëÁªúÊ®°Âûã</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModel</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(MyModel, self).__init__()<br>        self.model = nn.Sequential(<br>            nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">32</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>            nn.MaxPool2d(<span class="hljs-number">2</span>),<br>            nn.Conv2d(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>            nn.MaxPool2d(<span class="hljs-number">2</span>),<br>            nn.Conv2d(<span class="hljs-number">32</span>, <span class="hljs-number">64</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>            nn.MaxPool2d(<span class="hljs-number">2</span>),<br>            nn.Flatten(),<br>            nn.Linear(<span class="hljs-number">64</span> * <span class="hljs-number">4</span> * <span class="hljs-number">4</span>, <span class="hljs-number">64</span>),<br>            nn.Linear(<span class="hljs-number">64</span>, <span class="hljs-number">10</span>)<br>        )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = self.model(x)<br>        <span class="hljs-keyword">return</span> x<br><br><br><span class="hljs-comment"># È™åËØÅ</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    myModel = MyModel()<br>    <span class="hljs-built_in">input</span> = torch.ones((<span class="hljs-number">64</span>, <span class="hljs-number">3</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>))<br>    output = myModel(<span class="hljs-built_in">input</span>)<br>    <span class="hljs-built_in">print</span>(output.shape)<br></code></pre></div></td></tr></table></figure><p>train.pyÔºöËøõË°åÁΩëÁªúËÆ≠ÁªÉ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torchvision<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader<br><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br><br><span class="hljs-keyword">from</span> model <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># ÂáÜÂ§áÊï∞ÊçÆÈõÜ</span><br>train_data = torchvision.datasets.CIFAR10(<span class="hljs-string">&quot;./dataset&quot;</span>, train=<span class="hljs-literal">True</span>, transform=torchvision.transforms.ToTensor(),<br>                                         download=<span class="hljs-literal">True</span>)<br>test_data = torchvision.datasets.CIFAR10(<span class="hljs-string">&quot;./dataset&quot;</span>, train=<span class="hljs-literal">False</span>, transform=torchvision.transforms.ToTensor(),<br>                                         download=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># Ëé∑ÂèñÊï∞ÊçÆÈõÜÈïøÂ∫¶</span><br>train_data_length = <span class="hljs-built_in">len</span>(train_data)<br>test_data_length = <span class="hljs-built_in">len</span>(test_data)<br><br><span class="hljs-comment"># Âà©Áî®DataLoaderÂä†ËΩΩÊï∞ÊçÆ</span><br>train_dataloader = DataLoader(train_data, batch_size=<span class="hljs-number">64</span>)<br>test_dataloader = DataLoader(test_data, batch_size=<span class="hljs-number">64</span>)<br><br><span class="hljs-comment"># ÂàõÂª∫ÁΩëÁªúÊ®°Âûã</span><br>myModel = MyModel()<br><br><span class="hljs-comment"># ÊçüÂ§±ÂáΩÊï∞</span><br>loss_fn = nn.CrossEntropyLoss()<br><br><span class="hljs-comment"># ‰ºòÂåñÂô®</span><br>learning_rate = <span class="hljs-number">0.01</span><br>optimizer = torch.optim.SGD(myModel.parameters(), lr=learning_rate)<br><br><span class="hljs-comment"># ËÆæÁΩÆËÆ≠ÁªÉÁΩëÁªúÁöÑ‰∏Ä‰∫õÂèÇÊï∞</span><br><span class="hljs-comment"># ËÆ∞ÂΩïËÆ≠ÁªÉÁöÑÊ¨°Êï∞</span><br>total_train_step = <span class="hljs-number">0</span><br><span class="hljs-comment"># ËÆ∞ÂΩïÊµãËØïÁöÑÊ¨°Êï∞</span><br>total_test_step = <span class="hljs-number">0</span><br><span class="hljs-comment"># ËÆ≠ÁªÉËÆ∫Êï∞</span><br>epoch = <span class="hljs-number">10</span><br><br><span class="hljs-comment"># Ê∑ªÂä†tensorboard</span><br>writer = SummaryWriter(<span class="hljs-string">&quot;logs_train&quot;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epoch):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;------Á¨¨%dËΩÆËÆ≠ÁªÉÂºÄÂßã------&quot;</span> % (i+<span class="hljs-number">1</span>))<br><br>    <span class="hljs-comment"># ËÆ≠ÁªÉÊ≠•È™§ÂºÄÂßã</span><br>    myModel.train()<br>    <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> train_dataloader:<br>        imgs, targets = data<br>        outputs = myModel(imgs)<br>        loss = loss_fn(outputs, targets)<br><br>        <span class="hljs-comment"># ‰ºòÂåñÂô®‰ºòÂåñÊ®°Âûã</span><br>        <span class="hljs-comment"># Âà©Áî®‰ºòÂåñÂô®ËøõË°åÊ¢ØÂ∫¶Ê∏ÖÈõ∂</span><br>        optimizer.zero_grad()<br>        <span class="hljs-comment"># ÂèçÂêë‰º†Êí≠</span><br>        loss.backward()<br>        optimizer.step()<br><br>        total_train_step = total_train_step + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> total_train_step % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ËÆ≠ÁªÉÊ¨°Êï∞Ôºö&#123;&#125;ÔºålossÔºö&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(total_train_step, loss.item()))<br>            writer.add_scalar(<span class="hljs-string">&quot;train_loss&quot;</span>, loss.item(), total_train_step)<br><br>    <span class="hljs-comment"># ÊµãËØïÊ≠•È™§ÂºÄÂßã</span><br>    myModel.<span class="hljs-built_in">eval</span>()<br>    total_test_loss = <span class="hljs-number">0</span><br>    total_accuracy = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">with</span> torch.no_grad():<br>        <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> test_dataloader:<br>            imgs, targets = data<br>            outputs = myModel(imgs)<br>            loss = loss_fn(outputs, targets)<br>            total_test_loss = total_test_loss + loss.item()<br>            accuracy = (outputs.argmax(<span class="hljs-number">1</span>) == targets).<span class="hljs-built_in">sum</span>()<br>            total_accuracy = total_accuracy + accuracy<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Êï¥‰ΩìÊµãËØïÈõÜ‰∏äÁöÑLossÔºö&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(total_test_loss))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Êï¥‰ΩìÊµãËØïÈõÜ‰∏äÁöÑÊ≠£Á°ÆÁéáÔºö&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(total_accuracy/test_data_length))<br>    writer.add_scalar(<span class="hljs-string">&quot;test_loss&quot;</span>, total_test_loss, total_test_step)<br>    writer.add_scalar(<span class="hljs-string">&quot;test_accuracy&quot;</span>, total_accuracy/test_data_length, total_test_step)<br>    total_test_step = total_test_step + <span class="hljs-number">1</span><br><br>    <span class="hljs-comment"># ‰øùÂ≠òÊØèËΩÆÁöÑÊï∞ÊçÆ</span><br>    torch.save(myModel, <span class="hljs-string">&quot;myModel_&#123;&#125;.pth&quot;</span>.<span class="hljs-built_in">format</span>(i))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Ê®°ÂûãÂ∑≤‰øùÂ≠ò&quot;</span>)<br><br>writer.close()<br></code></pre></div></td></tr></table></figure><h2 id="‰ΩøÁî®gpuËÆ≠ÁªÉ">15„ÄÅ‰ΩøÁî®GPUËÆ≠ÁªÉ</h2><h3 id="ÊñπÊ≥ï‰∏Ä">ÊñπÊ≥ï‰∏Ä</h3><p>Êàë‰ª¨ÈúÄË¶ÅÂØπÁΩëÁªúÊ®°Âûã„ÄÅÊï∞ÊçÆ„ÄÅÊçüÂ§±ÂáΩÊï∞ËøõË°å‰øÆÊîπ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ÊûÑÂª∫Ê®°Âûã</span><br>myModel = MyModel()<br><span class="hljs-keyword">if</span> torch.cuda.is_available():<br>    myModel = myModel.cuda()<br>    <br><span class="hljs-comment"># ÊçüÂ§±ÂáΩÊï∞</span><br>loss_fn = nn.CrossEntropyLoss()<br><span class="hljs-keyword">if</span> torch.cuda.is_available():<br>    loss_fn = loss_fn.cuda()<br>    <br>imgs, targets = data<br><span class="hljs-keyword">if</span> torch.cuda.is_available():<br>imgs = imgs.cuda()<br>targets = targets.cuda()<br></code></pre></div></td></tr></table></figure><h3 id="ÊñπÊ≥ï‰∫å">ÊñπÊ≥ï‰∫å</h3><p>ÈúÄË¶ÅÂú®Êñá‰ª∂ÊúÄÂºÄÂßãÂÆö‰πâËÆ≠ÁªÉÁöÑËÆæÂ§á</p><p>Ê≠§Êó∂‰∏∫Â∞ÜËÆæÂ§áËÆæÁΩÆ‰∏∫cpu</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ÂÆö‰πâËÆ≠ÁªÉÁöÑËÆæÂ§á</span><br>device = torch.device(<span class="hljs-string">&quot;cpu&quot;</span>)<br><br><span class="hljs-comment"># ÊûÑÂª∫Ê®°Âûã</span><br>myModel = MyModel()<br>myModel.to(device)<span class="hljs-comment"># Ê®°ÂûãÂíåÊçüÂ§±ÂáΩÊï∞‰∏çÁî®ÈáçÊñ∞ËµãÂÄº</span><br><br><span class="hljs-comment"># ÊçüÂ§±ÂáΩÊï∞</span><br>loss_fn = nn.CrossEntropyLoss()<br>loss_fn.to(device)<br><br>imgs, targets = data<br>imgs = imgs.to(device)<span class="hljs-comment"># Êï∞ÊçÆÈúÄË¶ÅÈáçÊñ∞ËµãÂÄº</span><br>targets = targets.to(device)<br></code></pre></div></td></tr></table></figure><p>Â¶ÇÊûúË¶Å‰ΩøÁî®gpuÈúÄË¶ÅÂ¶Ç‰∏ãËÆæÁΩÆÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ÂÆö‰πâËÆ≠ÁªÉÁöÑËÆæÂ§á</span><br>device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span>)<br></code></pre></div></td></tr></table></figure><p>Â¶ÇÊûúÊúâÂ§ö‰∏™gpuÔºåÂèØ‰ª•ÊåâÁÖßÂ¶Ç‰∏ãÈÄâÊã©ËÆæÁΩÆÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ÂÆö‰πâËÆ≠ÁªÉÁöÑËÆæÂ§á</span><br>device = torch.device(<span class="hljs-string">&quot;cudaÔºö0&quot;</span>)<br></code></pre></div></td></tr></table></figure><h2 id="Ê®°ÂûãÈ™åËØÅÂ•óË∑Ø">16„ÄÅÊ®°ÂûãÈ™åËØÅÂ•óË∑Ø</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">image_path = <span class="hljs-string">&quot;./img/dog.png&quot;</span><br><br>image = Image.<span class="hljs-built_in">open</span>(image_path)<br>image = image.convert(<span class="hljs-string">&#x27;RGB&#x27;</span>)<br><br>transform = torchvision.transforms.Compose([torchvision.transforms.Resize((<span class="hljs-number">32</span>, <span class="hljs-number">32</span>)),<br>                                            torchvision.transforms.ToTensor()])<br><br>image = transform(image)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModel</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(MyModel, self).__init__()<br>        self.model = nn.Sequential(<br>            nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">32</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>            nn.MaxPool2d(<span class="hljs-number">2</span>),<br>            nn.Conv2d(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>            nn.MaxPool2d(<span class="hljs-number">2</span>),<br>            nn.Conv2d(<span class="hljs-number">32</span>, <span class="hljs-number">64</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<br>            nn.MaxPool2d(<span class="hljs-number">2</span>),<br>            nn.Flatten(),<br>            nn.Linear(<span class="hljs-number">64</span> * <span class="hljs-number">4</span> * <span class="hljs-number">4</span>, <span class="hljs-number">64</span>),<br>            nn.Linear(<span class="hljs-number">64</span>, <span class="hljs-number">10</span>)<br>        )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = self.model(x)<br>        <span class="hljs-keyword">return</span> x<br><br><br>myModel = torch.load(<span class="hljs-string">&quot;myModel_0.pth&quot;</span>)<br><span class="hljs-built_in">print</span>(myModel)<br>image = torch.reshape(image, (<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>))<br>myModel.<span class="hljs-built_in">eval</span>()<br><span class="hljs-keyword">with</span> torch.no_grad():<br>    output = myModel(image)<br><span class="hljs-built_in">print</span>(output)<br><span class="hljs-built_in">print</span>(output.argmax(<span class="hljs-number">1</span>))<br></code></pre></div></td></tr></table></figure><p>ËæìÂá∫‰∏∫Ôºö</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">tensor([[ 0.3308,  0.0307,  0.9064,  0.9474,  0.2715,  0.8123, -0.4077,  0.2044,<br>         -0.4149, -1.0106]])<br>tensor([3])<br></code></pre></div></td></tr></table></figure><p>ÂèØ‰ª•ÁúãÂà∞ÊúÄÂêéÈ¢ÑÊµãÊàë‰ª¨ÁöÑÂõæÁâáÂ±û‰∫éÁ¨¨‰∏âÁ±ª</p><h2 id="lstm">17„ÄÅLSTM</h2><p><strong>ËæìÂÖ•ÁöÑÂèÇÊï∞ÂàóË°®ÂåÖÊã¨:</strong></p><ul><li>input_sizeËæìÂÖ•Êï∞ÊçÆÁöÑÁâπÂæÅÁª¥Êï∞ÔºåÈÄöÂ∏∏Â∞±ÊòØembedding_dim(ËØçÂêëÈáèÁöÑÁª¥Â∫¶)</li><li>hidden_size„ÄÄLSTM‰∏≠ÈöêÂ±ÇÁöÑÁª¥Â∫¶</li><li>num_layers„ÄÄÂæ™ÁéØÁ•ûÁªèÁΩëÁªúÁöÑÂ±ÇÊï∞</li><li>bias„ÄÄÁî®‰∏çÁî®ÂÅèÁΩÆÔºådefault=True</li><li>batch_firstËøô‰∏™Ë¶ÅÊ≥®ÊÑèÔºåÈÄöÂ∏∏Êàë‰ª¨ËæìÂÖ•ÁöÑÊï∞ÊçÆshape=(batch_size,seq_length,embedding_dim),ËÄåbatch_firstÈªòËÆ§ÊòØFalse,ÊâÄ‰ª•Êàë‰ª¨ÁöÑËæìÂÖ•Êï∞ÊçÆÊúÄÂ•ΩÈÄÅËøõLSTM‰πãÂâçÂ∞Übatch_size‰∏éseq_lengthËøô‰∏§‰∏™Áª¥Â∫¶Ë∞ÉÊç¢</li><li>dropout„ÄÄÈªòËÆ§ÊòØ0Ôºå‰ª£Ë°®‰∏çÁî®dropout</li><li>bidirectionalÈªòËÆ§ÊòØfalseÔºå‰ª£Ë°®‰∏çÁî®ÂèåÂêëLSTM</li></ul><p><strong>ËæìÂÖ•Êï∞ÊçÆÂåÖÊã¨input,(h_0,c_0):</strong></p><ul><li>inputÂ∞±ÊòØshape=(seq_length,batch_size,input_size)ÁöÑÂº†Èáè</li><li>h_0ÊòØshape=(num_layers*num_directions,batch_size,hidden_size)ÁöÑÂº†ÈáèÔºåÂÆÉÂåÖÂê´‰∫ÜÂú®ÂΩìÂâçËøô‰∏™batch_size‰∏≠ÊØè‰∏™Âè•Â≠êÁöÑÂàùÂßãÈöêËóèÁä∂ÊÄÅ„ÄÇÂÖ∂‰∏≠num_layersÂ∞±ÊòØLSTMÁöÑÂ±ÇÊï∞„ÄÇÂ¶ÇÊûúbidirectional=True,num_directions=2,Âê¶ÂàôÂ∞±ÊòØÔºëÔºåË°®Á§∫Âè™Êúâ‰∏Ä‰∏™ÊñπÂêë„ÄÇ</li><li>c_0Âíåh_0ÁöÑÂΩ¢Áä∂Áõ∏ÂêåÔºåÂÆÉÂåÖÂê´ÁöÑÊòØÂú®ÂΩìÂâçËøô‰∏™batch_size‰∏≠ÁöÑÊØè‰∏™Âè•Â≠êÁöÑÂàùÂßãÁªÜËÉûÁä∂ÊÄÅ„ÄÇh_0,c_0Â¶ÇÊûú‰∏çÊèê‰æõÔºåÈÇ£‰πàÈªòËÆ§ÊòØÔºê„ÄÇ</li></ul><p><strong>ËæìÂá∫Êï∞ÊçÆÂåÖÊã¨output,(h_n,c_n):</strong></p><ul><li>outputÁöÑshape=(seq_length,batch_size,num_directions*hidden_size),ÂÆÉÂåÖÂê´ÁöÑÊòØLSTMÁöÑÊúÄÂêé‰∏ÄÊó∂Èó¥Ê≠•ÁöÑËæìÂá∫ÁâπÂæÅ(h_t),ÔΩîÊòØbatch_size‰∏≠ÊØè‰∏™Âè•Â≠êÁöÑÈïøÂ∫¶„ÄÇ</li><li>h_n.shape==(num_directions * num_layers,batch,hidden_size)</li><li>h_nÂåÖÂê´ÁöÑÊòØÂè•Â≠êÁöÑÊúÄÂêé‰∏Ä‰∏™ÂçïËØçÔºà‰πüÂ∞±ÊòØÊúÄÂêé‰∏Ä‰∏™Êó∂Èó¥Ê≠•ÔºâÁöÑÈöêËóèÁä∂ÊÄÅÔºåc_nÂåÖÂê´ÁöÑÊòØÂè•Â≠êÁöÑÊúÄÂêé‰∏Ä‰∏™ÂçïËØçÁöÑÁªÜËÉûÁä∂ÊÄÅÔºåÊâÄ‰ª•ÂÆÉ‰ª¨ÈÉΩ‰∏éÂè•Â≠êÁöÑÈïøÂ∫¶seq_lengthÊó†ÂÖ≥„ÄÇ</li><li>output[-1]‰∏éh_nÊòØÁõ∏Á≠âÁöÑÔºåÂõ†‰∏∫output[-1]ÂåÖÂê´ÁöÑÊ≠£ÊòØbatch_size‰∏™Âè•Â≠ê‰∏≠ÊØè‰∏Ä‰∏™Âè•Â≠êÁöÑÊúÄÂêé‰∏Ä‰∏™ÂçïËØçÁöÑÈöêËóèÁä∂ÊÄÅÔºåÊ≥®ÊÑèLSTM‰∏≠ÁöÑÈöêËóèÁä∂ÊÄÅÂÖ∂ÂÆûÂ∞±ÊòØËæìÂá∫ÔºåcellstateÁªÜËÉûÁä∂ÊÄÅÊâçÊòØLSTM‰∏≠‰∏ÄÁõ¥ÈöêËóèÁöÑÔºåËÆ∞ÂΩïÁùÄ‰ø°ÊÅØ„ÄÇ</li></ul><h2 id="lstmcell">18„ÄÅLSTMcell</h2><p>‰∏äËø∞ÁöÑnn.LSTMÊ®°Âùó‰∏ÄÊ¨°ÊûÑÈÄ†ÂÆåËã•Âπ≤Â±ÇÁöÑLSTM,‰ΩÜÊòØ‰∏∫‰∫ÜÂØπÊ®°ÂûãÊúâÊõ¥Âä†ÁÅµÊ¥ªÁöÑÂ§Ñnn‰∏≠ËøòÊúâ‰∏Ä‰∏™LSTMCellÊ®°ÂùóÔºåÊòØÁªÑÊàêLSTMÊï¥‰∏™Â∫èÂàóËÆ°ÁÆóËøáÁ®ãÁöÑÂü∫Êú¨ÁªÑÊàêÂçïÂÖÉÔºå‰πüÂ∞±ÊòØËøõË°åsequence‰∏≠‰∏Ä‰∏™wordÁöÑËÆ°ÁÆó„ÄÇ</p><p>ÂêåÊó∂ÂÆÉÁöÑÂèÇÊï∞‰πüÂ∞±Âè™Êúâ3‰∏™ÔºöËæìÂÖ•Áª¥Â∫¶ÔºåÈöêËäÇÁÇπÊï∞ÊçÆÁª¥Â∫¶ÔºåÊòØÂê¶Â∏¶ÊúâÂÅèÁΩÆ„ÄÇ‰ªÖÊèê‰æõÊúÄÂü∫Êú¨‰∏Ä‰∏™LSTMÂçïÂÖÉÁªìÊûÑÔºåÊÉ≥Ë¶ÅÂÆåÊï¥ÁöÑËøõË°å‰∏Ä‰∏™Â∫èÂàóÁöÑËÆ≠ÁªÉÁöÑË¶ÅËøòË¶ÅËá™Â∑±ÁºñÂÜô‰º†Êí≠ÂáΩÊï∞ÊääcellÈó¥ÁöÑËæìÂÖ•ËæìÂá∫ËøûÊé•Ëµ∑Êù•„ÄÇ‰ΩÜÊòØÊÉ≥Ë¶ÅËá™ÂÆö‰πâ‰∏çÂêåcellÈöêËäÇÁÇπÁª¥Â∫¶ÁöÑÂ§öÂ±ÇLSTMÁöÑËØùÔºåËøô‰∏™Ê®°ÂùóËøòÊòØÊå∫ÊúâÁî®ÁöÑ„ÄÇ</p><h2 id="pad_sequence">19„ÄÅpad_sequence</h2><p><strong>sequences</strong>ÔºöË°®Á§∫ËæìÂÖ•Ê†∑Êú¨Â∫èÂàóÔºå‰∏∫ list Á±ªÂûãÔºålist‰∏≠ÁöÑÂÖÉÁ¥†‰∏∫ tensor Á±ªÂûã„ÄÇ tensor ÁöÑ size ‰∏∫ L * F „ÄÇÂÖ∂‰∏≠ÔºåL‰∏∫Âçï‰∏™Â∫èÂàóÁöÑÈïøÂ∫¶ÔºåF ‰∏∫Â∫èÂàó‰∏≠ÊØè‰∏™Êó∂Èó¥Ê≠•ÔºàtimestepÔºâÁâπÂæÅÁöÑ‰∏™Êï∞ÔºåÊ†πÊçÆ‰ªªÂä°ÁöÑ‰∏çÂêå F ÁöÑÁª¥Â∫¶‰ºöÊúâÊâÄ‰∏çÂêå„ÄÇ</p><p><strong>batch_first</strong>Ôºö‰∏∫ True ÂØπÂ∫î [batch_size, seq_len,feature]ÔºõFalse ÂØπÂ∫î[seq_len, batch_size,feature]Ôºå‰ªé‰π†ÊÉØ‰∏äÊù•ËÆ≤‰∏ÄËà¨ËÆæÁΩÆ‰∏∫ True ÊØîËæÉÁ¨¶ÂêàÊàë‰ª¨ÁöÑËÆ§Áü•„ÄÇ</p><p><strong>padding_value</strong>ÔºöÂ°´ÂÖÖÂÄºÔºåÈªòËÆ§ÂÄº‰∏∫ 0 „ÄÇ</p><p><strong>ËØ¥Êòé</strong></p><p>‰∏ªË¶ÅÁî®Êù•ÂØπÊ†∑Êú¨ËøõË°åÂ°´ÂÖÖÔºåÂ°´ÂÖÖÂÄº‰∏ÄËà¨‰∏∫ 0„ÄÇÊàë‰ª¨Âú®ËÆ≠ÁªÉÁΩëÁªúÊó∂Ôºå‰∏ÄËà¨‰ºöÈááÁî®‰∏Ä‰∏™‰∏Ä‰∏™ mini-batchÁöÑÊñπÂºèÔºåÂ∞ÜËÆ≠ÁªÉÊ†∑Êú¨Êï∞ÊçÆÂñÇÁªôÁΩëÁªú„ÄÇÂú® PyTorch ÈáåÈù¢Êï∞ÊçÆÈÉΩÊòØ‰ª• tensorÁöÑÂΩ¢ÂºèÂ≠òÂú®Ôºå‰∏Ä‰∏™ mini-batch ÂÆûÈôÖ‰∏äÂ∞±ÊòØ‰∏Ä‰∏™È´òÁª¥ÁöÑ tensorÔºåÊØè‰∏™Â∫èÂàóÊï∞ÊçÆÁöÑÈïøÂ∫¶ÂøÖÈ°ªÁõ∏ÂêåÊâçËÉΩÁªÑÊàê‰∏Ä‰∏™ tensor „ÄÇ‰∏∫‰∫Ü‰ΩøÁΩëÁªúÂèØ‰ª•Â§ÑÁêÜmini-batch ÂΩ¢ÂºèÁöÑÊï∞ÊçÆÔºåÂ∞±ÂøÖÈ°ªÂØπÂ∫èÂàóÊ†∑Êú¨ËøõË°åÂ°´ÂÖÖÔºå‰øùËØÅ‰∏Ä‰∏™ mini-batchÈáåÈù¢ÁöÑÊï∞ÊçÆÈïøÂ∫¶ÊòØÁõ∏ÂêåÁöÑ„ÄÇ</p><p>Âú® PyTorch ÈáåÈù¢‰∏ÄËà¨ÊòØ‰ΩøÁî® DataLoader ËøõË°åÊï∞ÊçÆÂä†ËΩΩÔºåËøîÂõû mini-batchÂΩ¢ÂºèÁöÑÊï∞ÊçÆÔºåÂÜçÂ∞ÜÊ≠§Êï∞ÊçÆÂñÇÁªôÁΩëÁªúËøõË°åËÆ≠ÁªÉ„ÄÇÊàë‰ª¨‰∏ÄËà¨‰ºöËá™ÂÆö‰πâ‰∏Ä‰∏™ collate_fnÂáΩÊï∞ÔºåÂÆåÊàêÂØπÊï∞ÊçÆÁöÑÂ°´ÂÖÖ„ÄÇ</p><p><strong>Á§∫‰æã</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset, DataLoader<br><span class="hljs-keyword">from</span> torch.nn.utils.rnn <span class="hljs-keyword">import</span> pad_sequence,pack_padded_sequence,pack_sequence,pad_packed_sequence<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyData</span>(<span class="hljs-title class_ inherited__">Dataset</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data</span>):<br>        self.data = data<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.data)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, idx</span>):<br>        <span class="hljs-keyword">return</span> self.data[idx]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">collate_fn</span>(<span class="hljs-params">data</span>):<br>    data.sort(key=<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">len</span>(x), reverse=<span class="hljs-literal">True</span>)<br>    data = pad_sequence(data, batch_first=<span class="hljs-literal">True</span>, padding_value=<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> data<br><br>a = torch.tensor([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])<br>b = torch.tensor([<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>])<br>c = torch.tensor([<span class="hljs-number">7</span>,<span class="hljs-number">8</span>])<br>d = torch.tensor([<span class="hljs-number">9</span>])<br>train_x = [a, b, c, d]<br><br>data = MyData(train_x)<br>data_loader = DataLoader(data, batch_size=<span class="hljs-number">2</span>, shuffle=<span class="hljs-literal">True</span>, collate_fn=collate_fn)<br><span class="hljs-comment"># ÈááÁî®ÈªòËÆ§ÁöÑ collate_fn ‰ºöÊä•Èîô</span><br><span class="hljs-comment">#data_loader = DataLoader(data, batch_size=2, shuffle=True) </span><br>batch_x = <span class="hljs-built_in">iter</span>(data_loader).<span class="hljs-built_in">next</span>()<br></code></pre></div></td></tr></table></figure><p>ËøêË°åÁ®ãÂ∫èÔºåÂæóÂà∞ batch_x ÁöÑÂÄºÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># batch_x</span><br>tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>],<br>        [<span class="hljs-number">9</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]])<br></code></pre></div></td></tr></table></figure><p>‰ªé batch_x ÁöÑÂÄºÂèØ‰ª•ÁúãÂá∫ÔºåÁ¨¨‰∫åË°åÂ°´ÂÖÖ‰∫Ü‰∏â‰∏™ 0Ôºå‰ΩøÂÖ∂ÈïøÂ∫¶ÂíåÁ¨¨‰∏ÄË°å‰øùÊåÅ‰∏ÄËá¥„ÄÇ</p><p>ÈúÄË¶ÅËØ¥ÊòéÁöÑÊòØÔºåÂØπ‰∫éÈïøÂ∫¶‰∏çÂêåÁöÑÂ∫èÂàóÔºå‰ΩøÁî®ÈªòËÆ§ÁöÑ collate_fnÂáΩÊï∞Ôºå‰∏çËá™ÂÆö‰πâ collate_fn ÂáΩÊï∞ÂÆåÊàêÂØπÂ∫èÂàóÁöÑÂ°´ÂÖÖÔºå‰∏äÈù¢ÁöÑÁ®ãÂ∫èÂ∞±‰ºöÊä•Èîô„ÄÇ</p><h2 id="pack_padded_sequence">20„ÄÅpack_padded_sequence</h2><p><strong>ÂèÇÊï∞</strong></p><p><strong>input</strong>ÔºöÁªèËøá pad_sequence Â§ÑÁêÜ‰πãÂêéÁöÑÊï∞ÊçÆ„ÄÇ</p><p><strong>lengths</strong>Ôºömini-batch‰∏≠ÂêÑ‰∏™Â∫èÂàóÁöÑÂÆûÈôÖÈïøÂ∫¶„ÄÇ</p><p><strong>batch_first</strong>ÔºöTrue ÂØπÂ∫î [batch_size, seq_len,feature] Ôºõ</p><p>False ÂØπÂ∫î [seq_len, batch_size, feature] „ÄÇ</p><p><strong>enforce_sorted</strong>ÔºöÂ¶ÇÊûúÊòØ TrueÔºåÂàôËæìÂÖ•Â∫îËØ•ÊòØÊåâÈïøÂ∫¶ÈôçÂ∫èÊéíÂ∫èÁöÑÂ∫èÂàó„ÄÇÂ¶ÇÊûúÊòØ FalseÔºå‰ºöÂú®ÂáΩÊï∞ÂÜÖÈÉ®ËøõË°åÊéíÂ∫è„ÄÇÈªòËÆ§ÂÄº‰∏∫ True „ÄÇ</p><p><strong>ËØ¥Êòé</strong></p><p>Ëøô‰∏™ pack ÁöÑÊÑèÊÄùÂèØ‰ª•ÁêÜËß£‰∏∫ÂéãÁ¥ßÊàñÂéãÁº©ÔºåÂõ†‰∏∫Êï∞ÊçÆÂú®ÁªèËøáÂ°´ÂÖÖ‰πãÂêéÔºå‰ºöÊúâÂæàÂ§öÂÜó‰ΩôÁöÑpadding_valueÔºåÊâÄ‰ª•ÈúÄË¶ÅÂéãÁº©‰∏Ä‰∏ã„ÄÇ</p><p>‰∏∫‰ªÄ‰πàË¶Å‰ΩøÁî®Ëøô‰∏™ÂáΩÊï∞Âë¢Ôºü</p><p>RNN ËØªÂèñÊï∞ÊçÆÁöÑÊñπÂºèÔºöÁΩëÁªúÊØèÊ¨°ÂêÉËøõÂéª‰∏ÄÁªÑÂêåÊ†∑Êó∂Èó¥Ê≠• Ôºàtime stepÔºâÁöÑÊï∞ÊçÆÔºå‰πüÂ∞±ÊòØ mini-batch ÁöÑÊâÄÊúâÊ†∑Êú¨‰∏≠‰∏ãÊ†áÁõ∏ÂêåÁöÑÊï∞ÊçÆÔºåÁÑ∂ÂêéËé∑Âæó‰∏Ä‰∏™mini-batch ÁöÑËæìÂá∫ÔºõÂÜçÁßªÂà∞‰∏ã‰∏Ä‰∏™Êó∂Èó¥Ê≠• Ôºàtime stepÔºâÔºåÂÜçËØªÂÖ• mini-batch‰∏≠ÊâÄÊúâËØ•Êó∂Èó¥Ê≠•ÁöÑÊï∞ÊçÆÔºåÂÜçËæìÂá∫ÔºõÁõ¥Âà∞Â§ÑÁêÜÂÆåÊâÄÊúâÁöÑÊó∂Èó¥Ê≠•Êï∞ÊçÆ„ÄÇ</p><p>Á¨¨‰∏Ä‰∏™Êó∂Èó¥Ê≠•Ôºö</p><p><img src="/img/pytorch/12.png" /></p><p>Á¨¨‰∫å‰∏™Êó∂Èó¥Ê≠•Ôºö</p><p><img src="/img/pytorch/13.png" /></p><p>mini-batch ‰∏≠ÁöÑ 0 Âè™ÊòØÁî®Êù•ÂÅöÊï∞ÊçÆÂØπÈΩêÁöÑ padding_value ÔºåÂ¶ÇÊûúËøõË°åforward ËÆ°ÁÆóÊó∂ÔºåÊää padding_value‰πüËÄÉËôëËøõÂéªÔºåÂèØËÉΩ‰ºöÂØºËá¥RNNÈÄöËøá‰∫ÜÈùûÂ∏∏Â§öÊó†Áî®ÁöÑpadding_valueÔºåËøôÊ†∑‰∏ç‰ªÖÊµ™Ë¥πËÆ°ÁÆóËµÑÊ∫êÔºåÊúÄÂêéÂæóÂà∞ÁöÑÂÄºÂèØËÉΩËøò‰ºöÂ≠òÂú®ËØØÂ∑Æ„ÄÇÂØπ‰∫é‰∏äÈù¢ÁöÑÂ∫èÂàó2 ÁöÑÊï∞ÊçÆÔºåÈÄöËøá RNN ÁΩëÁªúÔºö</p><p><img src="/img/pytorch/14.png" /></p><p>ÂÆûÈôÖ‰∏ä‰ªéÁ¨¨ 2 ‰∏™Êó∂Èó¥Ê≠•ÂºÄÂßã‰∏ÄÁõ¥Âà∞ÊúÄÂêéÁöÑËÆ°ÁÆóÈÉΩÊòØÂ§ö‰ΩôÁöÑÔºåËæìÂÖ•ÈÉΩÊòØÊó†ÊïàÁöÑpadding_value ËÄåÂ∑≤„ÄÇ</p><p>‰ªé‰∏äÈù¢ÁöÑÂàÜÊûêÂèØ‰ª•ÁúãÂá∫Ôºå‰∏∫‰∫Ü‰Ωø RNN ÂèØ‰ª•È´òÊïàÁöÑËØªÂèñÊï∞ÊçÆËøõË°åËÆ≠ÁªÉÔºåÂ∞±ÈúÄË¶ÅÂú®pad ‰πãÂêéÂÜç‰ΩøÁî® pack_padded_sequence ÂØπÊï∞ÊçÆËøõË°åÂ§ÑÁêÜ„ÄÇ</p><p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÈªòËÆ§Êù°‰ª∂‰∏ãÔºåÊàë‰ª¨ÂøÖÈ°ªÊääËæìÂÖ•Êï∞ÊçÆÊåâÁÖßÂ∫èÂàóÈïøÂ∫¶‰ªéÂ§ßÂà∞Â∞èÊéíÂàóÂêéÊâçËÉΩÈÄÅÂÖ•pack_padded_sequence ÔºåÂê¶Âàô‰ºöÊä•Èîô„ÄÇ</p><p><strong>Á§∫‰æã</strong></p><p>Âè™ÈúÄË¶ÅÂ∞Ü‰∏äÈù¢ÁöÑ‰æãÂ≠ê‰∏≠ÁöÑ collate_fnÂáΩÊï∞Á®ç‰Ωú‰øÆÊîπÂç≥ÂèØÔºåÂÖ∂‰ΩôÈÉ®ÂàÜ‰øùÊåÅ‰∏çÂèò„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">collate_fn</span>(<span class="hljs-params">data</span>):<br>    data.sort(key=<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">len</span>(x), reverse=<span class="hljs-literal">True</span>)<br>    seq_len = [s.size(<span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> data] <span class="hljs-comment"># Ëé∑ÂèñÊï∞ÊçÆÁúüÂÆûÁöÑÈïøÂ∫¶</span><br>    data = pad_sequence(data, batch_first=<span class="hljs-literal">True</span>)    <br>    data = pack_padded_sequence(data, seq_len, batch_first=<span class="hljs-literal">True</span>)<br>    <span class="hljs-keyword">return</span> data<br></code></pre></div></td></tr></table></figure><p>ËæìÂá∫Ôºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># batch_x</span><br>PackedSequence(data=tensor([<span class="hljs-number">1</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]), <br>               batch_sizes=tensor([<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]), <br>               sorted_indices=<span class="hljs-literal">None</span>, unsorted_indices=<span class="hljs-literal">None</span>)<br></code></pre></div></td></tr></table></figure><p>ÂèØ‰ª•ÁúãÂá∫ÔºåËæìÂá∫ËøîÂõû‰∏Ä‰∏™ PackedSequence ÂØπË±°ÔºåÂÆÉ‰∏ªË¶ÅÂåÖÂê´‰∏§ÈÉ®ÂàÜÔºödata Âíåbatch_sizes „ÄÇ</p><p><img src="/img/pytorch/15.png" /></p><p>Â°´ÂÖÖÂÄº 0 Â∞±Ë¢´Ë∑≥Ëøá‰∫Ü„ÄÇbatch_size‰∏≠ÁöÑÂÄºÔºåÂÆûÈôÖ‰∏äÂ∞±ÊòØÂëäËØâÁΩëÁªúÊØè‰∏™Êó∂Èó¥Ê≠•ÈúÄË¶ÅÂêÉËøõÂéªÂ§öÂ∞ëÊï∞ÊçÆ„ÄÇ</p><p>Â¶ÇÊûú‰ªîÁªÜÁúãÔºåÂÖ∂ÂÆûËæìÂá∫ÁöÑ PackedSequence ÂØπË±°ËøòÂåÖÂê´‰∏§‰∏™ÈÉ®ÂàÜsorted_indices Âíåunsorted_indices „ÄÇÂâçÈù¢ËØ¥Âà∞ pack_padded_sequenceËøòÊúâ‰∏Ä‰∏™ÂèÇÊï∞ <strong>enforce_sorted</strong> ÔºåÂ¶ÇÊûúÊòØ TrueÔºåÂàôËæìÂÖ•Â∫îËØ•ÊòØÊåâÈïøÂ∫¶ÈôçÂ∫èÊéíÂ∫èÁöÑÂ∫èÂàó„ÄÇÂ¶ÇÊûúÊòØ FalseÔºå‰ºöÂú®ÂáΩÊï∞ÂÜÖÈÉ®ËøõË°åÊéíÂ∫è„ÄÇÈªòËÆ§ÂÄº‰∏∫ True „ÄÇ‰πüÂ∞±ÊòØËØ¥Âú®ËæìÂÖ•pack_padded_sequence ÂâçÔºåÊàë‰ª¨‰πüÂèØ‰ª•‰∏çÂØπÊï∞ÊçÆËøõË°åÊéíÂ∫è„ÄÇ</p><p>Áé∞Âú®Êàë‰ª¨Â∞Ü enforce_sorted ËÆæÁΩÆ‰∏∫ FalseÔºå‰∏îËæìÂÖ•Êï∞ÊçÆ‰∏çÈ¢ÑÂÖàËøõË°åÊéíÂ∫è„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">data = [torch.tensor([<span class="hljs-number">9</span>]), <br>        torch.tensor([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]),<br>        torch.tensor([<span class="hljs-number">5</span>,<span class="hljs-number">6</span>])]<br><br>seq_len = [s.size(<span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> data]<br>data = pad_sequence(data, batch_first=<span class="hljs-literal">True</span>)    <br>data = pack_padded_sequence(data, seq_len, batch_first=<span class="hljs-literal">True</span>, enforce_sorted=<span class="hljs-literal">False</span>)<br></code></pre></div></td></tr></table></figure><p>ËæìÂá∫Ôºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">PackedSequence(data=tensor([<span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]), <br>               batch_sizes=tensor([<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]), <br>               sorted_indices=tensor([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>]), <br>               unsorted_indices=tensor([<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]))<br></code></pre></div></td></tr></table></figure><p>sorted_indices = tensor([1, 2, 0]ÔºåË°®Á§∫ÊéíÂ∫è‰πãÂêéÁöÑÁªìÊûú‰∏éÂéüÂßã data ‰∏≠ÁöÑtensor ÁöÑ‰∏ãÊ†áÂØπÂ∫îÂÖ≥Á≥ª„ÄÇ1 Ë°®Á§∫ÂéüÂßã data ‰∏≠ Á¨¨ 1Ë°åÊúÄÈïøÔºåÊéíÂ∫è‰πãÂêéÊéíÂú®ÊúÄÂâçÈù¢ÔºåÂÖ∂Ê¨°ÊòØÁ¨¨ 2 Ë°å„ÄÅÁ¨¨ 0 Ë°å„ÄÇ</p><p>ÂÅáËÆæÊéíÂ∫è‰πãÂêéÁöÑÁªìÊûú‰∏∫Ôºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">sort_data = [torch.tensor([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]),<br>             torch.tensor([<span class="hljs-number">5</span>,<span class="hljs-number">6</span>])<br>             torch.tensor([<span class="hljs-number">9</span>]), <br>             ]<br></code></pre></div></td></tr></table></figure><p>unsorted_indices = tensor([2, 0, 1]ÔºåË°®Á§∫Êú™ÊéíÂ∫èÂâçÁªìÊûú„ÄÇ2 Ë°®Á§∫sort_data ÁöÑÁ¨¨ 2 Ë°åÂØπÂ∫î data ‰∏≠Á¨¨ 0 Ë°åÔºõ0 Ë°®Á§∫ sort_data ÁöÑÁ¨¨ 0 Ë°åÂØπÂ∫îdata ‰∏≠ÁöÑÁ¨¨ 1 Ë°åÔºõ1 Ë°®Á§∫ sort_data ÁöÑÁ¨¨ 1 Ë°åÂØπÂ∫î data ‰∏≠ÁöÑÁ¨¨ 2 Ë°å„ÄÇ</p><h2 id="pack_sequence">21„ÄÅpack_sequence</h2><p><strong>ÂèÇÊï∞</strong></p><p><strong>sequences</strong>ÔºöËæìÂÖ•Ê†∑Êú¨Â∫èÂàóÔºå‰∏∫ list Á±ªÂûãÔºålist‰∏≠ÁöÑÂÖÉÁ¥†‰∏∫ tensor Ôºõtensor ÁöÑ size ‰∏∫ L * FÔºåÂÖ∂‰∏≠ÔºåL ‰∏∫Âçï‰∏™Â∫èÂàóÁöÑÈïøÂ∫¶ÔºåF‰∏∫Â∫èÂàó‰∏≠ÊØè‰∏™Êó∂Èó¥Ê≠•Ôºàtime stepÔºâÁâπÂæÅÁöÑ‰∏™Êï∞ÔºåÊ†πÊçÆ‰ªªÂä°ÁöÑ‰∏çÂêå FÁöÑÁª¥Â∫¶‰ºöÊúâÊâÄ‰∏çÂêå„ÄÇ</p><p><strong>enforce_sorted</strong>ÔºöÂ¶ÇÊûúÊòØ TrueÔºåÂàôËæìÂÖ•Â∫îËØ•ÊòØÊåâÈïøÂ∫¶ÈôçÂ∫èÊéíÂ∫èÁöÑÂ∫èÂàó„ÄÇÂ¶ÇÊûúÊòØ FalseÔºå‰ºöÂú®ÂáΩÊï∞ÂÜÖÈÉ®ËøõË°åÊéíÂ∫è„ÄÇÈªòËÆ§ÂÄº‰∏∫ True „ÄÇ</p><p><strong>ËØ¥Êòé</strong></p><p>Êàë‰ª¨ÁúãÁúã PyTorch ‰∏≠ÁöÑÊ∫êÁ†ÅÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">pack_sequence</span>(<span class="hljs-params">sequences, enforce_sorted=<span class="hljs-literal">True</span></span>): <br>lengths = torch.as_tensor([v.size(<span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> sequences]) <br><span class="hljs-keyword">return</span> pack_padded_sequence(pad_sequence(sequences),lengths,enforce_sorted=enforce_sorted)<br></code></pre></div></td></tr></table></figure><p>ÂèØ‰ª•ÁúãÂá∫ pack_sequence ÂÆûÈôÖ‰∏äÂ∞±ÊòØÂØπ pad_sequence Âíåpack_padded_sequenceÊìç‰ΩúÁöÑ‰∏Ä‰∏™Â∞ÅË£Ö„ÄÇÈÄöËøá‰∏Ä‰∏™ÂáΩÊï∞ÂÆåÊàê‰∫Ü‰∏§Ê≠•ÊâçËÉΩÂÆåÊàêÁöÑÂ∑•‰Ωú„ÄÇ</p><p><strong>Á§∫‰æã</strong></p><p>ÂâçÈù¢ÁöÑ collate_fn ÂáΩÊï∞ÂèØ‰ª•Ëøõ‰∏ÄÊ≠•‰øÆÊîπ‰∏∫Ôºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">collate_fn</span>(<span class="hljs-params">data</span>):<br>    data.sort(key=<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">len</span>(x), reverse=<span class="hljs-literal">True</span>)<br>   <br>    data = pack_sequence(data)<br>    <span class="hljs-comment">#seq_len = [s.size(0) for s in data]</span><br>    <span class="hljs-comment">#data = pad_sequence(data, batch_first=True)    </span><br>    <span class="hljs-comment">#data = pack_padded_sequence(data, seq_len, batch_first=True)</span><br>    <span class="hljs-keyword">return</span> data<br></code></pre></div></td></tr></table></figure><p>ËæìÂá∫ÁªìÊûú‰∏éÂâçÈù¢Áõ∏ÂêåÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># batch_x</span><br>PackedSequence(data=tensor([<span class="hljs-number">1</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]), <br>               batch_sizes=tensor([<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]), <br>               sorted_indices=<span class="hljs-literal">None</span>, unsorted_indices=<span class="hljs-literal">None</span>)<br></code></pre></div></td></tr></table></figure><h2 id="pad_packed_sequence">22„ÄÅpad_packed_sequence</h2><p><strong>ÂèÇÊï∞</strong></p><p><strong>sequences</strong>ÔºöPackedSequence ÂØπË±°ÔºåÂ∞ÜË¶ÅË¢´Â°´ÂÖÖÁöÑ batchÔºõ</p><p><strong>batch_first</strong>Ôºö‰∏ÄËà¨ËÆæÁΩÆ‰∏∫ TrueÔºåËøîÂõûÁöÑÊï∞ÊçÆÊ†ºÂºè‰∏∫[batch_size, seq_len, feature] Ôºõ</p><p><strong>padding_value</strong>ÔºöÂ°´ÂÖÖÂÄºÔºõ</p><p><strong>total_length</strong>ÔºöÂ¶ÇÊûú‰∏çÊòØ<code>None</code>ÔºåËæìÂá∫Â∞ÜË¢´Â°´ÂÖÖÂà∞ÈïøÂ∫¶Ôºö<code>total_length</code>„ÄÇ</p><p><strong>ËØ¥Êòé</strong></p><p>Â¶ÇÊûúÂú®ÂñÇÁªôÁΩëÁªúÊï∞ÊçÆÁöÑÊó∂ÂÄôÔºåÁî®‰∫Ü pack_sequence ËøõË°åÊâìÂåÖÔºåpytorch ÁöÑ RNN‰πü‰ºöÊääËæìÂá∫ out ÊâìÂåÖÊàê‰∏Ä‰∏™ PackedSequence ÂØπË±°„ÄÇ</p><p>Ëøô‰∏™ÂáΩÊï∞ÂÆûÈôÖ‰∏äÊòØ pack_padded_sequenceÂáΩÊï∞ÁöÑÈÄÜÂêëÊìç‰Ωú„ÄÇÂ∞±ÊòØÊääÂéãÁ¥ßÁöÑÂ∫èÂàóÂÜçÂ°´ÂÖÖÂõûÊù•„ÄÇ</p><p>‰∏∫Âï•Ë¶ÅÂ°´ÂÖÖÂõûÊù•Âë¢ÔºüÊàëÁöÑÁêÜËß£ÊòØÔºåÂú® collate_fn ÂáΩÊï∞ÈáåÈù¢ÈÄöÂ∏∏‰πü‰ºöË∞ÉÁî®pad_sequence ÂØπ label ËøõË°åÂ°´ÂÖÖÔºåRNN ÁöÑËæìÂá∫ÁªìÊûú‰∏∫‰∫ÜÂíå labelÂØπÈΩêÔºåÈúÄË¶ÅÂ∞ÜÂéãÁ¥ßÁöÑÂ∫èÂàóÂÜçÂ°´ÂÖÖÂõûÊù•ÔºåÊñπ‰æøÂêéÁª≠ÁöÑËÆ°ÁÆó„ÄÇ</p><p><strong>Á§∫‰æã</strong></p><p>ÈúÄË¶ÅËØ¥ÊòéÁöÑÊòØÔºå‰∏ãÈù¢ÁöÑÁ®ãÂ∫è‰∏≠Ôºå‰∏∫‰∫Ü‰∫ßÁîüÁ¨¶Âêà LSTM ËæìÂÖ•Ê†ºÂºè [batch_size,seq_len, feature] ÁöÑÊï∞ÊçÆÔºå‰ΩøÁî®‰∫ÜÂáΩÊï∞ unsqueeze ËøõË°åÂçáÁª¥Â§ÑÁêÜ„ÄÇÂÖ∂‰∏≠Ôºåbatch_size ÊòØ<strong>Ê†∑Êú¨Êï∞</strong>Ôºåseq_lenÊòØ<strong>Â∫èÂàóÈïøÂ∫¶</strong>Ôºåfeature ÊòØ<strong>ÁâπÂæÅÊï∞</strong>„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyData</span>(<span class="hljs-title class_ inherited__">Dataset</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data</span>):<br>        self.data = data<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.data)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, idx</span>):<br>        <span class="hljs-keyword">return</span> self.data[idx]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">collate_fn</span>(<span class="hljs-params">data</span>):<br>    data.sort(key=<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">len</span>(x), reverse=<span class="hljs-literal">True</span>)<br>    seq_len = [s.size(<span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> data]<br>    data = pad_sequence(data, batch_first=<span class="hljs-literal">True</span>).<span class="hljs-built_in">float</span>()    <br>    data = data.unsqueeze(-<span class="hljs-number">1</span>)<br>    data = pack_padded_sequence(data, seq_len, batch_first=<span class="hljs-literal">True</span>)<br>    <span class="hljs-keyword">return</span> data<br><br>a = torch.tensor([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])<br>b = torch.tensor([<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>])<br>c = torch.tensor([<span class="hljs-number">7</span>,<span class="hljs-number">8</span>])<br>d = torch.tensor([<span class="hljs-number">9</span>])<br>train_x = [a, b, c, d]<br><br>data = MyData(train_x)<br>data_loader = DataLoader(data, batch_size=<span class="hljs-number">2</span>, shuffle=<span class="hljs-literal">True</span>, collate_fn=collate_fn)<br>batch_x = <span class="hljs-built_in">iter</span>(data_loader).<span class="hljs-built_in">next</span>()<br><br>rnn = nn.LSTM(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, batch_first=<span class="hljs-literal">True</span>)<br>h0 = torch.rand(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>).<span class="hljs-built_in">float</span>()<br>c0 = torch.rand(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>).<span class="hljs-built_in">float</span>()<br>out, (h1, c1) = rnn(batch_x, (h0, c0))<br></code></pre></div></td></tr></table></figure><p>ÂæóÂà∞ out ÁöÑÁªìÊûúÂ¶Ç‰∏ãÔºåÊòØ‰∏Ä‰∏™ PackedSequence Á±ªÂûãÁöÑÂØπË±°Ôºå‰∏éÂâçÈù¢Ë∞ÉÁî®pack_padded_sequence ÂæóÂà∞ÁöÑÁªìÊûúÁ±ªÂûãÁõ∏Âêå„ÄÇ</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># out</span><br>PackedSequence(data=tensor([[-<span class="hljs-number">1.3302e-04</span>,  <span class="hljs-number">5.7754e-02</span>,  <span class="hljs-number">4.3181e-02</span>,  <span class="hljs-number">6.4226e-02</span>],<br>        [-<span class="hljs-number">2.8673e-02</span>,  <span class="hljs-number">3.9089e-02</span>, -<span class="hljs-number">2.6875e-03</span>,  <span class="hljs-number">4.2686e-03</span>],<br>        [-<span class="hljs-number">1.0216e-01</span>,  <span class="hljs-number">2.5236e-02</span>, -<span class="hljs-number">1.2230e-01</span>,  <span class="hljs-number">5.1524e-02</span>],<br>        [-<span class="hljs-number">1.6211e-01</span>,  <span class="hljs-number">2.1079e-02</span>, -<span class="hljs-number">1.5849e-01</span>,  <span class="hljs-number">5.2800e-02</span>],<br>        [-<span class="hljs-number">1.5774e-01</span>,  <span class="hljs-number">2.6749e-02</span>, -<span class="hljs-number">1.3333e-01</span>,  <span class="hljs-number">4.7894e-02</span>]],<br>       grad_fn=&lt;CatBackward&gt;), <br>       batch_sizes=tensor([<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>]), <br>       sorted_indices=<span class="hljs-literal">None</span>, unsorted_indices=<span class="hljs-literal">None</span>)<br></code></pre></div></td></tr></table></figure><p>ÂØπ out Ë∞ÉÁî® pad_packed_sequence ËøõË°åÂ°´ÂÖÖÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">out_pad, out_len = pad_packed_sequence(out, batch_first=<span class="hljs-literal">True</span>)<br></code></pre></div></td></tr></table></figure><p>out_pad Âíå out_len ÁöÑÁªìÊûúÂ¶Ç‰∏ãÔºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># out_pad </span><br>tensor([[[-<span class="hljs-number">1.3302e-04</span>,  <span class="hljs-number">5.7754e-02</span>,  <span class="hljs-number">4.3181e-02</span>,  <span class="hljs-number">6.4226e-02</span>],<br>         [-<span class="hljs-number">1.0216e-01</span>,  <span class="hljs-number">2.5236e-02</span>, -<span class="hljs-number">1.2230e-01</span>,  <span class="hljs-number">5.1524e-02</span>],<br>         [-<span class="hljs-number">1.6211e-01</span>,  <span class="hljs-number">2.1079e-02</span>, -<span class="hljs-number">1.5849e-01</span>,  <span class="hljs-number">5.2800e-02</span>],<br>         [-<span class="hljs-number">1.5774e-01</span>,  <span class="hljs-number">2.6749e-02</span>, -<span class="hljs-number">1.3333e-01</span>,  <span class="hljs-number">4.7894e-02</span>]],<br><br>        [[-<span class="hljs-number">2.8673e-02</span>,  <span class="hljs-number">3.9089e-02</span>, -<span class="hljs-number">2.6875e-03</span>,  <span class="hljs-number">4.2686e-03</span>],<br>         [ <span class="hljs-number">0.0000e+00</span>,  <span class="hljs-number">0.0000e+00</span>,  <span class="hljs-number">0.0000e+00</span>,  <span class="hljs-number">0.0000e+00</span>],<br>         [ <span class="hljs-number">0.0000e+00</span>,  <span class="hljs-number">0.0000e+00</span>,  <span class="hljs-number">0.0000e+00</span>,  <span class="hljs-number">0.0000e+00</span>],<br>         [ <span class="hljs-number">0.0000e+00</span>,  <span class="hljs-number">0.0000e+00</span>,  <span class="hljs-number">0.0000e+00</span>,  <span class="hljs-number">0.0000e+00</span>]]],<br>       grad_fn=&lt;TransposeBackward0&gt;)<br><br><span class="hljs-comment"># out_len</span><br>tensor([<span class="hljs-number">4</span>, <span class="hljs-number">1</span>])<br></code></pre></div></td></tr></table></figure><p>ÂÜçÂõûÊÉ≥‰∏ãÊàë‰ª¨Ë∞ÉÁî® pad_sequence Â°´ÂÖÖ‰πãÂêéÁöÑËæìÂÖ•Ôºö</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># batch_x</span><br>tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>],<br>        [<span class="hljs-number">9</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]])<br></code></pre></div></td></tr></table></figure><p>Ëøô‰∏™ out_pad ÁªìÊûúÂÖ∂ÂÆûÂ∞±ÂíåÊàë‰ª¨Â°´ÂÖÖ‰πãÂêéÁöÑËæìÂÖ•ÂØπÂ∫îËµ∑Êù•‰∫Ü„ÄÇ</p><h2 id="cat">22„ÄÅcat</h2><p>Âá∫‰∫Ü‰∏§‰∏™Âº†ÈáèAÂíåBÔºåÂàÜÂà´ÊòØ2Ë°å3ÂàóÔºå4Ë°å3Âàó„ÄÇÂç≥‰ªñ‰ª¨ÈÉΩÊòØ2Áª¥Âº†Èáè„ÄÇÂõ†‰∏∫Âè™Êúâ‰∏§Áª¥ÔºåËøôÊ†∑Âú®Áî®torch.catÊãºÊé•ÁöÑÊó∂ÂÄôÂ∞±Êúâ‰∏§ÁßçÊãºÊé•ÊñπÂºèÔºöÊåâË°åÊãºÊé•ÂíåÊåâÂàóÊãºÊé•„ÄÇÂç≥ÊâÄË∞ìÁöÑÁª¥Êï∞0ÂíåÁª¥Êï∞1.</p><p>C=torch.cat((A,B),0)Â∞±Ë°®Á§∫ÊåâÁª¥Êï∞0ÔºàË°åÔºâÊãºÊé•AÂíåBÔºå‰πüÂ∞±ÊòØÁ´ñÁùÄÊãºÊé•ÔºåA‰∏äB‰∏ã„ÄÇÊ≠§Êó∂ÈúÄË¶ÅÊ≥®ÊÑèÔºöÂàóÊï∞ÂøÖÈ°ª‰∏ÄËá¥ÔºåÂç≥Áª¥Êï∞1Êï∞ÂÄºË¶ÅÁõ∏ÂêåÔºåËøôÈáåÈÉΩÊòØ3ÂàóÔºåÊñπËÉΩÂàóÂØπÈΩê„ÄÇÊãºÊé•ÂêéÁöÑCÁöÑÁ¨¨0Áª¥ÊòØ‰∏§‰∏™Áª¥Êï∞0Êï∞ÂÄºÂíåÔºåÂç≥2+4=6</p><p>C=torch.cat((A,B),1)Â∞±Ë°®Á§∫ÊåâÁª¥Êï∞1ÔºàÂàóÔºâÊãºÊé•AÂíåBÔºå‰πüÂ∞±ÊòØÊ®™ÁùÄÊãºÊé•ÔºåAÂ∑¶BÂè≥„ÄÇÊ≠§Êó∂ÈúÄË¶ÅÊ≥®ÊÑèÔºöË°åÊï∞ÂøÖÈ°ª‰∏ÄËá¥ÔºåÂç≥Áª¥Êï∞0Êï∞ÂÄºË¶ÅÁõ∏ÂêåÔºåËøôÈáåÈÉΩÊòØ2Ë°åÔºåÊñπËÉΩË°åÂØπÈΩê„ÄÇÊãºÊé•ÂêéÁöÑCÁöÑÁ¨¨1Áª¥ÊòØ‰∏§‰∏™Áª¥Êï∞1Êï∞ÂÄºÂíåÔºåÂç≥3+4=7</p><h2 id="torch.split">23„ÄÅtorch.split</h2><p><code>torch.split(tensor, split_size_or_sections, dim=0)</code></p><p>torch.split()‰ΩúÁî®Â∞ÜtensorÂàÜÊàêÂùóÁªìÊûÑ„ÄÇ</p><p>ÂèÇÊï∞Ôºö</p><ul><li>tesnorÔºöinputÔºåÂæÖÂàÜËæìÂÖ•</li><li>split_size_or_sectionsÔºöÈúÄË¶ÅÂàáÂàÜÁöÑÂ§ßÂ∞è(int or list )</li><li>dimÔºöÂàáÂàÜÁª¥Â∫¶</li><li>outputÔºöÂàáÂàÜÂêéÂùóÁªìÊûÑ &lt;class 'tuple'&gt;</li><li>ÂΩìsplit_size_or_sections‰∏∫<strong>int</strong>Êó∂ÔºåtenorÁªìÊûÑÂíåsplit_size_or_sectionsÔºåÊ≠£Â•ΩÂåπÈÖçÔºåÈÇ£‰πàouputÂ∞±ÊòØÂ§ßÂ∞èÁõ∏ÂêåÁöÑÂùóÁªìÊûÑ„ÄÇÂ¶ÇÊûúÊåâÁÖßsplit_size_or_sectionsÁªìÊûÑÔºåtensor‰∏çÂ§ü‰∫ÜÔºåÈÇ£‰πàÂ∞±ÊääÂâ©‰∏ãÁöÑÈÇ£ÈÉ®ÂàÜÂÅö‰∏Ä‰∏™ÂùóÂ§ÑÁêÜ„ÄÇ</li><li>ÂΩìsplit_size_or_sections‰∏∫<strong>list</strong>Êó∂ÔºåÈÇ£‰πàtensorÁªìÊûÑ‰ºö‰∏ÄÂÖ±ÂàáÂàÜÊàêlen(list)Ëøô‰πàÂ§öÁöÑÂ∞èÂùóÔºåÊØè‰∏™Â∞èÂùó‰∏≠ÁöÑÂ§ßÂ∞èÊåâÁÖßlist‰∏≠ÁöÑÂ§ßÂ∞èÂÜ≥ÂÆöÔºåÂÖ∂‰∏≠list‰∏≠ÁöÑÊï∞Â≠óÊÄªÂíåÂ∫îÁ≠â‰∫éËØ•Áª¥Â∫¶ÁöÑÂ§ßÂ∞èÔºåÂê¶Âàô‰ºöÊä•ÈîôÔºàÊ≥®ÊÑèËøôÈáå‰∏ésplit_size_or_sections‰∏∫intÊó∂ÁöÑÊÉÖÂÜµ‰∏çÂêåÔºâ„ÄÇ</li></ul><h2id="torch.squeezeÂíåtorch.unsqueeze">24„ÄÅtorch.squeezeÂíåtorch.unsqueeze</h2><p>‚ºÄ„ÄÅÂÖàÁúãtorch.squeeze()Ëøô‰∏™ÂáΩÊï∞‰∏ªË¶ÅÂØπÊï∞ÊçÆÁöÑÁª¥Â∫¶Ëøõ‚æèÂéãÁº©ÔºåÂéªÊéâÁª¥Êï∞‰∏∫1ÁöÑÁöÑÁª¥Â∫¶Ôºå‚ΩêÂ¶ÇÊòØ‚ºÄ‚æèÊàñËÄÖ‚ºÄÂàóËøôÁßçÔºå‚ºÄ‰∏™‚ºÄ‚æè‰∏âÂàóÔºà1,3ÔºâÁöÑÊï∞ÂéªÊéâÁ¨¨‚ºÄ‰∏™Áª¥Êï∞‰∏∫‚ºÄÁöÑÁª¥Â∫¶‰πãÂêéÂ∞±ÂèòÊàêÔºà3Ôºâ‚æè„ÄÇ</p><ul><li>1.squeeze(a)Â∞±ÊòØÂ∞Üa‰∏≠ÊâÄÊúâ‰∏∫1ÁöÑÁª¥Â∫¶Âà†Êéâ„ÄÇ‰∏ç‰∏∫1ÁöÑÁª¥Â∫¶Ê≤°ÊúâÂΩ±Âìç„ÄÇ</li><li>2.a.squeeze(N) Â∞±ÊòØÂéªÊéâa‰∏≠ÊåáÂÆöÁöÑÁª¥Êï∞‰∏∫‚ºÄÁöÑÁª¥Â∫¶„ÄÇ</li><li>3.ËøòÊúâ‚ºÄÁßçÂΩ¢ÂºèÂ∞±ÊòØb=torch.squeeze(aÔºåN)a‰∏≠ÂéªÊéâÊåáÂÆöÁöÑÁª¥Êï∞N‰∏∫‚ºÄÁöÑÁª¥Â∫¶„ÄÇ</li></ul><p>‚ºÜ„ÄÅÂÜçÁúãtorch.unsqueeze()Ëøô‰∏™ÂáΩÊï∞‰∏ªË¶ÅÊòØÂØπÊï∞ÊçÆÁª¥Â∫¶Ëøõ‚æèÊâ©ÂÖÖ„ÄÇ</p><ul><li>1.ÁªôÊåáÂÆö‰ΩçÁΩÆÂä†‰∏äÁª¥Êï∞‰∏∫‚ºÄÁöÑÁª¥Â∫¶Ôºå‚ΩêÂ¶ÇÂéüÊú¨Êúâ‰∏™‰∏â‚æèÁöÑÊï∞ÊçÆÔºà3ÔºâÔºåÂú®0ÁöÑ‰ΩçÁΩÆÂä†‰∫Ü‚ºÄÁª¥Â∞±ÂèòÊàê‚ºÄ‚æè‰∏âÂàóÔºà1,3Ôºâ„ÄÇa.unsqueeze(N)Â∞±ÊòØÂú®a‰∏≠ÊåáÂÆö‰ΩçÁΩÆNÂä†‰∏ä‚ºÄ‰∏™Áª¥Êï∞‰∏∫1ÁöÑÁª¥Â∫¶„ÄÇ</li><li>2.ËøòÊúâ‚ºÄÁßçÂΩ¢ÂºèÂ∞±ÊòØb=torch.unsqueeze(aÔºåN)aÂ∞±ÊòØÂú®a‰∏≠ÊåáÂÆö‰ΩçÁΩÆNÂä†‰∏ä‚ºÄ‰∏™Áª¥Êï∞‰∏∫1ÁöÑÁª¥Â∫¶</li></ul><h2 id="nn.embedding">25„ÄÅnn.Embedding</h2><p><code>torch.nn.Embedding(num_embeddings, embedding_dim, padding_idx=None,max_norm=None,  norm_type=2.0,   scale_grad_by_freq=False, sparse=False,  _weight=None)</code></p><p>ÂÖ∂‰∏∫‰∏Ä‰∏™ÁÆÄÂçïÁöÑÂ≠òÂÇ®Âõ∫ÂÆöÂ§ßÂ∞èÁöÑËØçÂÖ∏ÁöÑÂµåÂÖ•ÂêëÈáèÁöÑÊü•ÊâæË°®ÔºåÊÑèÊÄùÂ∞±ÊòØËØ¥ÔºåÁªô‰∏Ä‰∏™ÁºñÂè∑ÔºåÂµåÂÖ•Â±ÇÂ∞±ËÉΩËøîÂõûËøô‰∏™ÁºñÂè∑ÂØπÂ∫îÁöÑÂµåÂÖ•ÂêëÈáèÔºåÂµåÂÖ•ÂêëÈáèÂèçÊò†‰∫ÜÂêÑ‰∏™ÁºñÂè∑‰ª£Ë°®ÁöÑÁ¨¶Âè∑‰πãÈó¥ÁöÑËØ≠‰πâÂÖ≥Á≥ª„ÄÇ</p><p>ËæìÂÖ•‰∏∫‰∏Ä‰∏™ÁºñÂè∑ÂàóË°®ÔºåËæìÂá∫‰∏∫ÂØπÂ∫îÁöÑÁ¨¶Âè∑ÂµåÂÖ•ÂêëÈáèÂàóË°®„ÄÇ</p><p><strong>ÂèÇÊï∞Ëß£Èáä</strong></p><ul><li>num_embeddings (python:int) ‚ÄìËØçÂÖ∏ÁöÑÂ§ßÂ∞èÂ∞∫ÂØ∏ÔºåÊØîÂ¶ÇÊÄªÂÖ±Âá∫Áé∞5000‰∏™ËØçÔºåÈÇ£Â∞±ËæìÂÖ•5000„ÄÇÊ≠§Êó∂index‰∏∫Ôºà0-4999Ôºâ</li><li>embedding_dim (python:int) ‚ÄìÂµåÂÖ•ÂêëÈáèÁöÑÁª¥Â∫¶ÔºåÂç≥Áî®Â§öÂ∞ëÁª¥Êù•Ë°®Á§∫‰∏Ä‰∏™Á¨¶Âè∑„ÄÇ</li><li>padding_idx (python:int, optional) ‚ÄìÂ°´ÂÖÖidÔºåÊØîÂ¶ÇÔºåËæìÂÖ•ÈïøÂ∫¶‰∏∫100Ôºå‰ΩÜÊòØÊØèÊ¨°ÁöÑÂè•Â≠êÈïøÂ∫¶Âπ∂‰∏ç‰∏ÄÊ†∑ÔºåÂêéÈù¢Â∞±ÈúÄË¶ÅÁî®Áªü‰∏ÄÁöÑÊï∞Â≠óÂ°´ÂÖÖÔºåËÄåËøôÈáåÂ∞±ÊòØÊåáÂÆöËøô‰∏™Êï∞Â≠óÔºåËøôÊ†∑ÔºåÁΩëÁªúÂú®ÈÅáÂà∞Â°´ÂÖÖidÊó∂ÔºåÂ∞±‰∏ç‰ºöËÆ°ÁÆóÂÖ∂‰∏éÂÖ∂ÂÆÉÁ¨¶Âè∑ÁöÑÁõ∏ÂÖ≥ÊÄß„ÄÇ<strong>ÔºàÂàùÂßãÂåñ‰∏∫0Ôºâ</strong></li><li>max_norm (python:float, optional) ‚ÄìÊúÄÂ§ßËåÉÊï∞ÔºåÂ¶ÇÊûúÂµåÂÖ•ÂêëÈáèÁöÑËåÉÊï∞Ë∂ÖËøá‰∫ÜËøô‰∏™ÁïåÈôêÔºåÂ∞±Ë¶ÅËøõË°åÂÜçÂΩí‰∏ÄÂåñ„ÄÇ</li><li>norm_type (python:float, optional) ‚ÄìÊåáÂÆöÂà©Áî®‰ªÄ‰πàËåÉÊï∞ËÆ°ÁÆóÔºåÂπ∂Áî®‰∫éÂØπÊØîmax_normÔºåÈªòËÆ§‰∏∫2ËåÉÊï∞„ÄÇ</li><li>scale_grad_by_freq (boolean, optional) ‚ÄìÊ†πÊçÆÂçïËØçÂú®mini-batch‰∏≠Âá∫Áé∞ÁöÑÈ¢ëÁéáÔºåÂØπÊ¢ØÂ∫¶ËøõË°åÊîæÁº©„ÄÇÈªòËÆ§‰∏∫False.</li><li>sparse (bool, optional) ‚ÄìËã•‰∏∫True,Âàô‰∏éÊùÉÈáçÁü©ÈòµÁõ∏ÂÖ≥ÁöÑÊ¢ØÂ∫¶ËΩ¨Âèò‰∏∫Á®ÄÁñèÂº†Èáè„ÄÇ</li></ul><h2 id="torch.bmm">26„ÄÅtorch.bmm</h2><p>ËÆ°ÁÆó‰∏§‰∏™torchÁöÑÁü©Èòµ‰πòÊ≥ï</p><p>ÂáΩÊï∞ÂÆö‰πâÔºö</p><p><code>def bmm(self: Tensor,mat2: Tensor,*,out: Optional[Tensor] = None) -&gt; Tensor</code></p><p>ÂáΩÊï∞ÁöÑ‰º†ÂÖ•ÂèÇÊï∞ÂæàÁÆÄÂçïÔºå‰∏§‰∏™‰∏âÁª¥<ahref="https://so.csdn.net/so/search?q=Áü©Èòµ&amp;spm=1001.2101.3001.7020">Áü©Èòµ</a>ËÄåÂ∑≤ÔºåÂè™ÊòØË¶ÅÊ≥®ÊÑèËøô‰∏§‰∏™Áü©ÈòµÁöÑshapeÊúâ‰∏Ä‰∫õË¶ÅÊ±ÇÔºö</p><p><code>res = torch.bmm(ma, mb)</code></p><p><code>ma: [a, b, c]</code></p><p><code>mb: [a, c, d]</code></p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Á∫øÊÄßÊ®°Âûã</title>
    <link href="/2022/04/26/%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B/"/>
    <url>/2022/04/26/%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Á∫øÊÄßÊ®°Âûã">Á∫øÊÄßÊ®°Âûã</h1><h2 id="Á∫øÊÄßÂõûÂΩí">1„ÄÅÁ∫øÊÄßÂõûÂΩí</h2><p>ÂÅáÂ¶ÇÂí±‰ª¨Êúâ‰∏Ä‰∏™Êï∞ÊçÆÈõÜÔºåÈáåÈù¢ÁöÑÊï∞ÊçÆÊòØ‰øÑÂãíÂÜàÂ∑ûÊ≥¢ÁâπÂÖ∞Â∏ÇÁöÑ <spanclass="math inline">\(47\)</span> Â•óÊàøÂ±ãÁöÑÈù¢ÁßØÂíå‰ª∑Ê†ºÔºö</p><table><thead><tr class="header"><th style="text-align: center;">Â±Ö‰ΩèÈù¢ÁßØÔºàÂπ≥ÊñπËã±Â∞∫Ôºâ</th><th style="text-align: center;">‰ª∑Ê†ºÔºàÂçÉÁæéÂÖÉÔºâ</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><spanclass="math inline">\(2104\)</span></td><td style="text-align: center;"><spanclass="math inline">\(400\)</span></td></tr><tr class="even"><td style="text-align: center;"><spanclass="math inline">\(1600\)</span></td><td style="text-align: center;"><spanclass="math inline">\(330\)</span></td></tr><tr class="odd"><td style="text-align: center;"><spanclass="math inline">\(2400\)</span></td><td style="text-align: center;"><spanclass="math inline">\(369\)</span></td></tr><tr class="even"><td style="text-align: center;"><spanclass="math inline">\(1416\)</span></td><td style="text-align: center;"><spanclass="math inline">\(232\)</span></td></tr><tr class="odd"><td style="text-align: center;"><spanclass="math inline">\(3000\)</span></td><td style="text-align: center;"><spanclass="math inline">\(540\)</span></td></tr><tr class="even"><td style="text-align: center;">‚Ä¶‚Ä¶</td><td style="text-align: center;">‚Ä¶‚Ä¶</td></tr></tbody></table><p><img src="/img/Á∫øÊÄßÊ®°Âûã/1.png" /></p><p>Â¶ÇÊûúÊù•‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑÈù¢ÁßØÔºåÂÅáËÆæÂú®ÈîÄÂîÆ‰ª∑Èí±ÁöÑËÆ∞ÂΩï‰∏≠Ê≤°ÊúâÁöÑÔºåÊàë‰ª¨ÊÄé‰πàÂäûÂë¢Ôºü</p><p>Êàë‰ª¨ÂèØ‰ª•Áî®‰∏ÄÊù°Êõ≤Á∫øÂéªÂ∞ΩÈáèÂáÜÁöÑÊãüÂêàËøô‰∫õÊï∞ÊçÆÔºåÁÑ∂ÂêéÂ¶ÇÊûúÊúâÊñ∞ÁöÑËæìÂÖ•ËøáÊù•ÔºåÊàë‰ª¨ÂèØ‰ª•Â∞ÜÊõ≤Á∫ø‰∏äËøô‰∏™ÁÇπÂØπÂ∫îÁöÑÂÄºËøîÂõû„ÄÇËøôÂ∞±ÊòØÁ∫øÊÄßÂõûÂΩíÁöÑÊÄùÊÉ≥„ÄÇ</p><p>‰∏∫‰∫ÜËÆ©Êàë‰ª¨ÁöÑÊàøÂ±ãÊ°à‰æãÊõ¥ÊúâÊÑèÊÄùÔºåÂí±‰ª¨Á®çÂæÆÂØπÊï∞ÊçÆÈõÜËøõË°å‰∏Ä‰∏ãË°•ÂÖÖÔºåÂ¢ûÂä†‰∏äÊØè‰∏Ä‰∏™ÊàøÂ±ãÁöÑÂçßÂÆ§Êï∞ÁõÆÔºö</p><table><thead><tr class="header"><th style="text-align: center;">Â±Ö‰ΩèÈù¢ÁßØÔºàÂπ≥ÊñπËã±Â∞∫Ôºâ</th><th style="text-align: center;">ÂçßÂÆ§Êï∞ÁõÆ</th><th style="text-align: center;">‰ª∑Ê†ºÔºàÂçÉÁæéÂÖÉÔºâ</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><spanclass="math inline">\(2104\)</span></td><td style="text-align: center;"><spanclass="math inline">\(3\)</span></td><td style="text-align: center;"><spanclass="math inline">\(400\)</span></td></tr><tr class="even"><td style="text-align: center;"><spanclass="math inline">\(1600\)</span></td><td style="text-align: center;"><spanclass="math inline">\(3\)</span></td><td style="text-align: center;"><spanclass="math inline">\(330\)</span></td></tr><tr class="odd"><td style="text-align: center;"><spanclass="math inline">\(2400\)</span></td><td style="text-align: center;"><spanclass="math inline">\(3\)</span></td><td style="text-align: center;"><spanclass="math inline">\(369\)</span></td></tr><tr class="even"><td style="text-align: center;"><spanclass="math inline">\(1416\)</span></td><td style="text-align: center;"><spanclass="math inline">\(2\)</span></td><td style="text-align: center;"><spanclass="math inline">\(232\)</span></td></tr><tr class="odd"><td style="text-align: center;"><spanclass="math inline">\(3000\)</span></td><td style="text-align: center;"><spanclass="math inline">\(4\)</span></td><td style="text-align: center;"><spanclass="math inline">\(540\)</span></td></tr><tr class="even"><td style="text-align: center;">‚Ä¶‚Ä¶</td><td style="text-align: center;">‚Ä¶‚Ä¶</td><td style="text-align: center;">‚Ä¶‚Ä¶</td></tr></tbody></table><p>‰πüÊòØÂêåÊ†∑ÁöÑÊñπÊ≥ïÔºåÊ≠§Êó∂ÁöÑËá™ÂèòÈáèÂ∞±ÂèòÊàê‰∫Ü‰∫åÁª¥ÂêëÈáè„ÄÇ</p><p>‰∏ãÈù¢ÊòØ‰∏Ä‰∏™ÂÖ∏ÂûãÁöÑÊú∫Âô®Â≠¶‰π†ÁöÑËøáÁ®ãÔºåÈ¶ñÂÖàÁªôÂá∫‰∏Ä‰∏™ËæìÂÖ•Êï∞ÊçÆÔºåÊàë‰ª¨ÁöÑÁÆóÊ≥ï‰ºöÈÄöËøá‰∏ÄÁ≥ªÂàóÁöÑËøáÁ®ãÂæóÂà∞‰∏Ä‰∏™‰º∞ËÆ°ÁöÑÂáΩÊï∞ÔºåËøô‰∏™ÂáΩÊï∞ÊúâËÉΩÂäõÂØπÊ≤°ÊúâËßÅËøáÁöÑÊñ∞Êï∞ÊçÆÁªôÂá∫‰∏Ä‰∏™Êñ∞ÁöÑ‰º∞ËÆ°Ôºå‰πüË¢´Áß∞‰∏∫ÊûÑÂª∫‰∏Ä‰∏™Ê®°Âûã„ÄÇÂ∞±Â¶ÇÂêå‰∏äÈù¢ÁöÑÁ∫øÊÄßÂõûÂΩíÂáΩÊï∞„ÄÇ</p><p><img src="/img/Á∫øÊÄßÊ®°Âûã/2.png" /></p><p>Á∫øÊÄßÂõûÂΩíÂÅáËÆæÁâπÂæÅÂíåÁªìÊûúÊª°Ë∂≥Á∫øÊÄßÂÖ≥Á≥ª„ÄÇÂÖ∂ÂÆûÁ∫øÊÄßÂÖ≥Á≥ªÁöÑË°®ËææËÉΩÂäõÈùûÂ∏∏Âº∫Â§ßÔºåÊØè‰∏™ÁâπÂæÅÂØπÁªìÊûúÁöÑÂΩ±ÂìçÂº∫Âº±ÂèØ‰ª•ÊúâÂâçÈù¢ÁöÑÂèÇÊï∞‰ΩìÁé∞ÔºåËÄå‰∏îÊØè‰∏™ÁâπÂæÅÂèòÈáèÂèØ‰ª•È¶ñÂÖàÊò†Â∞ÑÂà∞‰∏Ä‰∏™ÂáΩÊï∞ÔºåÁÑ∂ÂêéÂÜçÂèÇ‰∏éÁ∫øÊÄßËÆ°ÁÆó„ÄÇËøôÊ†∑Â∞±ÂèØ‰ª•Ë°®ËææÁâπÂæÅ‰∏éÁªìÊûú‰πãÈó¥ÁöÑÈùûÁ∫øÊÄßÂÖ≥Á≥ª„ÄÇ</p><p>Êàë‰ª¨Áî®<span class="math inline">\(x_1\)</span>Ôºå<spanclass="math inline">\(x_2\)</span>ÂéªÊèèËø∞featureÈáåÈù¢ÁöÑÂàÜÈáèÔºåÊØîÂ¶Ç <spanclass="math inline">\(x_1\)</span>=Â±Ö‰ΩèÈù¢ÁßØÔºå<spanclass="math inline">\(x_2\)</span>=ÂçßÂÆ§Êï∞ÁõÆÔºåÊàë‰ª¨ÂèØ‰ª•ÂÅöÂá∫‰∏Ä‰∏™‰º∞ËÆ°ÂáΩÊï∞Ôºö<span class="math display">\[h_\theta  (x) = \theta_0 + \theta_1 \times x_1 + \theta_2 \times x_2\]</span> ÁÆÄÂåñ‰∏Ä‰∏ãÂ∞±‰∏∫Ôºö <span class="math display">\[h(x) = \sum^n_{i=0}  \theta_i x_i = \theta^T x\]</span> Êàë‰ª¨Á®ãÂ∫è‰πüÈúÄË¶Å‰∏Ä‰∏™Êú∫Âà∂ÂéªËØÑ‰º∞Êàë‰ª¨<spanclass="math inline">\(\theta\)</span>ÊòØÂê¶ÊØîËæÉÂ•ΩÔºåÊâÄ‰ª•ËØ¥ÈúÄË¶ÅÂØπÊàë‰ª¨ÂÅöÂá∫ÁöÑ<spanclass="math inline">\(h\)</span>ÂáΩÊï∞ËøõË°åËØÑ‰º∞Ôºå‰∏ÄËà¨Ëøô‰∏™ÂáΩÊï∞Áß∞‰∏∫ÊçüÂ§±ÂáΩÊï∞Ôºàloss functionÔºâÊàñËÄÖÈîôËØØÂáΩÊï∞(errorfunction)ÔºåÊèèËø∞<span class="math inline">\(h\)</span>ÂáΩÊï∞‰∏çÂ•ΩÁöÑÁ®ãÂ∫¶ÔºåÂú®‰∏ãÈù¢ÔºåÊàë‰ª¨Áß∞Ëøô‰∏™ÂáΩÊï∞‰∏∫<spanclass="math inline">\(J\)</span>ÂáΩÊï∞Ôºö <span class="math display">\[J(\theta) = \frac 12 \sum^m_{i=1}(h_\theta(x^{(i)})-y^{(i)})^2\]</span> Â¶Ç‰ΩïË∞ÉÊï¥<span class="math inline">\(\theta\)</span>‰ª•‰ΩøÂæó<spanclass="math inline">\(J(\theta)\)</span>ÂèñÂæóÊúÄÂ∞èÂÄºÊúâÂæàÂ§öÊñπÊ≥ïÔºåÂÖ∂‰∏≠ÊúâÊúÄÂ∞è‰∫å‰πòÊ≥ï(leastsquares method)ÂíåÊ¢ØÂ∫¶‰∏ãÈôçÊ≥ïÁ≠â„ÄÇ</p><h3 id="ÊúÄÂ∞è‰∫å‰πòÊ≥ï">1.1 ÊúÄÂ∞è‰∫å‰πòÊ≥ï</h3><p>ÁªôÂÆö‰∏Ä‰∏™ËÆ≠ÁªÉÈõÜÔºåÊää<strong>ËÆæËÆ°Áü©ÈòµÔºàdesign matrixÔºâ</strong> <spanclass="math inline">\(x\)</span> ËÆæÁΩÆ‰∏∫‰∏Ä‰∏™ <spanclass="math inline">\(m\times n\)</span>Áü©ÈòµÔºàÂÆûÈôÖ‰∏äÔºåÂ¶ÇÊûúËÄÉËôëÂà∞Êà™Ë∑ùÈ°πÔºå‰πüÂ∞±ÊòØ <spanclass="math inline">\(\theta_0\)</span> ÈÇ£‰∏ÄÈ°πÔºåÂ∞±Â∫îËØ•ÊòØ <spanclass="math inline">\(m\times (n+1)\)</span>Áü©ÈòµÔºâÔºåËøô‰∏™Áü©ÈòµÈáåÈù¢ÂåÖÂê´‰∫ÜËÆ≠ÁªÉÊ†∑Êú¨ÁöÑËæìÂÖ•ÂÄº‰Ωú‰∏∫ÊØè‰∏ÄË°åÔºö</p><p><span class="math display">\[X =\begin{bmatrix}(x^{(1)}) ^T\\(x^{(2)}) ^T\\\vdots \\(x^{(m)}) ^T\\\end{bmatrix}\]</span></p><p>ÁÑ∂ÂêéÔºåÂí±‰ª¨ËÆæ <span class="math inline">\(\vec{y}\)</span> ÊòØ‰∏Ä‰∏™<span class="math inline">\(m\)</span> Áª¥ÂêëÈáèÔºàm-dimensionalvectorÔºâÔºåÂÖ∂‰∏≠ÂåÖÂê´‰∫ÜËÆ≠ÁªÉÈõÜ‰∏≠ÁöÑÊâÄÊúâÁõÆÊ†áÂÄºÔºö</p><p><span class="math display">\[Y =\begin{bmatrix}y^{(1)}\\y^{(2)}\\\vdots \\y^{(m)}\\\end{bmatrix}\]</span></p><p>ÂÅáËÆæ<span class="math inline">\(h_\theta(x_1,x_2,...,x_m)=\theta_0+\theta_1 \times x_1 + \theta_2 \times x_2 + ... +\theta \timesx_m\)</span>‚Äã ÁöÑÁü©ÈòµË°®ËææÂºè‰∏∫ <span class="math display">\[h_\theta(x)=X_\theta\]</span> ÊçüÂ§±ÂáΩÊï∞ÂÆö‰πâ‰∏∫Ôºö <span class="math display">\[\frac \partial {\partial\theta_j}J(\theta) = \frac12 (X_\theta - Y) ^ T(X_\theta - T)\]</span> ËøôÊó∂ÂÄôÊàë‰ª¨Ë¶ÅÂØπËøô‰∏™ÊçüÂ§±ÂáΩÊï∞ÁöÑ <spanclass="math inline">\(\theta\)</span> ÂêëÈáèËøõË°åÊ±ÇÂØºÂèñ0ÔºåÁªìÊûúÂ¶Ç‰∏ãÂºèÔºö<span class="math display">\[\theta = (X^T X)^{-1} X^T Y\]</span></p><h3 id="Ê¢ØÂ∫¶‰∏ãÈôçÁÆóÊ≥ï">1.2 Ê¢ØÂ∫¶‰∏ãÈôçÁÆóÊ≥ï</h3><p>Êàë‰ª¨Â∏åÊúõÈÄâÊã©‰∏Ä‰∏™ËÉΩËÆ© <span class="math inline">\(J(\theta)\)</span>ÊúÄÂ∞èÁöÑ <span class="math inline">\(\theta\)</span>ÂÄº„ÄÇÊÄé‰πàÂÅöÂë¢ÔºåÂí±‰ª¨ÂÖàÁî®‰∏Ä‰∏™ÊêúÁ¥¢ÁöÑÁÆóÊ≥ïÔºå‰ªéÊüê‰∏Ä‰∏™ÂØπ <spanclass="math inline">\(\theta\)</span> ÁöÑ‚ÄúÂàùÂßãÁåúÊµãÂÄº‚ÄùÔºåÁÑ∂ÂêéÂØπ <spanclass="math inline">\(\theta\)</span> ÂÄº‰∏çÊñ≠ËøõË°åË∞ÉÊï¥ÔºåÊù•ËÆ© <spanclass="math inline">\(J(\theta)\)</span>ÈÄêÊ∏êÂèòÂ∞èÔºåÊúÄÂ•ΩÊòØÁõ¥Âà∞Êàë‰ª¨ËÉΩÂ§üËææÂà∞‰∏Ä‰∏™‰Ωø <spanclass="math inline">\(J(\theta)\)</span> ÊúÄÂ∞èÁöÑ <spanclass="math inline">\(\theta\)</span>„ÄÇÂÖ∑‰ΩìÊù•ËØ¥ÔºåÂí±‰ª¨ÂèØ‰ª•ËÄÉËôë‰ΩøÁî®Ê¢ØÂ∫¶‰∏ãÈôçÊ≥ïÔºàgradientdescent algorithmÔºâÔºåËøô‰∏™ÊñπÊ≥ïÂ∞±ÊòØ‰ªéÊüê‰∏Ä‰∏™ <spanclass="math inline">\(\theta\)</span>ÁöÑÂàùÂßãÂÄºÂºÄÂßãÔºåÁÑ∂ÂêéÈÄêÊ∏êÈáçÂ§çÊõ¥Êñ∞Ôºö</p><p><span class="math display">\[\theta_j := \theta_j - \alpha \frac \partial {\partial\theta_j}J(\theta)\]</span></p><p>Ôºà‰∏äÈù¢ÁöÑËøô‰∏™Êõ¥Êñ∞Ë¶ÅÂêåÊó∂ÂØπÂ∫î‰ªé <span class="math inline">\(0\)</span>Âà∞ <span class="math inline">\(n\)</span> ÁöÑÊâÄÊúâ<spanclass="math inline">\(j\)</span> ÂÄºËøõË°å„ÄÇÔºâËøôÈáåÁöÑ <spanclass="math inline">\(\alpha\)</span>‰πüÁß∞‰∏∫Â≠¶‰π†ÈÄüÁéá„ÄÇËøô‰∏™ÁÆóÊ≥ïÊòØÂæàËá™ÁÑ∂ÁöÑÔºåÈÄêÊ≠•ÈáçÂ§çÊúùÂêë <spanclass="math inline">\(J\)</span> Èôç‰ΩéÊúÄÂø´ÁöÑÊñπÂêëÁßªÂä®„ÄÇ</p><p>Ë¶ÅÂÆûÁé∞Ëøô‰∏™ÁÆóÊ≥ïÔºåÂí±‰ª¨ÈúÄË¶ÅËß£ÂÜ≥Á≠âÂè∑Âè≥ËæπÁöÑÂØºÊï∞È°π„ÄÇÈ¶ñÂÖàÊù•Ëß£ÂÜ≥Âè™Êúâ‰∏ÄÁªÑËÆ≠ÁªÉÊ†∑Êú¨<span class="math inline">\((x, y)\)</span>ÁöÑÊÉÖÂÜµÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ÂøΩÁï•ÊéâÁ≠âÂè∑Âè≥ËæπÂØπ <spanclass="math inline">\(J\)</span> ÁöÑÊ±ÇÂíåÈ°πÁõÆ‰∫Ü„ÄÇÂÖ¨ÂºèÂ∞±ÁÆÄÂåñ‰∏ãÈù¢ËøôÊ†∑Ôºö</p><p><span class="math display">\[\begin{aligned}\frac \partial {\partial\theta_j}J(\theta) &amp; = \frac \partial{\partial\theta_j} \frac  12(h_\theta(x)-y)^2\\&amp; = 2 \cdot\frac 12(h_\theta(x)-y)\cdot \frac \partial{\partial\theta_j}  (h_\theta(x)-y) \\&amp; = (h_\theta(x)-y)\cdot \frac \partial{\partial\theta_j}(\sum^n_{i=0} \theta_ix_i-y) \\&amp; = (h_\theta(x)-y) x_j\end{aligned}\]</span></p><p>ÂØπÂçï‰∏™ËÆ≠ÁªÉÊ†∑Êú¨ÔºåÊõ¥Êñ∞ËßÑÂàôÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö</p><p><span class="math display">\[\theta_j := \theta_j + \alpha (y^{(i)}-h_\theta (x^{(i)}))x_j^{(i)}\]</span></p><p>Á¨¨‰∏ÄÁßçÂ∞±ÊòØ‰∏ãÈù¢Ëøô‰∏™ÁÆóÊ≥ïÔºö</p>$<span class="math display">\[\begin{aligned}&amp;\qquad ÈáçÂ§çÁõ¥Âà∞Êî∂Êïõ \{ \\&amp;\qquad\qquad\theta_j := \theta_j + \alpha\sum^m_{i=1}(y^{(i)}-h_\theta (x^{(i)}))x_j^{(i)}\quad(ÂØπÊØè‰∏™j) \\&amp;\qquad\}\end{aligned}\]</span><p>$</p><p>ËØªËÄÖÂæàÂÆπÊòìËÉΩËØÅÊòéÔºåÂú®‰∏äÈù¢Ëøô‰∏™Êõ¥Êñ∞ËßÑÂàô‰∏≠Ê±ÇÂíåÈ°πÁöÑÂÄºÂ∞±ÊòØ<spanclass="math inline">\(\frac {\partial J(\theta)}{\partial\theta_j}\)</span> ÔºàËøôÊòØÂõ†‰∏∫ÂØπ <span class="math inline">\(J\)</span>ÁöÑÂéüÂßãÂÆö‰πâÔºâ„ÄÇÊâÄ‰ª•Ëøô‰∏™Êõ¥Êñ∞ËßÑÂàôÂÆûÈôÖ‰∏äÂ∞±ÊòØÂØπÂéüÂßãÁöÑÊàêÊú¨ÂáΩÊï∞<spanclass="math inline">\(J\)</span>ËøõË°åÁÆÄÂçïÁöÑÊ¢ØÂ∫¶‰∏ãÈôç„ÄÇËøô‰∏ÄÊñπÊ≥ïÂú®ÊØè‰∏Ä‰∏™Ê≠•ÈïøÂÜÖÊ£ÄÊü•ÊâÄÊúâÊï¥‰∏™ËÆ≠ÁªÉÈõÜ‰∏≠ÁöÑÊâÄÊúâÊ†∑Êú¨Ôºå‰πüÂè´ÂÅö<strong>ÊâπÈáèÊ¢ØÂ∫¶‰∏ãÈôçÊ≥ïÔºàbatchgradientdescent</strong>Ôºâ„ÄÇËøôÈáåË¶ÅÊ≥®ÊÑèÔºåÂõ†‰∏∫Ê¢ØÂ∫¶‰∏ãÈôçÊ≥ïÂÆπÊòìË¢´Â±ÄÈÉ®ÊúÄÂ∞èÂÄºÂΩ±ÂìçÔºåËÄåÊàë‰ª¨Ë¶ÅËß£ÂÜ≥ÁöÑËøô‰∏™Á∫øÊÄßÂõûÂΩíÁöÑ‰ºòÂåñÈóÆÈ¢òÂè™ËÉΩÊúâ‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑËÄå‰∏çÊòØÂ±ÄÈÉ®ÁöÑÊúÄ‰ºòËß£ÔºõÂõ†Ê≠§ÔºåÊ¢ØÂ∫¶‰∏ãÈôçÊ≥ïÂ∫îËØ•ÊÄªÊòØÊî∂ÊïõÂà∞ÂÖ®Â±ÄÊúÄÂ∞èÂÄºÔºàÂÅáËÆæÂ≠¶‰π†ÈÄüÁéá<span class="math inline">\(\alpha\)</span> ‰∏çËÆæÁΩÆÁöÑËøáÂ§ßÔºâ„ÄÇ</p><p>ÂØπÂí±‰ª¨‰πãÂâçÁöÑÊàøÂ±ãÊï∞ÊçÆÈõÜËøõË°åÊâπÈáèÊ¢ØÂ∫¶‰∏ãÈôçÊù•ÊãüÂêà <spanclass="math inline">\(\theta\)</span>ÔºåÊääÊàøÂ±ã‰ª∑Ê†ºÂΩì‰ΩúÊàøÂ±ãÈù¢ÁßØÁöÑÂáΩÊï∞Êù•ËøõË°åÈ¢ÑÊµãÔºåÊàë‰ª¨ÂæóÂà∞ÁöÑÁªìÊûúÊòØ <spanclass="math inline">\(\theta_0 = 71.27, \theta_1 =0.1345\)</span>„ÄÇÂ¶ÇÊûúÊää <spanclass="math inline">\(h_{\theta}(x)\)</span> ‰Ωú‰∏∫‰∏Ä‰∏™ÂÆö‰πâÂüüÂú® <spanclass="math inline">\(x\)</span>‰∏äÁöÑÂáΩÊï∞Êù•ÊäïÂΩ±ÔºåÂêåÊó∂‰πüÊäï‰∏äËÆ≠ÁªÉÈõÜ‰∏≠ÁöÑÂ∑≤ÊúâÊï∞ÊçÆÁÇπÔºå‰ºöÂæóÂà∞‰∏ãÈù¢ËøôÂπÖÂõæÔºö</p><p><img src="/img/Á∫øÊÄßÊ®°Âûã/3.png" /></p><p>Â¶ÇÊûúÂú®Êï∞ÊçÆÈõÜ‰∏≠Ê∑ªÂä†‰∏äÂçßÂÆ§Êï∞ÁõÆ‰Ωú‰∏∫ËæìÂÖ•ÁâπÂæÅÔºåÈÇ£‰πàÂæóÂà∞ÁöÑÁªìÊûúÂ∞±ÊòØ <spanclass="math inline">\(\theta_0 = 89.60, \theta_1 = 0.1392, \theta_2 =‚àí8.738\)</span>‚Äã„ÄÇËøô‰∏™ÁªìÊûúÂ∞±ÊòØÁî®ÊâπÈáèÊ¢ØÂ∫¶‰∏ãÈôçÊ≥ïÊù•Ëé∑ÂæóÁöÑ„ÄÇ</p><p>Ê≠§Â§ñËøòÊúâÂè¶Â§ñ‰∏ÄÁßçÊñπÊ≥ïËÉΩÂ§üÊõø‰ª£ÊâπÈáèÊ¢ØÂ∫¶‰∏ãÈôçÊ≥ïÔºåËøôÁßçÊñπÊ≥ïÊïàÊûú‰πü‰∏çÈîô„ÄÇÂ¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>$<span class="math display">\[\begin{aligned}&amp;\qquadÂæ™ÁéØÔºö\{ \\&amp;\qquad\qquad i‰ªé1Âà∞m,\{   \\&amp;\qquad\qquad\qquad\theta_j :=\theta_j  +\alpha(y^{(i)}-h_{\theta}(x^{(i)}))x_j^{(i)} \qquad(ÂØπÊØè‰∏™ j)\\&amp;\qquad\qquad\}  \\&amp;\qquad\}\end{aligned}\]</span><p>$</p><p>Âú®Ëøô‰∏™ÁÆóÊ≥ïÈáåÔºåÊàë‰ª¨ÂØπÊï¥‰∏™ËÆ≠ÁªÉÈõÜËøõË°å‰∫ÜÂæ™ÁéØÈÅçÂéÜÔºåÊØèÊ¨°ÈÅáÂà∞‰∏Ä‰∏™ËÆ≠ÁªÉÊ†∑Êú¨ÔºåÊ†πÊçÆÊØè‰∏™Âçï‰∏ÄËÆ≠ÁªÉÊ†∑Êú¨ÁöÑËØØÂ∑ÆÊ¢ØÂ∫¶Êù•ÂØπÂèÇÊï∞ËøõË°åÊõ¥Êñ∞„ÄÇËøô‰∏™ÁÆóÊ≥ïÂè´ÂÅö<strong>ÈöèÊú∫Ê¢ØÂ∫¶‰∏ãÈôçÊ≥ïÔºàstochasticgradient descentÔºâ</strong>ÔºåÊàñËÄÖÂè´<strong>Â¢ûÈáèÊ¢ØÂ∫¶‰∏ãÈôçÊ≥ïÔºàincrementalgradientdescentÔºâ</strong>„ÄÇÊâπÈáèÊ¢ØÂ∫¶‰∏ãÈôçÊ≥ïË¶ÅÂú®ËøêË°åÁ¨¨‰∏ÄÊ≠•‰πãÂâçÂÖàÂØπÊï¥‰∏™ËÆ≠ÁªÉÈõÜËøõË°åÊâ´ÊèèÈÅçÂéÜÔºåÂΩìËÆ≠ÁªÉÈõÜÁöÑËßÑÊ®°<span class="math inline">\(m\)</span>ÂèòÂæóÂæàÂ§ßÁöÑÊó∂ÂÄôÔºåÂºïËµ∑ÁöÑÊÄßËÉΩÂºÄÈîÄÂ∞±Âæà‰∏çÂàíÁÆó‰∫ÜÔºõÈöèÊú∫Ê¢ØÂ∫¶‰∏ãÈôçÊ≥ïÂ∞±Ê≤°ÊúâËøô‰∏™ÈóÆÈ¢òÔºåËÄåÊòØÂèØ‰ª•Á´ãÂç≥ÂºÄÂßãÔºåÂØπÊü•ËØ¢Âà∞ÁöÑÊØè‰∏™Ê†∑Êú¨ÈÉΩËøõË°åËøêÁÆó„ÄÇÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåÈöèÊú∫Ê¢ØÂ∫¶‰∏ãÈôçÊ≥ïÊü•ÊâæÂà∞Ë∂≥Â§üÊé•ËøëÊúÄ‰ΩéÂÄºÁöÑ<span class="math inline">\(\theta\)</span>ÁöÑÈÄüÂ∫¶Ë¶ÅÊØîÊâπÈáèÊ¢ØÂ∫¶‰∏ãÈôçÊ≥ïÊõ¥Âø´‰∏Ä‰∫õ„ÄÇÔºà‰πüË¶ÅÊ≥®ÊÑèÔºå‰πüÊúâÂèØËÉΩ‰ºö‰∏ÄÁõ¥Êó†Ê≥ïÊî∂ÊïõÔºàconvergeÔºâÂà∞ÊúÄÂ∞èÂÄºÔºåËøôÊó∂ÂÄô<span class="math inline">\(\theta\)</span> ‰ºö‰∏ÄÁõ¥Âú® <spanclass="math inline">\(J(\theta)\)</span>ÊúÄÂ∞èÂÄºÈôÑËøëÈúáËç°Ôºõ‰∏çËøáÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÂú®ÊúÄÂ∞èÂÄºÈôÑËøëÁöÑËøô‰∫õÂÄºÂ§ßÂ§öÊï∞ÂÖ∂ÂÆû‰πüË∂≥Â§üÈÄºËøë‰∫ÜÔºåË∂≥‰ª•Êª°Ë∂≥Âí±‰ª¨ÁöÑÁ≤æÂ∫¶Ë¶ÅÊ±ÇÔºåÊâÄ‰ª•‰πüÂèØ‰ª•Áî®„ÄÇÔºâÁî±‰∫éËøô‰∫õÂéüÂõ†ÔºåÁâπÂà´ÊòØÂú®ËÆ≠ÁªÉÈõÜÂæàÂ§ßÁöÑÊÉÖÂÜµ‰∏ãÔºåÈöèÊú∫Ê¢ØÂ∫¶‰∏ãÈôçÂæÄÂæÄÊØîÊâπÈáèÊ¢ØÂ∫¶‰∏ãÈôçÊõ¥ÂèóÈùíÁùê„ÄÇ</p>]]></content>
    
    
    <categories>
      
      <category>Machine Learning</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
